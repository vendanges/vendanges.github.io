<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>D3 弦布图 | 琼瑶</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="琼瑶" type="application/atom+xml">
    
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link" style="color: #fff">Home</a>
			
				<a href="/archives" class="header__link" style="color: #fff">Archive</a>
			
				<a href="/about" class="header__link" style="color: #fff">About</a>
			
		</nav>
		<!-- <h1 class="header__title"><a href="/">琼瑶</a></h1> -->
		<h1 class="header__title"><a href="/"><img style="width: 290px;" src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/202204152017786.png"></a></h1>
		<h2 class="header__subtitle">梦入琼楼寒有月，行过石树冻无烟</h2>
	</header>

	<main>
		<article>
	
		<h1>D3 弦布图</h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210408162242.png"><br>弦图（<code>Chord Diagram</code>），是一种表示一组<code>元素之间关系</code>的学术图表之一。主要可以分为<strong>外部节点</strong>和<strong>内部弦</strong>。通过弦图布局（<code>Chord Layout</code>）可以将方块矩阵转换成一个可用于绘制<strong>节点</strong>和<strong>弦</strong>的数据。</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.layout.chord()</td>
<td>创建弦布图</td>
<td></td>
</tr>
<tr>
<td></td>
<td>chord.matrix()</td>
<td>设置或获取矩阵（<strong>必须</strong>为方块矩阵，行列数相等）</td>
</tr>
<tr>
<td></td>
<td>chord.padding()</td>
<td>设置或获取元素节点之间的间距，默认为<code>0</code></td>
</tr>
<tr>
<td></td>
<td>chord.sortGroups()</td>
<td>对节点进行排序</td>
</tr>
<tr>
<td></td>
<td>chord.sortSubgroups()</td>
<td>对各点所在行的数据进行排序</td>
</tr>
<tr>
<td></td>
<td>chord.sortChords()</td>
<td>对弦进行排序</td>
</tr>
<tr>
<td></td>
<td>chord.chords()</td>
<td>返回弦数组</td>
</tr>
<tr>
<td></td>
<td>chord.groups()</td>
<td>返回节点数组</td>
</tr>
</tbody></table>
<h2 id="布局运算"><a href="#布局运算" class="headerlink" title="布局运算"></a>布局运算</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210408162302.png"><br>使用弦布图（<code>Chord Layout</code>）可以直接通过 d3 来计算出<code>弧</code>的<code>startAngle and endAngle</code>等，并通过使用<code>chords() and groups()</code>来直接输出弦图的<code>弦数组以及节点数组</code>，需要注意的是弦图使用的数据添加方法采用了<strong>方块矩阵</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> node = [</span><br><span class="line">    <span class="string">&quot;长春市&quot;</span>,<span class="string">&quot;四平市&quot;</span>,<span class="string">&quot;吉林市&quot;</span>,<span class="string">&quot;松原市&quot;</span>,<span class="string">&quot;通化市&quot;</span>,<span class="string">&quot;白城市&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nodeData = [</span><br><span class="line">    [<span class="number">0</span>,<span class="number">20.56</span>,<span class="number">14.16</span>,<span class="number">11.65</span>,<span class="number">4.87</span>,<span class="number">4.76</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">20.56</span>,<span class="number">14.16</span>,<span class="number">11.65</span>,<span class="number">4.87</span>,<span class="number">4.76</span>],</span><br><span class="line">    [<span class="number">53.57</span>,<span class="number">0</span>,<span class="number">3.09</span>,<span class="number">4.77</span>,<span class="number">1.5</span>,<span class="number">1.43</span>],</span><br><span class="line">    [<span class="number">53.57</span>,<span class="number">4.48</span>,<span class="number">0</span>,<span class="number">3.19</span>,<span class="number">4.86</span>,<span class="number">1.59</span>],</span><br><span class="line">    [<span class="number">43.96</span>,<span class="number">5.91</span>,<span class="number">2.59</span>,<span class="number">0</span>,<span class="number">0.62</span>,<span class="number">11.13</span>],</span><br><span class="line">    [<span class="number">21.22</span>,<span class="number">2.6</span>,<span class="number">8.81</span>,<span class="number">0.84</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> chord = d3.<span class="property">layout</span>.<span class="title function_">chord</span>()</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">0.03</span>)</span><br><span class="line">    .<span class="title function_">sortSubgroups</span>(d3.<span class="property">ascending</span>)</span><br><span class="line">    .<span class="title function_">matrix</span>(nodeData)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chord.<span class="title function_">groups</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chord.<span class="title function_">chords</span>())</span><br></pre></td></tr></table></figure>

<h2 id="弦布图"><a href="#弦布图" class="headerlink" title="弦布图"></a>弦布图</h2><p>在下述 code 中分别添加了三个<code>&lt;g&gt;</code>元素，分别包括了<code>位置、节点、弦</code>，分别代表了<code>gOuter(g)、gInner（g）、path（outerPath）、text（outerText）、innerPath（path）</code>，在 web 展示的结构是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- gChord --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">g</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- gOuter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">g</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">path</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span>    <span class="comment">&lt;!-- outerPath / path --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span>    <span class="comment">&lt;!-- outerText / text --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- gInner --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">g</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">path</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span>    <span class="comment">&lt;!-- innerPath / path --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 规格 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 弦图数据 */</span></span><br><span class="line"><span class="keyword">var</span> node = [</span><br><span class="line">    <span class="string">&quot;长春市&quot;</span>,<span class="string">&quot;四平市&quot;</span>,<span class="string">&quot;吉林市&quot;</span>,<span class="string">&quot;松原市&quot;</span>,<span class="string">&quot;通化市&quot;</span>,<span class="string">&quot;白城市&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nodeData = [</span><br><span class="line">    [<span class="number">0</span>,<span class="number">20.56</span>,<span class="number">14.16</span>,<span class="number">11.65</span>,<span class="number">4.87</span>,<span class="number">4.76</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">20.56</span>,<span class="number">14.16</span>,<span class="number">11.65</span>,<span class="number">4.87</span>,<span class="number">4.76</span>],</span><br><span class="line">    [<span class="number">53.57</span>,<span class="number">0</span>,<span class="number">3.09</span>,<span class="number">4.77</span>,<span class="number">1.5</span>,<span class="number">1.43</span>],</span><br><span class="line">    [<span class="number">53.57</span>,<span class="number">4.48</span>,<span class="number">0</span>,<span class="number">3.19</span>,<span class="number">4.86</span>,<span class="number">1.59</span>],</span><br><span class="line">    [<span class="number">43.96</span>,<span class="number">5.91</span>,<span class="number">2.59</span>,<span class="number">0</span>,<span class="number">0.62</span>,<span class="number">11.13</span>],</span><br><span class="line">    [<span class="number">21.22</span>,<span class="number">2.6</span>,<span class="number">8.81</span>,<span class="number">0.84</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 布局运算 */</span></span><br><span class="line"><span class="keyword">var</span> chord = d3.<span class="property">layout</span>.<span class="title function_">chord</span>()</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">0.03</span>)</span><br><span class="line">    .<span class="title function_">sortSubgroups</span>(d3.<span class="property">ascending</span>)</span><br><span class="line">    .<span class="title function_">matrix</span>(nodeData)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 计算出 &lt;g&gt; 元素位置 */</span></span><br><span class="line"><span class="keyword">var</span> gChord = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,</span><br><span class="line">        <span class="string">&quot;translate(&quot;</span> + padding.<span class="property">width</span>/<span class="number">2</span> + <span class="string">&quot;,&quot;</span> + padding.<span class="property">height</span>/<span class="number">2</span> + <span class="string">&quot;)&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 节点和弦的 &lt;g&gt; 元素 */</span></span><br><span class="line"><span class="keyword">var</span> gOuter = gChord.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> gInner = gChord.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 颜色比例尺 */</span></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20c</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 内部与外部半径 */</span></span><br><span class="line"><span class="keyword">var</span> innerRadius = padding.<span class="property">width</span> / <span class="number">2</span> * <span class="number">0.7</span></span><br><span class="line"><span class="keyword">var</span> outerRadius = innerRadius * <span class="number">1.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 弧生成器 */</span></span><br><span class="line"><span class="keyword">var</span> arcOuter = d3.<span class="property">svg</span>.<span class="title function_">arc</span>()</span><br><span class="line">    .<span class="title function_">innerRadius</span>(innerRadius)</span><br><span class="line">    .<span class="title function_">outerRadius</span>(outerRadius)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |- 添加 path 元素</span></span><br><span class="line"><span class="comment">    |- 绑定弧生成器 arcOuter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gOuter.<span class="title function_">selectAll</span>(<span class="string">&quot;.outerPath&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(chord.<span class="title function_">groups</span>())</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;outerPath&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(d.<span class="property">index</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, arcOuter)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |- 绘制节点文字</span></span><br><span class="line"><span class="comment">    |- 选择节点文字 node</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gOuter.<span class="title function_">selectAll</span>(<span class="string">&quot;.outerText&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(chord.<span class="title function_">groups</span>())</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    <span class="comment">/* 计算出弧中心角度 */</span></span><br><span class="line">    .<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">d,i</span>) &#123;</span><br><span class="line">        d.<span class="property">angle</span> = (d.<span class="property">startAngle</span> + d.<span class="property">endAngle</span>) /<span class="number">2</span></span><br><span class="line">        d.<span class="property">name</span> = node[i]</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;outerText&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>,<span class="string">&quot;.35em&quot;</span>)</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        |- 旋转 d.angle</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="string">&quot;rotate(&quot;</span> + (d.<span class="property">angle</span> * <span class="number">180</span> / <span class="title class_">Math</span>.<span class="property">PI</span>) + <span class="string">&quot;)&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            |- 平移到半径外</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        result += <span class="string">&quot;translate(0,&quot;</span> + -<span class="number">1.0</span> * (outerRadius + <span class="number">10</span>) + <span class="string">&quot;)&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            翻转文字</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (d.<span class="property">angle</span> &gt; <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">3</span> / <span class="number">4</span> &amp;&amp; d.<span class="property">angle</span> &lt; <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">5</span> /<span class="number">4</span>)</span><br><span class="line">            result += <span class="string">&quot;rotate(180)&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arcInner =  d3.<span class="property">svg</span>.<span class="title function_">chord</span>()</span><br><span class="line">    .<span class="title function_">radius</span>(innerRadius)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绑定数据并生成弦 */</span></span><br><span class="line">gInner.<span class="title function_">selectAll</span>(<span class="string">&quot;.innerPath&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(chord.<span class="title function_">chords</span>())</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;innerPath&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,arcInner)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> color (d.<span class="property">source</span>.<span class="property">index</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>less</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@colorWhite</span>: #ffffff;</span><br><span class="line"><span class="selector-class">.outerPath</span>&#123;</span><br><span class="line">  stroke: @colorWhite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.outerText</span>&#123;</span><br><span class="line">  text-anchor: middle;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  fill: @color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.innerPath</span>&#123;</span><br><span class="line">  stroke: @colorWhite;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了体现出<code>外弦</code>和<code>节点</code>的区分，我们需要为<code>outerPath（外弦路径）、outerText（外弦文字/节点文字）、innerPath（内弦路径）</code>添加样式。</p>
<blockquote>
<p>css</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.outerPath</span>&#123;</span><br><span class="line">  stroke: <span class="number">#ffffff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.outerText</span>&#123;</span><br><span class="line">  text-anchor: middle;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  fill: <span class="number">#929292</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.innerPath</span>&#123;</span><br><span class="line">  stroke: <span class="number">#ffffff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="behavior"><a href="#behavior" class="headerlink" title="behavior"></a>behavior</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210408190119.png"></p>
<p>为了增加观感上的体验，我们为弦布图增加了<code>behavior</code>，主要通过使用使用<code>mouseover（鼠标光标） and mouseout（光标移出）</code>，然后通过<code>d.source.index !=i &amp;&amp; d.target.index !=i</code>排除<strong>光标选择外的数据</strong>，在通过添加过渡来实现效果。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  |_ 鼠标事件</span></span><br><span class="line"><span class="comment">    |_| _ mouseover    光标接触</span></span><br><span class="line"><span class="comment">    |_| _ mouseout     光标移出</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gOuter.<span class="title function_">selectAll</span>(<span class="string">&quot;.outerPath&quot;</span>)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseover&quot;</span>, <span class="title function_">fade</span>(<span class="number">0.0</span>))</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseout&quot;</span>, <span class="title function_">fade</span>(<span class="number">1.0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 透明与半透明方法</span></span><br><span class="line"><span class="comment">    |_|_ 选择鼠标接触到的内部弦</span></span><br><span class="line"><span class="comment">    |_|_ 设置过度与延迟</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fade</span>(<span class="params">opacity</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">g,i</span>) &#123;</span><br><span class="line">        gInner.<span class="title function_">selectAll</span>(<span class="string">&quot;.innerPath&quot;</span>)</span><br><span class="line">            .<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> d.<span class="property">source</span>.<span class="property">index</span> !=i &amp;&amp; d.<span class="property">target</span>.<span class="property">index</span> !=i</span><br><span class="line">        &#125;)</span><br><span class="line">            .<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">2000</span>)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;opacity&quot;</span>, opacity)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
	

	
		<span class="different-posts"><a href="/2022/04/21/javascript/d3/25.D3%20%E5%BC%A6%E5%B8%83%E5%9B%BE/" onclick="window.history.go(-1); return false;">⬅️ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>欢迎来到我的 blog <br><br> 通过 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>+<a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a> 进行构建的，存放在 <a target="_blank" rel="noopener" href="https://github.com/vendanges/vendanges.github.io">Github</a> 上。</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2022 John Doe | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
