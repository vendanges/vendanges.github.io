<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>D3 地图投影 | 琼瑶</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="琼瑶" type="application/atom+xml">
    
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link" style="color: #fff">Home</a>
			
				<a href="/archives" class="header__link" style="color: #fff">Archive</a>
			
				<a href="/about" class="header__link" style="color: #fff">About</a>
			
		</nav>
		<!-- <h1 class="header__title"><a href="/">琼瑶</a></h1> -->
		<h1 class="header__title"><a href="/"><img style="width: 290px;" src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/202204152017786.png"></a></h1>
		<h2 class="header__subtitle">梦入琼楼寒有月，行过石树冻无烟</h2>
	</header>

	<main>
		<article>
	
		<h1>D3 地图投影</h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p>在 D3 中 创建投影的方式大多数也一定是通过<code>d3.geo.projection</code>来进行创建的，D3 为此包含了很多现成的投影方法，如<code>albersUsa()、conicConformal()、conicEqualArea()、conicEqualArea.parallels()</code>等投影，但最常用的可能也就是<code>d3.geo.projection</code> &amp; <code>d3.geo.orthographic()</code>两种投影等。</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.geo.projection(raw)</td>
<td>从制定的原始点投影函数，创建一个投影</td>
<td></td>
</tr>
<tr>
<td>projection(location)</td>
<td>将球面坐标系坐标投影到<code>笛卡尔坐标系的坐标</code>，（location是一个数组，返回数组[x,y]，输入数组是形式为<code>[[经度],[纬度]]</code>）</td>
<td></td>
</tr>
<tr>
<td>projection.invert(<code>point</code>)</td>
<td>从直角坐标（像素）反响投影到球面坐标（度）返回一个数组<code>[经度，纬度]</code>，分别表示<code>[x,y]</code>，<strong>但并非有所有的投影都会被反转</strong></td>
<td></td>
</tr>
<tr>
<td>projection.rotate(<code>rotation</code>)</td>
<td>设置渲染，rotation 数组是<code>[yaw, pitch, roll]</code>，其中yew <strong>表示左右</strong>，pitch 表示<strong>倾斜度</strong>，而 roll <strong>表示转动</strong></td>
<td></td>
</tr>
<tr>
<td>projection.center(<code>[location]</code>)</td>
<td>设置投影中心，如果设置了中心点。(location 数组，格式为[<code>经度、纬度</code>]) ，默认为(0,0)</td>
<td></td>
</tr>
<tr>
<td>projection.translate(<code>point</code>)</td>
<td>设置投影的平移，如果 point 点被指定，则设置位移为<strong>经度，和维度</strong>的两元数组并发那会投影，默认为 [480,250]</td>
<td></td>
</tr>
<tr>
<td>projection.scale(<code>[scale]</code>)</td>
<td>设置投影的比例尺，如设置 scale则返回投影，即缩放因子，未指定投影则默认[150]</td>
<td></td>
</tr>
<tr>
<td>projection.clipAngle(<code>angle</code>)</td>
<td>设置圆的裁剪角度，<code>单位为度</code></td>
<td></td>
</tr>
<tr>
<td>projection.clipExtent(<code>extent</code>)</td>
<td>设置矩形裁剪框，extent 的格式为<code>[[x0,y0], [x1,y1]]</code>，分别表示</td>
<td></td>
</tr>
<tr>
<td></td>
<td>x0</td>
<td>视窗的左边界</td>
</tr>
<tr>
<td></td>
<td>y0</td>
<td>上方</td>
</tr>
<tr>
<td></td>
<td>x1</td>
<td>右方</td>
</tr>
<tr>
<td></td>
<td>y1</td>
<td>下方</td>
</tr>
</tbody></table>
<h2 id="地图投影"><a href="#地图投影" class="headerlink" title="地图投影"></a>地图投影</h2><h3 id="墨卡托投影-d3-geo-mercator"><a href="#墨卡托投影-d3-geo-mercator" class="headerlink" title="墨卡托投影 (d3.geo.mercator)"></a>墨卡托投影 (d3.geo.mercator)</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210422162031.png"></p>
<blockquote>
<p>简单理解就是墨卡托投影是将圆柱展开平面后得到的投影，而这个投影的形成就是在地球内部中心放个点光源，之后光线会将地表中每一个位置都投影到柱面上，展开后就是世界地图。</p>
</blockquote>
<p>墨卡托投影（<code>mercator</code>），是<strong>正轴等角圆柱投影</strong>，由荷兰地理学家墨卡托（G.Mercator）1569年创立。他假想了一个地轴方向一致的圆柱或切割于地球。当圆柱展为平面后，得到本投影（通常<strong>横是纬线，竖经线</strong>）。</p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210422162057.png"></p>
<p>需要注意的是墨卡托投影并不是真实的世界样貌，由于地球是三维球体，将完整展现在二维平面是需要牺牲些真实性。所以墨卡托选择<strong>牺牲了面积大小，保留角度和形状</strong>。</p>
<p>因此上图将地球切为12份，然后将边缘的切口进行连接，那么只有赤道的点互相连接，就会造成<strong>远离赤道的距离越大，就会显得面积较广</strong>，而在 D3 中的API 手册中也有类似的建议</p>
<blockquote>
<p>这个球面的Mercator投影是常用的分片式映射库（例如OpenLayers 和Leaflet）。例如显示栅格分片与Mercator投影，可以参见d3.geo.tile插件，它是正形投影的，然而，它的推行造成了世界范围地区严重失真，因此不建议使用choropleths。</p>
</blockquote>
<h3 id="等距投影-d3-geo-equirectangular"><a href="#等距投影-d3-geo-equirectangular" class="headerlink" title="等距投影 (d3.geo.equirectangular)"></a>等距投影 (d3.geo.equirectangular)</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210422162111.png"><br>等距投影（<code>equirectangular</code>）是一种简单的地图投影方法，该投影的<strong>经线和纬线都是互相垂直且等距的</strong>。在这种投影方法中，假设了球面和圆柱面相切于赤道，<code>将球面的经纬线投影到圆柱面上，之后沿着圆柱的一条母线所开展平面的一种投影</code>。</p>
<h3 id="正射投影（d3-geo-orthographic）"><a href="#正射投影（d3-geo-orthographic）" class="headerlink" title="正射投影（d3.geo.orthographic）"></a>正射投影（d3.geo.orthographic）</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210421202824.png"></p>
<p>正射投影（<code>orthographic</code>）适用与<strong>投射单个半球的方位投影</strong>，属于任意性质的透视方位投影。</p>
<h3 id="立体投影（d3-gao-stereographic）"><a href="#立体投影（d3-gao-stereographic）" class="headerlink" title="立体投影（d3.gao.stereographic）"></a>立体投影（d3.gao.stereographic）</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210422162122.png"><br>立体投影（<code>stereigraohic</code>）是另一个角度（方位）的投影。在极方位上，<strong>经线是极点的直线</strong>，所有的直线间的夹角都是根据正北来进行确定。<strong>纬线</strong>都显示为同心圆弧，其间距都是从极点来进行增加，交点均为90度，<strong>无法显示另一极点</strong>。</p>
<blockquote>
<p>立体投影是一种等角地图投影，他不会保持真实的方向，但是角度和形状将会保持最小比例。可以使用标准纬线或比例因子参数来指定比例畸变圆弧。面积和距离和比例的畸变会随着标准纬线的距离增加而迅速增大。</p>
</blockquote>
<h3 id="球心投影-x2F-心射极平投影（d3-geo-gnomonic）"><a href="#球心投影-x2F-心射极平投影（d3-geo-gnomonic）" class="headerlink" title="球心投影&#x2F;心射极平投影（d3.geo.gnomonic）"></a>球心投影&#x2F;心射极平投影（d3.geo.gnomonic）</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210422162130.png"><br>球心投影（<code>d3.gao.gnomonic</code>）是方位投影之一，以球心<code>O</code>为投射中心，<strong>他是最有用的投影方法之一</strong>，也被称之为<code>心射极平投影</code>，来表示出一种物体的上的点、面、与角距关系的平面投影，<strong>投影面与投影球的北极相切。</strong></p>
<h3 id="圆锥等距投影（d3-geo-conicEquidistant）"><a href="#圆锥等距投影（d3-geo-conicEquidistant）" class="headerlink" title="圆锥等距投影（d3.geo.conicEquidistant）"></a>圆锥等距投影（d3.geo.conicEquidistant）</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210422162203.png" alt="圆锥等距投影"></p>
<p>圆锥等距投影（<code>conicEquidistant</code>）或等距圆锥投影保留了所有<strong>经线和两个标准纬线之间的距离</strong>。该投影方法通常作为<code>兰勃特等角圆锥和阿尔伯斯等积圆锥投影</code>的一种折衷投影。</p>
<p>该投影最适用与在中纬度东西分布的大陆板块，基本投影形式由 Claudius Ptolemy 于公元100年最初提出，后盖被进行各种改进，最大的改进由 Nicolas d3’ l’lsle 于 1745年进行修改。</p>
<blockquote>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210422162304.png" alt="兰勃特地图投影"><br>兰勃特等角堆地图投影由 Johann H.Lambert 于1772年开发，该投影主要基于两个标准纬线，但也可以使用单个标准纬线和比例因子对其进行定义（适用与中纬度东西方向分布的大陆进行角制图，<code>第一次世界大战前很少使用，目前全世界的官方地图制图通常使用该投影</code>）</p>
</blockquote>
<blockquote>
<p> <img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210422162949.png" alt="阿尔伯斯地图投影"><br>阿尔伯斯地图投影是一种等积圆锥投影，该圆锥投影使用两条标准纬线，相比仅使用一条标准纬线的投影可以从某种程度上减少畸变。<strong>该投影主最适用与中纬度东西方向分布的大陆板块</strong>，最早由 Heinrich C. Albers 于 1805年提出，椭圆方程被Oscar S.Adams 于1927年开发。</p>
</blockquote>
<h2 id="各个参数"><a href="#各个参数" class="headerlink" title="各个参数"></a>各个参数</h2><h3 id="center-and-scale-as-well-as-translate"><a href="#center-and-scale-as-well-as-translate" class="headerlink" title="center() and scale as well as translate"></a>center() and scale as well as translate</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210422163651.png"><br>在下述的 code 中，将地图中心点设置为台湾省，坐标为<code>121.56372070312499,25.035838555635017</code>，缩放因子&#x2F;比例尺为<code>600</code>，之后通过平移使得原点位与 SVG 的区域中心即<code>padding.width/2, padding.height/2</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1000</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * center</span></span><br><span class="line"><span class="comment">    *   用于设置中心点，本次设置的中心点为 台湾省</span></span><br><span class="line"><span class="comment">    * scale</span></span><br><span class="line"><span class="comment">    *   设置缩放因子为600,</span></span><br><span class="line"><span class="comment">    * translate</span></span><br><span class="line"><span class="comment">    *   以 svg 区域为中心为坐标的原点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> projection = d3.<span class="property">geo</span>.<span class="title function_">equirectangular</span>()</span><br><span class="line">    .<span class="title function_">center</span>([<span class="number">121.56372070312499</span>,<span class="number">25.035838555635017</span>])</span><br><span class="line">    .<span class="title function_">scale</span>(<span class="number">600</span>)</span><br><span class="line">    .<span class="title function_">translate</span>([padding.<span class="property">width</span>/<span class="number">2</span>, padding.<span class="property">height</span>/<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> path = d3.<span class="property">geo</span>.<span class="title function_">path</span>()</span><br><span class="line">    .<span class="title function_">projection</span>(projection)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 绘制地图</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">d3.<span class="title function_">json</span>(<span class="string">&quot;./world-continents.geo.json&quot;</span>, <span class="keyword">function</span> (<span class="params">error, root</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> groups = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    groups.<span class="title function_">selectAll</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">        .<span class="title function_">data</span>(root.<span class="property">features</span>)</span><br><span class="line">        .<span class="title function_">enter</span>()</span><br><span class="line">        .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;province&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,path)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * rect 为轮廓</span></span><br><span class="line"><span class="comment">        * line 为 x/y 轴</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    svg.<span class="title function_">append</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;border&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>,<span class="number">0</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>,<span class="number">0</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line">    svg.<span class="title function_">append</span>(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;axis&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;x1&quot;</span>,<span class="number">0</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;y1&quot;</span>,padding.<span class="property">height</span>/<span class="number">2</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;x2&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;y2&quot;</span>,padding.<span class="property">height</span>/<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    svg.<span class="title function_">append</span>(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;axis&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;x1&quot;</span>,padding.<span class="property">width</span>/<span class="number">2</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;y1&quot;</span>,<span class="number">0</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;x2&quot;</span>,padding.<span class="property">width</span>/<span class="number">2</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;y2&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.province</span> &#123;</span><br><span class="line">  fill: white;</span><br><span class="line">  stroke: <span class="number">#25595a</span>;</span><br><span class="line">  stroke-<span class="attribute">width</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.border</span> &#123;</span><br><span class="line">  fill: transparent;</span><br><span class="line">  stroke: black;</span><br><span class="line">  stroke-<span class="attribute">width</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.axis</span> &#123;</span><br><span class="line">  fill: transparent;</span><br><span class="line">  stroke: <span class="built_in">rgb</span>(<span class="number">255</span>,<span class="number">0</span>,<span class="number">255</span>);</span><br><span class="line">  stroke-<span class="attribute">width</span>: <span class="number">0.7px</span>;</span><br><span class="line">  stroke-dasharray: <span class="number">5</span>,<span class="number">5</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="projection-and-invert"><a href="#projection-and-invert" class="headerlink" title="projection and invert"></a>projection and invert</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210422202618.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```js</span><br><span class="line">var padding = &#123;</span><br><span class="line">    width: 1000,</span><br><span class="line">    height: 1000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var svg = d3.select(&quot;body&quot;)</span><br><span class="line">    .append(&quot;svg&quot;)</span><br><span class="line">    .attr(&quot;width&quot;,padding.width)</span><br><span class="line">    .attr(&quot;height&quot;, padding.height)</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">    * center</span><br><span class="line">    *   用于设置中心点，本次设置的中心点为 台湾省</span><br><span class="line">    * scale</span><br><span class="line">    *   设置缩放因子为600,</span><br><span class="line">    * translate</span><br><span class="line">    *   以 svg 区域为中心为坐标的原点</span><br><span class="line"> */</span><br><span class="line">var projection = d3.geo.equirectangular()</span><br><span class="line">    .center([121.56372070312499,25.035838555635017])</span><br><span class="line">    .scale(800)</span><br><span class="line">    .translate([padding.width/2, padding.height/2])</span><br><span class="line"></span><br><span class="line">var path = d3.geo.path()</span><br><span class="line">    .projection(projection)</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">    * 绘制地图</span><br><span class="line">*/</span><br><span class="line">d3.json(&quot;./world-continents.geo.json&quot;, function (error, root) &#123;</span><br><span class="line">    if (error)</span><br><span class="line">        return console.error(error)</span><br><span class="line"></span><br><span class="line">    var groups = svg.append(&quot;g&quot;)</span><br><span class="line">    groups.selectAll(&quot;path&quot;)</span><br><span class="line">        .data(root.features)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(&quot;path&quot;)</span><br><span class="line">        .attr(&quot;class&quot;,&quot;province&quot;)</span><br><span class="line">        .attr(&quot;d&quot;,path)</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">        * rect 为轮廓</span><br><span class="line">        * line 为 x/y 轴</span><br><span class="line">     */</span><br><span class="line">    svg.append(&quot;rect&quot;)</span><br><span class="line">        .attr(&quot;class&quot;,&quot;border&quot;)</span><br><span class="line">        .attr(&quot;x&quot;,0)</span><br><span class="line">        .attr(&quot;y&quot;,0)</span><br><span class="line">        .attr(&quot;width&quot;,padding.width)</span><br><span class="line">        .attr(&quot;height&quot;,padding.height)</span><br><span class="line"></span><br><span class="line">    svg.append(&quot;line&quot;)</span><br><span class="line">        .attr(&quot;class&quot;,&quot;axis&quot;)</span><br><span class="line">        .attr(&quot;x1&quot;,0)</span><br><span class="line">        .attr(&quot;y1&quot;,padding.height/2)</span><br><span class="line">        .attr(&quot;x2&quot;,padding.width)</span><br><span class="line">        .attr(&quot;y2&quot;,padding.height/2)</span><br><span class="line"></span><br><span class="line">    svg.append(&quot;line&quot;)</span><br><span class="line">        .attr(&quot;class&quot;,&quot;axis&quot;)</span><br><span class="line">        .attr(&quot;x1&quot;,padding.width/2)</span><br><span class="line">        .attr(&quot;y1&quot;,0)</span><br><span class="line">        .attr(&quot;x2&quot;,padding.width/2)</span><br><span class="line">        .attr(&quot;y2&quot;,padding.height)</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">        (1)</span><br><span class="line">            projection与invert前者是投影到球面坐标之后转到笛卡尔坐标,</span><br><span class="line">                并返回数组[x,y]，而invert则是投影反响直角坐标系到球面坐标中。</span><br><span class="line">     */</span><br><span class="line">    var projectioncircle = projection([121.56372070312499,25.035838555635017])</span><br><span class="line">        svg.append(&quot;circle&quot;)</span><br><span class="line">        .attr(&quot;cx&quot;,projectioncircle[0])</span><br><span class="line">        .attr(&quot;cy&quot;,projectioncircle[1])</span><br><span class="line">        .attr(&quot;r&quot;,3)</span><br><span class="line">        .style(&quot;fill&quot;,&quot;red&quot;)</span><br><span class="line"></span><br><span class="line">    var pos = projection.invert(projectioncircle)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="clipExtent"><a href="#clipExtent" class="headerlink" title="clipExtent"></a>clipExtent</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210422202515.png"></p>
<figure class="highlight plaintext"><figcaption><span>设置为：```[300,0],[padding.width,padding.height]```，就可以进行裁剪左侧的地图数据：</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```js</span><br><span class="line">var padding = &#123;</span><br><span class="line">    width: 1000,</span><br><span class="line">    height: 1000</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var svg = d3.select(&quot;body&quot;)</span><br><span class="line">    .append(&quot;svg&quot;)</span><br><span class="line">    .attr(&quot;width&quot;,padding.width)</span><br><span class="line">    .attr(&quot;height&quot;, padding.height)</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">    * center</span><br><span class="line">    *   用于设置中心点，本次设置的中心点为 台湾省</span><br><span class="line">    * scale</span><br><span class="line">    *   设置缩放因子为600,</span><br><span class="line">    * translate</span><br><span class="line">    *   以 svg 区域为中心为坐标的原点</span><br><span class="line">    * clipExtent</span><br><span class="line">    *   projection.clipExtent()主要表示设置一个矩形裁剪框，其格式可以为[x0,y0],[x1,y1]</span><br><span class="line"> */</span><br><span class="line">var projection = d3.geo.equirectangular()</span><br><span class="line">    .clipExtent([[300,0],[padding.width,padding.height]])</span><br><span class="line">    .center([121.56372070312499,25.035838555635017])</span><br><span class="line">    .scale(200)</span><br><span class="line">    .translate([padding.width/2, padding.height/2])</span><br><span class="line"></span><br><span class="line">var path = d3.geo.path()</span><br><span class="line">    .projection(projection)</span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line">    * 绘制地图</span><br><span class="line">*/</span><br><span class="line">d3.json(&quot;./world-continents.geo.json&quot;, function (error, root) &#123;</span><br><span class="line">    if (error)</span><br><span class="line">        return console.error(error)</span><br><span class="line"></span><br><span class="line">    var groups = svg.append(&quot;g&quot;)</span><br><span class="line">    groups.selectAll(&quot;path&quot;)</span><br><span class="line">        .data(root.features)</span><br><span class="line">        .enter()</span><br><span class="line">        .append(&quot;path&quot;)</span><br><span class="line">        .attr(&quot;class&quot;,&quot;province&quot;)</span><br><span class="line">        .attr(&quot;d&quot;,path)</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">        * rect 为轮廓</span><br><span class="line">        * line 为 x/y 轴</span><br><span class="line">     */</span><br><span class="line">    svg.append(&quot;rect&quot;)</span><br><span class="line">        .attr(&quot;class&quot;,&quot;border&quot;)</span><br><span class="line">        .attr(&quot;x&quot;,0)</span><br><span class="line">        .attr(&quot;y&quot;,0)</span><br><span class="line">        .attr(&quot;width&quot;,padding.width)</span><br><span class="line">        .attr(&quot;height&quot;,padding.height)</span><br><span class="line"></span><br><span class="line">    svg.append(&quot;line&quot;)</span><br><span class="line">        .attr(&quot;class&quot;,&quot;axis&quot;)</span><br><span class="line">        .attr(&quot;x1&quot;,0)</span><br><span class="line">        .attr(&quot;y1&quot;,padding.height/2)</span><br><span class="line">        .attr(&quot;x2&quot;,padding.width)</span><br><span class="line">        .attr(&quot;y2&quot;,padding.height/2)</span><br><span class="line"></span><br><span class="line">    svg.append(&quot;line&quot;)</span><br><span class="line">        .attr(&quot;class&quot;,&quot;axis&quot;)</span><br><span class="line">        .attr(&quot;x1&quot;,padding.width/2)</span><br><span class="line">        .attr(&quot;y1&quot;,0)</span><br><span class="line">        .attr(&quot;x2&quot;,padding.width/2)</span><br><span class="line">        .attr(&quot;y2&quot;,padding.height)</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">        (1)</span><br><span class="line">            projection与invert前者是投影到球面坐标之后转到笛卡尔坐标,</span><br><span class="line">                并返回数组[x,y]，而invert则是投影反响直角坐标系到球面坐标中。</span><br><span class="line">     */</span><br><span class="line">    var projectioncircle = projection([121.56372070312499,25.035838555635017])</span><br><span class="line">    svg.append(&quot;circle&quot;)</span><br><span class="line">        .attr(&quot;cx&quot;,projectioncircle[0])</span><br><span class="line">        .attr(&quot;cy&quot;,projectioncircle[1])</span><br><span class="line">        .attr(&quot;r&quot;,3)</span><br><span class="line">        .style(&quot;fill&quot;,&quot;red&quot;)</span><br><span class="line"></span><br><span class="line">    var pos = projection.invert(projectioncircle)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="rotate-and-clipAngle"><a href="#rotate-and-clipAngle" class="headerlink" title="rotate and clipAngle"></a>rotate and clipAngle</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210423000046.png"><br>这里介绍下在正射投影<code>orthographic()</code>中较为常用的两个方法为<code>rotate and clipAngle</code>，分别表示了<strong>旋转角度（rotate）</strong>和裁剪角度（clipAngle），如果不清楚的读者可以看下图：<br><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210423000059.png"></p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210423000106.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">1000</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> projection = d3.<span class="property">geo</span>.<span class="title function_">orthographic</span>()</span><br><span class="line">    .<span class="title function_">scale</span>(<span class="number">400</span>)</span><br><span class="line">    .<span class="title function_">translate</span>([padding.<span class="property">width</span>/<span class="number">2</span>, padding.<span class="property">height</span>/<span class="number">2</span>])</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        * rotate</span></span><br><span class="line"><span class="comment">        *   有三个角度，分别为左右、倾斜度、转动等，[yaw, pitch, roll]</span></span><br><span class="line"><span class="comment">        * clipAngle</span></span><br><span class="line"><span class="comment">        *   即裁剪骄傲读为90：参数别为 30°（左上）、60°（右上）、90°（左下）、180°（右下）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    .<span class="title function_">rotate</span>([-<span class="number">120</span> ,-<span class="number">20</span>, <span class="number">0</span>])</span><br><span class="line">    .<span class="title function_">clipAngle</span>(<span class="number">90</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> path = d3.<span class="property">geo</span>.<span class="title function_">path</span>()</span><br><span class="line">    .<span class="title function_">projection</span>(projection)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * graticule</span></span><br><span class="line"><span class="comment">    *   返回一个多重链接(MultiLineString)几何对象表示刻度尺的所有经线和纬线</span></span><br><span class="line"><span class="comment">    * extent</span></span><br><span class="line"><span class="comment">    *   如果指定则设置刻度尺的主要和次要范围，默认为[[-180,-80],[180,80]]</span></span><br><span class="line"><span class="comment">    * step</span></span><br><span class="line"><span class="comment">    *   设置刻度的主要和次要步长，及间隔，默认为 [10,10]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> graticule = d3.<span class="property">geo</span>.<span class="title function_">graticule</span>()</span><br><span class="line">    .<span class="title function_">extent</span>([[-<span class="number">180</span>,-<span class="number">90</span>],[<span class="number">180</span>,<span class="number">90</span>]])</span><br><span class="line">    .<span class="title function_">step</span>([<span class="number">10</span>,<span class="number">10</span>])</span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;graticule&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,<span class="title function_">path</span>(<span class="title function_">graticule</span>()))</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 绘制地图</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">d3.<span class="title function_">json</span>(<span class="string">&quot;./world-continents.geo.json&quot;</span>, <span class="keyword">function</span> (<span class="params">error, root</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (error)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">console</span>.<span class="title function_">error</span>(error)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> groups = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    groups.<span class="title function_">selectAll</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">        .<span class="title function_">data</span>(root.<span class="property">features</span>)</span><br><span class="line">        .<span class="title function_">enter</span>()</span><br><span class="line">        .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;province&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,path)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.province</span> &#123;</span><br><span class="line">  fill: white;</span><br><span class="line">  stroke: <span class="number">#25595a</span>;</span><br><span class="line">  stroke-<span class="attribute">width</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.graticule</span> &#123;</span><br><span class="line">  fill: transparent;</span><br><span class="line">  stroke: <span class="number">#dddddd</span>;</span><br><span class="line">  stroke-<span class="attribute">width</span>: <span class="number">1px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
	

	
		<span class="different-posts"><a href="/2022/04/21/javascript/d3/32.D3%20%E5%9C%B0%E5%9B%BE%E6%8A%95%E5%BD%B1/" onclick="window.history.go(-1); return false;">⬅️ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>欢迎来到我的 blog <br><br> 通过 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>+<a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a> 进行构建的，存放在 <a target="_blank" rel="noopener" href="https://github.com/vendanges/vendanges.github.io">Github</a> 上。</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2022 John Doe | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
