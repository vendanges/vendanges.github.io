<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>Node.js MySql at Sequelize | 琼瑶</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="琼瑶" type="application/atom+xml">
    
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link" style="color: #fff">Home</a>
			
				<a href="/archives" class="header__link" style="color: #fff">Archive</a>
			
				<a href="/about" class="header__link" style="color: #fff">About</a>
			
		</nav>
		<!-- <h1 class="header__title"><a href="/">琼瑶</a></h1> -->
		<h1 class="header__title"><a href="/"><img style="width: 290px;" src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/202204152017786.png"></a></h1>
		<h2 class="header__subtitle">梦入琼楼寒有月，行过石树冻无烟</h2>
	</header>

	<main>
		<article>
	
		<h1>Node.js MySql at Sequelize</h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/node-js/" rel="tag">node.js</a>
			</span>
		
	</div>

	

	
		<p>这是通过了 npm 注册中心所发布的 node.js 模块，并由 node.js 驱动，以 JavaScript 编写且并不需要编译，并 100% 遵循了 MIT 许可证，可直接使用 npm 进行安装：</p>
<blockquote>
<p>npm install mysql</p>
<p>在 MySQL 创建一个表和库</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&gt; create databases node</span><br><span class="line">&gt; use node</span><br><span class="line">&gt; create table user (</span><br><span class="line">    -&gt; id int COMMENT &quot;编号&quot;,</span><br><span class="line">    -&gt; name varchar(40) COMMENT &quot;名称&quot;</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.015 sec)</span><br><span class="line"></span><br><span class="line">&gt; INSERT INTO user(id,name) value (&#x27;2&#x27;,&#x27;mysql_user&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.003 sec)</span><br><span class="line"></span><br><span class="line">&gt; INSERT INTO user(id,name) value (&#x27;1&#x27;,&#x27;users_node&#x27;);</span><br><span class="line">Query OK, 1 row affected (0.003 sec)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> connection = mysql.<span class="title function_">createConnection</span>(&#123;</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">user</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;toor&#x27;</span>,</span><br><span class="line">    <span class="attr">database</span>: <span class="string">&#x27;node&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">connection.<span class="title function_">connect</span>(<span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;connection is error&#x27;</span> + err.<span class="property">stack</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;threadId:&#x27;</span> + connection.<span class="property">threadId</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> showUser = <span class="string">&quot;SELECT * FROM user;&quot;</span></span><br><span class="line"></span><br><span class="line">connection.<span class="title function_">query</span>(showUser,<span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;show user:&#x27;</span>,result[<span class="number">0</span>])</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">connection.<span class="title function_">end</span>() <span class="comment">// or connection.destory()</span></span><br></pre></td></tr></table></figure>

<h2 id="Sequelize"><a href="#Sequelize" class="headerlink" title="Sequelize"></a>Sequelize</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/javascript/node.js/19.node.js%20mysql%20at%20sequelize%20.md/1705434495801.png"></p>
<p>在 node.js 所提供的 <code>mysql</code> 库中，多基于命令形式并通过 <code>connection,query</code> 来实现与数据库的交互，并提供了很多链接方法，如连接池等，而对于开发项目来说这种方式和并不利于项目在生产环境的发布。</p>
<p>因此基于 <code>mysql</code> 所提供的接口，Node 提供了 ORM(Object-Relational Mapping) 来将数据库的表结构来映射到数据库中，这种方式不仅统一了风格还使得与 SQL 的操作变得规范，但核心还是基于 <code>mysql</code> 库。</p>
<p>Sequelize 是一个基于 Promise 的 Node.js ORM，并适用与 Postgres、MySQL、MariaDB、SQLite、Microsoft SQL Server。相对于直接使用原生 <code>mysql</code> 库，直接使用 ORM 格式显得更加的规范和简洁。在 Node.js 中使用 <code>Sequelize</code> 可以直接通过 npm 进行安装，同样的由于 Sequelize 是一个方法约定，因此需要安装 <code>mysql2</code> 作为主要依赖：</p>
<blockquote>
<p>npm install sequelize<br>npm install mysql2</p>
</blockquote>
<p>首先需要创建一个 <code>config.js</code> 文件用于作为配置文件并通过 <code>app.js</code> 进行连接。</p>
<blockquote>
<p>config.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> config = &#123;</span><br><span class="line">    <span class="attr">databases</span>: <span class="string">&#x27;node&#x27;</span>,</span><br><span class="line">    <span class="attr">username</span>: <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">    <span class="attr">password</span>: <span class="string">&#x27;toor&#x27;</span>,</span><br><span class="line">    <span class="attr">host</span>: <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="attr">port</span>: <span class="string">&#x27;3306&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = config</span><br></pre></td></tr></table></figure>

<blockquote>
<p>app.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Sequelize</span> = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sequelize = <span class="keyword">new</span> <span class="title class_">Sequelize</span>(config.<span class="property">databases</span>, config.<span class="property">username</span>, config.<span class="property">password</span>, &#123;</span><br><span class="line">    <span class="attr">host</span>: config.<span class="property">host</span>,</span><br><span class="line">    <span class="attr">dialect</span>: <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="attr">pool</span>: &#123;</span><br><span class="line">        <span class="attr">max</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">min</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">idle</span>: <span class="number">30000</span>     <span class="comment">// 连接在被释放之前可以空闲的最长时间（以毫秒为单位）。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">sequelize</span><br><span class="line">    .<span class="title function_">authenticate</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Connection has been established successfully</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接已成功建立&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Unable to connect to the database</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;无法连接到数据库&#x27;</span>, err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="Data-Types"><a href="#Data-Types" class="headerlink" title="Data Types"></a>Data Types</h3><p>Sequelize 的数据类型主要分为 8 种，均代替原生数据库语法以进行统一并适配多种数据库写法，其中 mysql 的对应关系为：</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Name</th>
<th>MySql</th>
<th>Type</th>
<th>Info</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>DataTypes.STRING</td>
<td>VARCHAR(255)</td>
<td>Strings</td>
<td>长度在 1 到 ~ 字符之间的可变长度的字符串（VARCHAR 字段在创建时必须定义长度，Sequelize 默认的 VARCHAR 为 255）</td>
</tr>
<tr>
<td></td>
<td>DataTypes.STRING(1234)</td>
<td>VARCHAR(1234)</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>DataTypes.SIRING.BINARY</td>
<td>VARCHAR BINARY</td>
<td></td>
<td>BLOB 是“二进制大对象”，用于存储大量二进制数据，例如图像或其他类型的文件。</td>
</tr>
<tr>
<td>2</td>
<td>DataTypes.TEXT</td>
<td>TEXT</td>
<td></td>
<td>最大长度为 65535 个字符的字段。BLOB 是“二进制大对象”，用于存储大量二进制数据，例如图像或其他类型的文件， 定义为 TEXT 的字段也包含大量数据。 两者的区别在于对存储数据的排序和比较在 BLOB 中区分大小写，而在 TEXT 字段中不区分大小写。</td>
</tr>
<tr>
<td></td>
<td>DataTypes.TEXT(‘tiny’)</td>
<td>TINYTEXT</td>
<td></td>
<td>最大长度为 255 个字符的 BLOB 或 TEXT 列</td>
</tr>
<tr>
<td>4</td>
<td>DataTypes.Boolean</td>
<td>TINYINT(1)</td>
<td>Boolean</td>
<td>一个可以有符号或无符号的非常小的整数,如果有符号，则允许的范围是从 -128 到 127。如果是无符号，则允许的范围是从 0 到 255。</td>
</tr>
<tr>
<td>5</td>
<td>DataTypes.INTEGER</td>
<td>INTEGER</td>
<td>Numbers</td>
<td>一个可以有符号或无符号的非常小的整数,如果有符号，则允许的范围是从 -128 到 127。如果是无符号，则允许的范围是从 0 到 255。</td>
</tr>
<tr>
<td></td>
<td>DataTypes.INTEGER.UNSIGNED</td>
<td></td>
<td>Unsigned &amp; Zerofill integers(无符号和零填充整数)</td>
<td>一个可以有符号或无符号的非常小的整数</td>
</tr>
<tr>
<td></td>
<td>DataTypes.ZEROFILL</td>
<td></td>
<td></td>
<td>零填充</td>
</tr>
<tr>
<td></td>
<td>DataTypes.INTEGER.UNSIGNED.ZEROFILL</td>
<td></td>
<td></td>
<td>一个可以有符号或无符号的非常小的整数,且零填充</td>
</tr>
<tr>
<td>6</td>
<td>DataTypes.BIGINT</td>
<td>BIGINT</td>
<td></td>
<td>可以有符号或无符号的大整数。,如果有符号，则允许范围为 -9223372036854775808 到 9223372036854775807。如果没有符号，则允许范围为 0 到 18446744073709551615。</td>
</tr>
<tr>
<td>7</td>
<td>DataType.FLOAT</td>
<td>FLOAT</td>
<td></td>
<td>不能无符号的浮点数,可以定义显示长度 (M) 和小数位数 (D),这不是必需的，默认为 10,2，其中 2 是小数位数，10 是总位数（包括小数）,	对于 FLOAT，十进制精度可以达到 24 位。</td>
</tr>
<tr>
<td>8</td>
<td>DataType.DOUBLE</td>
<td>DOUBLE</td>
<td></td>
<td>不能无符号的双精度浮点数,您可以定义显示长度 (M) 和小数位数 (D),这不是必需的，默认为 16,4，其中 4 是小数位数。 DOUBLE 的十进制精度可以达到 53 位, REAL 是 DOUBLE 的同义词。</td>
</tr>
<tr>
<td>9</td>
<td>DataType.DECIMAL</td>
<td>DECIMAL</td>
<td></td>
<td>无法无符号的解压缩浮点数,在未压缩的十进制中，每个十进制对应一个字节。 需要定义显示长度 (M) 和小数位数 (D)。 NUMERIC 是 DECIMAL 的同义词。</td>
</tr>
<tr>
<td>10</td>
<td>DataType.DATE</td>
<td>DATETIME</td>
<td>Dates</td>
<td>日期和时间的组合。 格式：YYYY-MM-DD hh:mm:ss。 支持的范围是从“1000-01-01 00:00:00”到“9999-12-31 23:59:59”。 在列定义中添加 DEFAULT 和 ON UPDATE 以获取自动初始化并更新到当前日期和时间</td>
</tr>
<tr>
<td>11</td>
<td>DataType.DATEONLY</td>
<td>DATE</td>
<td></td>
<td>一个日期,格式:YYYY-MM-DD。支持的范围从“1000-01-01”到“99999 -12-31”</td>
</tr>
</tbody></table>
<p>sequelize 可通过 <code>sequlize.define</code> 来定义一个模型，之后通过 <code>model.create</code> 来创建模型的数据信息，之后使用 <code>sequlize.sync</code> 同步到数据库中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Sequelize</span> = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sequelize = <span class="keyword">new</span> <span class="title class_">Sequelize</span>(config.<span class="property">databases</span>, config.<span class="property">username</span>, config.<span class="property">password</span>, &#123;</span><br><span class="line">    <span class="attr">host</span>: config.<span class="property">host</span>,</span><br><span class="line">    <span class="attr">dialect</span>: <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="attr">pool</span>: &#123;</span><br><span class="line">        <span class="attr">max</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">min</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">idle</span>: <span class="number">30000</span>     <span class="comment">// 连接在被释放之前可以空闲的最长时间（以毫秒为单位）。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">sequelize</span><br><span class="line">    .<span class="title function_">authenticate</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Connection has been established successfully</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接已成功建立&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Unable to connect to the database</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;无法连接到数据库&#x27;</span>, err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个模型</span></span><br><span class="line"><span class="keyword">var</span> users = sequelize.<span class="title function_">define</span>(<span class="string">&#x27;users&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="title function_">STRING</span>(<span class="number">40</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,        <span class="comment">// 作为主键的字段一部分不可以包含 null value 且一个表中只能有一个</span></span><br><span class="line">        <span class="attr">uniqueKey</span>: <span class="literal">true</span>         <span class="comment">//  唯一键，该表没有两个不同的行或这些列的值相同的记录</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">Sequelize</span>.<span class="title function_">STRING</span>(<span class="number">90</span>),</span><br><span class="line">    <span class="attr">gender</span>: <span class="title class_">Sequelize</span>.<span class="property">BOOLEAN</span>,</span><br><span class="line">    <span class="attr">createAt</span>: <span class="title class_">Sequelize</span>.<span class="property">BIGINT</span>,</span><br><span class="line">    <span class="attr">updateAt</span>: <span class="title class_">Sequelize</span>.<span class="property">BIGINT</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">timestamps</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前时间戳的默认值</span></span><br><span class="line"><span class="keyword">var</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line"></span><br><span class="line">users.<span class="title function_">create</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Administrator&#x27;</span>,</span><br><span class="line">    <span class="attr">gender</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">createAt</span>: now,</span><br><span class="line">    <span class="attr">updateAt</span>: now</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">p</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;created:&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(p))</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;failed:&#x27;</span> + err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步链接</span></span><br><span class="line">sequelize.<span class="title function_">sync</span>()</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="CURD"><a href="#CURD" class="headerlink" title="CURD"></a>CURD</h3><h4 id="Select"><a href="#Select" class="headerlink" title="Select"></a>Select</h4><p>Sequelize 提供了两种查询方法，一种分别为 <code>sequlize.fn</code> 以及 <code>WHERE</code> 子句以及更为负责的 <code>Operator</code>，本文我们以最为常用的  <code>WHERE</code> 子句作为演示：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Sequelize</span> = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sequelize = <span class="keyword">new</span> <span class="title class_">Sequelize</span>(config.<span class="property">databases</span>, config.<span class="property">username</span>, config.<span class="property">password</span>, &#123;</span><br><span class="line">    <span class="attr">host</span>: config.<span class="property">host</span>,</span><br><span class="line">    <span class="attr">dialect</span>: <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="attr">pool</span>: &#123;</span><br><span class="line">        <span class="attr">max</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">min</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">idle</span>: <span class="number">30000</span>     <span class="comment">// 连接在被释放之前可以空闲的最长时间（以毫秒为单位）。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">sequelize</span><br><span class="line">    .<span class="title function_">authenticate</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Connection has been established successfully</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接已成功建立&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Unable to connect to the database</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;无法连接到数据库&#x27;</span>, err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个模型</span></span><br><span class="line"><span class="keyword">var</span> users = sequelize.<span class="title function_">define</span>(<span class="string">&#x27;users&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="title function_">STRING</span>(<span class="number">40</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,        <span class="comment">// 作为主键的字段一部分不可以包含 null value 且一个表中只能有一个</span></span><br><span class="line">        <span class="attr">uniqueKey</span>: <span class="literal">true</span>         <span class="comment">//  唯一键，该表没有两个不同的行或这些列的值相同的记录</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">Sequelize</span>.<span class="title function_">STRING</span>(<span class="number">90</span>),</span><br><span class="line">    <span class="attr">gender</span>: <span class="title class_">Sequelize</span>.<span class="property">BOOLEAN</span>,</span><br><span class="line">    <span class="attr">createAt</span>: <span class="title class_">Sequelize</span>.<span class="property">BIGINT</span>,</span><br><span class="line">    <span class="attr">updateAt</span>: <span class="title class_">Sequelize</span>.<span class="property">BIGINT</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">timestamps</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    find 1 tousers</span></span><br><span class="line"><span class="comment">    &#123;&quot;id&quot;:&quot;1&quot;,&quot;name&quot;:&quot;Administrator&quot;,&quot;gender&quot;:false,&quot;createAt&quot;:1631729482972,&quot;updateAt&quot;:1631729482972&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">tofind =  <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> tousers = <span class="keyword">await</span> users.<span class="title function_">findAll</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`find <span class="subst">$&#123;tousers.length&#125;</span> tousers`</span>)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> u <span class="keyword">of</span> tousers) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(u))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">tofind</span>()</span><br></pre></td></tr></table></figure>

<h4 id="Add"><a href="#Add" class="headerlink" title="Add"></a>Add</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Sequelize</span> = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sequelize = <span class="keyword">new</span> <span class="title class_">Sequelize</span>(config.<span class="property">databases</span>, config.<span class="property">username</span>, config.<span class="property">password</span>, &#123;</span><br><span class="line">    <span class="attr">host</span>: config.<span class="property">host</span>,</span><br><span class="line">    <span class="attr">dialect</span>: <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="attr">pool</span>: &#123;</span><br><span class="line">        <span class="attr">max</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">min</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">idle</span>: <span class="number">30000</span>     <span class="comment">// 连接在被释放之前可以空闲的最长时间（以毫秒为单位）。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">sequelize</span><br><span class="line">    .<span class="title function_">authenticate</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Connection has been established successfully</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接已成功建立&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Unable to connect to the database</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;无法连接到数据库&#x27;</span>, err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个模型</span></span><br><span class="line"><span class="keyword">var</span> users = sequelize.<span class="title function_">define</span>(<span class="string">&#x27;users&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="title function_">STRING</span>(<span class="number">40</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,        <span class="comment">// 作为主键的字段一部分不可以包含 null value 且一个表中只能有一个</span></span><br><span class="line">        <span class="attr">uniqueKey</span>: <span class="literal">true</span>         <span class="comment">//  唯一键，该表没有两个不同的行或这些列的值相同的记录</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">Sequelize</span>.<span class="title function_">STRING</span>(<span class="number">90</span>),</span><br><span class="line">    <span class="attr">gender</span>: <span class="title class_">Sequelize</span>.<span class="property">BOOLEAN</span>,</span><br><span class="line">    <span class="attr">createAt</span>: <span class="title class_">Sequelize</span>.<span class="property">BIGINT</span>,</span><br><span class="line">    <span class="attr">updateAt</span>: <span class="title class_">Sequelize</span>.<span class="property">BIGINT</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">timestamps</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// create:&#123;&quot;id&quot;:2,&quot;name&quot;:&quot;User&quot;,&quot;gender&quot;:true,&quot;createAt&quot;:1631731389401,&quot;updateAt&quot;:1631731389401&#125;</span></span><br><span class="line">tousers = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> addusers = <span class="keyword">await</span> users.<span class="title function_">create</span>(&#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="number">2</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;User&#x27;</span>,</span><br><span class="line">        <span class="attr">gender</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">createAt</span>: now,</span><br><span class="line">        <span class="attr">updateAt</span>: now</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;create:&#x27;</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(addusers))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">tousers</span>()</span><br></pre></td></tr></table></figure>

<h4 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h4><p>通过 Sequelize 所提供的方法直接使用 <code>destory()</code> 对查询到的数据进行破坏即可完成删除需求：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Sequelize</span> = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sequelize = <span class="keyword">new</span> <span class="title class_">Sequelize</span>(config.<span class="property">databases</span>, config.<span class="property">username</span>, config.<span class="property">password</span>, &#123;</span><br><span class="line">    <span class="attr">host</span>: config.<span class="property">host</span>,</span><br><span class="line">    <span class="attr">dialect</span>: <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="attr">pool</span>: &#123;</span><br><span class="line">        <span class="attr">max</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">min</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">idle</span>: <span class="number">30000</span>     <span class="comment">// 连接在被释放之前可以空闲的最长时间（以毫秒为单位）。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">sequelize</span><br><span class="line">    .<span class="title function_">authenticate</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Connection has been established successfully</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接已成功建立&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Unable to connect to the database</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;无法连接到数据库&#x27;</span>, err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个模型</span></span><br><span class="line"><span class="keyword">var</span> users = sequelize.<span class="title function_">define</span>(<span class="string">&#x27;users&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="title function_">STRING</span>(<span class="number">40</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,        <span class="comment">// 作为主键的字段一部分不可以包含 null value 且一个表中只能有一个</span></span><br><span class="line">        <span class="attr">uniqueKey</span>: <span class="literal">true</span>         <span class="comment">//  唯一键，该表没有两个不同的行或这些列的值相同的记录</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">Sequelize</span>.<span class="title function_">STRING</span>(<span class="number">90</span>),</span><br><span class="line">    <span class="attr">gender</span>: <span class="title class_">Sequelize</span>.<span class="property">BOOLEAN</span>,</span><br><span class="line">    <span class="attr">createAt</span>: <span class="title class_">Sequelize</span>.<span class="property">BIGINT</span>,</span><br><span class="line">    <span class="attr">updateAt</span>: <span class="title class_">Sequelize</span>.<span class="property">BIGINT</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">timestamps</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">todelete = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> delUser = <span class="keyword">await</span> users.<span class="title function_">findAll</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> d <span class="keyword">of</span> delUser) &#123;</span><br><span class="line">        <span class="keyword">await</span> d.<span class="title function_">destroy</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">todelete</span>()</span><br></pre></td></tr></table></figure>

<h4 id="Updete"><a href="#Updete" class="headerlink" title="Updete"></a>Updete</h4><p>对于 Sequlize 的修改同样是先进行查询后使用其 <code>Model</code> 进行修改数据，并通过 <code>.save()</code> 进行保存，从而达到更改数据字段的效果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Sequelize</span> = <span class="built_in">require</span>(<span class="string">&#x27;sequelize&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> mysql = <span class="built_in">require</span>(<span class="string">&#x27;mysql2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">&#x27;./config&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sequelize = <span class="keyword">new</span> <span class="title class_">Sequelize</span>(config.<span class="property">databases</span>, config.<span class="property">username</span>, config.<span class="property">password</span>, &#123;</span><br><span class="line">    <span class="attr">host</span>: config.<span class="property">host</span>,</span><br><span class="line">    <span class="attr">dialect</span>: <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="attr">pool</span>: &#123;</span><br><span class="line">        <span class="attr">max</span>: <span class="number">5</span>,</span><br><span class="line">        <span class="attr">min</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="attr">idle</span>: <span class="number">30000</span>     <span class="comment">// 连接在被释放之前可以空闲的最长时间（以毫秒为单位）。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">sequelize</span><br><span class="line">    .<span class="title function_">authenticate</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Connection has been established successfully</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;连接已成功建立&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Unable to connect to the database</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;无法连接到数据库&#x27;</span>, err)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个模型</span></span><br><span class="line"><span class="keyword">var</span> users = sequelize.<span class="title function_">define</span>(<span class="string">&#x27;users&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">id</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="title class_">Sequelize</span>.<span class="title function_">STRING</span>(<span class="number">40</span>),</span><br><span class="line">        <span class="attr">primaryKey</span>: <span class="literal">true</span>,        <span class="comment">// 作为主键的字段一部分不可以包含 null value 且一个表中只能有一个</span></span><br><span class="line">        <span class="attr">uniqueKey</span>: <span class="literal">true</span>         <span class="comment">//  唯一键，该表没有两个不同的行或这些列的值相同的记录</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">name</span>: <span class="title class_">Sequelize</span>.<span class="title function_">STRING</span>(<span class="number">90</span>),</span><br><span class="line">    <span class="attr">gender</span>: <span class="title class_">Sequelize</span>.<span class="property">BOOLEAN</span>,</span><br><span class="line">    <span class="attr">createAt</span>: <span class="title class_">Sequelize</span>.<span class="property">BIGINT</span>,</span><br><span class="line">    <span class="attr">updateAt</span>: <span class="title class_">Sequelize</span>.<span class="property">BIGINT</span></span><br><span class="line">&#125;, &#123;</span><br><span class="line">    <span class="attr">timestamps</span>: <span class="literal">false</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> now = <span class="title class_">Date</span>.<span class="title function_">now</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    MariaDB [node]&gt; select * from users;</span></span><br><span class="line"><span class="comment">    +----+---------------+--------+---------------+---------------+</span></span><br><span class="line"><span class="comment">    | id | name          | gender | createAt      | updateAt      |</span></span><br><span class="line"><span class="comment">    +----+---------------+--------+---------------+---------------+</span></span><br><span class="line"><span class="comment">    | 1  | Administrator |      1 | 1631729482972 | 1631731823059 |</span></span><br><span class="line"><span class="comment">    +----+---------------+--------+---------------+---------------+</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">toupdete = <span class="title function_">async</span>() =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> upAdmin = <span class="keyword">await</span> users.<span class="title function_">findAll</span>(&#123;</span><br><span class="line">        <span class="attr">where</span>: &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> u <span class="keyword">of</span> upAdmin) &#123;</span><br><span class="line">        u.<span class="property">gender</span> = <span class="literal">true</span></span><br><span class="line">        u.<span class="property">updateAt</span> = now</span><br><span class="line">        <span class="keyword">await</span> u.<span class="title function_">save</span>()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">toupdete</span>()</span><br></pre></td></tr></table></figure>
	

	
		<span class="different-posts"><a href="/2022/04/21/javascript/node/19.Node.js%20MySQL%20at%20Sequelize%20/" onclick="window.history.go(-1); return false;">⬅️ Go back </a></span>

	

</article>

	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>欢迎来到我的 blog <br><br> 通过 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>+<a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a> 进行构建的，存放在 <a target="_blank" rel="noopener" href="https://github.com/vendanges/vendanges.github.io">Github</a> 上。</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2022 John Doe | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
