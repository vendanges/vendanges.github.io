<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>ç¼ç‘¶</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="ç¼ç‘¶" type="application/atom+xml">
    
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link" style="color: #fff">Home</a>
			
				<a href="/archives" class="header__link" style="color: #fff">Archive</a>
			
				<a href="/about" class="header__link" style="color: #fff">About</a>
			
		</nav>
		<!-- <h1 class="header__title"><a href="/">ç¼ç‘¶</a></h1> -->
		<h1 class="header__title"><a href="/"><img style="width: 290px;" src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/202204152017786.png"></a></h1>
		<h2 class="header__subtitle">æ¢¦å…¥ç¼æ¥¼å¯’æœ‰æœˆï¼Œè¡Œè¿‡çŸ³æ ‘å†»æ— çƒŸ</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">ğŸ“– <a href="/page/13">earlier posts</a> ğŸ“–</span>




	<article>
	
		<h1><a href="/2022/04/21/java/spring cloud/8.Spring cloud Hystrix å®¹é”™å¤„ç†/">Spring cloud Hystrix å®¹é”™å¤„ç†</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/java/" rel="tag">java</a> <a class="article__tag-none-link" href="/tags/spring-cloud/" rel="tag">spring cloud</a>
			</span>
		
	</div>

	

	
		<p>Hystrix æ˜¯ç”± Netflix å¼€æºçš„ä¸€ä¸ªå»¶è¿Ÿå’Œå®¹é”™åº“ï¼Œæ—¨åœ¨éš”ç¦»å¯¹è¿œç¨‹ç³»ç»Ÿã€æœåŠ¡å’Œç¬¬ä¸‰æ–¹åº“çš„è®¿é—®ç‚¹ï¼Œä»–ä¸»è¦é€šè¿‡ï¼šâ€œéš”ç¦»ã€é™çº§ã€èæ–­ã€ç¼“å­˜â€ï¼Œç­‰æ–¹å¼æ¥é¿å…æˆ–è§£å†³é›ªå´©æ•ˆåº”ã€‚å¤„ç†å’Œé¢„é˜²è¿™ç±»é—®é¢˜çš„é¡¹ç›®ä¹Ÿå¾ˆå¤šï¼Œé€šå¸¸ä¸»æµçš„æ˜¯ Sentinelã€Hystrixã€Resillience4j ä¸‰ç±»è§£å†³æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>Sentinel</p>
<blockquote>
<p>é˜¿é‡Œå·´å·´äº 2012å¹´ å‘å¸ƒçš„é¢å‘åˆ†å¸ƒå¼æœåŠ¡æ¶æ„çš„è½»é‡çº§æµé‡æ§åˆ¶ç»„ä»¶ã€‚</p>
</blockquote>
<p>Resilience4j </p>
<blockquote>
<p>ä»–æ˜¯ä¸€ä¸ªå— Netfilx Hystrix å¯å‘çš„è½»é‡çº§å®¹é”™åº“ï¼Œä¸“é—¨ä¸ºå‡½æ•°å¼ç¼–ç¨‹è€Œè®¾è®¡</p>
</blockquote>
</blockquote>
<h2 id="é›ªå´©æ•ˆåº”"><a href="#é›ªå´©æ•ˆåº”" class="headerlink" title="é›ªå´©æ•ˆåº”"></a>é›ªå´©æ•ˆåº”</h2><p>é›ªå´©æ•ˆåº”ä¹Ÿè¢«ç§°ä¹‹ä¸º â€œæœåŠ¡é›ªå´©â€ï¼Œè€Œé›ªå´©æ•ˆåº”çš„é€ æˆå°±æ˜¯ <strong>çº§è”</strong> çš„å´©æºƒï¼Œå‡è®¾æœåŠ¡Aè°ƒç”¨æœåŠ¡Bï¼ŒæœåŠ¡Bè°ƒç”¨æœåŠ¡Cï¼ŒæœåŠ¡Cè°ƒç”¨æœåŠ¡Dï¼Œè¿™å…¶ä¸­ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æ— æ³•ä½¿ç”¨ï¼Œå°±ä¼šé€ æˆä¸‹é¢çš„æœåŠ¡æ— æ³•ä½¿ç”¨ï¼Œè¿™å°±ä¼šäº§ç”Ÿçº§è”æ•…éšœã€‚</p>
<p>å¦‚æœè¿™ç§è¯·æ±‚å¾ˆå¤šï¼Œé‚£ä¹ˆå°†ä¼šå¯¼è‡´ä¸å¯ç”¨çš„æœåŠ¡è¶Šæ¥è¶Šå¤šï¼Œä¹‹åå ç”¨çš„è®¡ç®—æœºèµ„æºä¹Ÿè¶Šå¤šï¼Œè€Œè¿™äº›è¯·æ±‚åˆ™ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œå¯¼è‡´å…¶ä»–è¯·æ±‚ä¹Ÿä¸å¯ç”¨ï¼Œè¿™ç§ç°è±¡ä¹Ÿè¢«ç§°ä¹‹ä¸ºï¼šâ€œæœåŠ¡é›ªå´©â€ã€‚</p>
<blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´å½“æœåŠ¡æä¾›è€…å¯¼è‡´äº†æœåŠ¡æ¶ˆè´¹è€…ä¸å¯ä½¿ç”¨ï¼Œå¹¶å°†é—®é¢˜é€æ¸æ”¾å¤§è‡³å¾®æœåŠ¡ç³»ç»Ÿï¼Œè¿›è€Œé€ æˆç³»ç»Ÿå´©æºƒã€‚</p>
</blockquote>
<h3 id="é€ æˆé›ªå´©åŸå› "><a href="#é€ æˆé›ªå´©åŸå› " class="headerlink" title="é€ æˆé›ªå´©åŸå› "></a>é€ æˆé›ªå´©åŸå› </h3><p>é›ªå´©æ•ˆåº”çš„é€ æˆåŸå› å¯ä»¥æ˜¯æµé‡æ¿€å¢ã€ç¡¬ä»¶æ•…éšœã€bugã€ç¼“å­˜ã€èµ„æºè€—å°½ã€çº¿ç¨‹åŒæ­¥ç­‰å¾…ã€é…å¥—èµ„æºä¸å¯ç”¨ç­‰ï¼š</p>
<h4 id="æµé‡æ¿€å¢"><a href="#æµé‡æ¿€å¢" class="headerlink" title="æµé‡æ¿€å¢"></a>æµé‡æ¿€å¢</h4><p>åœ¨ç›®å‰ï¼Œé€ æˆæµé‡æ¿€å¢çš„æ–¹å¼å¯ä»¥æ¶æ„æ”»å‡»ï¼Œæˆ–è€…è¯´æ˜¯çˆ¬è™«é€ æˆçš„éƒ½æœ‰å¯èƒ½ï¼Œè¿™ç§ä¸»è¦ä½“ç°åœ¨äº†äº¬ä¸œ 6Â·18 æ´»åŠ¨ä¸­ã€‚</p>
<h4 id="ç¡¬ä»¶æ•…éšœ"><a href="#ç¡¬ä»¶æ•…éšœ" class="headerlink" title="ç¡¬ä»¶æ•…éšœ"></a>ç¡¬ä»¶æ•…éšœ</h4><p>å‡è®¾ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œæœ‰ä¸¤ä¸ªæœåŠ¡æä¾›è€…ï¼Œä¸€ä¸ªæœåŠ¡æä¾›è€…çš„ç¡¬ä»¶æŸå®³ã€‚é‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±æˆä¸ºäº†å•ç‚¹åº”ç”¨ï¼Œå¯¼è‡´æœåŠ¡çš„å‹åŠ›åŠ å¤§ï¼Œä»è€Œå‡ºç°äº†æœåŠ¡å»¶è¿Ÿï¼Œç”±äºæœåŠ¡å»¶è¿Ÿçš„ä¸æ–­å¢åŠ ï¼Œæœ€ç»ˆå¯¼è‡´äº†é›ªå´©ã€‚</p>
<h4 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h4><p>é€šå¸¸ç¨‹åºä¸­å‡ºç° bug éƒ½æ˜¯æ­£å¸¸çš„äº‹æƒ…ï¼Œåœ¨ spring cloud ä¸­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªä¸åº”è¯¥è¢«ç±»ä½¿ç”¨çš„æ¥å£è¢«è°ƒç”¨ï¼Œåˆ™ä¼šé€ æˆæœåŠ¡ä¹‹é—´çš„äº’ç›¸è°ƒç”¨å¯¼è‡´çš„å¾ªç¯é€»è¾‘é—®é¢˜ï¼Œåˆ™ä¼šå¯èƒ½å¯¼è‡´æœåŠ¡é›ªå´©ã€‚</p>
<h4 id="ç¼“å­˜é—®é¢˜"><a href="#ç¼“å­˜é—®é¢˜" class="headerlink" title="ç¼“å­˜é—®é¢˜"></a>ç¼“å­˜é—®é¢˜</h4><p>ç¼“å­˜é—®é¢˜ä¸»è¦å¯ä»¥åˆ†ä¸ºç¼“å­˜ç©¿é€ã€ç¼“å­˜å‡»ç©¿ã€ç¼“å­˜é›ªå´©ç­‰ä¸‰ä¸ªé—®é¢˜ï¼š</p>
<h5 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h5><p>ç¼“å­˜ç©¿é€æŒ‡çš„æ˜¯ç”¨æˆ·ä¸æ–­è¯·æ±‚æ•°æ®åº“ä¸­æ²¡æœ‰çš„æ•°æ®ï¼Œè¿™å°†ä¼šå¯¼è‡´æ•°æ®åº“çš„å‹åŠ›è¿‡å¤§ã€‚è‡³äºè¿™ç§é—®é¢˜çš„é˜²èŒƒé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä¸‹è¿°æ–¹æ³•è§£å†³ï¼š</p>
<ol>
<li>åœ¨è·¯ç”±ä¸­å¢åŠ æƒé™æ ¡éªŒ</li>
<li>è®¾ç½®æœ€å¤§ï¼ˆmaxï¼‰ä¸æœ€å°ï¼ˆminï¼‰çš„æ‹¦æˆªè¯·æ±‚ï¼ˆå¤§äºç­‰äºæˆ–å°äºç­‰äºï¼‰</li>
</ol>
<h5 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h5><p>ç¼“å­˜å‡»ç©¿æ˜¯æŒ‡ <strong>ç¼“å­˜æ²¡æœ‰æ•°æ®ï¼Œä½†æ•°æ®åº“ä¸­æœ‰æ•°æ®ï¼ˆé€šå¸¸æ˜¯ç¼“å­˜æ—¶é—´åˆ°æœŸäº†ï¼‰</strong>ï¼Œå½“ç”¨æˆ·åœ¨ç¼“å­˜ä¸­æ²¡æœ‰å¾—åˆ°æ•°æ®ï¼Œå°±ä»æ•°æ®åº“ä¸­è·å¾—æ•°æ®ï¼Œä»è€Œè®©æ•°æ®åº“å‹åŠ›å¢å¤§ï¼Œå°±ä¼šé€ æˆç¼“å­˜å‡»ç©¿ã€‚</p>
<blockquote>
<p>è‡³äºé¢„é˜²ç¼“å­˜å‡»ç©¿ï¼Œé‚£ä¹ˆå°±å°±æ˜¯å°† <strong>çƒ­ç‚¹æ•°æ®</strong> è®¾ç½®ä¸ºæ°¸ä¸è¿‡æœŸï¼Œæ¥è§£å†³é—®é¢˜ã€‚</p>
</blockquote>
<h5 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h5><p>ç¼“å­˜é›ªå´©è¯´ç›´ç™½ä¸€ç‚¹ï¼Œå°±æ˜¯ç¼“å­˜å¤§é‡è¿‡æœŸï¼Œè€Œæ­¤æ—¶å¾ˆå¤šç”¨æˆ·éƒ½æ˜¯æŸ¥è¯¢ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œä»è€Œå°†æµé‡è½¬å‘æ•°æ®åº“ï¼Œè¿›ä¸€æ­¥å¯¼è‡´æ•°æ®åº“å®•æœºã€‚é¢„é˜²è¿™ç§é—®é¢˜éœ€è¦é€šè¿‡å°†ç¼“å­˜æ•°æ®çš„è¿‡æœŸæ—¶é—´ä¸º <strong>éšæœºï¼Œä»¥æ­¤æ¥é˜²æ­¢æ•°æ®ç¼“å­˜åŒä¸€æ—¶é—´å¤§é‡è¿‡æœŸã€‚</strong> å¦‚æœå°†ç¼“å­˜å‡»ç©¿çš„é—®é¢˜è§£å†³äº†ï¼Œé‚£ä¹ˆç¼“å­˜é›ªå´©çš„é—®é¢˜ä¹Ÿå¯ä»¥é€‚å½“çš„é¢„é˜²ã€‚</p>
<h4 id="èµ„æºè€—å°½"><a href="#èµ„æºè€—å°½" class="headerlink" title="èµ„æºè€—å°½"></a>èµ„æºè€—å°½</h4><p>èµ„æºè€—å°½ä¸»è¦ç”±ä¸¤ç§åŸå› é€ æˆçš„åŸå› å¯ä»¥æ˜¯ï¼šâ€œæœåŠ¡æä¾›è€…ä¸å¯ç”¨ï¼Œå¯¼è‡´æœåŠ¡æ¶ˆè´¹è€…ç­‰å¾…ï¼Œè¿›è€Œé€ æˆèµ„æºæ¶ˆè€—â€ï¼Œä¹Ÿå¯æ˜¯ç”¨æˆ·çš„å¤§é‡æµé‡è¯·æ±‚ï¼Œä»¥åŠé‡è¯•æµé‡åŠ å¤§å¯¼è‡´çš„ã€‚</p>
<h4 id="çº¿ç¨‹åŒæ­¥ç­‰å¾…"><a href="#çº¿ç¨‹åŒæ­¥ç­‰å¾…" class="headerlink" title="çº¿ç¨‹åŒæ­¥ç­‰å¾…"></a>çº¿ç¨‹åŒæ­¥ç­‰å¾…</h4><p>å‡è®¾ç³»ç»Ÿé‡‡ç”¨çš„æ˜¯æœåŠ¡è°ƒç”¨æ¨¡å¼ï¼Œ<strong>æ ¸å¿ƒæœåŠ¡å’Œéæ ¸å¿ƒæœåŠ¡å…±ç”¨ä¸€ä¸ªçº¿ç¨‹æ± ä»¥åŠæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‡è®¾ä¸€ä¸ªæ ¸å¿ƒçš„ä¸šåŠ¡çº¿ç¨‹è°ƒç”¨äº†ä¸€ä¸ªéæ ¸å¿ƒè¿›ç¨‹</strong>ï¼Œé‚£ä¹ˆè¿™ä¸ªéæ ¸å¿ƒè¿›ç¨‹ä¸€æ—¦å‡ºç°é—®é¢˜ï¼Œåˆ™å¯¼è‡´æ ¸å¿ƒçº¿ç¨‹å‡ºç°é—®é¢˜ã€‚å¦‚æœæ ¸å¿ƒçº¿ç¨‹æ–­äº†ï¼Œé‚£ä¹ˆå°†ä¼šå¯¼è‡´åç»­çš„çº¿ç¨‹ä¹Ÿä¸€ä¸€å´©æºƒï¼Œæœ€ç»ˆå¯¼è‡´é›ªå´©ã€‚</p>
<h4 id="é…å¥—èµ„æºä¸å¯ç”¨"><a href="#é…å¥—èµ„æºä¸å¯ç”¨" class="headerlink" title="é…å¥—èµ„æºä¸å¯ç”¨"></a>é…å¥—èµ„æºä¸å¯ç”¨</h4><p>é…å¥—èµ„æºä¸å¯ç”¨å¯èƒ½æ˜¯æ•°æ®ä¸­å¿ƒä¸å¯ç”¨æˆ–è€…ç”µä¿¡åŸºç¡€ç½‘ç»œæœåŠ¡å‡ºç°é—®é¢˜ï¼Œæ¬£æ…°çš„æ˜¯è¿™ç±»äº‹æ•…å‡ºç°çš„æ¦‚ç‡æä½ã€‚</p>
<h3 id="Hystrix-çš„è§£å†³æ–¹å¼"><a href="#Hystrix-çš„è§£å†³æ–¹å¼" class="headerlink" title="Hystrix çš„è§£å†³æ–¹å¼"></a>Hystrix çš„è§£å†³æ–¹å¼</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210704165337.png"></p>
<h4 id="ç†”æ–­æœºåˆ¶"><a href="#ç†”æ–­æœºåˆ¶" class="headerlink" title="ç†”æ–­æœºåˆ¶"></a>ç†”æ–­æœºåˆ¶</h4><p>è‡³äº Hystrix ç†”æ–­æœºåˆ¶ï¼Œä»–ä¸»è¦é€šè¿‡èæ–­å™¨æ¥æ‰§è¡Œèæ–­çš„å·¥ä½œï¼Œç†”æ–­å™¨åœ¨ç°å®ç”Ÿæ´»ä¸­çš„è¿ç”¨ä¸»è¦æ˜¯ â€œä¿é™©ä¸â€ã€‚</p>
<blockquote>
<p>ä¿é™©ä¸ï¼ˆfuseï¼‰çš„åœ¨ç”µå™¨çš„ä¸»è¦ä½œç”¨å°±æ˜¯ <strong>å½“ç”µå™¨çš„ç”µæµå¼‚å¸¸å‡é«˜åˆ°ä¸€å®šçƒ­åº¦çš„æ—¶å€™ï¼Œé‚£ä¹ˆä¿é™©ä¸è‡ªèº«ç†”æ–­æ¥åˆ‡æ–­ç”µæµï¼Œä»¥æ­¤æ¥ä¿æŠ¤ç”µè·¯çš„å®‰å…¨è¿è¡Œ</strong></p>
</blockquote>
<h5 id="å¿«é€Ÿå¤±è´¥åŠç†”æ–­æœºåˆ¶"><a href="#å¿«é€Ÿå¤±è´¥åŠç†”æ–­æœºåˆ¶" class="headerlink" title="å¿«é€Ÿå¤±è´¥åŠç†”æ–­æœºåˆ¶"></a>å¿«é€Ÿå¤±è´¥åŠç†”æ–­æœºåˆ¶</h5><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210704165348.png"><br>Hystrix çš„ç†”æ–­å™¨å¯ä»¥å®ç°å¿«é€Ÿå¤±è´¥ï¼Œæ‰€è°“å¿«é€Ÿå¤±è´¥å°±æ˜¯å½“ä¸€ä¸ªé—®é¢˜è¾¾åˆ°äº†æŸä¸ªè§„åˆ™çš„é˜€å€¼ï¼Œåˆ™è¯¥è¯·æ±‚ä»¥åè°ƒç”¨ä»»ä½•æ¥å£éƒ½ä¼šå¤±è´¥ï¼Œæœ€åå¯¼è‡´ä¸ä¼šè®¿é—®è¿œç¨‹æœåŠ¡å™¨ï¼Œä»¥æ­¤æ¥é˜²æ­¢åº”ç”¨ç¨‹åºå’Œèµ„æºçš„æ¶ˆè€—ã€‚</p>
<p>ç†”æ–­å™¨èƒ½å¤Ÿè¯Šæ–­é”™è¯¯æ˜¯å¦ç»è¿‡ä¿®æ­£ï¼Œå¦‚æœå·²ç»ä¿®æ­£é‚£ä¹ˆç†”æ–­å™¨åˆ™ä¼šå…³é—­ï¼Œè®©åº”ç”¨ç¨‹åºåœ¨æ­¤è°ƒç”¨æ“ä½œã€‚ç†”æ–­å™¨èƒ½å¤Ÿè®°å½•æœ€è¿‘è°ƒç”¨æ‰€å‘ç”Ÿçš„é”™è¯¯æ¬¡æ•°ï¼Œå‡è®¾ç†”æ–­å™¨å°äºé˜€å€¼ï¼Œåˆ™å¯ä»¥å…³é—­ï¼Œå¦åˆ™ç»§ç»­å¼€å¯ã€‚</p>
<p>ç†”æ–­åœ¨æ­£å¸¸çŠ¶æ€ä¸‹ï¼Œä¸€èˆ¬å¤„äºå…³é—­çŠ¶æ€ï¼Œå¦‚æœè°ƒç”¨çš„æœåŠ¡å‡ºé”™å€¼è¾¾åˆ°è«ä¸ªé˜€å€¼ï¼Œåˆ™ä¼šè®©å…¶å¿«é€Ÿå¤±æ•ˆï¼Œä»¥æ­¤æ¥é¿å…å¤§é‡çš„æ— æ•ˆè¯·æ±‚å½±å“ç³»ç»Ÿã€‚</p>
<p>ä¸€æ®µæ—¶é—´è¿‡åç†”æ–­æœºåˆ¶å°†ä¼šè¿›å…¥åŠå°è¯•çŠ¶æ€ï¼Œå…è®¸å°‘é‡è¯·æ±‚è¿›è¡Œå°è¯•ï¼Œå¦‚æœæˆåŠŸåˆ™å…³é—­ç†”æ–­çŠ¶æ€ï¼Œå¦åˆ™å°†ç»§ç»­æŒç»­ã€‚</p>
<h4 id="éš”ç¦»æœºåˆ¶"><a href="#éš”ç¦»æœºåˆ¶" class="headerlink" title="éš”ç¦»æœºåˆ¶"></a>éš”ç¦»æœºåˆ¶</h4><p>éš”ç¦»æœºåˆ¶ä¸»è¦åˆ†ä¸ºçº¿ç¨‹æ± éš”ç¦»ä»¥åŠä¿¡å·é‡éš”ç¦»æ¨¡å¼ï¼Œåœ¨ç—…æ¯’ä¼ æ’­ä¸­ä¸ºäº†é˜²æ­¢ç—…æ¯’æ‰©æ•£ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯éš”ç¦»ç—…æ¯’æºå¸¦è€…ï¼Œä»è€Œæ¥ä¿æŠ¤æ­£å¸¸çš„ä¸ªä½“ã€‚è¿™ç§æ–¹å¼åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ä¹Ÿé‡‡ç”¨éš”ç¦»çš„æ–¹å¼è¿›è¡Œå®¹é”™å¤„ç†ã€‚</p>
<h5 id="çº¿ç¨‹æ± éš”ç¦»æ¨¡å¼"><a href="#çº¿ç¨‹æ± éš”ç¦»æ¨¡å¼" class="headerlink" title="çº¿ç¨‹æ± éš”ç¦»æ¨¡å¼"></a>çº¿ç¨‹æ± éš”ç¦»æ¨¡å¼</h5><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210704224421.png"><br>åœ¨ Hystrix çš„çº¿ç¨‹æ± éš”ç¦»æ¨¡å¼ä¸‹ï¼Œä¼šä¸ºæ¯ä¸€ä¸ª <strong>ä¾èµ–å»ºç«‹ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œä»¥æ­¤æ¥å­˜å‚¨å½“å‰çš„ä¾èµ–è¯·æ±‚ï¼Œçº¿ç¨‹æ± å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚</strong> çº¿ç¨‹æ± çš„ä¸»è¦ä½œç”¨å°±æ˜¯éš”ç¦»çº¿ç¨‹çš„ä¾èµ–ï¼Œä»¥æ­¤æ¥é™åˆ¶çº¿ç¨‹çš„å¹¶å‘è®¿é—®å’Œé˜»å¡æ‰©å¼ ã€‚</p>
<p><strong>å½“æµé‡è¾¾åˆ°å³°å€¼çš„æ—¶å€™</strong>ï¼Œå¦‚æœä¸èƒ½åŠæ—¶å¤„ç†çš„è¯·æ±‚å°†ä¼šè¢«å­˜å‚¨åˆ°çº¿ç¨‹æ± åè¿›è¡Œå¤„ç†ã€‚<strong>è¿è¥ç¯å¢ƒè¢«éš”ç¦»æ—¶</strong>ï¼Œä¼šæ ¹æ®ä¾èµ–åˆ’åˆ†å¤šä¸ªçº¿ç¨‹æ± ï¼Œä»¥æ­¤æ¥è¿›è¡Œèµ„æºéš”ç¦»ï¼Œå°±ç®—è°ƒç”¨çš„æœåŠ¡ä»£ç å­˜åœ¨ bugï¼Œä¹Ÿä¸ä¼šå¯¹ç³»ç»Ÿçš„å…¶ä»–æœåŠ¡é€ æˆå½±å“ã€‚</p>
<h5 id="ä¿¡å·é‡éš”ç¦»æ¨¡å¼"><a href="#ä¿¡å·é‡éš”ç¦»æ¨¡å¼" class="headerlink" title="ä¿¡å·é‡éš”ç¦»æ¨¡å¼"></a>ä¿¡å·é‡éš”ç¦»æ¨¡å¼</h5><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210704224435.png"><br>ä¿¡å·é‡éš”ç¦»æ¨¡å¼ä¸»è¦ç”¨äºè®°å½•å½“å‰è¯·æ±‚çš„æ•°é‡ï¼Œä»–å†…åœ¨å­˜åœ¨äº†ä¸€ä¸ªç±»ä¼¼ <strong>â€œè§„åˆ™â€</strong> çš„ï¼Œå½“ä¿¡å·é‡å°äºç­‰äºè§„åˆ™å†…æœ€å¤§çš„æ•°é‡æ—¶ï¼Œå°†ä¼šä¸¢å¼ƒè¯·æ±‚ï¼Œå¦åˆ™å°†ä¼šæ‰§è¡Œè¯·æ±‚ï¼Œä¸”å¯¹å½“å‰çš„ä¿¡å·é‡åŠ ä¸€ã€‚</p>
<h4 id="æœåŠ¡é™çº§"><a href="#æœåŠ¡é™çº§" class="headerlink" title="æœåŠ¡é™çº§"></a>æœåŠ¡é™çº§</h4><p>æœåŠ¡é™çº§çš„ä¸»è¦æœºåˆ¶å°±æ˜¯ <strong>å¦‚æœä¸€ä¸ªèµ„æºå¿«ä¸å¤Ÿäº†ï¼Œåˆ™éœ€è¦å°†æŸäº›æœåŠ¡å…ˆå…³æ‰ï¼Œä¹‹åç­‰åˆ°èµ„æºè¶³å¤Ÿæ—¶åœ¨è¿›è¡Œå¼€å¯</strong>ï¼Œå’Œç†”æ–­çš„ç›®çš„ç›¸å·®æ— å‡ ï¼Œä»¥æ­¤æ¥ä¿è¯ä¸Šæ¸¸æœåŠ¡çš„ç¨³å®šæ€§ã€‚æ ¹æ®ä¸šåŠ¡çš„ä¸åŒï¼Œé™çº§ä¹Ÿåˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<h5 id="Fallback"><a href="#Fallback" class="headerlink" title="Fallback"></a>Fallback</h5><p>Fallback ä¸€è¯ä¹Ÿè¢«ç§°ä¹‹ä¸º â€œå€’é€€â€ çš„æ„æ€ï¼ŒåŠå¦‚æœæœåŠ¡å¤±è´¥ï¼Œé‚£ä¹ˆåˆ™ä¼šé€šè¿‡ fallback çš„æ–¹å¼è¿›è¡Œé™çº§ã€‚</p>
<h5 id="æœåŠ¡çº§è”æ¨¡å¼"><a href="#æœåŠ¡çº§è”æ¨¡å¼" class="headerlink" title="æœåŠ¡çº§è”æ¨¡å¼"></a>æœåŠ¡çº§è”æ¨¡å¼</h5><p>æœåŠ¡çº§è”æ¨¡å¼åˆ™æ˜¯å¦‚æœæœåŠ¡å¤±è´¥ï¼Œåˆ™éœ€è¦è°ƒç”¨å¤‡ç”¨æœåŠ¡ï¼ŒæœåŠ¡çº§è”æ¨¡å¼ä¼šå°½å¯èƒ½çš„è¿”å›æ•°æ®ã€‚</p>
<blockquote>
<p>è¿™æ ·çš„åšæ³•å¦‚æœè€ƒè™‘ä¸å……åˆ†ä¼šé€ æˆçº§è”çš„å´©æºƒï¼Œå‡è®¾åœ¨ç¼“å­˜å¤±è´¥åå°†å…¨éƒ¨æµé‡å¯¼åˆ°æ•°æ®åº“è¯·æ±‚ä¸­ï¼Œé‚£ä¹ˆæ•°æ®åº“å¯èƒ½ä¼šç›´æ¥å´©æºƒï¼Œå› æ­¤çº§è”æ¨¡å¼ä¹Ÿè€ƒéªŒå¼€å‘è€…çš„èƒ½åŠ›</p>
</blockquote>
<p>ç®€å•æ¥è®²æœåŠ¡é™çº§çš„ä¸¤ç§æ–¹å¼åˆ†åˆ«æ˜¯åˆ†çº§ï¼Œå°†æ•…éšœçš„æœåŠ¡ä¸¢å¼ƒï¼Œè€ŒæœåŠ¡çº§è”æ¨¡å¼åˆ™æ˜¯å°†è¯·æ±‚è½¬ç§»åœ¨å¦ä¸€ä¸ªé›†ç¾¤ä¸Šã€‚</p>
<h4 id="ç¼“å­˜æœºåˆ¶"><a href="#ç¼“å­˜æœºåˆ¶" class="headerlink" title="ç¼“å­˜æœºåˆ¶"></a>ç¼“å­˜æœºåˆ¶</h4><p>ç¼“å­˜æœºåˆ¶å°±æ˜¯å°†è¯·æ±‚çš„æ‰€æœ‰ç»“æœè¿›è¡Œç¼“å­˜ï¼Œå¦‚æœæœ‰ç›¸åŒçš„è¯·æ±‚å‘é€è¿‡æ¥ï¼Œåˆ™ç›´æ¥ä»ç¼“å­˜ä¸­å–å‡ºç»“æœï¼Œä»¥æ­¤æ¥å‡å°‘è¯·æ±‚çš„å¼€é”€ã€‚</p>
<h3 id="Hystrix-Fallback-å®ç°"><a href="#Hystrix-Fallback-å®ç°" class="headerlink" title="Hystrix Fallback å®ç°"></a>Hystrix Fallback å®ç°</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210705222024.png"><br>é€šå¸¸å›é€€æ–¹æ³•çš„å®ç°æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯é€šè¿‡ <code>feign</code> æ¥è¿›è¡Œå®ç°ï¼Œå¦ä¸€ç§è§£å†³æ–¹æ¡ˆåˆ™æ˜¯æ ¹æ® <code>@HystrixCommand</code> æ³¨è§£è¿›è¡Œå®ç°ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦æ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-hystrix --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.2.2.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>ä¹‹ååœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯åŠ¨ç±»ï¼Œåˆ†åˆ«å¼€å¯ consulã€feign ä»¥åŠæœåŠ¡ç†”æ–­</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å°½ç®¡ <code>@EnableCircuitBreaker</code> åœ¨ <strong>3.0.1</strong> å¼€å§‹ Hystrix å°±ä¸åœ¨ <code>Spring cloud Netfilx</code> ä¸­äº†ï¼Œä½†æ˜¯ä»–æ˜¯å”¯ä¸€ä¸€ä¸ªå®ç°æ–­è·¯å™¨çš„æ³¨è§£</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/CircuitBreaker.html">https://martinfowler.com/bliki/CircuitBreaker.html</a></p>
</blockquote>
</blockquote>
<h4 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">Hystrix</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">9900</span></span><br><span class="line"><span class="attr">spring.cloud.consul.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.cloud.consul.port</span>=<span class="string">8500</span></span><br><span class="line"><span class="attr">spring.cloud.consul.discovery.service-name</span>=<span class="string">service-provider</span></span><br><span class="line"><span class="attr">spring.cloud.consul.discovery.register</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">feign.hystrix.enabled</span>=<span class="string">true                                    # å¼€å¯ Hystrix</span></span><br></pre></td></tr></table></figure>


<h4 id="service"><a href="#service" class="headerlink" title="service"></a>service</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ Feign æ”¯æŒ Hystrixï¼Œå³æ·»åŠ  fallback å¤„ç†ç±»ï¼Œåœ¨æœåŠ¡ç†”æ–­æ—¶è¿”å› fallback ç±»ä¸­å†…å®¹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FeignClient(&quot;service-provider&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyFeignFallbackClient</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ·»åŠ æŒ‡å®šçš„ fallback ç±»ï¼Œåœ¨æœåŠ¡ç†”æ–­æ—¶è¿”å› fallback ç±»å†…å®¹</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hey&quot;)</span></span><br><span class="line">    String <span class="title function_">hey</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.service.MyFeignFallbackClient;</span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.javanica.annotation.HystrixCommand;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨ FeiginFallback å®¢æˆ·ç«¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyFeignFallbackClient myFeignFallbackClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hey&quot;)</span></span><br><span class="line">    <span class="meta">@HystrixCommand(fallbackMethod = &quot;defaultCities&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">fallback</span> <span class="operator">=</span> myFeignFallbackClient.hey();</span><br><span class="line">        <span class="keyword">return</span> fallback;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">defaultCities</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No server!!!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Hystrix-Dashboard-consul"><a href="#Hystrix-Dashboard-consul" class="headerlink" title="Hystrix Dashboard (consul)"></a>Hystrix Dashboard (consul)</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210706113456.png"><br>Hystrix Dashboard å³ â€œHystrix ä»ªè¡¨ç›˜â€ï¼Œä¹Ÿæ˜¯é™¤äº†å®¹é”™ä¹‹å¤–è¿˜æä¾›çš„å®æ—¶ç›‘æ§åŠŸèƒ½ï¼Œä»–ä¼šå®æ—¶çš„ç´¯åŠ è®°å½•æ‰€æœ‰å…³äº <strong>HystrixCommand</strong> æ‰§è¡Œçš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…å«äº†æ¯ç§’æ‰§è¡Œäº†å¤šå°‘è¯·æ±‚ï¼Œä»¥åŠæˆåŠŸæˆ–å¤±è´¥ç­‰ä¿¡æ¯ã€‚</p>
<blockquote>
<p>Hystrix Dashboard æ˜¯ä¸€æ¬¾é’ˆå¯¹ Hystrix è¿›è¡Œå®æ—¶ç›‘æ§çš„å·¥å…·ï¼Œå¯ä»¥å®ç°å‡ºå®æ—¶ç›‘æ§æ•°æ®ï¼Œå¹¶ç›´è§‚çš„æ˜¾ç¤º Hystrix Command çš„è¯·æ±‚å“åº”æ—¶é—´ã€è¯·æ±‚æˆåŠŸç‡ç­‰</p>
</blockquote>
<p>å› ä¸º Hystrix Dashboard ä»…ä»…å®ç°äº†æ•°æ®çš„ç›‘æ§ï¼Œå› æ­¤ <strong>æˆ‘ä»¬éœ€è¦åœ¨ Hystrix Fallback çš„åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•</strong>ï¼Œå…¶ä¸­å¯åŠ¨ç±»éœ€è¦ä¿®æ”¹å¹¶æ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-hystrix --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.2.2.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-netflix-hystrix-dashboard --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-netflix-hystrix-dashboard&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.2.7.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.hystrix.contrib.metrics.eventstream.HystrixMetricsStreamServlet;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.circuitbreaker.EnableCircuitBreaker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.hystrix.dashboard.EnableHystrixDashboard;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯ç”¨æœåŠ¡å‘ç°ä»¥åŠ feignã€Hystrix Dashboard å’ŒæœåŠ¡ç†”æ–­ç­‰æ³¨è§£æ”¯æŒï¼Œå¹¶é…ç½® Servlet</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@EnableHystrixDashboard</span></span><br><span class="line"><span class="meta">@EnableCircuitBreaker</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletRegistrationBean <span class="title function_">servletRegistrantionBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HystrixMetricsStreamServlet</span> <span class="variable">hystrixMetricsStreamServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HystrixMetricsStreamServlet</span>();</span><br><span class="line">        <span class="type">ServletRegistrationBean</span> <span class="variable">registrationBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletRegistrationBean</span>(hystrixMetricsStreamServlet);</span><br><span class="line">        registrationBean.setLoadOnStartup(<span class="number">1</span>);</span><br><span class="line">        registrationBean.addUrlMappings(<span class="string">&quot;/actuator/hystrix.stream&quot;</span>);</span><br><span class="line">        registrationBean.setName(<span class="string">&quot;HystrixMetricsStreamServlet&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> registrationBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="application-properties-1"><a href="#application-properties-1" class="headerlink" title="application.properties"></a>application.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">HystrixDashboard</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">9502</span></span><br><span class="line"><span class="attr">spring.cloud.consul.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.cloud.consul.port</span>=<span class="string">8500</span></span><br><span class="line"><span class="attr">spring.cloud.consul.discovery.service-name</span>=<span class="string">service-provider</span></span><br><span class="line"><span class="attr">feign.hystrix.enabled</span>=<span class="string">true</span></span><br><span class="line"><span class="attr">hystrix.dashboard.proxy-stream-allow-list</span>=<span class="string">*        # è®¾ç½®ä»ªè¡¨æ¿ä»£ç†æµå…è®¸åˆ—è¡¨ä¸ºæ‰€æœ‰</span></span><br></pre></td></tr></table></figure>

<p>å½“ä¸€åˆ‡å®Œæˆä¹‹åè®¿é—® <a target="_blank" rel="noopener" href="http://localhost:9502/hystrix">http://localhost:9502/hystrix</a> å¹¶åœ¨è¾“å…¥æ¡†è¾“å…¥ <a target="_blank" rel="noopener" href="http://localhost:9502/actuator/hystrix.stream">http://localhost:9502/actuator/hystrix.stream</a> å³å¯ã€‚</p>
<blockquote>
<p>Hystrix Turbine ä¸ Hystrix Dashboard çš„åŒºåˆ«å°±æ˜¯ä¸€ä¸ªåªèƒ½çœ‹åˆ°å•ä¸ªåº”ç”¨ç¨‹åºå†…çš„æœåŠ¡ä¿¡æ¯ï¼Œè€Œå¦ä¸€ä¸ªåˆ™æ˜¯å¤šä¸ªå®ä¾‹é›†ç¾¤çš„çŠ¶æ€å½¢å¼å±•ç°ï¼Œå› æ­¤ Hystrix Turbine ç”±æ­¤è€Œç”Ÿã€‚</p>
<blockquote>
<p><strong>å¼ºçƒˆå»ºè®®ä½¿ç”¨ Eureka</strong></p>
</blockquote>
</blockquote>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/java/spring cloud/7.Spring cloud Ribbon or RestTemplate and Feign/">Spring cloud Ribbon or RestTemplate and Feign</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/java/" rel="tag">java</a> <a class="article__tag-none-link" href="/tags/spring-cloud/" rel="tag">spring cloud</a>
			</span>
		
	</div>

	

	
		<p>é¦–å…ˆæˆ‘ä»¬åªéœ€è¦çŸ¥é“åœ¨ Ribbon å’Œ Feign æˆ– RestTemplate ä¸­ï¼ŒRibbon ä¸»è¦åŸºäº HTTPå’ŒTCPå‡ºæ¥è¿›è¡Œå®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡ï¼Œä»–æ˜¯ç”± Netfix å…¬å¸æ‰€å¼€æºé¡¹ç›® Netfix OSS çš„ä¸€éƒ¨åˆ†ï¼Œå¯è‡ªåŠ¨ä¸ Netfix Server Discover ä¹Ÿå°±æ˜¯ Eureka è¿›è¡Œäº¤äº’ã€‚</p>
<blockquote>
<p>Ribbon æ˜¯ä¸å¯ä»¥ç‹¬ç«‹éƒ¨ç½²çš„ï¼ŒSpring cloud Ribbon æ˜¯åŸºäº Ribbon çš„å®ç°ã€‚åŸºäºäº†è½®å»“ã€éšæœºç­‰è§„åˆ™è‡ªåŠ¨è°ƒç”¨æœåŠ¡ï¼Œå½“ç„¶é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥æ ¹æ®è‡ªèº«éœ€è¦æ¥å®šä¹‰å‡è¡¡ç®—æ³•ã€‚</p>
</blockquote>
<p>è€Œ Feign å’Œ RestTemplate éƒ½æ˜¯ç”¨äºå®ç°æœåŠ¡å‘ç°ï¼Œ Feign ä¸»è¦æ˜¯å£°æ˜è¯•çš„ WebService å®¢æˆ·ç«¯ï¼Œä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¿«æ·ã€ä¼˜é›…çš„è°ƒç”¨ HTTP APIã€‚åè€…åˆ™æ˜¯éœ€è¦æœåŠ¡çš„ IPåœ°å€ç­‰è¿™äº›ä¿¡æ¯æ¥å®ç°å„ä¸ªæœåŠ¡ä¹‹é—´çš„é€šä¿¡è°ƒç”¨ï¼ŒåŒºåˆ«å°±æ˜¯ Feign ä¼š <strong>æ¯” RestTemplate ç®€æ´å’Œä¼˜é›…è®¸å¤š</strong>ã€‚</p>
<h2 id="è´Ÿè½½å‡è¡¡"><a href="#è´Ÿè½½å‡è¡¡" class="headerlink" title="è´Ÿè½½å‡è¡¡"></a>è´Ÿè½½å‡è¡¡</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210621200441.png"><br>åœ¨ä»”ç»†è®²è§£ Ribbon ä¸ Feign æˆ– RestTemplate ä¹‹å‰ï¼Œä»–ä»¬éƒ½æ˜¯æ¶‰åŠæˆ–å®ç°å‡ºè´Ÿè½½å‡è¡¡è¿™ä¸ªåŠŸèƒ½ï¼Œå› æ­¤è´Ÿè½½å‡è¡¡åœ¨è¿™é‡Œå°¤ä¸ºé‡è¦ã€‚</p>
<p>è´Ÿè½½å‡é¢ï¼ˆLoad Balanceï¼‰ä»å­—é¢æ„æ€ä¸Šæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå½“ä¸€ä¸ªæ•°æ®è¯·æ±‚æ—¶å¯ä»¥åˆ†æ‘Šå¤šä¸ªå•å…ƒè¿›è¡Œåˆ†æµï¼Œé€šå¸¸è´Ÿè½½å‡è¡¡ä¼šåˆ†ä¸ºæœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡ä»¥åŠå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸¤ç§ã€‚</p>
<h3 id="æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡"><a href="#æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡" class="headerlink" title="æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡"></a>æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡</h3><p>æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡ä¸»è¦æ˜¯åº”å¯¹é«˜å¹¶å‘å’ŒæœåŠ¡å™¨ç«¯æ‰©å®¹çš„é‡è¦æ–¹æ³•ä¹‹ä¸€ï¼Œè´Ÿè½½å‡è¡¡ä¹Ÿé€šå¸¸è®²çš„æ˜¯æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡ã€‚æœåŠ¡å™¨ç«¯çš„è´Ÿè½½å‡è¡¡ä¸»è¦é€šè¿‡åœ¨æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä¹‹é—´æ·»åŠ è´Ÿè½½å‡è¡¡å™¨è¿›è¡Œå®ç°ï¼Œä¸»è¦åˆ†ä¸ºç¡¬ä»¶å’Œè½¯ä»¶è´Ÿè½½å‡è¡¡ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦ä»‹ç»è½¯ä»¶çš„è´Ÿè½½å‡è¡¡ã€‚</p>
<blockquote>
<p> æ— è®ºæ˜¯è½¯ä»¶çš„è´Ÿè½½å‡è¡¡è¿˜æ˜¯ç¡¬ä»¶çš„è´Ÿè½½å‡è¡¡å‡ç»´æŠ¤ç€ä¸€ä¸ªæ­£å¸¸æœåŠ¡æ¸…å•ï¼Œé€šè¿‡å¿ƒè·³æœºåˆ¶æ¥åˆ é™¤å‡ºç°æ•…éšœçš„æœåŠ¡èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä»–æ¥æ¢å¤æœåŠ¡èŠ‚ç‚¹ã€‚</p>
</blockquote>
<p>è½¯ä»¶è´Ÿè½½å‡è¡¡ä¸»è¦æ˜¯åœ¨æ™®é€šçš„æœåŠ¡å™¨ä¸Šå®‰è£…å…·æœ‰è´Ÿè½½å‡è¡¡çš„è½¯ä»¶æ¥å®ç°è¯·æ±‚çš„åˆ†å‘ï¼Œè¿›è€Œå®ç°è´Ÿè½½å‡è¡¡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æœåŠ¡å™¨ç«¯çš„ â€œæ­£å¸¸æœåŠ¡æä¾›è€…æ¸…å•â€ æ˜¯å­˜å‚¨åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸­çš„ã€‚</p>
<h3 id="å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡"><a href="#å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡" class="headerlink" title="å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡"></a>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡</h3><p>å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸æœåŠ¡å™¨ç«¯è´Ÿè½½å‡è¡¡ç›¸å·®æ— å‡ ï¼Œä»–ä»¬çš„åŒºåˆ«ä¸»è¦æ˜¯å®¢æˆ·ç«¯ä»–æœ¬èº«æ‹¥æœ‰ â€œæ­£å¸¸æœåŠ¡æä¾›è€…æ¸…å•â€ï¼Œåœ¨å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ä¸­ã€‚æ‰€æœ‰å®¢æˆ·ç«¯ç®¡ç†éƒ½ç®¡ç†ç€ä¸€ä»½è‡ªå·±éœ€è¦è®¿é—®çš„æœåŠ¡æä¾›è€…æ¸…å•ï¼Œè€Œè¿™äº›æ¸…å•å¤§å¤šæ•°ä»æœåŠ¡ä¸­å¿ƒè¿›è¡Œè·å–ã€‚</p>
<h2 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210622080816.png"><br>Ribbon æ˜¯ Netfix å…¬å¸æ‰€å¼€æºé¡¹ç›® Netfix OSS çš„ä¸€éƒ¨åˆ†ï¼Œä¸»è¦æä¾›ä¸€ä¸ªå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„äº‘åº“ã€‚ä»–ä¸»è¦åŸºäº HTTP å’Œ TCP çš„å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ç»„ä»¶ï¼Œä¹‹åçš„ Spring cloud Ribbon æ˜¯ä¸€ä¸ªåŸºäº Ribbon å®ç°ï¼Œä¸»è¦ç‰¹ç‚¹æ˜¯å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</p>
<blockquote>
<p>Choose Server æ˜¯è´Ÿè½½å‡è¡¡ç­–ç•¥ä¸­ â€œçº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆRound Robin Ruieï¼‰â€ å·¥ä½œæµç¨‹å†…çš„ç¬¬ä¸‰æ­¥éª¤ï¼Œå…¶ä½œç”¨æ˜¯è·å–æœåŠ¡åˆ—è¡¨ä¸­å–æœåŠ¡è¿›è¡Œè¯·æ±‚ï¼Œå¦‚æœè¿ç»­åæ¬¡éƒ½æ²¡æœ‰è·å–åˆ°æœåŠ¡åˆ™æŠ¥é”™ã€‚</p>
</blockquote>
<p>ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒRibbon æœ¬èº«æ‰€ç»´æŠ¤ç€ æ­£å¸¸æœåŠ¡æä¾›è€…æ¸…å•çš„æœ‰æ•ˆæ€§ï¼Œå¦‚æœé€šè¿‡ <code>ChooseServer</code> ä¸å¯ç”¨ï¼Œåˆ™ä¼šé‡æ–°ä»æœåŠ¡ä¸­å¿ƒè·å–æœ‰æ•ˆçš„æœåŠ¡æä¾›è€…æ¸…å•æ¥è¿›è¡Œæ›´æ–°ã€‚</p>
<h3 id="Ribbon-æ¥å£ç±»å‹"><a href="#Ribbon-æ¥å£ç±»å‹" class="headerlink" title="Ribbon æ¥å£ç±»å‹"></a>Ribbon æ¥å£ç±»å‹</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210623161907.png"></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Type Info</th>
<th>Bean Name</th>
<th>Class Name</th>
</tr>
</thead>
<tbody><tr>
<td>IClientConfig</td>
<td><strong>ç”¨äºè¯»å–é…ç½®</strong>ï¼Œå®ç°ç±»æ˜¯ <code>DefaultClientConfigIcmpl</code>ï¼Œè€Œé»˜è®¤å€¼ä¹Ÿæ˜¯è¯¥ç±»</td>
<td>ribbonClientConfig</td>
<td>DefaultClientConfigIcmpl</td>
</tr>
<tr>
<td>IRule</td>
<td><strong>è´Ÿè´£å¤„ç†è´Ÿè½½å‡è¡¡è§„åˆ™</strong>ï¼Œå®ç°ç±»æ˜¯ <code>ZoneAvoidanceRule</code> é»˜è®¤é€šè¿‡ä»–æ¥é€‰æ‹©å®ä¾‹ï¼Œæ­¥éª¤æ˜¯ï¼š</td>
<td>ribbonRule</td>
<td>ZoneAvoidanceRule</td>
</tr>
<tr>
<td></td>
<td>1.ServerList è·å–æ‰€æœ‰å¯ç”¨çš„æœåŠ¡æä¾›è€…åˆ—è¡¨</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>2.ServerListFileter è¿‡æ»¤ä¸€éƒ¨åˆ†æœåŠ¡æä¾›è€…åœ°å€</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>3.æœ€ååœ¨å‰©ä¸‹çš„åœ°å€ä¸­é€šè¿‡ IRule é€‰æ‹©ä¸€å°æœåŠ¡å™¨</td>
<td></td>
<td></td>
</tr>
<tr>
<td>IPing</td>
<td><strong>ç”¨æ¥ç­›é€‰æ‰æ— æ³•è®¿é—®çš„å®ä¾‹</strong></td>
<td>ribbonPing</td>
<td>DummyPing</td>
</tr>
<tr>
<td>ServerList <code>&lt;server&gt;</code></td>
<td><strong>ç”¨äºè·å–æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨</strong>ï¼Œå¯ä»¥æ˜¯ä¸€ç»„å›ºå®šåœ°å€ä¹Ÿå¯æ˜¯æœåŠ¡ä¸­å¿ƒä¸­å®šæœŸæŸ¥è¯¢æœåŠ¡æä¾›è€…çš„åœ°å€åˆ—è¡¨</td>
<td>ribbonServerList</td>
<td>ConfigurationBasedServerList</td>
</tr>
<tr>
<td>ServerListFileter <code>&lt;server&gt;</code></td>
<td>åœ¨åŸå§‹æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼Œ<strong>é€šè¿‡ä½¿ç”¨ä¸€å®šçš„ç­–ç•¥è¿‡æ»¤ä¸€éƒ¨åˆ†ä¸ç¬¦åˆæ¡ä»¶çš„åœ°å€</strong>ï¼ˆå½“åŠ¨æ€ä½¿ç”¨ ServerListæ—¶ä½¿ç”¨ï¼‰</td>
<td>ribbonServerListFilter</td>
<td>ZonePrefernenceServerListFilter</td>
</tr>
<tr>
<td>ILoadBalancer</td>
<td>å¯é€šè¿‡è´Ÿè½½å‡è¡¡ä¸­é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¹¶é€šè¿‡æ ‡è®°æš‚åœæœåŠ¡çš„æœåŠ¡å™¨ï¼Œä¸€å¯ä»¥è·å–æ‰€æœ‰å·²çŸ¥çš„æœåŠ¡å™¨æä¾›è€…åˆ—è¡¨</td>
<td>ribbonLoadBalancer</td>
<td>ZoneAwareLoadBalancer or BaseLoadBalancer</td>
</tr>
<tr>
<td>ServerListUpdater</td>
<td><strong>ç”¨äºServerListçš„æ›´æ–°</strong>ï¼Œå½“æœåŠ¡ä¸­å¿ƒçš„æœåŠ¡æä¾›è€…å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼ŒServerList ä¼šæ ¹æ® PollingServerListUpdater æ¥å®ç°å®šæ—¶æ›´æ–°æœåŠ¡æä¾›è€…åˆ—è¡¨</td>
<td>ribbonServerListUpdate</td>
<td>PollingServerListUpdater</td>
</tr>
</tbody></table>
<h3 id="è´Ÿè½½å‡è¡¡å™¨"><a href="#è´Ÿè½½å‡è¡¡å™¨" class="headerlink" title="è´Ÿè½½å‡è¡¡å™¨"></a>è´Ÿè½½å‡è¡¡å™¨</h3><p>è´Ÿè½½å‡è¡¡å™¨å¾ˆå¤šéƒ½æ˜¯é€šè¿‡ Ribbon æ¥å£ç±»å‹æ¥è¿›è¡Œå®ç°å…·ä½“çš„è´Ÿè½½å‡è¡¡ Bean å¦‚ï¼š</p>
<p>| Bean | Type | Class Name |<br>| â€” | â€” | â€” | â€” |<br>| LoadBalancerClient | ILoad Balancer | RibbonLoadBalancerClient |<br>| AbstractLoadBalancer | ILoad Balancer | AbstractLoadBalancer |</p>
<h4 id="LoadBalancer"><a href="#LoadBalancer" class="headerlink" title="LoadBalancer"></a>LoadBalancer</h4><p>åœ¨åˆå§‹åŒ–æ—¶ <code>execute()</code> æ–¹æ³•ä¼šé€šè¿‡ILoadBalancer æ¥ä»æœåŠ¡ä¸­å¿ƒè·å–æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ï¼Œå¹¶æ¯ 10s æ¥æ£€æµ‹ä¸€ä¸‹æœåŠ¡çš„å¯ç”¨æ€§ã€‚å¦‚æœæœåŠ¡ç«¯å¯ç”¨æ€§å‘ç”Ÿæ”¹å˜ï¼Œæˆ–è€…æ•°é‡ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆ <code>RibbonLoadBanlancer</code> ä¼šä»æ³¨å†Œä¸­å¿ƒæ›´æ–°æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ï¼Œä¹‹åå¯ä»¥æ ¹æ® IRule æ¥è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚</p>
<p>LoadBanlancerä¸»è¦çš„èŒè´£æ˜¯æ·»åŠ æœåŠ¡å™¨ã€é€‰æ‹©æœåŠ¡å™¨ã€è·å–æ‰€æœ‰çš„æœåŠ¡å™¨åˆ—è¡¨ã€è·å–å¯ç”¨çš„æœåŠ¡æä¾›è€…åˆ—è¡¨ç­‰ã€‚</p>
<table>
<thead>
<tr>
<th>Method Name</th>
<th>Method Info</th>
</tr>
</thead>
<tbody><tr>
<td><code>addServers(List&lt;Server&gt; newServers)</code></td>
<td>å‘æœåŠ¡å™¨åˆå§‹åˆ—è¡¨ä¸­å¢åŠ æ–°çš„æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨</td>
</tr>
<tr>
<td><code>chooseServer(Object key)</code></td>
<td>ä»è´Ÿè½½å‡è¡¡å™¨ä¸­é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨</td>
</tr>
<tr>
<td><code>markServerDown(Server server)</code></td>
<td>é€šçŸ¥æˆ–æ ‡è®°å·²ç»æš‚åœæœåŠ¡çš„æœåŠ¡å™¨</td>
</tr>
<tr>
<td><code>getReachableServers()</code></td>
<td>è¿”å›è·å–åˆ°å¯ç”¨çš„æœåŠ¡æä¾›è€…åˆ—è¡¨</td>
</tr>
<tr>
<td><code>getAllServers</code></td>
<td>è·å–æ‰€æœ‰çœ‹åˆ°æœåŠ¡æä¾›è€…åˆ—è¡¨</td>
</tr>
</tbody></table>
<p>Load Balancer ä¸»è¦ç”¨äºå®šä¹‰è½¯ä»¶è´Ÿè½½å‡è¡¡çš„æ“ä½œæ¥å£ï¼Œä¸€ä¸ªå…¸å‹çš„è´Ÿè½½è´Ÿè½½å‡è¡¡å®ç°éœ€è¦ä¸€ç»„æœåŠ¡å™¨è¿›è¡Œã€‚é€šå¸¸ä¸€ä¸ªæ–¹æ³•æ¥æ ‡è®°ç‰¹å®šçš„æœåŠ¡å™¨ä¸å¾ªç¯ï¼Œä¸€ä¸ªè°ƒç”¨å°†ç°æœ‰çš„æœåŠ¡å™¨åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨æ¥è¿›è¡Œæä¾›æœåŠ¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.netflix.loadbalancer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  å®šä¹‰è½¯ä»¶è´Ÿè½½å‡è¡¡çš„æ“ä½œæ¥å£ï¼Œä¸€ä¸ªå…¸å‹çš„è´Ÿè½½è´Ÿè½½å‡è¡¡å®ç°éœ€è¦ä¸€ç»„æœåŠ¡å™¨è¿›è¡Œã€‚é€šå¸¸ä¸€ä¸ªæ–¹æ³•æ¥æ ‡è®°ç‰¹å®šçš„æœåŠ¡å™¨ä¸å¾ªç¯</span></span><br><span class="line"><span class="comment"> * ä¸€ä¸ªè°ƒç”¨å°†ç°æœ‰çš„æœåŠ¡å™¨åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨æ¥è¿›è¡Œæä¾›æœåŠ¡ã€‚</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> stonse</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ILoadBalancer</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * å‘æœåŠ¡å™¨åˆå§‹åˆ—è¡¨ä¸­å¢åŠ æ–°çš„æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ï¼ˆhost:portï¼‰</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> æ·»åŠ æ–°æœåŠ¡æä¾›è€…</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addServers</span><span class="params">(List&lt;Server&gt; newServers)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ä»è´Ÿè½½å‡è¡¡å™¨ä¸­é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> è´Ÿè½½å‡è¡¡å™¨å°†å¯ç”¨äºç¡®å®šè¿”å›é‚£ä¸ªæœåŠ¡å™¨çš„å¯¹è±¡ï¼Œå¦‚ä¸ºç©ºåˆ™</span></span><br><span class="line"><span class="comment">	 *         è´Ÿè½½å‡è¡¡å™¨å°†ä¸ä¼šä½¿ç”¨æ­¤å‚æ•°</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> é€‰æ‹©æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> Server <span class="title function_">chooseServer</span><span class="params">(Object key)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * ç”±è´Ÿè½½å‡è¡¡å™¨çš„å®¢æˆ·ç«¯æ‰åº”æ¥é€šçŸ¥æŸä¸ªæœåŠ¡å™¨æš‚åœæœåŠ¡ï¼Œå¦åˆ™ ILoadBalancer ä¾ç„¶è®¤ä¸ºä»–å¯ä»¥æä¾›æœåŠ¡</span></span><br><span class="line"><span class="comment">	 * ç›´åˆ°ä¸‹ä¸€æ¬¡æ£€æµ‹çš„å‘¨æ</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> æ ‡è®°å·²ç»æš‚åœæœåŠ¡çš„æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">markServerDown</span><span class="params">(Server server)</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@deprecated</span>    getServerList åœ¨ 2016-01-20 å°±è¢«å¼ƒç”¨ï¼Œå–è€Œä»£ä¹‹çš„åˆ™æ˜¯ getReachableServers ä»¥åŠ getAllServer APIã€‚</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> å¦‚æœä¸º true åˆ™åªåº”ç”¨è¿”å›å¯ç”¨çš„æœåŠ¡å™¨</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Deprecated</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;Server&gt; <span class="title function_">getServerList</span><span class="params">(<span class="type">boolean</span> availableOnly)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> è¿”å›è·å–åˆ°å¯ç”¨çš„æœåŠ¡æä¾›è€…åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Server&gt; <span class="title function_">getReachableServers</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> è·å–æ‰€æœ‰çœ‹åˆ°æœåŠ¡æä¾›è€…åˆ—è¡¨</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;Server&gt; <span class="title function_">getAllServers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="AbstractLoadBalancer"><a href="#AbstractLoadBalancer" class="headerlink" title="AbstractLoadBalancer"></a>AbstractLoadBalancer</h4><p>Abstract Load Balancer æ˜¯ ILoad Balancer çš„å®ç°ç±»ï¼Œä»–åŒ…å«äº†å¤§å¤šæ•°è´Ÿè½½å‡è¡¡å®ç°æ‰€éœ€è¦çš„åŠŸèƒ½ï¼Œå…¸å‹çš„æ˜¯ Load Balancer çš„ç»“æ„ï¼š</p>
<ol>
<li>åŸºäºç‰¹å®šçš„æ ‡å‡†å¯ä»¥åˆ†æ—¶æ®µçš„æœåŠ¡æä¾›è€…ä¿¡æ¯åˆ—è¡¨</li>
<li>é€šè¿‡è§„åˆ™çš„å®šä¹‰å’Œå®ç°è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ç±»</li>
<li>å®šä¹‰å¹¶å®ç°ä¸€ç§æœºåˆ¶æ¥ç¡®å®šæœåŠ¡æä¾›è€…è¡¨å•ä¸­çš„èŠ‚ç‚¹ã€å¯ç”¨æ€§çš„ç±»ã€‚</li>
</ol>
<p>åœ¨è¿™ä¸‰ç±»ä¸­ï¼ŒAbstract Load Balancer ç±»å®ç°äº†æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨åˆ†ç»„çš„ä½œç”¨ï¼Œè¢« æœåŠ¡å™¨ç»„ï¼ˆServerGroupï¼‰ æ¥å®šä¹‰ï¼š</p>
<table>
<thead>
<tr>
<th>Method name</th>
<th>Method info</th>
</tr>
</thead>
<tbody><tr>
<td>ServerGroup</td>
<td></td>
</tr>
<tr>
<td></td>
<td>ALLï¼šæ‰€æœ‰æœåŠ¡</td>
</tr>
<tr>
<td></td>
<td>STATUS_UPï¼šæ­£å¸¸è¿è¡Œçš„æœåŠ¡</td>
</tr>
<tr>
<td></td>
<td>STATUS_NOT_UPï¼šä¸‹çº¿æˆ–å´©æºƒçš„æœåŠ¡</td>
</tr>
<tr>
<td>chooseServer</td>
<td></td>
</tr>
<tr>
<td></td>
<td>ä»è´Ÿè½½å‡è¡¡ä¸­é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨</td>
</tr>
<tr>
<td>getServerList(ServerGroup serverGroup)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>è·å–è´Ÿè½½å‡è¡¡ä¸­æ‰€æœ‰æœåŠ¡çš„å®ä¾‹åˆ—è¡¨</td>
</tr>
<tr>
<td>getLoadBalancerStats()</td>
<td></td>
</tr>
<tr>
<td></td>
<td>ä» Load Balancer æ¥è·å–æ¯ä¸ªæœåŠ¡çš„æ‰€æœ‰ç»†èŠ‚ç»Ÿè®¡ä¿¡æ¯</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.netflix.loadbalancer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AbstractLoadBalancer contains features required for most loadbalancing</span></span><br><span class="line"><span class="comment"> * implementations.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * An anatomy of a typical LoadBalancer consists of 1. A List of Servers (nodes)</span></span><br><span class="line"><span class="comment"> * that are potentially bucketed based on a specific criteria. 2. A Class that</span></span><br><span class="line"><span class="comment"> * defines and implements a LoadBalacing Strategy via &lt;code&gt;IRule&lt;/code&gt; 3. A</span></span><br><span class="line"><span class="comment"> * Class that defines and implements a mechanism to determine the</span></span><br><span class="line"><span class="comment"> * suitability/availability of the nodes/servers in the List.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> stonse</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractLoadBalancer</span> <span class="keyword">implements</span> <span class="title class_">ILoadBalancer</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">ServerGroup</span>&#123;</span><br><span class="line">        ALL,</span><br><span class="line">        STATUS_UP,</span><br><span class="line">        STATUS_NOT_UP        </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * delegate to &#123;<span class="doctag">@link</span> #chooseServer(Object)&#125; with parameter null.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Server <span class="title function_">chooseServer</span><span class="params">()</span> &#123;</span><br><span class="line">    	<span class="keyword">return</span> chooseServer(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * List of servers that this Loadbalancer knows about</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> serverGroup Servers grouped by status, e.g., &#123;<span class="doctag">@link</span> ServerGroup#STATUS_UP&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;Server&gt; <span class="title function_">getServerList</span><span class="params">(ServerGroup serverGroup)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Obtain LoadBalancer related Statistics</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> LoadBalancerStats <span class="title function_">getLoadBalancerStats</span><span class="params">()</span>;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="BaseLoadBalancer"><a href="#BaseLoadBalancer" class="headerlink" title="BaseLoadBalancer"></a>BaseLoadBalancer</h5><p>Base Load Balancer ç±»æ˜¯ Abstract Load Balancer çš„å®ç°ç±»æˆ–å·¥å…·ç±»ï¼Œä»–å¯ä»¥ç”¨ä¸€ä¸ª List é›†åˆï¼ˆAllServerListï¼‰æ¥ä¿å­˜æ‰€æœ‰æœåŠ¡å®ä¾‹ï¼Œä¹‹åç”¨å¦ä¸€ä¸ª List ä¿å­˜ï¼ˆUpServerListï¼‰å½“å‰æœ‰æ•ˆçš„æœåŠ¡å®ä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Monitor(name = PREFIX + &quot;AllServerList&quot;, type = DataSourceType.INFORMATIONAL)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">volatile</span> List&lt;Server&gt; allServerList = Collections</span><br><span class="line">        .synchronizedList(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Server&gt;());</span><br><span class="line"><span class="meta">@Monitor(name = PREFIX + &quot;UpServerList&quot;, type = DataSourceType.INFORMATIONAL)</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">volatile</span> List&lt;Server&gt; upServerList = Collections</span><br><span class="line">        .synchronizedList(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Server&gt;());</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>Method name</th>
<th>Method info</th>
</tr>
</thead>
<tbody><tr>
<td>IpingStrategy</td>
<td>ç”¨äºå®šä¹‰æ£€æŸ¥æœåŠ¡çš„ç­–ç•¥ï¼Œå°† ping æ‰€æœ‰çš„æœåŠ¡å™¨ï¼ˆå¦‚æœæ‰§è¡Œçš„å¾ˆæ…¢å¯èƒ½æ˜¯ä½ æœ‰å¤§é‡çš„æœåŠ¡å™¨åœ¨æ­¤é›†ç¾¤ä¸­ï¼‰</td>
</tr>
<tr>
<td>chooseServer</td>
<td>è°ƒç”¨ rule ç±»ä¸­çš„ <code>choose</code> æ–¹æ³•æ¥é€‰æ‹©æœåŠ¡å™¨å¯¹è±¡ï¼ˆå¦‚æœæ²¡æœ‰åˆ™è¿”å› nullï¼‰</td>
</tr>
<tr>
<td>PingTask()</td>
<td>æ¯ x ç§’è¿è¡Œä¸€æ¬¡å®šæ—¶å™¨ä»»åŠ¡ï¼Œæ£€æŸ¥æœåŠ¡å™¨åˆ—è¡¨ä¸­æ¯ä¸ªæœåŠ¡å™¨&#x2F;èŠ‚ç‚¹çš„çŠ¶æ€ï¼ˆé»˜è®¤ä¸º 1000sï¼‰</td>
</tr>
<tr>
<td>markServerDown()</td>
<td>ç”¨äºæ ‡æ³¨æœåŠ¡æ˜¯å¦æœ‰æ•ˆï¼ˆmark Server Down called for serverï¼‰</td>
</tr>
<tr>
<td>getReachableServer()</td>
<td>è·å–æ‰€æœ‰æœ‰æ•ˆçš„æœåŠ¡å®ä¾‹åˆ—è¡¨</td>
</tr>
<tr>
<td>getAllServer()</td>
<td>æ‹¥æœ‰è·å–æ‰€æœ‰æœåŠ¡å™¨å®ä¾‹åˆ—è¡¨</td>
</tr>
<tr>
<td>addServer()</td>
<td>å‘è´Ÿè½½å‡è¡¡å™¨ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„æœåŠ¡å®ä¾‹åˆ—è¡¨</td>
</tr>
</tbody></table>
<p>é™¤æ­¤ä¹‹å¤–ï¼ŒBase Load Balancer ç±»ä¸­çš„å­ç±» <code>DynamicServerListLoadBalancer</code> ä»¥åŠ <code>ZoneAwareLoadBalancer</code> ä½œä¸º <code>DynamicServerListLoadBalancer</code> çš„å­ç±»ï¼Œéƒ½å®ç°äº†äº†ä¸€äº›èƒ½åŠ›ï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<p><strong>DynamicServerListLoadBalancer</strong><br>åœ¨è´Ÿè½½å‡è¡¡å™¨çš„åŸºç¡€ä¸Šåšäº†è¿›ä¸€æ­¥çš„æ‰©å±•ï¼Œå¯ä»¥åœ¨æœåŠ¡å®ä¾‹æ¸…å•åœ¨è¿è¡Œæ—¶çš„åŠ¨æ€æ›´æ–°çš„å®ç°ï¼Œä»¥åŠè¿˜æä¾›äº†ä¸€ä¸ªè¿‡æ»¤å™¨æ ‡å‡†æ¥è¿‡æ»¤æ‰ä¸ç¬¦åˆæ‰€éœ€æ ‡å‡†çš„æœåŠ¡å™¨ã€‚</p>
<h3 id="Ribbon-Ping-çš„å®ç°"><a href="#Ribbon-Ping-çš„å®ç°" class="headerlink" title="Ribbon Ping çš„å®ç°"></a>Ribbon Ping çš„å®ç°</h3><p>åœ¨ä¸Šè¿°ä»‹ç»ä¸­ï¼Œæˆ‘ä»¬éƒ½è®¾è®¡åˆ°äº† Ping æˆ– â€œå¿ƒè·³â€ è¿™ä¸ªæ¦‚å¿µï¼Œè´Ÿè½½å‡è¡¡ä¸­ Ping æœºåˆ¶ä¸»è¦ç”¨äºæ£€æµ‹æœåŠ¡æä¾›è€…çš„æœ‰æ•ˆæ€§ã€‚<strong>ä»–ä¼šæ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œ Ping æ¥åˆ¤æ–­æœåŠ¡å™¨æ˜¯å¦å­˜æ´»</strong> ï¼Œè€Œè¿™äº›å·¥ä½œéƒ½å°†ç”± IPing å’Œä»–çš„å®ç°ç±»æ¥è´Ÿè´£ï¼ˆRibbon é»˜è®¤å®ç°ç±»æ˜¯ DummyPingï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯é»˜è®¤æƒ…å†µä¸‹ä¸ä¼šæ¿€æ´» Ping æœºåˆ¶ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>Class Name</th>
<th>Class Info</th>
</tr>
</thead>
<tbody><tr>
<td>DummyPing</td>
<td>è™šæ‹Ÿçš„ Ping å®ç°ï¼Œå½“ç¡®å®šæœåŠ¡å™¨æ´»ç€çš„æ—¶å€™ä¼šè¿”å› <code>true</code></td>
</tr>
<tr>
<td>NoOpPing</td>
<td>è®¾ä¹ˆéƒ½ä¸åšç›´æ¥è¿”å› <code>true</code></td>
</tr>
<tr>
<td>PingConstant</td>
<td>IPing çš„å®ç°ç±»ï¼Œä»–ç”¨äºè¿”å›ä»»ä½•è®¾ç½®çš„å†…å®¹ï¼Œtrue æˆ– falseï¼ˆé€šå¸¸åªè¦å¸¸é‡å‚æ•°ä¸º true ä¸ºæœåŠ¡å®ä¾‹å­˜æ´»ï¼Œå¦åˆ™ä¸ºå¤±æ•ˆï¼‰</td>
</tr>
</tbody></table>
<h4 id="DummyPing"><a href="#DummyPing" class="headerlink" title="DummyPing"></a>DummyPing</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.netflix.loadbalancer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.netflix.client.config.IClientConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Default simple implementation that marks the liveness of a Server</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> stonse</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DummyPing</span> <span class="keyword">extends</span> <span class="title class_">AbstractLoadBalancerPing</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DummyPing</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAlive</span><span class="params">(Server server)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initWithNiwsConfig</span><span class="params">(IClientConfig clientConfig)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="NoOpPing"><a href="#NoOpPing" class="headerlink" title="NoOpPing"></a>NoOpPing</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.netflix.loadbalancer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * No Op Ping</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> stonse</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NoOpPing</span> <span class="keyword">implements</span> <span class="title class_">IPing</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAlive</span><span class="params">(Server server)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="PingConstant"><a href="#PingConstant" class="headerlink" title="PingConstant"></a>PingConstant</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.netflix.loadbalancer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A utility Ping Implementation that returns whatever its been set to return</span></span><br><span class="line"><span class="comment"> * (alive or dead)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> stonse</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PingConstant</span> <span class="keyword">implements</span> <span class="title class_">IPing</span> &#123;</span><br><span class="line">		<span class="type">boolean</span> <span class="variable">constant</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConstant</span><span class="params">(String constantStr)</span> &#123;</span><br><span class="line">				constant = (constantStr != <span class="literal">null</span>) &amp;&amp; (constantStr.toLowerCase().equals(<span class="string">&quot;true&quot;</span>));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setConstant</span><span class="params">(<span class="type">boolean</span> constant)</span> &#123;</span><br><span class="line">				<span class="built_in">this</span>.constant = constant;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">getConstant</span><span class="params">()</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> constant;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAlive</span><span class="params">(Server server)</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> constant;</span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è´Ÿè½½å‡è¡¡ç­–ç•¥"><a href="#è´Ÿè½½å‡è¡¡ç­–ç•¥" class="headerlink" title="è´Ÿè½½å‡è¡¡ç­–ç•¥"></a>è´Ÿè½½å‡è¡¡ç­–ç•¥</h3><p>AbstractLoadBalancerRule æ˜¯ä¸€ä¸ª <code>IRule</code> çš„ç»§æ‰¿ï¼Œä»–æœ¬èº«åˆ™æ˜¯ä¸€ä¸ªè´Ÿè½½å‡è¡¡ç­–ç•¥çš„æŠ½è±¡ç±»ï¼Œè€Œ IRule ä¸»è¦å®šä¹‰äº† <code>ILoadBalancer</code> ï¼Œå…¶æœ€ä¸ºæ ¸å¿ƒçš„æ–¹æ³•ä¸º <code>choose()</code>ï¼Œè¿™æ˜¯ç”¨äºé€‰æ‹©æœåŠ¡å™¨å¯¹è±¡ï¼ˆæœåŠ¡å®ä¾‹ï¼‰ï¼Œå¦‚è¿‡æ²¡æœ‰å°†ä¼šè¿”å› nullã€‚</p>
<p>è€Œå®šä¹‰ <code>IRule</code> ä¸»è¦çš„ç›®çš„ç¬¬ä¸€å°±æ˜¯ä¸ºäº†è¾…åŠ©è´Ÿè½½å‡è¡¡å™¨ï¼ˆ<code>ILoadBalancer</code>ï¼‰<strong>æ¥é€šè¿‡è´Ÿè½½å‡è¡¡ç­–ç•¥é€‰æ‹©åˆé€‚çš„æœåŠ¡å®ä¾‹</strong>ï¼Œå…¶é»˜è®¤ä½¿ç”¨çš„æ˜¯ <strong>ä¹å¤§è´Ÿè½½å‡è¡¡</strong> ç­–ç•¥ä¸­çš„ <code>çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆRoundRobinRuleï¼‰</code>ã€‚</p>
<h4 id="çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆRound-Robin-Ruleï¼‰"><a href="#çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆRound-Robin-Ruleï¼‰" class="headerlink" title="çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆRound Robin Ruleï¼‰"></a>çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆRound Robin Ruleï¼‰</h4><p>ç”±äº Round Robin Rule æ˜¯ ILoadBalancer é»˜è®¤é‡‡ç”¨çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå› æ­¤ä¹Ÿå’Œä»–çš„æµç¨‹éå¸¸ç¬¦åˆï¼Œä¸æ­¤åŒæ—¶ä»–è¿˜æ˜¯ä½œä¸ºè‘—åçš„è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œä»–ä¸»è¦å®šä¹‰äº† <code>AVAILABLE_ONLY_SERVERSï¼ˆä»…å¯ç”¨æœåŠ¡å™¨ï¼‰</code>ã€<code>ALL_SERVERSï¼ˆæ‰€æœ‰æœåŠ¡å™¨ï¼‰</code> ä¸¤ä¸ªçŠ¶æ€ã€‚</p>
<ol>
<li><code>choose(ILoadBalancer lb, Object key)</code> æ–¹æ³•ä»è´Ÿè½½å‡è¡¡ä¸­é€‰æ‹©ä¸€ä¸ªæœåŠ¡å™¨å¹¶è®¡æ•°ï¼Œ<strong>å¦‚æœæ²¡æœ‰åˆ™ä¼šè¿”å›</strong>ï¼š<code>â€œno load balancerâ€</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Server <span class="title function_">choose</span><span class="params">(ILoadBalancer lb, Object key)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (lb == <span class="literal">null</span>) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;no load balancer&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>incrementAndGetModulo</code> æ–¹æ³•ä¼šé€šè¿‡<code>serverCount</code> å‡½æ•°æ¥è¯·æ±‚ <code>allServersï¼ˆæ‰€æœ‰æœåŠ¡å™¨ï¼‰</code>ï¼Œè€Œ <code>incrementAndGetModulo</code> æ–¹æ³•åˆ™ä¼šè·å–ä¸‹ä¸€ä¸ªç´¢å¼•ï¼Œä¹Ÿå°±æ˜¯è¯´ <strong>è·å–æ‰€æœ‰æœåŠ¡å™¨ï¼Œå¹¶ä» 0 çš„åŸºç¡€ä¸Š +1</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">incrementAndGetModulo</span><span class="params">(<span class="type">int</span> modulo)</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">current</span> <span class="operator">=</span> nextServerCyclicCounter.get();</span><br><span class="line">        <span class="type">int</span> <span class="variable">next</span> <span class="operator">=</span> (current + <span class="number">1</span>) % modulo;</span><br><span class="line">        <span class="keyword">if</span> (nextServerCyclicCounter.compareAndSet(current, next))</span><br><span class="line">            <span class="keyword">return</span> next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>æœ€åé€šè¿‡ <code>choose(Object key)</code> é€šè¿‡ç´¢å¼•å»æœåŠ¡åˆ—è¡¨è·å–æœåŠ¡ï¼Œå¦‚æœè¿ç»­ <strong>10æ¬¡æ²¡æœ‰è·å–åˆ°æœåŠ¡</strong>ï¼Œåˆ™ä¼šè¿”å›: â€œNo available alive servers after 10 tries from load balancerâ€ã€‚å‡è®¾ <code>å¯è¾¾æœåŠ¡å™¨ï¼ˆreachableServersï¼‰</code> æˆ– <code>æœåŠ¡å™¨æ€»æ•°ï¼ˆallServersï¼‰</code> ä¸º 0ï¼Œåˆ™ä¼šè¾“å‡º: â€œNo up servers available from load balancerâ€ é”™è¯¯ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">    <span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (server == <span class="literal">null</span> &amp;&amp; count++ &lt; <span class="number">10</span>) &#123;</span><br><span class="line">        List&lt;Server&gt; reachableServers = lb.getReachableServers();</span><br><span class="line">        List&lt;Server&gt; allServers = lb.getAllServers();</span><br><span class="line">        <span class="type">int</span> <span class="variable">upCount</span> <span class="operator">=</span> reachableServers.size();</span><br><span class="line">        <span class="type">int</span> <span class="variable">serverCount</span> <span class="operator">=</span> allServers.size();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((upCount == <span class="number">0</span>) || (serverCount == <span class="number">0</span>)) &#123;</span><br><span class="line">            log.warn(<span class="string">&quot;No up servers available from load balancer: &quot;</span> + lb);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">nextServerIndex</span> <span class="operator">=</span> incrementAndGetModulo(serverCount);</span><br><span class="line">        server = allServers.get(nextServerIndex);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (server == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">/* Transient. */</span></span><br><span class="line">            Thread.yield();</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (server.isAlive() &amp;&amp; (server.isReadyToServe())) &#123;</span><br><span class="line">            <span class="keyword">return</span> (server);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Next.</span></span><br><span class="line">        server = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (count &gt;= <span class="number">10</span>) &#123;</span><br><span class="line">        log.warn(<span class="string">&quot;No available alive servers after 10 tries from load balancer: &quot;</span></span><br><span class="line">                + lb);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> server;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é‡è¯•ç­–ç•¥ï¼ˆRetry-Ruleï¼‰"><a href="#é‡è¯•ç­–ç•¥ï¼ˆRetry-Ruleï¼‰" class="headerlink" title="é‡è¯•ç­–ç•¥ï¼ˆRetry Ruleï¼‰"></a>é‡è¯•ç­–ç•¥ï¼ˆRetry Ruleï¼‰</h4><p>é‡è¯•ç­–ç•¥ï¼ˆRetry Ruleï¼‰æ˜¯ Rule çš„çº§è”ï¼Œä»–é‡‡ç”¨ Round Robin Ruleçš„ <code>choose()</code>æ–¹æ³•æ¥è·å–æœåŠ¡å™¨å®ä¾‹ï¼Œ<code>æœ€å¤§é‡è¯•æ¬¡æ•°ï¼ˆmaxRetryMillisï¼‰</code> æ˜¯ <strong>500</strong>ï¼Œå› æ­¤ä»–åœ¨é€‰æ‹©å®ä¾‹å’Œé‡è¯•æ–¹æ³•æ˜¯ï¼š</p>
<blockquote>
<p>çº§è”ï¼ˆcascadeï¼‰åœ¨è®¡ç®—æœºç§‘å­¦ä¸­æŒ‡å¤šä¸ªå¯¹è±¡ä¹‹é—´ä¸€å¯¹å¤šçš„æ˜ å°„å…³ç³»ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€å¼ è¡¨ A ç”¨äºå­˜æ”¾å­¦ç”Ÿæ‰€åœ¨ç­çº§ï¼ˆå§“åã€æ€§åˆ«ã€å¹´é¾„ï¼‰è€Œå§“åä½œä¸ºä¸»é”®ï¼Œè€Œå¦ä¸€å¼ è¡¨ B å­˜æ”¾ç€æ¥¼å±‚ä½æˆ·ä¿¡æ¯ï¼ˆå§“åã€æ€§åˆ«ï¼‰ä»–ä»¬ä¹‹é—´é€šè¿‡ <strong>å§“åã€å¹´é¾„</strong> æ¥ä½œä¸ºçº§è”</p>
</blockquote>
<ol>
<li><p>å¦‚æœé€šè¿‡ <code>choose()</code> æ–¹æ³•è·å–æœåŠ¡å™¨å®ä¾‹æ­£å¸¸ï¼Œåˆ™å›ç­”å¹¶è¿”å›æ•°æ®</p>
</li>
<li><p>å‡è®¾è¶…è¿‡äº† <code>æœ€å¤§çš„é‡è¯•æ¬¡æ•°ï¼ˆmaxRetryMillisï¼‰</code> æ²¡æœ‰è·å–åˆ° â€œæ´»ç€çš„æœåŠ¡å™¨â€ï¼Œåˆ™è¿”å› null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((answer == <span class="literal">null</span>) || (!answer.isAlive())) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> answer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ€åå¦‚æœæ²¡æœ‰æ´»ç€çš„æœåŠ¡å›ç­”åœ¨å½“å‰æ—¶é—´å°äº <code>500 ms</code> çš„æƒ…å†µä¸‹ï¼Œåˆ™ä¼šä¸æ–­çš„åœ¨è¿™æ—¶é—´æ®µé‡è¯•ã€‚</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (((answer == <span class="literal">null</span>) || (!answer.isAlive()))</span><br><span class="line">		&amp;&amp; (System.currentTimeMillis() &lt; deadline)) &#123;</span><br><span class="line">	<span class="comment">/* pause and retry hoping it&#x27;s transient */</span></span><br><span class="line">	Thread.yield();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="åŠ æƒå“åº”æ—¶é—´ç­–ç•¥ï¼ˆWeightedResponseTimeRuleï¼‰"><a href="#åŠ æƒå“åº”æ—¶é—´ç­–ç•¥ï¼ˆWeightedResponseTimeRuleï¼‰" class="headerlink" title="åŠ æƒå“åº”æ—¶é—´ç­–ç•¥ï¼ˆWeightedResponseTimeRuleï¼‰"></a>åŠ æƒå“åº”æ—¶é—´ç­–ç•¥ï¼ˆWeightedResponseTimeRuleï¼‰</h4><p>WeightedResponseTimeRule æ˜¯ <code>RoundRobinRule</code> çš„å»¶ä¼¸ï¼Œå¯¹ä¸€äº›åŠŸèƒ½è¿›è¡Œäº†æ‰©å±•ã€å¯ä»¥æ ¹æ®æœåŠ¡å®ä¾‹çš„è¿è¡Œæƒ…å†µè®¡ç®—å‡ºæœåŠ¡å®ä¾‹çš„æƒé‡ï¼Œä¹‹åè¿›è¡ŒæœåŠ¡å®ä¾‹çš„æŒ‘é€‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Server <span class="title function_">choose</span><span class="params">(ILoadBalancer lb, Object key)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (lb == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (server == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// get hold of the current reference in case it is changed from the other thread</span></span><br><span class="line">        List&lt;Double&gt; currentWeights = accumulatedWeights;</span><br><span class="line">        <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Server&gt; allList = lb.getAllServers();</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">serverCount</span> <span class="operator">=</span> allList.size();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (serverCount == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">serverIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// last one in the list is the sum of all weights</span></span><br><span class="line">        <span class="type">double</span> <span class="variable">maxTotalWeight</span> <span class="operator">=</span> currentWeights.size() == <span class="number">0</span> ? <span class="number">0</span> : currentWeights.get(currentWeights.size() - <span class="number">1</span>); </span><br><span class="line">        <span class="comment">// No server has been hit yet and total weight is not initialized</span></span><br><span class="line">        <span class="comment">// fallback to use round robin</span></span><br><span class="line">        <span class="keyword">if</span> (maxTotalWeight &lt; <span class="number">0.001d</span>) &#123;</span><br><span class="line">            server =  <span class="built_in">super</span>.choose(getLoadBalancer(), key);</span><br><span class="line">            <span class="keyword">if</span>(server == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> server;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// generate a random weight between 0 (inclusive) to maxTotalWeight (exclusive)</span></span><br><span class="line">            <span class="type">double</span> <span class="variable">randomWeight</span> <span class="operator">=</span> random.nextDouble() * maxTotalWeight;</span><br><span class="line">            <span class="comment">// pick the server index based on the randomIndex</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (Double d : currentWeights) &#123;</span><br><span class="line">                <span class="keyword">if</span> (d &gt;= randomWeight) &#123;</span><br><span class="line">                    serverIndex = n;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    n++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            server = allList.get(serverIndex);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (server == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">/* Transient. */</span></span><br><span class="line">            Thread.yield();</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (server.isAlive()) &#123;</span><br><span class="line">            <span class="keyword">return</span> (server);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Next.</span></span><br><span class="line">        server = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> server;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>åœ¨ <code>choose</code> æ–¹æ³•è·å–æœåŠ¡å®ä¾‹æ—¶ï¼Œå¦‚æœæœåŠ¡è´Ÿè½½å‡è¡¡å™¨å’Œæ‰€æœ‰è®¿é—®å™¨ä¸ºç©ºï¼Œåˆ™è¿”å› null</li>
<li>ä¹‹åå½“å‰æ‰€æœ‰æœåŠ¡çš„ç´¢å¼•çš„æœ€åä¸€ä½ï¼Œåˆ™æ˜¯æ‰€æœ‰æƒé‡çš„æ€»å’Œï¼Œä¹‹åç”Ÿæˆ <strong>0ï½æ€»å’Œ</strong> çš„éšæœºæƒé‡</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            logger.info(<span class="string">&quot;Weight adjusting job started&quot;</span>);</span><br><span class="line">            <span class="type">AbstractLoadBalancer</span> <span class="variable">nlb</span> <span class="operator">=</span> (AbstractLoadBalancer) lb;</span><br><span class="line">            <span class="type">LoadBalancerStats</span> <span class="variable">stats</span> <span class="operator">=</span> nlb.getLoadBalancerStats();</span><br><span class="line">            <span class="keyword">if</span> (stats == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// no statistics, nothing to do</span></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">double</span> <span class="variable">totalResponseTime</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="comment">// find maximal 95% response time</span></span><br><span class="line">            <span class="keyword">for</span> (Server server : nlb.getAllServers()) &#123;</span><br><span class="line">                <span class="comment">// this will automatically load the stats if not in cache</span></span><br><span class="line">                <span class="type">ServerStats</span> <span class="variable">ss</span> <span class="operator">=</span> stats.getSingleServerStat(server);</span><br><span class="line">                totalResponseTime += ss.getResponseTimeAvg();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// weight for each server is (sum of responseTime of all servers - responseTime)</span></span><br><span class="line">            <span class="comment">// so that the longer the response time, the less the weight and the less likely to be chosen</span></span><br><span class="line">            <span class="type">Double</span> <span class="variable">weightSoFar</span> <span class="operator">=</span> <span class="number">0.0</span>;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// create new list and hot swap the reference</span></span><br><span class="line">            List&lt;Double&gt; finalWeights = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Double&gt;();</span><br><span class="line">            <span class="keyword">for</span> (Server server : nlb.getAllServers()) &#123;</span><br><span class="line">                <span class="type">ServerStats</span> <span class="variable">ss</span> <span class="operator">=</span> stats.getSingleServerStat(server);</span><br><span class="line">                <span class="type">double</span> <span class="variable">weight</span> <span class="operator">=</span> totalResponseTime - ss.getResponseTimeAvg();</span><br><span class="line">                weightSoFar += weight;</span><br><span class="line">                finalWeights.add(weightSoFar);   </span><br><span class="line">            &#125;</span><br><span class="line">            setWeights(finalWeights);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;Error calculating server weights&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            serverWeightAssignmentInProgress.set(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™å…¶ä¸­ä½œä¸ºæœ€ç»ˆè¦çš„è§’è‰²åˆ™æ˜¯ <code>DynamicServerWeightTask</code> æ–¹æ³•ï¼Œä¸»è¦é€šè¿‡ <code>totalResponseTimeï¼ˆæ€»å“åº”æ—¶é—´ï¼‰</code> æ¥è®¡ç®—æƒé‡ï¼Œå…¶åŸç†å°±æ˜¯ä½¿ç”¨ <code>ServerStats</code> åœ¨è´Ÿè½½å‡è¡¡å™¨ä¸­æ•è·æ¯ä¸ªæœåŠ¡å™¨çš„å„ç§ç»Ÿè®¡ä¿¡æ¯ï¼Œé‚£ä¹ˆæ€»å“åº”æ—¶é—´å°±æ˜¯é€šè¿‡ä»–çš„ <code>getResponseTimeAvg</code> æ–¹æ³•è·å–å¤„ç†è¯·æ±‚çš„å¹³å‡æ€»æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ‰¾åˆ°æœ€å¤§ 95% çš„å“åº”æ—¶é—´</p>
<p>è¿™æ ·æ¯ä¸ªæœåŠ¡å™¨çš„æƒé‡å°±æ˜¯ æ‰€æœ‰æœåŠ¡å™¨å“åº”æ—¶é—´çš„æ€»å’Œå‡å»å“åº”æ—¶é—´ <code>ï¼ˆtotalResponseTime - getResponseTimeAvgï¼‰</code> è¿™æ ·å¾—å‡ºçš„ç»“æœå°±æ˜¯ <strong>å“åº”æ—¶é—´è¶Šé•¿åˆ™æƒé‡è¶Šå°ï¼Œåˆ™é€‰ä¸­çš„å‡ ç‡å°±å¾ˆå°</strong></p>
<h4 id="éšæœºç­–ç•¥ï¼ˆRandomRuleï¼‰"><a href="#éšæœºç­–ç•¥ï¼ˆRandomRuleï¼‰" class="headerlink" title="éšæœºç­–ç•¥ï¼ˆRandomRuleï¼‰"></a>éšæœºç­–ç•¥ï¼ˆRandomRuleï¼‰</h4><p>RandomRule ä¸»è¦æ˜¯ä¸€ä¸ªåœ¨ç°æœ‰æœåŠ¡å™¨ä¹‹é—´éšæœºåˆ†é…æµé‡çš„è´Ÿè½½å‡è¡¡ï¼Œä»–ä¸»è¦çš„æ­¥éª¤æ˜¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Server <span class="title function_">choose</span><span class="params">(ILoadBalancer lb, Object key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lb == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Server</span> <span class="variable">server</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (server == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            List&lt;Server&gt; upList = lb.getReachableServers();</span><br><span class="line">            List&lt;Server&gt; allList = lb.getAllServers();</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">serverCount</span> <span class="operator">=</span> allList.size();</span><br><span class="line">            <span class="keyword">if</span> (serverCount == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * No servers. End regardless of pass, because subsequent passes</span></span><br><span class="line"><span class="comment">                 * only get more restrictive.</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> rand.nextInt(serverCount);</span><br><span class="line">            server = upList.get(index);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (server == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                 * The only time this should happen is if the server list were</span></span><br><span class="line"><span class="comment">                 * somehow trimmed. This is a transient condition. Retry after</span></span><br><span class="line"><span class="comment">                 * yielding.</span></span><br><span class="line"><span class="comment">                 */</span></span><br><span class="line">                Thread.yield();</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (server.isAlive()) &#123;</span><br><span class="line">                <span class="keyword">return</span> (server);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Shouldn&#x27;t actually happen.. but must be transient or a bug.</span></span><br><span class="line">            server = <span class="literal">null</span>;</span><br><span class="line">            Thread.yield();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ol>
<li>é€šè¿‡<code>choose</code> æ–¹æ³•è·å–åˆ°æœåŠ¡å™¨å®ä¾‹ï¼Œå¦‚æœè´Ÿè½½å‡è¡¡å™¨å’ŒæœåŠ¡å™¨ä¸º0åˆ™è¿”å› <code>null</code></li>
<li>é¦–å…ˆä»–ä¼šé€šè¿‡ <code>upList</code> ä»¥åŠ <code>allList()</code> åˆ†åˆ«è·å–å­˜æ´»æœåŠ¡å™¨åˆ—è¡¨å’Œæ‰€æœ‰æœåŠ¡å™¨åˆ—è¡¨ï¼Œä¹‹åé€šè¿‡ <code>Random</code> æ¥ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨</li>
<li>å¦‚æœæœåŠ¡å™¨æ­£å¸¸è¿è¡Œï¼Œåˆ™è¿”å›è¯¥æœåŠ¡ï¼Œå¹¶å¯¹å¯ä»¥è¯·æ±‚çš„æœåŠ¡å™¨æ ‡æ³¨ä¸€ä¸ªéšæœºçš„å€¼ï¼Œè¿™å°±è®©æ¯æ¬¡é€šè¿‡ <code>choose</code> æ–¹æ³•è·å–åˆ°çš„æœåŠ¡å™¨å®ä¾‹éƒ½ä¼šæœ‰ä¸€ä¸ªéšæœºçš„æ ‡æ³¨ã€‚</li>
</ol>
<h4 id="å®¢æˆ·ç«¯é…ç½®å¯ç”¨çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆClientConfigEnabledRoundRobinRuleï¼‰"><a href="#å®¢æˆ·ç«¯é…ç½®å¯ç”¨çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆClientConfigEnabledRoundRobinRuleï¼‰" class="headerlink" title="å®¢æˆ·ç«¯é…ç½®å¯ç”¨çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆClientConfigEnabledRoundRobinRuleï¼‰"></a>å®¢æˆ·ç«¯é…ç½®å¯ç”¨çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆClientConfigEnabledRoundRobinRuleï¼‰</h4><p>å®¢æˆ·ç«¯é…ç½®å¯ç”¨çº¿æ€§è½®è¯¢ç­–ç•¥ï¼Œä»åå­—ä¸Šå¯ä»¥çœ‹å‡ºä»–å°±æ˜¯ä¸ºäº†å¯ç”¨ <code>RoundRobinRule</code> ç­–ç•¥çš„ï¼Œå› æ­¤ä»–çš„æ•´ä¸ªæµç¨‹éƒ½æ˜¯é€šè¿‡ <code>RoundRobinRule</code> æ¥ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ã€‚è€Œ <code>choose</code> æ–¹æ³•åˆ™ä¹Ÿæ˜¯é€šè¿‡ <code>RoundRobinRule</code> æ¥å®ç°çš„ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨ä»–åˆ™ä¼šå‡ºç° ï¼šâ€œThis class has not been initialized with the RoundRobinRule classâ€ çš„æŠ¥é”™ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClientConfigEnabledRoundRobinRule</span> <span class="keyword">extends</span> <span class="title class_">AbstractLoadBalancerRule</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">RoundRobinRule</span> <span class="variable">roundRobinRule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RoundRobinRule</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initWithNiwsConfig</span><span class="params">(IClientConfig clientConfig)</span> &#123;</span><br><span class="line">        roundRobinRule = <span class="keyword">new</span> <span class="title class_">RoundRobinRule</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setLoadBalancer</span><span class="params">(ILoadBalancer lb)</span> &#123;</span><br><span class="line">    	<span class="built_in">super</span>.setLoadBalancer(lb);</span><br><span class="line">    	roundRobinRule.setLoadBalancer(lb);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Server <span class="title function_">choose</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (roundRobinRule != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> roundRobinRule.choose(key);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                    <span class="string">&quot;This class has not been initialized with the RoundRobinRule class&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æœ€å¤§ç©ºé—²ç­–ç•¥ï¼ˆBestAvailableRuleï¼‰"><a href="#æœ€å¤§ç©ºé—²ç­–ç•¥ï¼ˆBestAvailableRuleï¼‰" class="headerlink" title="æœ€å¤§ç©ºé—²ç­–ç•¥ï¼ˆBestAvailableRuleï¼‰"></a>æœ€å¤§ç©ºé—²ç­–ç•¥ï¼ˆBestAvailableRuleï¼‰</h4><p>è¯¥è§„åˆ™ä¸»è¦ç”¨äºé€‰æ‹©å¹¶å‘è¯·æ±‚æœ€å°‘çš„æœåŠ¡å™¨å®ä¾‹æ¥æä¾›æœåŠ¡ï¼Œå»¶ä¼¸è‡ª <code>ClientConfigEnabledRoundRobinRule</code>ï¼Œé€šè¿‡ <code>LoadBalancerStats</code> æ¥ç»Ÿè®¡æ¯ä¸ªæœåŠ¡å™¨çš„ç‰¹å¾å’Œä¿¡æ¯ï¼Œä»¥æ­¤æ¥è¿‡æ»¤å¤±è´¥çš„æœåŠ¡å®ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Server <span class="title function_">choose</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (loadBalancerStats == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.choose(key);</span><br><span class="line">    &#125;</span><br><span class="line">    List&lt;Server&gt; serverList = getLoadBalancer().getAllServers();</span><br><span class="line">    <span class="type">int</span> <span class="variable">minimalConcurrentConnections</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">    <span class="type">long</span> <span class="variable">currentTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="type">Server</span> <span class="variable">chosen</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (Server server: serverList) &#123;</span><br><span class="line">        <span class="type">ServerStats</span> <span class="variable">serverStats</span> <span class="operator">=</span> loadBalancerStats.getSingleServerStat(server);</span><br><span class="line">        <span class="keyword">if</span> (!serverStats.isCircuitBreakerTripped(currentTime)) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">concurrentConnections</span> <span class="operator">=</span> serverStats.getActiveRequestsCount(currentTime);</span><br><span class="line">            <span class="keyword">if</span> (concurrentConnections &lt; minimalConcurrentConnections) &#123;</span><br><span class="line">                minimalConcurrentConnections = concurrentConnections;</span><br><span class="line">                chosen = server;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (chosen == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.choose(key);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> chosen;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœ <code>loadBalancerStats</code> ä¸ä¸º nullï¼Œåˆ™æ‰¾å‡ºæœ€å°çš„å¹¶å‘è¿æ¥æ•°ï¼ˆminimalConcurrentConnectionsï¼‰æ¥ä½¿ç”¨ã€‚å‡è®¾ <code>loadBalancerStats</code> ä¸º nullï¼Œåˆ™é€šè¿‡ <code>ClientConfigEnabledRoundRobinRule</code> ç±»ä¸­çš„ <code>choose</code> ç±»æ¥ä½¿ç”¨çº¿æ€§è½®è¯¢ç­–ç•¥ã€‚</p>
<h4 id="è¿‡æ»¤çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆPredicateBasedRuleï¼‰"><a href="#è¿‡æ»¤çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆPredicateBasedRuleï¼‰" class="headerlink" title="è¿‡æ»¤çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆPredicateBasedRuleï¼‰"></a>è¿‡æ»¤çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆPredicateBasedRuleï¼‰</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210629013902.png"></p>
<p>è¿‡æ»¤çº¿æ€§è½®è¯¢ç­–ç•¥ä¸»è¦åœ¨è¿‡æ»¤ç»™å®šçš„æœåŠ¡å™¨åˆ—è¡¨å’Œè´Ÿè½½å‡è¡¡å™¨åï¼Œé€šè¿‡å†…éƒ¨å®šä¹‰çš„ä¸€ä¸ªè¿‡æ»¤å™¨æ¥ç­›é€‰å‡ºæœåŠ¡å®ä¾‹æ¸…å•ï¼Œä¹‹åé€šè¿‡çº¿æ€§è½®è¯¢æ–¹å¼è¿‡æ»¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä»æ¸…å•é€‰å–ä¸€ä¸ªæœåŠ¡å®ä¾‹ã€‚</p>
<blockquote>
<figure class="highlight plaintext"><figcaption><span>æ˜¯æœåŠ¡å™¨è¿‡æ»¤é€»è¾‘çš„åŸºæœ¬æ„å»ºå—ï¼Œå¯ç”¨äºè§„åˆ™å’ŒæœåŠ¡å™¨åˆ—è¡¨è¿‡æ»¤å™¨ã€‚ è°“è¯çš„è¾“å…¥å¯¹è±¡æ˜¯PredicateKeyï¼Œé‡Œé¢æœ‰Serverå’Œè´Ÿè½½å‡è¡¡å™¨çš„keyä¿¡æ¯ã€‚</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```java</span><br><span class="line">   public Server choose(Object key) &#123;</span><br><span class="line">       ILoadBalancer lb = getLoadBalancer();</span><br><span class="line">       Optional&lt;Server&gt; server = getPredicate().chooseRoundRobinAfterFiltering(lb.getAllServers(), key);</span><br><span class="line">       if (server.isPresent()) &#123;</span><br><span class="line">           return server.get();</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">           return null;</span><br><span class="line">       &#125;       </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h5 id="AbstractServerPredicate"><a href="#AbstractServerPredicate" class="headerlink" title="AbstractServerPredicate"></a>AbstractServerPredicate</h5><p>è¿‡æ»¤çº¿æ€§è½®è¯¢çš„ä¸»è¦åŠŸèƒ½ä¸»è¦é€šè¿‡ <code>AbstractServerPredicate</code> è¿›è¡Œå®ç°ï¼Œè€Œ <code>AbstractServerPredicate</code> æ˜¯ <code>Predicate</code> çš„å®ç°ã€‚</p>
<blockquote>
<figure class="highlight plaintext"><figcaption><span>ä¸»è¦æ˜¯ç”¨äºç¡®å®šç»™å®šè¾“å…¥çš„ true æˆ– falseï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¹‹ä¸º â€œè°“è¯â€ã€‚</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; åœ¨æ•°å­¦é€»è¾‘ä¸­ï¼Œè°“è¯é€šå¸¸ä½¿ç”¨å¤§å†™ç½—é©¬å­—æ¯è¡¨ç¤ºï¼Œå¦‚Pã€Qã€Rè¿™äº›ï¼Œæ ¹æ®å…¶å˜é‡å€¼æ¥å¯èƒ½ä¸º â€œçœŸå‡ï¼ˆtrue or falseï¼‰â€ çš„é™ˆè¿°ã€‚</span><br><span class="line">&gt;&gt;</span><br><span class="line">&gt;&gt; ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè¿ç®—ç¬¦æˆ–å‡½æ•°ï¼ˆå¸ƒå°”å€¼å‡½æ•°ï¼‰ï¼Œæ ¹æ®è¾“å…¥æ¥è¿”å›ä¸€ä¸ª false or trueã€‚</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1. åœ¨åˆå§‹é˜¶æ®µï¼Œä»–ä¸»è¦ä¼šé€šè¿‡ ```LoadBalancerStats``` æ¥è·å–è´Ÿè½½å‡è¡¡å™¨çš„ç»Ÿè®¡ä¿¡æ¯</span><br><span class="line">   1. å¦‚æœä¸ºç©ºåˆ™è¿”å›è´Ÿè½½å‡è¡¡å™¨çš„ä¿¡æ¯ã€‚</span><br><span class="line">   2. ä¸ä¸ºç©ºçš„è¯è·å–è´Ÿè½½å‡è¡¡å™¨ï¼ˆ```ILoadBalancer```ï¼‰ï¼Œåœ¨è·å–è´Ÿè½½å‡è¡¡å™¨çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå¹¶è¿”å›è®¾ç½®çš„è´Ÿè½½å‡è¡¡å™¨ç»Ÿè®¡ä¿¡æ¯ï¼ˆ```setLoadBalancerStats```ï¼‰ã€‚</span><br><span class="line">       1. å¦‚æœæœªæ‰¾åˆ° LoadalancerStats æœªæ‰¾åˆ°åˆ™è¿”å› null</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">   protected LoadBalancerStats getLBStats() &#123;</span><br><span class="line">       if (lbStats != null) &#123;</span><br><span class="line">           return lbStats;</span><br><span class="line">       &#125; else if (rule != null) &#123;</span><br><span class="line">           ILoadBalancer lb = rule.getLoadBalancer();</span><br><span class="line">           if (lb instanceof AbstractLoadBalancer) &#123;</span><br><span class="line">               LoadBalancerStats stats =  ((AbstractLoadBalancer) lb).getLoadBalancerStats();</span><br><span class="line">               setLoadBalancerStats(stats);</span><br><span class="line">               return stats;</span><br><span class="line">           &#125; else &#123;</span><br><span class="line">               return null;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; else &#123;</span><br><span class="line">           return null;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<ol start="2">
<li>ä¹‹åé€šè¿‡ <code>getServerOnlyPredicate</code> æ¥è·å–å¸ƒå°”å€¼å‡½æ•°ï¼ˆå³è°“è¯ï¼‰ï¼Œå¹¶é€šè¿‡ <code>getEligibleServers</code> ç­›é€‰å‡ºåˆæ ¼çš„æœåŠ¡å™¨ã€‚æœ€åä½¿ç”¨ <code>chooseRandomlyAfterFiltering</code> æ–¹æ³•ç­›é€‰å¹¶éšæœºé€‰æ‹©æœåŠ¡å™¨å®ä¾‹ï¼Œæœ€åä¹Ÿå¯ä»¥é€šè¿‡ <code>chooseRoundRobinAfterFiltering</code> æ–¹æ³•æ¥åˆ›å»ºå¾ªç¯é€‰æ‹©è¿‡ç­›é€‰åçš„æœåŠ¡å™¨å®ä¾‹ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Optional&lt;Server&gt; <span class="title function_">chooseRandomlyAfterFiltering</span><span class="params">(List&lt;Server&gt; servers)</span> &#123;</span><br><span class="line">    List&lt;Server&gt; eligible = getEligibleServers(servers);</span><br><span class="line">    <span class="keyword">if</span> (eligible.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.absent();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Optional.of(eligible.get(random.nextInt(eligible.size())));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Choose a server in a round robin fashion after the predicate filters a list of servers. Load balancer key </span></span><br><span class="line"><span class="comment"> * is presumed to be null.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Optional&lt;Server&gt; <span class="title function_">chooseRoundRobinAfterFiltering</span><span class="params">(List&lt;Server&gt; servers)</span> &#123;</span><br><span class="line">    List&lt;Server&gt; eligible = getEligibleServers(servers);</span><br><span class="line">    <span class="keyword">if</span> (eligible.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.absent();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Optional.of(eligible.get(nextIndex.getAndIncrement() % eligible.size()));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Choose a random server after the predicate filters list of servers given list of servers and</span></span><br><span class="line"><span class="comment"> * load balancer key. </span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Optional&lt;Server&gt; <span class="title function_">chooseRandomlyAfterFiltering</span><span class="params">(List&lt;Server&gt; servers, Object loadBalancerKey)</span> &#123;</span><br><span class="line">    List&lt;Server&gt; eligible = getEligibleServers(servers, loadBalancerKey);</span><br><span class="line">    <span class="keyword">if</span> (eligible.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.absent();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Optional.of(eligible.get(random.nextInt(eligible.size())));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Choose a server in a round robin fashion after the predicate filters a given list of servers and load balancer key. </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> Optional&lt;Server&gt; <span class="title function_">chooseRoundRobinAfterFiltering</span><span class="params">(List&lt;Server&gt; servers, Object loadBalancerKey)</span> &#123;</span><br><span class="line">    List&lt;Server&gt; eligible = getEligibleServers(servers, loadBalancerKey);</span><br><span class="line">    <span class="keyword">if</span> (eligible.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> Optional.absent();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Optional.of(eligible.get(nextIndex.getAndIncrement() % eligible.size()));</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> AbstractServerPredicate <span class="title function_">ofKeyPredicate</span><span class="params">(<span class="keyword">final</span> Predicate&lt;PredicateKey&gt; p)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AbstractServerPredicate</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="meta">@edu</span>.umd.cs.findbugs.annotations.SuppressWarnings(value = <span class="string">&quot;NP&quot;</span>)</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">apply</span><span class="params">(PredicateKey input)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p.apply(input);</span><br><span class="line">        &#125;            </span><br><span class="line">    &#125;;        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create an instance from a predicate.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> AbstractServerPredicate <span class="title function_">ofServerPredicate</span><span class="params">(<span class="keyword">final</span> Predicate&lt;Server&gt; p)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AbstractServerPredicate</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="meta">@edu</span>.umd.cs.findbugs.annotations.SuppressWarnings(value = <span class="string">&quot;NP&quot;</span>)</span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">apply</span><span class="params">(PredicateKey input)</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> p.apply(input.getServer());</span><br><span class="line">        &#125;            </span><br><span class="line">    &#125;;        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="åŒºåŸŸæ„ŸçŸ¥è½®è¯¢ç­–ç•¥ï¼ˆZoneAvoidanceRuleï¼‰"><a href="#åŒºåŸŸæ„ŸçŸ¥è½®è¯¢ç­–ç•¥ï¼ˆZoneAvoidanceRuleï¼‰" class="headerlink" title="åŒºåŸŸæ„ŸçŸ¥è½®è¯¢ç­–ç•¥ï¼ˆZoneAvoidanceRuleï¼‰"></a>åŒºåŸŸæ„ŸçŸ¥è½®è¯¢ç­–ç•¥ï¼ˆZoneAvoidanceRuleï¼‰</h5><p>è¯¥ç­–ç•¥æ˜¯ <strong>è¿‡æ»¤çº¿æ€§è½®è¯¢ç­–ç•¥ï¼ˆPredicateBasedRuleï¼‰</strong> çš„å®ç°ç±»ï¼Œä¸»è¦ä»¥ <strong>åŒºåŸŸå’Œå¯ç”¨æ€§è¿‡æ»¤æœåŠ¡å™¨çš„è§„åˆ™</strong> ä¸ºåŸºç¡€ï¼Œä¹Ÿé€šè¿‡ç»„åˆè¿‡æ»¤æ¡ä»¶å’Œè¯¥ç­–ç•¥æœ¬èº«çš„è¿‡æ»¤æ¡ä»¶ç›¸è¾…ç›¸æˆï¼Œè€Œ AbstractServerPredicate åˆ™ä¸ºæ¬¡è¿‡æ»¤æ¡ä»¶ã€‚</p>
<p>ä»–çš„è¿‡æ»¤æ¡ä»¶ä¹Ÿéå¸¸çš„ç®€å•ï¼Œé¦–å…ˆï¼Œéœ€è¦é€šè¿‡ <code>randomChooseZone</code> æ¥éšæœºé€‰æ‹©æœåŠ¡å™¨ï¼Œä¹‹å <code>selectedZone</code> æ¥é€‰æ‹©åŒºåŸŸå¹¶è¿”å›ï¼Œä¹‹å <code>totalServerCount</code> ç»Ÿè®¡æœåŠ¡å™¨æ€»æ•°ï¼Œä»¥åŠè·å–å®ä¾‹æ•°ï¼ˆ<code>getInstanceCount</code>ï¼‰ã€‚</p>
<p>åœ¨é…åˆ <code>index</code> å’Œ <code>sum</code>ï¼Œå…¶ä¸­ index åŠæœåŠ¡å™¨æ€»æ•°ï¼Œæ¯å‘ç°ä¸€ä¸ª +1ã€‚è€Œ <code>sum</code> åˆ™æ˜¯å®ä¾‹æ•°çš„æ€»å’Œï¼Œå½“æœåŠ¡æ€»æ•°å°äºæ€»å’Œæ—¶ï¼Œé‚£ä¹ˆå°†ä¼šé€‰æ‹©è¯¥åŒºåŸŸå¹¶è¿”å›ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> String <span class="title function_">randomChooseZone</span><span class="params">(Map&lt;String, ZoneSnapshot&gt; snapshot,</span></span><br><span class="line"><span class="params">        Set&lt;String&gt; chooseFrom)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (chooseFrom == <span class="literal">null</span> || chooseFrom.size() == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">String</span> <span class="variable">selectedZone</span> <span class="operator">=</span> chooseFrom.iterator().next();</span><br><span class="line">    <span class="keyword">if</span> (chooseFrom.size() == <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> selectedZone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">totalServerCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (String zone : chooseFrom) &#123;</span><br><span class="line">        totalServerCount += snapshot.get(zone).getInstanceCount();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> random.nextInt(totalServerCount) + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (String zone : chooseFrom) &#123;</span><br><span class="line">        sum += snapshot.get(zone).getInstanceCount();</span><br><span class="line">        <span class="keyword">if</span> (index &lt;= sum) &#123;</span><br><span class="line">            selectedZone = zone;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> selectedZone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“é€‰æ‹©å®Œåï¼Œå°±æ˜¯é€šè¿‡ <code>availableZones</code> æ–¹æ³•è·å–å¯ç”¨åŒºåŸŸï¼Œå¦‚æœå¯ç”¨åŒºæ•°é‡ç­‰äº1ï¼Œåˆ™è¿”å›å¯ç”¨åŒºï¼ˆ<code>availableZones</code>ï¼‰ï¼Œå½“å®ä¾‹æ•°ä¸º0æ—¶ï¼Œå¼€å§‹ç§»å‡ºå¯ç”¨åŒºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (availableZones.size() == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> availableZones;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç§»å‡ºå¯ç”¨åŒºçš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œå…¶ä¸­å°±æ˜¯ <strong>è·å–å¿ƒè·³æ¬¡æ•°é™¤äºå®ä¾‹æ€»æ•°å¤§äºç­‰äºæœåŠ¡æ— å›åº”ç™¾åˆ†æ¯”æˆ–æ¯å°æœåŠ¡å™¨è´Ÿè½½</strong>ï¼Œå°äº0çš„ï¼Œä¹Ÿä¼šè¢«ç§»å‡ºå¯ç”¨åŒºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (((<span class="type">double</span>) zoneSnapshot.getCircuitTrippedCount())</span><br><span class="line">                        / instanceCount &gt;= triggeringBlackoutPercentage</span><br><span class="line">                        || loadPerServer &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    availableZones.remove(zone);</span><br><span class="line">                    limitedZoneAvailability = <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br></pre></td></tr></table></figure>

<p>æˆ–è€…è¯´æ¯å°æœåŠ¡å™¨è´Ÿè½½ï¼ˆ<code>loadPerServer</code>ï¼‰å‡å»æ¯å°æœåŠ¡å™¨æœ€å¤§è´Ÿè½½ï¼ˆ<code>maxLoadPerServer</code>ï¼‰å°äº 0.000001dï¼Œåˆ™ä¼šè¢«æ·»åŠ è‡³æœ€å·®åŒºåŸŸï¼ˆ<code>worstZones</code>ï¼‰ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Math.abs(loadPerServer - maxLoadPerServer) &lt; <span class="number">0.000001d</span>) &#123;</span><br><span class="line">    <span class="comment">// they are the same considering double calculation</span></span><br><span class="line">    <span class="comment">// round error</span></span><br><span class="line">    worstZones.add(zone);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (loadPerServer &gt; maxLoadPerServer) &#123;</span><br><span class="line">    maxLoadPerServer = loadPerServer;</span><br><span class="line">    worstZones.clear();</span><br><span class="line">    worstZones.add(zone);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥é€šè¿‡æ¯å°æœåŠ¡å™¨è´Ÿè½½ï¼ˆ<code>loadPerServer</code>ï¼‰å¤§äºæœåŠ¡å™¨æœ€å¤§è´Ÿè½½ï¼ˆ<code>maxLoadPerServer</code>ï¼‰çš„æ–¹å¼è®©å…¶åŠ å…¥åˆ°æœ€å·®åŒºåŸŸä¸­ã€‚</p>
<p>è‡³äºéšæœºé€‰æ‹©åŒºï¼ˆ<code>randomChooseZon</code>ï¼‰ï¼Œå¦‚æœä¸ä¸º0ï¼Œä¹Ÿä¼šè¢«ç§»å‡ºå¯ç”¨åŒºï¼ˆå› ä¸ºé¿å…åŒºåŸŸè¢«ä½ éœ¸å äº†ï¼‰ï¼Œå¦åˆ™è¿”å›å¯ç”¨åŒºã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="type">String</span> <span class="variable">zoneToAvoid</span> <span class="operator">=</span> randomChooseZone(snapshot, worstZones);</span><br><span class="line">    <span class="keyword">if</span> (zoneToAvoid != <span class="literal">null</span>) &#123;</span><br><span class="line">        availableZones.remove(zoneToAvoid);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> availableZones;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ€åï¼Œå½“ä¸€ç³»åˆ—çš„åŒºåŸŸè¿‡æ»¤å®Œæˆåï¼Œé€šè¿‡çº¿æ€§è½®è¯¢çš„æ–¹å¼ä»è¿‡æ»¤ç»“æœä¸­é€‰å‡ºä¸€ä¸ªæœåŠ¡å®ä¾‹ã€‚</p>
<h4 id="å¯ç”¨æ€§è¿‡æ»¤ç­–ç•¥ï¼ˆAvailabilityFilteringRuleï¼‰"><a href="#å¯ç”¨æ€§è¿‡æ»¤ç­–ç•¥ï¼ˆAvailabilityFilteringRuleï¼‰" class="headerlink" title="å¯ç”¨æ€§è¿‡æ»¤ç­–ç•¥ï¼ˆAvailabilityFilteringRuleï¼‰"></a>å¯ç”¨æ€§è¿‡æ»¤ç­–ç•¥ï¼ˆAvailabilityFilteringRuleï¼‰</h4><p>è¯¥ç­–ç•¥æ ¹æ®å®•æœºæˆ–è¶…è¿‡è¯·æ±‚æ—¶é™çš„æ´»åŠ¨è¿æ¥æ¥åˆ†é…æƒé‡ï¼Œä»–æ˜¯ <code>PredicateBasedRule</code> çš„å»¶ä¼¸ï¼Œå…¶ä¸»è¦è¿˜æ˜¯é€šè¿‡ <code>AbstractServerPredicate</code> æ¥å®ç°å…·ä½“çš„åŠŸèƒ½ã€‚</p>
<h3 id="Ribbon-è´Ÿè½½å‡è¡¡ç­–ç•¥è‡ªå®šä¹‰"><a href="#Ribbon-è´Ÿè½½å‡è¡¡ç­–ç•¥è‡ªå®šä¹‰" class="headerlink" title="Ribbon è´Ÿè½½å‡è¡¡ç­–ç•¥è‡ªå®šä¹‰"></a>Ribbon è´Ÿè½½å‡è¡¡ç­–ç•¥è‡ªå®šä¹‰</h3><p>è‡ªå®šä¹‰è´Ÿè½½å‡è¡¡ç­–ç•¥éœ€è¦å…ˆè¿è¡Œ <strong>consul</strong> é™¤æœåŠ¡æ¶ˆè´¹è€…ä¹‹å¤–çš„é›†ç¾¤ï¼Œä¹‹åæ–°å»ºé¡¹ç›®æ·»åŠ ä¾èµ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-cloud-netflix-ribbon&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.1.6.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.0.3&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;!-- https://mvnrepository.com/artifact/com.netflix.ribbon/ribbon-loadbalancer --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.netflix.ribbon&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;ribbon-loadbalancer&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.7.18&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;compile&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">        &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<h4 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">Ribbon Rule</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">9003</span></span><br><span class="line"><span class="attr">spring.cloud.consul.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.cloud.consul.discovery.service-name</span>=<span class="string">service-provider        # æœåŠ¡æä¾›è€…åå­—</span></span><br><span class="line"><span class="attr">spring.cloud.consul.discovery.register</span>=<span class="string">false                       # æ˜¯å¦æ³¨å†ŒæœåŠ¡</span></span><br></pre></td></tr></table></figure>

<h4 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h4><p>åœ¨å¯åŠ¨ç±»ä¸­é€šè¿‡ <code>@LoadBalancd</code> ä»¥åŠ <code>@Bean</code> æ¥å®ä¾‹åŒ– <code>restTemplate</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯åŠ¨ç±»ï¼Œé€šè¿‡ <span class="doctag">@LoadBalanced</span> æ¥å¼€å¯å®¢æˆ·ç«¯çš„è´Ÿè½½å‡è¡¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/06/22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  å®ä¾‹åŒ– RestTemplate</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> RestTemplate</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@LoadBalanced</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h4 id="RibbonConfig"><a href="#RibbonConfig" class="headerlink" title="RibbonConfig"></a>RibbonConfig</h4><p>åœ¨é…ç½®ç±»ä¸­å¯ç”¨ <code>Configuration</code> æ³¨è§£ï¼Œå¹¶ä½¿ç”¨ <code>RibbonClient</code> æ¥é…ç½®æœåŠ¡æä¾›è€…åç§°ï¼Œæœ€åé€šè¿‡ <code>Bean</code> æ³¨è§£å®ä¾‹åŒ–è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼ˆRandomRuleï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.IRule;</span><br><span class="line"><span class="keyword">import</span> com.netflix.loadbalancer.RandomRule;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.ribbon.RibbonClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.ribbon.RibbonClientConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é…ç½®ç±»ï¼Œé€šè¿‡ <span class="doctag">@RibbonClient</span> æ³¨è§£æ¥é…ç½®æœåŠ¡åä»¥åŠå®ä¾‹åŒ–</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/06/29</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@RibbonClient(name = &quot;service-provider&quot;, configuration = RibbonClientConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RibbonConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ä¾‹åŒ– Ribbon çš„éšæœºç­–ç•¥ï¼ˆRandomRuleï¼‰</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> RandomRule</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> IRule <span class="title function_">irule</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomRule</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="TestController"><a href="#TestController" class="headerlink" title="TestController"></a>TestController</h4><p>æµ‹è¯•ç±»ä¸»è¦ç”¨äºé€šè¿‡è´Ÿè½½å‡è¡¡å™¨æ¥ä½¿ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥å®ç°é€‰æ‹©æœåŠ¡å®ä¾‹çš„æ•ˆæœï¼š</p>
<blockquote>
<p>è¿è¡Œåæµè§ˆå™¨æ‰“å¼€ <a target="_blank" rel="noopener" href="http://localhost:9003/hey">http://localhost:9003/hey</a> æ¯æ¬¡åˆ·æ–°ä¼šå¾—åˆ°ä¸åŒçš„æœåŠ¡æä¾›è€…å®ä¾‹è¿”å›çš„ä¿¡æ¯</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.ServiceInstance;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalancerClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoadBalancerClient loadBalancerClient;</span><br><span class="line"></span><br><span class="line">    <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyy-MM-dd hh:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> loadBalancerClient.choose(<span class="string">&quot;service-provider&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">callService</span> <span class="operator">=</span> <span class="string">&quot;Host: &quot;</span> + serviceInstance.getHost() + <span class="string">&quot; Port: &quot;</span> + serviceInstance.getPort() + <span class="string">&quot; Date:&quot;</span> + simpleDateFormat.format(date);</span><br><span class="line">        <span class="keyword">return</span> callService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Feign"><a href="#Feign" class="headerlink" title="Feign"></a>Feign</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ Feign <strong>æ˜¯é™¤äº† RestTemplate å®¢æˆ·ç«¯å®ç°æœåŠ¡å‘ç°å¤–</strong> ï¼Œå¯ä»¥å®ç°æœåŠ¡å‘ç°çš„å¦ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡æ•´åˆ Ribbon å¥½åå¯ä»¥æä¾›è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ã€‚</p>
<p>Feign ä¸ Ribbon æœ€ä¸ºä¸åŒçš„å°±æ˜¯è°ƒç”¨æ–¹å¼ï¼Œé€šå¸¸æƒ…å†µä¸‹ Ribbon éœ€è¦è‡ªå·±æ„å»ºä¸€ä¸ª HTTP è¯·æ±‚ï¼Œç„¶å RestTemplate å°†è¯¥è¯·æ±‚å‘é€ç»™å…¶ä»–æœåŠ¡ï¼Œ<code>RibbonClient(value = &quot;serverName&quot;)</code> å°±å°è¯äº†è¿™ä¸€ç‚¹ã€‚</p>
<p>è€Œ Feign æ˜¯åœ¨ Ribbon çš„åŸºç¡€ä¸Šåœ¨è¿›è¡Œä¸€å±‚å°è£…ï¼Œå› ä¸ºæ˜¯é‡‡ç”¨æ¥å£çš„æ–¹å¼ä»–å¹¶ä¸éœ€è¦è‡ªå·±æ„å»º HTTP è¯·æ±‚ã€‚<strong>åªéœ€è¦å°†å…¶ä»–æœåŠ¡æ–¹æ³•å®šä¹‰æˆæŠ½è±¡æ–¹æ³•å³å¯</strong>ï¼Œ<code>@FeignClient(&quot;ServerName&quot;)</code> æ³¨è§£æ¥è°ƒç”¨æœåŠ¡ã€‚</p>
<blockquote>
<figure class="highlight plaintext"><figcaption><span>å±æ€§å€¼åº”ä¸æœåŠ¡ä¸­å¿ƒæ–¹æ³•åä¸€è‡´</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### Feign å·¥ä½œæµç¨‹</span><br><span class="line">ä¸Šè¿°è¿™äº›ä¸ Feugn çš„å·¥ä½œåŸç†å¯†ä¸å¯åˆ†ï¼Œåœ¨æ­£å¸¸çš„æƒ…å†µä¸‹ä»–æœ‰å››ä¸ªæ­¥éª¤ï¼Œåˆ†åˆ«ä¸ºï¼š</span><br><span class="line">![](https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210701034924.png)</span><br><span class="line"></span><br><span class="line">åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¦‚æœä½¿ç”¨äº† ```@FeignClient``` æ³¨è§£ï¼Œé‚£ä¹ˆ Feign å®¢æˆ·ç«¯å°†ä¼šåˆ›å»ºä¸€ä¸ªåŠ¨æ€ä»£ç†ã€‚</span><br><span class="line">ä¹‹åè°ƒç”¨è¿™ä¸ªæ¥å£ï¼ˆå³è°ƒç”¨äº† Feign å®¢æˆ·ç«¯æ‰€åˆ›å»ºçš„åŠ¨æ€ä»£ç†ï¼‰ï¼Œè€Œ Feign å®¢æˆ·ç«¯çš„åŠ¨æ€ä»£ç†ä¼šæ ¹æ®æ¥å£ä¸Šçš„ ```@RequestMapping``` æ³¨è§£æ¥æ„é€ å‡ºåœ°å€ä»¥åŠæ–¹æ³•ã€‚</span><br><span class="line">æœ€åå‘èµ·è¯·æ±‚å¹¶è§£æå“åº”</span><br><span class="line"></span><br><span class="line">![](https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210701030423.png)</span><br><span class="line"></span><br><span class="line">æœåŠ¡æä¾›è€… **è°ƒç”¨äº†** å®šä¹‰ ```@FeignClient``` æ³¨è§£çš„æ¥å£æ—¶ï¼ŒFeign ä¼šæ„å»ºä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œä¹‹åæ„é€ åœ°å€</span><br><span class="line">æœ€ç»ˆå‘æ¥å£å‘é€è¯·æ±‚ï¼ˆä¹Ÿå°±æ˜¯æœåŠ¡æä¾›è€…ï¼‰</span><br><span class="line"></span><br><span class="line">#### Feign è´Ÿè½½å‡è¡¡</span><br><span class="line">![](https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210701111804.gif)</span><br><span class="line">Feign æ˜¯ä¸€ä¸ªå£°æ˜å¼çš„ Web Servce å®¢æˆ·ç«¯ï¼ŒSpring cloud å®¢æˆ·ç«¯æ·»åŠ äº†Spring MVC çš„æ”¯æŒï¼ŒFeign åœ¨æ•´åˆäº† Ribbon åå³å¯ä¸€å…±è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦æ·»åŠ ä¾èµ–ï¼š</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-cloud-starter-consul-discovery&lt;/artifactId&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ä»¥åŠåœ¨ <code>application.properties</code> å…¨å±€é…ç½®æ–‡ä»¶ä¸­é…ç½®æœåŠ¡ç«¯å£ä»¥åŠåç§°ç­‰ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">Feign Configuration</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8780</span></span><br><span class="line"><span class="attr">spring.cloud.consul.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.cloud.consul.port</span>=<span class="string">8500</span></span><br><span class="line"><span class="attr">spring.cloud.consul.discovery.register</span>=<span class="string">false     </span></span><br></pre></td></tr></table></figure>

<p>ç„¶ååœ¨å¯åŠ¨ç±»ä¸­é€šè¿‡ <code>EnableDiscoveryClient</code> æ¥å¯ç”¨æœåŠ¡å‘ç°ï¼Œå¹¶ä½¿ç”¨ <code>@EnableFeignClients</code> æ³¨è§£æ¥å¯åŠ¨ Feign å®¢æˆ·ç«¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å¯åŠ¨ç±»ï¼Œé€šè¿‡ <span class="doctag">@EnableDiscoveryClient</span> å®ç°æœåŠ¡ä¸­å¿ƒï¼Œä»¥åŠ <span class="doctag">@EnableFeignClients</span> æ¥æ”¯æŒ Feign</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h5><p>åœ¨é…ç½®ç±»ä¸­æˆ‘ä»¬ä¸»è¦ç”¨äºå®ç°ä½¿ç”¨é»˜è®¤å¥‘çº¦ï¼Œå³ <code>Spring cloud Netfilx MVC Controller</code> æ”¹ä¸º <code>feign.Contract.Defaull</code> åŸç”Ÿå¥‘çº¦ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> feign.Contract;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰ Feign é…ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°† Spring cloud MVC Netfilx Controller æ”¹ä¸º feign.Contract.Defaull</span></span><br><span class="line"><span class="comment">     * ä¹‹åå¥‘çº¦å°†é»˜è®¤æ”¹ä¸º Feign åŸç”Ÿå¥‘çº¦ï¼Œä¹‹åå¯ä»¥ä½¿ç”¨é»˜è®¤æ³¨è§£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> feign.Contract.Defaull</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Contract <span class="title function_">contract</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Contract</span>.Default();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="Interface"><a href="#Interface" class="headerlink" title="Interface"></a>Interface</h5><p>ä¸ºäº†é€šè¿‡ consul æœåŠ¡å‘ç°æä¾›è€…ï¼Œå› æ­¤éœ€è¦é€šè¿‡ <code>FeignClient</code> æ³¨è§£æ¥è¿›è¡Œè¿æ¥ï¼Œä¹Ÿå°±æ˜¯ Feign å·¥ä½œæµç¨‹ä¸­çš„ â€œæ„é€ åœ°å€â€˜ï¼Œä»¥åŠ Feign çš„é…ç½®ç­‰ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> feign.RequestLine;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> com.example.demo.config.FeignConfig;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * FeignClient æ¥å£</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FeignClient(contextId = &quot;feignClient&quot;, name = &quot;service-provider&quot;, configuration = FeignConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FeignClientInterface</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é€šè¿‡ <span class="doctag">@RequestLine</span> å°† Spring MVC æ³¨è§£ä¿®æ”¹ä¸ºåŸç”Ÿçš„ <span class="doctag">@RequestLine</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> <span class="doctag">@RequestLine</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@RequestLine(&quot;GET /hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hey</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h5><p>æœ€åçš„ Feign æ§åˆ¶å™¨åˆ™æ˜¯ä¸ºäº†æä¾›æœåŠ¡ï¼Œå› æ­¤åªéœ€è¦é€šè¿‡è°ƒç”¨ Feigin æ¥å£å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.FeignClientInterface;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨æ¥å£ä»¥æ­¤æ¥æä¾›æœåŠ¡</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    FeignClientInterface feignClientInterface;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> feignClientInterface.hey();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Feign-è®°å½•æ—¥å¿—"><a href="#Feign-è®°å½•æ—¥å¿—" class="headerlink" title="Feign è®°å½•æ—¥å¿—"></a>Feign è®°å½•æ—¥å¿—</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210701155448.png"></p>
<p>åœ¨ Feign ä¸­ï¼Œè®°å½•æ—¥å¿—çš„ç­‰çº§å¯ä»¥åˆ†ä¸ºå››ä¸ªï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
</tr>
</thead>
<tbody><tr>
<td>NONE</td>
<td>ä¸è®°å½•ï¼ˆé»˜è®¤ï¼‰</td>
</tr>
<tr>
<td>BASIC</td>
<td>åªè®°å½•å’Œè¯·æ±‚æ–¹æ³•ã€URLã€ç›¸åº”çŠ¶æ€ç ä»¥åŠæ‰§è¡Œæ—¶é—´</td>
</tr>
<tr>
<td>HEADERS</td>
<td>åªè®°å½•åŸºæœ¬ä¿¡æ¯ï¼Œè¯·æ±‚å’Œå“åº”çš„æ ‡é¢˜</td>
</tr>
<tr>
<td>FULL</td>
<td>è®°å½•è¯·æ±‚ã€å“åº”çš„æ ‡é¢˜ä»¥åŠæ­£æ–‡å’Œå…ƒæ•°æ®</td>
</tr>
</tbody></table>
<p>åœ¨ Feigin è´Ÿè½½å‡è¡¡çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å®é™…ä¸Šåªéœ€è¦ä¿®æ”¹æˆ–æ·»åŠ  <code>config</code> åŒ…ä¸‹çš„ <code>FeignConfig</code> ç±»å³å¯ï¼š</p>
<h5 id="FeignConfig"><a href="#FeignConfig" class="headerlink" title="FeignConfig"></a>FeignConfig</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> feign.Contract;</span><br><span class="line"><span class="keyword">import</span> feign.Logger;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰ Feign é…ç½®</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FeignConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å°† Spring cloud MVC Controller æ”¹ä¸º feign.Contract.Defaull</span></span><br><span class="line"><span class="comment">     * ä¹‹åå¥‘çº¦å°†é»˜è®¤æ”¹ä¸º Feign åŸç”Ÿå¥‘çº¦ï¼Œä¹‹åå¯ä»¥ä½¿ç”¨é»˜è®¤æ³¨è§£</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> feign.Contract.Defaull</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Contract <span class="title function_">contract</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Contract</span>.Default();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ—¥å¿—ç®¡ç†å™¨è®°å½•ç­‰çº§ä¸º FULL</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Logger.Level.Full</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    Logger.Level <span class="title function_">level</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.FULL;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Logger æ˜¯ä¸€ä¸ªæ—¥å¿—ç®¡ç†å™¨ï¼Œä¸ level ç»„åˆä¸º <code>Logger.Level</code> å³æ—¥å¿—ç®¡ç†å™¨ç­‰çº§</p>
</blockquote>
<h5 id="application-properties-1"><a href="#application-properties-1" class="headerlink" title="application.properties"></a>application.properties</h5><p>ä¹‹ååœ¨ <code>applicatin.properties</code> å…¨å±€é…ç½®æ–‡ä»¶ä¸­æ·»åŠ  <code>logging.level.com.example.demo=DEBUG</code> æ¥å¼€å¯è®°å½•æ—¥å¿—çš„åŒ…ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">Feign Configuration</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8780</span></span><br><span class="line"><span class="attr">spring.cloud.consul.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.cloud.consul.port</span>=<span class="string">8500</span></span><br><span class="line"><span class="attr">spring.cloud.consul.discovery.register</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">logging.level.com.example.demo</span>=<span class="string">DEBUG</span></span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/java/spring cloud/6.Spring cloud Consul/">Spring cloud Consul</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/java/" rel="tag">java</a> <a class="article__tag-none-link" href="/tags/spring-cloud/" rel="tag">spring cloud</a>
			</span>
		
	</div>

	

	
		<p>Spring cloud Consul æ˜¯ç”± HashiCorp å…¬å¸ä½¿ç”¨ Go lang æ‰€å¼€å‘çš„ä¸€ä¸ª <strong>æœåŠ¡æ²»ç†</strong> é¡¹ç›®ï¼Œä¸»è¦åŒ…å«äº† <strong>æœåŠ¡æ²»ç†ã€å¥åº·æ£€æŸ¥ã€Key-value å­˜å‚¨ã€å¤šæ•°æ®ä¸­å¿ƒ</strong> çš„åŠŸèƒ½ã€‚ä¸ å…¶ä»–æœåŠ¡ä¸­å¿ƒç›¸æ¯”ï¼ŒConsul æ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼Œå†…å¤–ç½‘æœåŠ¡é‡‡ç”¨ä¸åŒçš„ç«¯å£å·è¿›è¡Œç›‘å¬ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥é¿å…å•æ•°æ®ä¸­å¿ƒæ•…éšœæ‰€å¯¼è‡´çš„é—®é¢˜ã€‚</p>
<p>Consul æ‰€ä½¿ç”¨çš„æ˜¯ Raftï¼ˆReliable, Replicated, Redundant,d Fault An-Tolerantï¼Œå¯é ã€å¯å¤åˆ¶ã€å¯æ²‰ä½™ã€å¯å®¹é”™ï¼‰ ç®—æ³•æ¥ä¿è¯ä¸€è‡´æ€§ï¼Œç›¸æ¯” Poxosï¼ŒRaft çš„ç›®æ ‡åˆ™æ˜¯æä¾›æ›´åŠ æ¸…æ™°çš„é€»è¾‘åˆ†å·¥ä½¿å¾—ç®—æ³•æœ¬èº«å¯ä»¥è¢«æ›´å¥½çš„ç†è§£ã€‚</p>
<h2 id="åŸç†æµç¨‹"><a href="#åŸç†æµç¨‹" class="headerlink" title="åŸç†æµç¨‹"></a>åŸç†æµç¨‹</h2><h3 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210616033154.png"></p>
<p>æœåŠ¡æä¾›è€…ï¼ˆService Providerï¼‰åœ¨å¯åŠ¨æ—¶å‘ Consul å‘é€ä¸€ä¸ªPOST è¯·æ±‚ï¼Œ<strong>æ¥å‘Šè¯‰è‡ªå·±çš„ IPå’Œç«¯å£å·ç­‰ä¿¡æ¯</strong>ã€‚Consul æ”¶åˆ°äº†æœåŠ¡æä¾›è€…çš„æ³¨å†Œåï¼Œé»˜è®¤æ¯éš”10sæƒ³æœåŠ¡æä¾›è€…å‘é€ä¸€ä¸ªå¥åº·è¯·æ±‚ï¼Œæ¥éªŒè¯è¯¥æä¾›è€…æ˜¯å¦å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡ã€‚</p>
<blockquote>
<p>Consul ä¸­çš„æœåŠ¡æä¾›è€…ä¸´æ—¶è¡¨æ¯éš” 10s æ›´æ–°ä¸€æ¬¡ï¼ŒåªåŒ…å«äº†é€šè¿‡å¥åº·æ£€æŸ¥çš„æœåŠ¡æä¾›æä¾›è€…ã€‚</p>
</blockquote>
<p>ä¹‹åæœåŠ¡æ¶ˆè´¹è€…ï¼ˆService Consumerï¼‰åœ¨è°ƒç”¨æœåŠ¡æä¾›è€…ä¹‹å‰ä¼šä» Consul è·å–å­˜å‚¨çš„æœåŠ¡æä¾›è€… IP å’Œåœ°å€çš„ä¸´æ—¶åœ°å€è¡¨ï¼Œä¹‹åå‘é€è¯·æ±‚ç»™ æœåŠ¡æä¾›è€…ã€‚</p>
<h3 id="é›†ç¾¤åŸç†"><a href="#é›†ç¾¤åŸç†" class="headerlink" title="é›†ç¾¤åŸç†"></a>é›†ç¾¤åŸç†</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210616033200.png"></p>
<blockquote>
<p>Consul çš„å¸¸è§é»‘è¯æœ‰å¾ˆå¤šï¼Œå¦‚ Agentã€Clientã€Serverã€DataCenterã€Consensusã€Gossipã€LAN Gossipã€WAN Gossipã€RPCâ€¦â€¦ ä»–ä»¬çš„æ„æ€å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><strong>Agent</strong></p>
<blockquote>
<p>Consul é›†ç¾¤ä¸­æ¯ä¸ªæˆå‘˜éƒ½ä¼šè¿è¡Œ Agentï¼Œä»–æ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ã€‚ä¸»è¦åˆ†ä¸º Server ä¸ Client æ¨¡å¼ï¼Œèƒ½è¿è¡Œ DNS æˆ– HTTP æ¥å£ï¼Œ<strong>è´Ÿè´£åœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œä¿æŒæœåŠ¡åŒæ­¥</strong>ã€‚</p>
</blockquote>
<p><strong>Client</strong></p>
<blockquote>
<p>Client è½¬å‘æ‰€æœ‰ RPC åˆ° Server çš„ä»£ç†ï¼ŒClient æƒ³å¯¹äºæ˜¯æ— çŠ¶æ€çš„ï¼Œä»–å”¯ä¸€æ‰§è¡Œåå°æ´»åŠ¨æ˜¯åŠ å…¥ LAN Gossip æ± ã€‚Client åªéœ€è¦è¾ƒä½çš„èµ„æºå¼€é”€ï¼Œä»¥åŠè¾ƒå°‘çš„ç½‘ç»œæµé‡å¸¦å®½ç­‰ã€‚</p>
<blockquote>
<p><strong>RPCï¼ˆRemote Procedure Callï¼‰è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</strong>ï¼Œè¯¥åè®®å…è®¸ä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨å¦ä¸€å°å¼€æ”¾ç½‘ç»œçš„è®¡ç®—æœºã€‚åœ¨ Consul é›†ç¾¤ä¸­ä¸»è¦å…è®¸ Client è¯·æ±‚ Server çš„è¯·æ±‚&#x2F;å“åº”æœºåˆ¶</p>
</blockquote>
<blockquote>
<p><strong>LAN gooip</strong> åŒ…å«äº†æ‰€æœ‰ä¸ä½äºåŒä¸€ä¸ªå±€åŸŸç½‘æˆ–åŒä¸€ä¸ªæ•°æ®ä¸­å¿ƒçš„æ‰€æœ‰èŠ‚ç‚¹</p>
<blockquote>
<p><strong>Gossip</strong> ä¸»è¦ç”¨äºå®ç°åŸºäº UDP çš„éšæœºç‚¹åˆ°ç‚¹é€šä¿¡</p>
</blockquote>
</blockquote>
</blockquote>
<p><strong>Server</strong></p>
<blockquote>
<p>å…·æœ‰æ‰©å±•åŠŸèƒ½çš„ä»£ç†ï¼ŒåŠŸèƒ½åŒ…æ‹¬Rafté€‰ä¸¾ã€ç»´æŠ¤é›†ç¾¤çŠ¶æ€ã€å“åº” RPCå·®éœ€ã€ä¸å…¶ä»–æ•°æ®ä¸­å¿ƒäº¤äº’ WAN gossipã€è½¬å‘æŸ¥è¯¢ç»™ Leader\è¿œç¨‹æ•°æ®ä¸­å¿ƒã€‚<br>ä»–ä¸»è¦æ˜¯åœ¨å±€åŸŸç½‘å†…ä¸æœ¬åœ°å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œé€šè¿‡å¹¿åŸŸç½‘ä¸å…¶ä»–æ•°æ®ä¸­å¿ƒè¿›è¡Œé€šä¿¡ï¼Œé€šå¸¸ Serverä¿å­˜é›†ç¾¤ä¸­çš„é…ç½®ä¿¡æ¯ï¼ˆæ¯ä¸ªæ•°æ®ä¸­å¿ƒçš„ Server æ•°é‡å»ºè®®ä¸º 3ï½5ä¸ªï¼‰</p>
<blockquote>
<p><strong>Wan gooip</strong> åªåŒ…å«åˆ†å¸ƒåœ¨ä¸åŒæ•°æ®ä¸­å¿ƒçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œæ•°æ®ä¸­å¿ƒé—´é€šå¸¸é‡‡ç”¨äº’è”ç½‘æˆ–å¹¿åŸŸç½‘è¿›è¡Œé€šä¿¡ã€‚</p>
</blockquote>
<p><strong>DataCenter</strong></p>
<blockquote>
<p>ä¸€ä¸ªç§æœ‰ä¸”ä½å»¶è¿Ÿå’Œé«˜å®½å¸¦çš„ç½‘ç»œç¯å¢ƒ</p>
</blockquote>
<p><strong>Consensus</strong></p>
<blockquote>
<p>Consensus ç”¨äºä»£è¡¨å¤åˆ¶æœºçš„çŠ¶æ€ä¸€è‡´æ€§ï¼Œå³ç”¨äºè¡¨æ˜ Server ä¸ é¢†è¢–é€‰ä¸¾çš„äº‹åŠ¡é¡ºåºè¾¾æˆä¸€è‡´ã€‚</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<h4 id="Gossip-and-Wan-and-LAN"><a href="#Gossip-and-Wan-and-LAN" class="headerlink" title="Gossip and Wan and LAN"></a>Gossip and Wan and LAN</h4><p>åœ¨ Consul æ•°æ®ä¸­å¿ƒä¸­ï¼Œå®˜æ–¹ç»™æˆ‘ä»¬æœ€å¥½çš„å»ºè®®æ•°é‡æ˜¯ä¸‰å°åˆ°äº”å°ä¹‹é—´ã€‚è¿™æ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘æ€è€ƒä¹‹åæ‰€å¾—åˆ°çš„ç»“æœï¼Œå½“å¾ˆå¤šå°æ•°æ®ä¸­å¿ƒåŠ å…¥åï¼Œåˆ™è¾¾æˆå…±è¯†çš„è¿‡ç¨‹å¾ˆæ…¢ï¼Œä½†åªæœ‰1ï½2å°æ•°æ®ä¸­å¿ƒå¯ç”¨æ€§åˆä¸é«˜ï¼Œå› æ­¤æ‰€å¾—å‡ºçš„æƒè¡¡åˆ©å¼Šçš„æ•°é‡ä¸º 3~5å°ä¹‹é—´ã€‚</p>
<h5 id="Gossip-ï¼ˆç¬¬å…­å±ŠACMåˆ†å¸ƒå¼è®¡ç®—åŸç†å¹´ä¼šè®ºæ–‡é›†ï¼‰"><a href="#Gossip-ï¼ˆç¬¬å…­å±ŠACMåˆ†å¸ƒå¼è®¡ç®—åŸç†å¹´ä¼šè®ºæ–‡é›†ï¼‰" class="headerlink" title="Gossip ï¼ˆç¬¬å…­å±ŠACMåˆ†å¸ƒå¼è®¡ç®—åŸç†å¹´ä¼šè®ºæ–‡é›†ï¼‰"></a>Gossip ï¼ˆç¬¬å…­å±ŠACMåˆ†å¸ƒå¼è®¡ç®—åŸç†å¹´ä¼šè®ºæ–‡é›†ï¼‰</h5><blockquote>
<p>Demers, Alan; Greene, Dan; Hauser, Carl; Irish, Wes; Larson, John; Shenker, Scott; Sturgis, Howard; Swinehart, Dan; Terry, Doug (1987-01-01). Epidemic Algorithms for Replicated Database Maintenance. Proceedings of the Sixth Annual ACM Symposium on Principles of Distributed Computing. PODC â€˜87. New York, NY, USA: ACM. pp. 1â€“12. doi:10.1145&#x2F;41840.41841. ISBN 978-0897912396. S2CID 1889203.</p>
</blockquote>
<p>Gossip protocol åˆç§° Epidemic Protocolï¼ˆæµè¡Œç—…åè®®ï¼‰ï¼Œè¯¥åè®®æ—©åœ¨1987å¹´å‘è¡¨åœ¨ ACM è®ºæ–‡ ã€ŠEpidemic Algorithms for Replicated Database Maintenanceã€‹ä¸­ï¼Œä¸»è¦ç”¨äºåœ¨åˆ†å¸ƒå¼æ•°æ®åº“ç³»ç»Ÿä¸­å„ä¸ªå‰¯æœ¬èŠ‚ç‚¹é—´çš„åŒæ­¥æ•°æ®ã€‚</p>
<h6 id="å…«å¦é€šä¿¡æ¨¡å‹-Gossip-Protocol"><a href="#å…«å¦é€šä¿¡æ¨¡å‹-Gossip-Protocol" class="headerlink" title="å…«å¦é€šä¿¡æ¨¡å‹ (Gossip Protocol)"></a>å…«å¦é€šä¿¡æ¨¡å‹ (Gossip Protocol)</h6><p>æ— è®ºå–œæ¬¢ä¸å¦ï¼Œå…«å¦åœ¨äººç±»ç¤¾ä¼šä¸­æ‰®æ¼”äº†é‡è¦çš„è§’è‰²ã€‚Dunbarï¼ˆä¸€ä½äººç±»å­¦å®¶ï¼‰åœ¨å…·æœ‰äº‰è®®çš„ä¸€æœ¬ä¹¦ä¸­å£°ç§°ï¼Œè¯­è¨€çš„å‡ºç°åŸå› æ˜¯å…è®¸é—²èŠï¼Œè€Œé—²èŠçš„æ•´ä¸ªè¿‡ç¨‹æ˜¯ä¸éœ€è¦ä»”ç»†æ€è€ƒå’Œæ¢³ç†çš„ã€‚</p>
<p>å› æ­¤æ— è®ºä»€ä¹ˆæƒ…å†µï¼Œæ¯«æ— ç–‘é—®è¿™äº›æµè¨€èœšè¯­ä»ç„¶æ˜¯ä¸€ç§åœ¨ç¤¾ä¼šæ´»åŠ¨ä¸­ä¼ æ’­éå¸¸ä¼˜ç§€çš„ã€‚ç‰¹åˆ«æ˜¯ä¼ æ’­é€Ÿåº¦éå¸¸ç‹‚ï¼Œè€Œè¿™ä¸ªè¿‡ç¨‹å¯¹ç»„ç»‡ä¿¡æ¯ä¼ æ’­çš„ä¼å›¾å…·æœ‰ä¸€äº›æŠµæŠ—åŠ›ã€‚</p>
<blockquote>
<p>Kimmel åœ¨ä¹¦ä¸­ç»™å‡ºäº†è®¸å¤šå…³äºäººç±»å…«å¦çš„ä¾‹å­å’Œç»†èŠ‚</p>
</blockquote>
<p>è™½ç„¶å…«å¦é€šå¸¸ä¼šè¢«è®¤ä¸ºæ˜¯ä¸€ç§ä¼ æ’­æ‰‹æ®µï¼Œä½†æ˜¯å®é™…ä¸Šå¹¶ä¸ä»…ä»…æ˜¯æœºå™¨ä¸Šçš„ä¼ é€’ï¼Œè€Œä¸ªç»è¿‡å¤„ç†çš„ã€‚å…·ä½“æµç¨‹ä¸ºä¸€ä¸ªäººæ”¶é›†ã€å¤„ç†ä¿¡æ¯å¹¶å°†å¤„ç†åçš„ä¿¡æ¯ä¼ é€’ç»™å…¶ä»–äººã€‚<br> åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¿¡æ¯è‡³å°‘ä¼šæ ¹æ®å…¶å…´è¶£è¿›è¡Œè¿‡æ»¤ï¼Œè¿™æ ·ä¸€æ¥æœ€æœ‰è¶£çš„æ–°é—»åœ¨ä¼ æ’­åˆ°æ¯ä¸ªäººä¹‹å‰å°±ä¸ä¼šåœæ­¢ä¼ æ’­ã€‚</p>
<p> æ›´å¤æ‚çš„åŒ–æ¥è®²ï¼Œä¿¡æ¯æ˜¯é€æ¸æ”¹å˜çš„ï¼Œè¿™å¢åŠ äº†è¿‡ç¨‹çš„å¤æ‚æ€§å¹¶å¯èƒ½å¯¼è‡´çªå‘è¡Œä¸ºï¼Œå…¶ä¸­è¿™ä¸ªå¹³å°åˆ™å……å½“äº† â€œé›†ä½“æ™ºèƒ½â€çš„ä¿¡æ¯å¤„ç†åª’ä»‹ã€‚</p>
<h6 id="æµè¡Œç—…ä¼ æ’­æ¨¡å‹-Epidemics-Protocol"><a href="#æµè¡Œç—…ä¼ æ’­æ¨¡å‹-Epidemics-Protocol" class="headerlink" title="æµè¡Œç—…ä¼ æ’­æ¨¡å‹ (Epidemics Protocol)"></a>æµè¡Œç—…ä¼ æ’­æ¨¡å‹ (Epidemics Protocol)</h6><p>å®é™…ä¸Šè¿™äº›å…«å¦éå¸¸ç±»ä¼¼äºæµè¡Œç—…ï¼Œç—…æ¯’æ‰®æ¼”ç€ä¿¡æ¯çš„è§’è‰²ï¼Œè€Œæ„ŸæŸ“è€…åˆ™æ‰®æ¼”è€…äº†è§£ä¿¡æ¯çš„è§’è‰²ã€‚åœ¨è¿‡å»çš„å‡ å¹´å½“ä¸­ â€œç—…æ¯’å¼è¥é”€â€ çš„æ¦‚å¿µéå¸¸ç«çˆ†ï¼Œé€šè¿‡è§†é¢‘åˆ†äº«å¹³å°ä»¥åŠç¤¾äº¤ç½‘ç»œï¼Œå¹¿å‘Šå•†å¯ä»¥æœ‰æ„è¯†çš„åˆ©ç”¨æ—¥ç›Šé«˜æ•ˆçš„ä¼ æ’­å…«å¦å¹¿å‘Šã€‚</p>
<p> è€Œä»¤äººéœ‡æƒŠæˆ–éå¸¸æœ‰è¶£çš„å¹¿å‘Šï¼Œç‰¹åˆ«æ˜¯è®¾è®¡ä¼šæœ‰æå¤§é™åº¦çš„æé«˜æœºä¼šï¼Œé˜…è¯»è€…é€šå¸¸ä¼šé€šçŸ¥ä»–ä»¬çš„æœ‹å‹ç­‰ç­‰ã€‚</p>
<h6 id="åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çµæ„Ÿ"><a href="#åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çµæ„Ÿ" class="headerlink" title="åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çµæ„Ÿ"></a>åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡çµæ„Ÿ</h6><p><strong>ç¬¬ä¸€åŸå› </strong><br>å…«å¦å¯¹äºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´éå¸¸æœ‰æ„ä¹‰ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ã€‚å…¶ä¸­ä¹‹ä¸€å°±æ˜¯è®¾è®¡æ–°åè®®çš„çµæ„Ÿæ¥æºï¼š Gossip æœ‰å‡ ä¸ªå¸å¼•äººçš„ç‰¹æ€§ï¼Œå¦‚ç®€å•ã€é€Ÿåº¦ã€å¥å£®ç­‰ï¼Œé™¤æ­¤è¿˜åŒ…å«äº†ç¼ºä¹ä¸­å¤®æ§åˆ¶çš„ç“¶é¢ˆã€‚</p>
<p>è¿™äº›ç‰¹æ€§å¯¹äºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿå…³é”®ç»„æˆéƒ¨åˆ†çš„ <strong>ä¿¡æ¯åˆ†å‘å’Œé›†ä½“ä¿¡æ¯å¤„ç†ï¼ˆèšåˆï¼‰</strong> éå¸¸é‡è¦ã€‚</p>
<p><strong>ç¬¬äºŒåŸå› </strong><br>éšç€å½“ä»Šäº’è”ç½‘çš„ç¨³æ­¥å‘å±•ï¼Œç—…æ¯’å’Œè •è™«çš„ä¼ æ’­ç­–ç•¥è¶Šæ¥è¶Šä¸ºä¹‹å¤æ‚ã€‚å—æ„ŸæŸ“çš„è®¡ç®—æœºé€šå¸¸ä¼šç»„æˆç½‘ç»œï¼ˆè¢«ç§°ä¸º â€œåƒµå°¸ç½‘ç»œâ€ï¼‰ï¼Œèƒ½å¤Ÿè¿›è¡Œåä½œå’Œæ‰§è¡Œæ”»å‡»ç­‰æ‰‹æ³•ã€‚</p>
<p> è¿™å¯¹äº’è”ç½‘åŸºç¡€è®¾æ–½æ„æˆäº†éå¸¸é‡å¤§çš„å¨èƒï¼Œä¸ºåº”å¯¹è¿™äº›ç½‘ç»œçš„ä¸€ä¸ªåŠæ³•å°±æ˜¯è®¾é˜²é˜²æ­¢ä»–ä»¬çš„ä¼ æ’­ï¼Œè¿™éœ€è¦å¯¹æµè¡Œç—…æœ‰å¾ˆå¥½çš„äº†è§£æ‰å¯é¢„é˜²ã€‚</p>
<p>åœ¨æœ¬ç¯‡è®ºæ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦å…³æ³¨æµè¡Œç—…ä»¥åŠå…«å¦ä½œä¸ºè®¾è®¡é«˜å¯ç”¨ç»„ç»‡ç³»ç»Ÿå’ŒæœåŠ¡çš„çµæ„Ÿä½œä¸ºæ¥æºã€‚</p>
<h5 id="Gossip-in-Consul"><a href="#Gossip-in-Consul" class="headerlink" title="Gossip in Consul"></a>Gossip in Consul</h5><h6 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h6><p>Consul ä½¿ç”¨ Gossip åè®®æ¥ç®¡ç†æˆå‘˜èµ„æ ¼å¹¶å‘é›†ç¾¤å¹¿æ’­æ¶ˆæ¯ï¼Œé€šè¿‡ Serf åº“æ‰€æä¾›ï¼Œæ‰€åŸºäº  â€œSWIM: Scalable Weakly-consistent Infection-style Process Group Membership Protocolâ€ è®ºæ–‡å¹¶åšäº†ä¸€äº›å¿…è¦çš„ä¿®æ”¹ã€‚</p>
<h6 id="WAN-and-Lan"><a href="#WAN-and-Lan" class="headerlink" title="WAN and Lan"></a>WAN and Lan</h6><p>Consul ä½¿ç”¨äº†ä¸¤ä¸ªä¸åŒçš„å…«å¦æ± ï¼Œåˆ†åˆ«ç§°ä¹‹ä¸º <strong>Lan ä¸ Wan</strong> æ± ï¼Œæ¯ä¸ªæ•°æ®ä¸­å¿ƒéƒ½æœ‰ä¸€ä¸ª Lan æ± ï¼Œå…¶ä¸­åŒ…å«æ•°æ®ä¸­å¿ƒçš„æ‰€æœ‰æˆå‘˜ï¼ˆåŒ…æ‹¬å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ï¼‰</p>
<p>Lan æ± çš„ä¸»è¦ä½œç”¨æ˜¯æˆå‘˜ä¿¡æ¯å…è®¸å®¢æˆ·ç«¯è‡ªåŠ¨å‘ç°æœåŠ¡å™¨ï¼Œä»¥æ­¤æ¥å‡å°‘æ‰€éœ€çš„é…ç½®é‡ã€‚åœ¨åˆ†å¸ƒå¼æ•…éšœæ£€æµ‹ä¸­å…è®¸æ£€æµ‹çš„å·¥ä½œç”±æ•´ä¸ªé›†ç¾¤å…±äº«ï¼Œè€Œä¸æ˜¯å•ä¸ªæœåŠ¡å™¨è¿›è¡Œï¼Œ <strong>ä»–åŒ…å«äº†æ‰€æœ‰ä½äºåŒä¸€ä¸ªå±€åŸŸç½‘æˆ–è€…åŒä¸€ä¸ªæ•°æ®ä¸­å¿ƒçš„æ‰€æœ‰èŠ‚ç‚¹</strong></p>
<p>è€Œ Wan æ± æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œæ— è®ºæ•°æ®ä¸­å¿ƒå¦‚ä½•ï¼Œæ‰€æœ‰æœåŠ¡å™¨éƒ½åº”å‚ä¸WANæ± ã€‚WAN æ± æä¾›æˆå‘˜ä¿¡æ¯å…è®¸æœåŠ¡å™¨æ‰§è¡Œå¤¸æ•°æ®ä¸­å¿ƒçš„è¯·æ±‚ã€‚</p>
<p>æ•…éšœæ£€æµ‹å…è®¸ Consul ä¼˜é›…çš„å¤„ç†ä¸¢å¤±è¿æ¥çš„æ•´ä¸ªæ•°æ®ä¸­å¿ƒï¼Œæˆ–ä»…å¤„ç†è¿œç¨‹æ•°æ®ä¸­å¿ƒçš„å•ä¸ªæœåŠ¡å™¨ï¼Œ<strong>ä»–åªåŒ…å«äº†åˆ†å¸ƒåœ¨ä¸åŒæ•°æ®ä¸­å¿ƒçš„æ‰€æœ‰èŠ‚ç‚¹</strong></p>
<h4 id="é›†ç¾¤å®ç°åŸç†"><a href="#é›†ç¾¤å®ç°åŸç†" class="headerlink" title="é›†ç¾¤å®ç°åŸç†"></a>é›†ç¾¤å®ç°åŸç†</h4><h5 id="Leader-and-Client-amp-Server"><a href="#Leader-and-Client-amp-Server" class="headerlink" title="Leader and Client&amp;Server"></a>Leader and Client&amp;Server</h5><p>ä»ä¸Šå›¾å¯ä»¥å¾—çŸ¥ï¼Œæ¯ä¸ªæ•°æ®ä¸­å¿ƒçš„ Client ä»¥åŠ Server æ˜¯æ··åˆçš„ï¼Œä¸€èˆ¬å®˜æ–¹å»ºè®®æ•°æ®ä¸­å¿ƒ Server é€šå¸¸ä¸º 3~5 å°ã€‚</p>
<blockquote>
<p>è¿™æ˜¯ç»è¿‡æ·±æ€ç†Ÿè™‘ä¹‹åæ‰€å¾—å‡ºçš„ç»“æœï¼Œå› ä¸ºå¦‚æœæœ‰å¤ªå¤šçš„æœºå™¨åŠ å…¥åˆ™è¾¾æˆå…±è¯†ä¼šå˜æ…¢ã€‚ä½†åªæœ‰ 1ï½2å°çš„æ•°æ®ä¸­å¿ƒå¯ç”¨æ€§åˆä¸é«˜ï¼Œäºæ˜¯ 3~5å°æ˜¯æœ€å¥½çš„é€‰æ‹©</p>
</blockquote>
<p>æ•°æ®ä¸­å¿ƒçš„é¢†è¢–ï¼ˆLeaderï¼‰æ˜¯æœ‰ä¸€ä¸ªé¢å¤–å·¥ä½œçš„ Serverï¼Œä»–æ˜¯ç”±æ‰€æœ‰ Server é€‰å‡ºçš„ï¼ˆRaft åè®®ï¼‰ï¼Œä¸»è¦ç”¨äºå¤„ç†æ‰€æœ‰çš„æŸ¥è¯¢å’Œäº‹åŠ¡ã€‚ç”±äºéœ€è¦éµä¸€è‡´æ€§åè®®çš„è¦æ±‚ï¼Œæ‰€ä»¥äº‹ç‰©ä¹Ÿå¿…é¡»è¢«å¤åˆ¶åˆ°å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹ä¸­ï¼ˆCAP åè®®ï¼‰ã€‚</p>
<blockquote>
<p>æ¯ä¸ªæ•°æ®ä¸­å¿ƒçš„ Server éƒ½æ˜¯ Raft èŠ‚ç‚¹é›†åˆçš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è¿™æœŸé—´å†…å¦‚æœæœ‰ä¸€ä¸ªéé¢†è¢–æœåŠ¡å™¨æ”¶åˆ°äº†RPCè¯·æ±‚ï¼Œå°†ä¼šå°†è¯·æ±‚è½¬å‘ç»™é›†ç¾¤ä¸­çš„é¢†è¢–æœåŠ¡å™¨ä¸­ã€‚</p>
</blockquote>
<h5 id="WAN-and-LAN"><a href="#WAN-and-LAN" class="headerlink" title="WAN and LAN"></a>WAN and LAN</h5><p>ä¸ºäº†å…è®¸æ•°æ®ä¸­å¿ƒèƒ½å¤Ÿä»¥ â€œä½è€¦åˆï¼ˆLow-touchï¼‰â€çš„æ–¹å¼å‘ç°å½¼æ­¤ã€‚é‚£ä¹ˆé€šè¿‡ WAN gossip Pool æ¥åªåŒ…å«æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œç”¨äºä¼˜åŒ–ç½‘ç»œå»¶è¿Ÿï¼Œé‚£ä¹ˆä¸€ä¸ªæ–°çš„æ•°æ®ä¸­å¿ƒå°±å¾ˆå®¹æ˜“åŠ å…¥åˆ°ç°å­˜çš„ WAN gooip æ± ä¸­ã€‚</p>
<blockquote>
<p>æ— è®ºæ•°æ®ä¸­å¿ƒå¦‚ä½•ï¼Œæ‰€æœ‰æœåŠ¡å™¨éƒ½åº”å‚ä¸WANæ± çš„åŸå› ï¼Œæ‰€ä»¥æœåŠ¡ä¹Ÿæ”¯æŒè·¨æ•°æ®ä¸­å¿ƒè¯·æ±‚</p>
</blockquote>
<p>è¿™ä¸ªæ—¶å€™ä¸€ä¸ªæœåŠ¡åœ¨æ”¶åˆ°äº†æ¥è‡ªå¦ä¸€ä¸ªæ•°æ®ä¸­å¿ƒçš„è¯·æ±‚åï¼Œä¼šéšå³å°†è¯¥è¯·æ±‚è½¬å‘ç»™æ­£ç¡®çš„æ•°æ®ä¸­å¿ƒçš„æœåŠ¡ä¸­ã€‚ä¹‹åè¯¥æœåŠ¡å†å°†è¯·æ±‚è½¬å‘ç»™æœ¬åœ°çš„é¢†è¢–æœåŠ¡ï¼ˆLeaderï¼‰ï¼Œè¿™ä½¿å¾—æœåŠ¡ä¹‹é—´æœ‰ä¸€ä¸ªå¾ˆä½çš„è€¦åˆã€‚</p>
<p>ç”±äº Consul è‡ªèº«çš„ä¸€äº›ä¼˜åŠ¿ï¼Œå¦‚ææ‰€æä¾›çš„å¥åº·æ£€æŸ¥ã€é“¾æ¥ç¼“å­˜ã€ä»¥åŠå¤ç”¨ç­‰åŠŸèƒ½ï¼Œä½¿å¾—è·¨æ•°æ®ä¸­å¿ƒè¯·æ±‚éƒ½æ˜¯ç›¸å¯¹å¿«é€Ÿä¸”å¯é çš„ã€‚</p>
<h2 id="Consul-é›†ç¾¤å®ç°"><a href="#Consul-é›†ç¾¤å®ç°" class="headerlink" title="Consul é›†ç¾¤å®ç°"></a>Consul é›†ç¾¤å®ç°</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210619183625.png"></p>
<h3 id="install"><a href="#install" class="headerlink" title="install"></a>install</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -</span><br><span class="line">sudo apt-add-repository &quot;deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main&quot;</span><br><span class="line">sudo apt-get update &amp;&amp; sudo apt-get install consul</span><br></pre></td></tr></table></figure>

<blockquote>
<p>è‡³äºç¬¬äºŒæ¡å‘½ä»¤å¯èƒ½å¾ˆå¤š debian er æ— æ³•ä½¿ç”¨ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… sudo apt-get install <code>software-properties-common</code> è½¯ä»¶åŒ…æ¥è§£å†³ä½  <code>add-repository</code> æ— æ³•ä½¿ç”¨çš„æƒ…å†µ</p>
<blockquote>
<p>å½“ä½ æ‰§è¡Œç¬¬ä¸‰æ¡å‘½ä»¤çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ <code>update</code> å¯¹äºä¸€äº›éå¸¸çº¯å‡€çš„å‘è¡Œç‰ˆï¼Œä½ å¯èƒ½è¿˜éœ€è¦å®‰è£… <code>sudo apt-get install apt-transport-https</code></p>
</blockquote>
</blockquote>
<p>å½“å®‰è£…å®Œæˆåæˆ‘ä»¬å¯ä»¥æ‰§è¡Œ <code>consul</code> æ¥éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">consul</span> </span><br><span class="line">Usage: consul [--version] [--help] &lt;command&gt; [&lt;args&gt;]</span><br><span class="line"></span><br><span class="line">Available commands are:</span><br><span class="line">    agent          Runs a Consul agent</span><br><span class="line">    catalog        Interact with the catalog</span><br><span class="line">    event          Fire a new event</span><br><span class="line">    exec           Executes a command on Consul nodes</span><br><span class="line">    force-leave    Forces a member of the cluster to enter the &quot;left&quot; state</span><br><span class="line">    info           Provides debugging information for operators.</span><br><span class="line">    join           Tell Consul agent to join cluster</span><br><span class="line">    keygen         Generates a new encryption key</span><br><span class="line">    keyring        Manages gossip layer encryption keys</span><br><span class="line">    kv             Interact with the key-value store</span><br><span class="line">    leave          Gracefully leaves the Consul cluster and shuts down</span><br><span class="line">    lock           Execute a command holding a lock</span><br><span class="line">    maint          Controls node or service maintenance mode</span><br><span class="line">    members        Lists the members of a Consul cluster</span><br><span class="line">    monitor        Stream logs from a Consul agent</span><br><span class="line">    operator       Provides cluster-level tools for Consul operators</span><br><span class="line">    reload         Triggers the agent to reload configuration files</span><br><span class="line">    rtt            Estimates network round trip time between nodes</span><br><span class="line">    snapshot       Saves, restores and inspects snapshots of Consul server state</span><br><span class="line">    validate       Validate config files/directories</span><br><span class="line">    version        Prints the Consul version</span><br><span class="line">    watch          Watch for changes in Consul</span><br></pre></td></tr></table></figure>

<h4 id="run"><a href="#run" class="headerlink" title="run"></a>run</h4><p>å¯ä»¥é€šè¿‡ä»¥å¼€å‘è€…æ¨¡å¼è¿è¡Œå’ŒæœåŠ¡å™¨æ¨¡å¼è¿è¡Œä¸¤ç§ï¼Œå¯é€šè¿‡ä½¿ç”¨ä¸‹è¿°å‘½ä»¤ç›´æ¥è¿›è¡Œå¯åŠ¨ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">consul agent -dev</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">consul agent -server</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><figcaption><span>or -server``` çš„åŒºåˆ«ä¸»è¦æ˜¯å¼€å‘è€…æ¨¡å¼å’ŒæœåŠ¡å™¨æ¨¡å¼ä¸¤ç§è¿è¡Œæ¨¡å¼ï¼Œè€Œ **agent** åˆ™æ˜¯ç”¨äºæ³¨å†ŒæœåŠ¡ã€è¿è¡Œå¥åº·æ£€æŸ¥çš„ä¸€ä¸ªåŠŸèƒ½ã€‚æ¯ä¸ªæ•°æ®ä¸­å¿ƒéƒ½è¦æ±‚è‡³å°‘æœ‰ä¸€å° Agent (Server æ¨¡å¼) ï¼Œæ¨èäº 3~5 å°ã€‚</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ä»–ä¸»è¦æœ‰ Client æ¨¡å¼å’Œ  Server ä¸¤ç§æ¨¡å¼ï¼Œå…¶ä¸­ Client æ¨¡å¼ä¸»è¦æ˜¯ç”¨äºè¿è¡Œå†™ä¸Šè¿°çš„æœåŠ¡ï¼ˆæ³¨å†ŒæœåŠ¡ã€å¥åº·æ£€æŸ¥â€¦â€¦ï¼‰è€Œ Server åˆ™æ˜¯ä¸»è¦æ¥æ”¶è¿™äº›åŠŸèƒ½æŸ¥è¯¢åçš„æ•°æ®ã€‚</span><br><span class="line"></span><br><span class="line">&gt; å½“è¿è¡Œä¹‹åæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—® [http://127.0.0.1:8500/](http://127.0.0.1:8500/) æ¥è¿›è¡ŒæŸ¥çœ‹å’Œç®¡ç† Consul é›†ç¾¤çŠ¶æ€</span><br><span class="line"></span><br><span class="line">**å¸¸ç”¨å‘½ä»¤**</span><br><span class="line"></span><br><span class="line">| ID | DA | FA |</span><br><span class="line">| --- | --- | --- | </span><br><span class="line">| members | åˆ—å‡º Consul ä¸‹é›†ç¾¤æˆå‘˜ | |</span><br><span class="line">| | -datailed | æŸ¥çœ‹ Consul  é›†ç¾¤æˆå‘˜è¯¦ç»†ä¿¡æ¯ | |</span><br><span class="line">| monitor | æŒç»­æ‰“å°å½“å‰ Consul ä»£ç†æµæ—¥å¿— | |</span><br><span class="line">| agent | è¿è¡Œ Consul ä»£ç† | |</span><br><span class="line">| | -dev | å¼€å‘è€…æ¨¡å¼ |</span><br><span class="line">| | -server | æœåŠ¡å™¨æ¨¡å¼ |</span><br><span class="line">| join | åŠ å…¥æŸä¸ªé›†ç¾¤ | |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### vagrant init</span><br><span class="line">Consul é›†ç¾¤çš„å®ç°ä¹Ÿéå¸¸ç®€å•ï¼Œä½†å¤šå‡ºäº† ```join``` å‚æ•°ï¼Œä¸»è¦æ˜¯åŠ å…¥é›†ç¾¤ã€‚è€Œåœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼Œåœ¨æ­£å¸¸ä¸”èµ„é‡‘ä¸å…è®¸çš„æƒ…å†µä¸‹æˆ‘ä»¬æ˜¯ä¸ä¼šä¸ŠæœåŠ¡å™¨çš„ï¼Œæ‰€ä»¥ä¸Šä¹Ÿæœ‰å¾ˆå¤šæ–‡ç« å‡ºç°äº†ä¸€äº›è¿·æƒ‘æ€§æ–‡ç« ã€‚</span><br><span class="line"></span><br><span class="line">æ¯”å¦‚ï¼Œè¿è¡Œ ```xxx``` å‘½ä»¤ï¼Œä¹‹åæ‰§è¡Œ ```join```ï¼Œè¿™å°±å¾ˆæ— è¯­ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åªè¦è¿è¡Œä¸€ä¸ªå•ä¸ª consul é›†ç¾¤å°±ä¼šå‘ç°ï¼Œä»– **å¹¶ä¸æ˜¯äº¤äº’å¼çš„**ï¼Œä½ è¿™ä¸ªç»ˆç«¯å°±æŒ‚ç€è¿™ä¸ªï¼Œä¹‹åä½ åœ¨å¼€ä¸ªæ–°ç»ˆç«¯ï¼Œæ¥åŠ å…¥ä»–ï¼Œè¿™ä¹Ÿåˆç†ã€‚</span><br><span class="line"></span><br><span class="line">&gt; ä¸è¦é—®ä¸ºä»€ä¹ˆæ˜¯ Vagrant é—®å°±æ˜¯ HashiCorp é¡¹ç›®ä¸‹çš„ï¼ˆä¸ Consul ä¸€ä¸ªå…¬å¸å‡ºçš„ï¼‰</span><br><span class="line"></span><br><span class="line">ä½†æ˜¯æœ€ä¸åˆç†çš„æƒ…å†µå‘ç°äº†ï¼Œå°±æ˜¯ ```-bind``` å‚æ•°ä¸‹åˆ°åº•è¦å¡«å†™ä»€ä¹ˆã€‚é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¼šé€šè¿‡ vagrant æ¥éƒ¨ç½²æµ‹è¯•ç¯å¢ƒè¿›è¡Œå®ç°ã€‚</span><br><span class="line"></span><br><span class="line">ä½†å¹¸è¿çš„æ˜¯æˆ‘ä»¬ä¸éœ€è¦å•ä¸ªæ‰‹åŠ¨é…ç½® Vagrant ç¯å¢ƒï¼Œåªéœ€è¦ä¸‹è½½ Consul æ‰€ä¸ºæˆ‘ä»¬æä¾›çš„é›†ç¾¤æµ‹è¯•ç¯å¢ƒå³å¯ï¼ˆå®é™…ä¸Šå°±æ˜¯ä¸¤ä¸ª debian è£…ä¸ª Consulï¼‰ï¼š[https://github.com/hashicorp/consul/blob/master/demo/vagrant-cluster/Vagrantfile](https://github.com/hashicorp/consul/blob/master/demo/vagrant-cluster/Vagrantfile)</span><br><span class="line"></span><br><span class="line">æˆ‘ä»¬å¯ä»¥é€‰æ‹©æ‰‹åŠ¨å®‰è£…æˆ–è‡ªåŠ¨å®‰è£…ï¼Œå³æ‰§è¡Œ ```vagrant up``` æ ¹æ® **Vagrantfile** æ–‡ä»¶å†…é…ç½®æ‰§è¡Œä¸€äº›å‘½ä»¤ã€‚å¦‚ Consul æ‰€æä¾›çš„åˆ™æ˜¯è‡ªåŠ¨å®‰è£… Consulï¼Œåˆ™å¯èƒ½ä¼šé€ æˆå¡ä½çš„é—®é¢˜ï¼Œè¯»è€…å¯è‡ªè¡Œè¿›è¡Œè§£å†³ã€‚</span><br><span class="line"></span><br><span class="line">å½“é…ç½®å¥½æµ‹è¯•ç¯å¢ƒåï¼Œæˆ‘ä»¬å³æ‹¥æœ‰äº†ä¸‰å°æµ‹è¯•ç¯å¢ƒï¼Œåˆ†åˆ«ä¸º vagrant box#2 ä»¥åŠè‡ªå·±æœ¬æœºçš„ç¯å¢ƒï¼Œæˆ‘ä»¬è¦ä¿è¯è¿™ä¸‰å°ç¯å¢ƒå†…å¯ä»¥æ­£å¸¸å¯åŠ¨ consul ä»¥åŠå…¶ä»–ç­‰ç­‰ï¼Œä¹‹åå³å¯è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</span><br><span class="line"></span><br><span class="line">#### localhost</span><br><span class="line">æˆ‘ä»¬é¦–å…ˆéœ€è¦å°†æˆ‘ä»¬æœ¬æœºæˆä¸ºæ•´ä¸ªé›†ç¾¤ä¸­çš„ **é¢†å¯¼è€…ï¼ˆserver/leaderï¼‰**ï¼Œä¹‹åå‰©ä¸‹çš„ n1ã€n2 åˆ™æ‰®æ¼”å®¢æˆ·ç«¯çš„è§’è‰²è¿›è¡Œï¼š</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">consul agent -dev -node=consul-server -bind=172.20.20.1 -data-dir=data -client 0.0.0.0</span><br></pre></td></tr></table></figure>

<p>é€šè¿‡ä¸Šè¿°å‘½ä»¤ï¼Œæˆ‘ä»¬ä¸»è¦å¼€å¯äº† <strong>æµ‹è¯•</strong> æ¨¡å¼ä¸‹çš„ consul ui ï¼Œå¯é€šè¿‡è®¿é—® <a target="_blank" rel="noopener" href="http://localhost:8500/ui">http://localhost:8500/ui</a> æ¥ç›´æ¥è¿›è¡Œé€šè¿‡å¯è§†åŒ–çš„æ–¹å¼è§‚å¯Ÿé›†ç¾¤çŠ¶æ€ã€‚</p>
<blockquote>
<figure class="highlight plaintext"><figcaption><span>å‚æ•°ä¸ºæœ¬æœºå™¨çš„ IP åœ°å€ã€‚</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æ—¶å€™ä½¿ç”¨çš„åˆ™æ˜¯ ```consul agent -server -bootstrap-expect=2 -node=consul-server -bind=172.20.20.1 -data-dir=data -client 0.0.0.0``` æ¥é€šè¿‡ ```bootstrap-expect``` é™åˆ¶é›†ç¾¤æ•°é‡ç­‰ã€‚</span><br><span class="line"></span><br><span class="line">è€Œç”Ÿäº§ç¯å¢ƒæ˜¯ä¸éœ€è¦å¯è§†åŒ– uiçš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢å‡ ä¸ª api æ¥å£æ¥è¿›è¡ŒæŸ¥çœ‹ï¼š</span><br><span class="line"></span><br><span class="line">| ID | DA | </span><br><span class="line">| --- | --- |</span><br><span class="line">| ip:port/v1/status/leader | æ˜¾ç¤ºå½“å‰é›†ç¾¤çš„é¢†è¢–æœåŠ¡å™¨ |</span><br><span class="line">| ip:port/v1/agent/members | æ˜¾ç¤ºé›†ç¾¤ä¸­æ‰€æœ‰æˆå‘˜ä¿¡æ¯ |</span><br><span class="line">| ip:port/v1/status/peers | æ˜¾ç¤ºå½“å‰é›†ç¾¤ä¸­çš„ Server æˆå‘˜ |</span><br><span class="line">| ip:port/v1/catalog/services | æ˜¾ç¤ºæ‰€æœ‰æœåŠ¡ |</span><br><span class="line">| ip:port/v1/catalog/nodes | æ˜¾ç¤ºé›†ç¾¤èŠ‚ç‚¹çš„è¯¦ç»†ä¿¡æ¯ |</span><br><span class="line"></span><br><span class="line">#### vagrant up</span><br><span class="line">![](https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210619183721.png)</span><br><span class="line">##### n1</span><br><span class="line">åœ¨ n1 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨ ```vagrant ssh n1``` ç›´æ¥è¿›å…¥ n1 çš„ debian ç¯å¢ƒï¼Œä¹‹åå»ºç«‹ä¸€ä¸ªç›®å½•ä¹Ÿå¯ä»¥ä¹‹é™…è¿è¡Œï¼š</span><br><span class="line"></span><br><span class="line">éœ€è¦æ³¨æ„çš„æ˜¯å½“ ```vagrant init``` å®Œäº‹ä¹‹åï¼Œæ‰å¯ä»¥ä½¿ç”¨ ```vagrant up``` æ¥è¿›è¡Œå¯åŠ¨ï¼Œæœ€åé€šè¿‡ ```vagrant shell n1``` æ¥é€‰æ‹©è¿›å…¥å¤šä¸ªç¯å¢ƒä¸‹è¿›è¡Œå·¥ä½œã€‚</span><br><span class="line"></span><br><span class="line">```shell</span><br><span class="line">consul agent -node=client-one -bind=172.20.20.10 -enable-script-checks=true -data-dir=data</span><br></pre></td></tr></table></figure>
</blockquote>
<p>é€šè¿‡ä½¿ç”¨ <code>enable-script-checks</code> æ¥å¼€å¯ consul çš„å¥åº·æ£€æŸ¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å¼€ä¸€ä¸ª n1 äº¤äº’å¼ shell è¿›è¡ŒåŠ å…¥æœåŠ¡é›†ç¾¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consul join 172.20.20.1</span><br></pre></td></tr></table></figure>

<h5 id="n2"><a href="#n2" class="headerlink" title="n2"></a>n2</h5><p>n2 çš„æµç¨‹å’Œæ­¥éª¤ä¹ŸåŸºæœ¬ä¸Šå’Œ n1 ç›¸å·®æ— å‡ ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯é€šè¿‡ <code>vagrant ssh n2</code> è¿›å…¥ç¯å¢ƒï¼Œä¹‹åæ ¹æ®è‡ªå·±å–œå¥½å†³å®šæ˜¯å¦å»ºç«‹æ–°çš„ç›®å½•ï¼ˆä¸»è¦å­˜å‚¨æ–‡ä»¶ï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consul agent -node=client-two -bind=172.20.20.11 -enable-script-checks=true -data-dir=data</span><br></pre></td></tr></table></figure>

<p>ä¹‹åä½ å¯ä»¥åœ¨å»ºç«‹ä¸€ä¸ª shell n2 è¿æ¥æ¥åŠ å…¥ consul-server é›†ç¾¤ä¸­ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consul join 172.20.20.1</span><br></pre></td></tr></table></figure>

<h2 id="æœåŠ¡æä¾›è€…ä»¥åŠæœåŠ¡æ¶ˆè´¹è€…"><a href="#æœåŠ¡æä¾›è€…ä»¥åŠæœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="æœåŠ¡æä¾›è€…ä»¥åŠæœåŠ¡æ¶ˆè´¹è€…"></a>æœåŠ¡æä¾›è€…ä»¥åŠæœåŠ¡æ¶ˆè´¹è€…</h2><p>é€šè¿‡ Consul å®ç°æœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åœ¨æ„å»ºé¡¹ç›®ä¸­é€‰æ‹© <code>Spring webã€Spring Boot Actuatorã€Consul Discovery</code> ç­‰é¡¹ç›®çš„ä¾èµ–ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨ pom.xml æ–‡ä»¶ä¸‹è¿›è¡Œæ·»åŠ ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæˆ‘ä»¬çš„æœåŠ¡æ¶ˆè´¹è€…ä¸éœ€è¦ <code>spring-boot-starter-actuator</code> ä¾èµ–ã€‚</p>
<h3 id="æœåŠ¡æä¾›è€…"><a href="#æœåŠ¡æä¾›è€…" class="headerlink" title="æœåŠ¡æä¾›è€…"></a>æœåŠ¡æä¾›è€…</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210620003322.png"><br>æˆ‘ä»¬é¦–å…ˆæ¨¡ä»¿ä¸‹çœŸå®ç¯å¢ƒä¸‹çš„ä¸‰å°æœåŠ¡å™¨ï¼Œåˆ†åˆ«è¿è¡Œç€åŠŸèƒ½æœåŠ¡ï¼Œå› æ­¤æˆ‘ä»¬ä¸»è¦é€šè¿‡ <code>.properties</code> è¿›è¡Œå®ç°å’Œæ¨¡æ‹Ÿè¿™ä¸ªç¯å¢ƒã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹å¯åŠ¨ç±»ä¸­æ·»åŠ  Consul çš„æœåŠ¡æ³¨å†Œæ³¨è§£ <code>@EnableDiscoveryClient</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * DemoApplication.class</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@data</span> 2021/6/19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h4><h5 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">consul-provider</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8501</span></span><br><span class="line"><span class="attr">spring.cloud.consul.port</span>=<span class="string">8500</span></span><br><span class="line"><span class="attr">spring.cloud.consul.discovery.service-name</span>=<span class="string">service-provider</span></span><br><span class="line"><span class="attr">provider.name</span>=<span class="string">provider</span></span><br><span class="line"><span class="attr">logging.level.ROOT</span>=<span class="string">info</span></span><br></pre></td></tr></table></figure>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ <code>spring cloud consul discovery service-name</code> æ˜¯ä¸€ä¸ª spring cloud consul å‘ç°æœåŠ¡æ—¶çš„åç§°ï¼Œè€Œ <code>logging.level.ROOT</code> åˆ™æ˜¯ç”¨äºæè¿°æ—¥å¿—ç­‰çº§çš„ã€‚</p>
<h5 id="application-consul-provider-one-properties"><a href="#application-consul-provider-one-properties" class="headerlink" title="application-consul-provider-one.properties"></a>application-consul-provider-one.properties</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">consul-provider-one</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8502    </span></span><br><span class="line"><span class="attr">spring.cloud.consul.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.cloud.consul.port</span>=<span class="string">8500</span></span><br><span class="line"><span class="attr">spring.cloud.consul.discovery.service-name</span>=<span class="string">service-provider</span></span><br><span class="line"><span class="attr">provider.name</span>=<span class="string">provider-one</span></span><br></pre></td></tr></table></figure>
<h5 id="application-consul-provider-two-properties"><a href="#application-consul-provider-two-properties" class="headerlink" title="application-consul-provider-two.properties"></a>application-consul-provider-two.properties</h5><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">consul-provider-two</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8503</span></span><br><span class="line"><span class="attr">spring.cloud.consul.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.cloud.consul.port</span>=<span class="string">8500</span></span><br><span class="line"><span class="attr">spring.cloud.consul.discovery.service-name</span>=<span class="string">service-provider</span></span><br><span class="line"><span class="attr">provider.name</span>=<span class="string">provider-two</span></span><br></pre></td></tr></table></figure>

<h4 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h4><h5 id="HeyController-java"><a href="#HeyController-java" class="headerlink" title="HeyController.java"></a>HeyController.java</h5><p>å½“é…ç½®å®Œå¯åŠ¨ç±»å’Œå…¨å±€æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å®ç°æœåŠ¡æä¾›çš„æ¥å£ä¿¡æ¯ï¼Œæ‰€æä¾›çš„ä¹Ÿéå¸¸ç®€å•ï¼Œå°±æ˜¯ <code>.properties</code> æ–‡ä»¶çš„å†…å®¹è·å–ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HeyController.class</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/06/19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeyController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;provider.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> <span class="string">&quot;æä¾›è€…åç§°ï¼š&quot;</span> + name + <span class="string">&quot; ç«¯å£å·ä¸ºï¼š&quot;</span> + port;</span><br><span class="line">        <span class="keyword">return</span> string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="run-1"><a href="#run-1" class="headerlink" title="run"></a>run</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">java -jar demo-0.0.1-SNAPSHOT.jar --spring.profiles.active=consul-provider-one</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">java -jar demo-0.0.1-SNAPSHOT.jar --spring.profiles.active=consul-provider-two</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">java -jar demo-0.0.1-SNAPSHOT.jar</span></span><br></pre></td></tr></table></figure>

<p>è¯»è€…å¯èƒ½éå¸¸ç–‘æƒ‘ <code>spring.profiles.active</code> çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Œå®é™…ä¸Š <code>profiles</code> æ˜¯ <strong>pro(perties</strong> çš„ç¼©å†™ï¼Œä¸ <strong>file</strong> ç›¸åŠ æ‰€ç­‰äºçš„ profilesã€‚å¯ä»¥ç†è§£ä¸ºå½“å¤šä¸ª properties æ–‡ä»¶æ—¶ï¼Œè¿è¡Œé‚£ä¸ªé…ç½®æ–‡ä»¶ï¼Œä¹‹åè®¿é—® ip:8501&#x2F;heyã€8502&#x2F;heyã€8503&#x2F;hey éƒ½å¯ä»¥çœ‹åˆ°è¿”å›çš„ä¿¡æ¯ã€‚</p>
<h3 id="æœåŠ¡æ¶ˆè´¹è€…"><a href="#æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="æœåŠ¡æ¶ˆè´¹è€…"></a>æœåŠ¡æ¶ˆè´¹è€…</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-consul-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="application-properties-1"><a href="#application-properties-1" class="headerlink" title="application.properties"></a>application.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">consul-consumer</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8504</span></span><br><span class="line"><span class="attr">spring.cloud.consul.host</span>=<span class="string">localhost</span></span><br><span class="line"><span class="attr">spring.cloud.consul.port</span>=<span class="string">8500</span></span><br><span class="line"><span class="attr">spring.cloud.consul.discovery.register</span>=<span class="string">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>å› ä¸ºæœåŠ¡æ¶ˆè´¹è€…å¹¶ä¸éœ€è¦æä¾›æœåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€‰æ‹©é€šè¿‡ <code>spring.cloud.consul.discovery.register=false</code>ï¼Œè®©å…¶ä¸æ³¨å†ŒæœåŠ¡åˆ° consul é›†ç¾¤ä¸­</p>
<h4 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210620003305.gif"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.ServiceInstance;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalancerClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * HeyController.java</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/06/19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired()</span></span><br><span class="line">    <span class="keyword">private</span> LoadBalancerClient loadBalancerClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> loadBalancerClient.choose(<span class="string">&quot;service-provider&quot;</span>);</span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> serviceInstance.getUri();</span><br><span class="line">        <span class="type">String</span> <span class="variable">callService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>().getForObject(uri + <span class="string">&quot;/hey&quot;</span>, String.class);</span><br><span class="line">        <span class="keyword">return</span> callService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™å…¶ä¸­èµ·åˆ°ä¸»è¦ä½œç”¨çš„å°±æ˜¯ <code>RestTemplate</code>ï¼Œä»–èµ·åˆ°äº†æœåŠ¡æä¾›è€…è´Ÿè½½å‡è¡¡çš„åŠŸèƒ½ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸‰å°æœåŠ¡æä¾›è€…ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¯æ¬¡åˆ·æ–°æœåŠ¡æ¶ˆè´¹è€…æ—¶ï¼Œä¼šå‡ºç°ä¸åŒçš„æœåŠ¡åç§°åŠç«¯å£å·ç­‰ä¿¡æ¯ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/java/spring cloud/5.Spring cloud Raft and CAP/">Spring cloud Raft and CAP</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/java/" rel="tag">java</a> <a class="article__tag-none-link" href="/tags/spring-cloud/" rel="tag">spring cloud</a>
			</span>
		
	</div>

	

	
		<h2 id="æ‹œå åº­å®¹é”™ç®—æ³•ï¼ˆByzantine-Generals-Problemï¼‰"><a href="#æ‹œå åº­å®¹é”™ç®—æ³•ï¼ˆByzantine-Generals-Problemï¼‰" class="headerlink" title="æ‹œå åº­å®¹é”™ç®—æ³•ï¼ˆByzantine Generals Problemï¼‰"></a>æ‹œå åº­å®¹é”™ç®—æ³•ï¼ˆByzantine Generals Problemï¼‰</h2><h3 id="ç†æƒ³æµç¨‹"><a href="#ç†æƒ³æµç¨‹" class="headerlink" title="ç†æƒ³æµç¨‹"></a>ç†æƒ³æµç¨‹</h3><p>æ‹œå åº­å®¹é”™ç®—æ³•ä¹Ÿå«æ‹œå åº­å°†å†›é—®é¢˜ï¼ˆByzantine Generals Problemï¼‰ï¼Œç”±è±æ–¯åˆ©-å…°æ³¢ç‰¹åœ¨è®ºæ–‡ä¸­æ‰€æå‡ºçš„åˆ†å¸ƒå¼å¯¹ç­‰ç½‘ç»œé€šä¿¡å®¹é”™é—®é¢˜ã€‚</p>
<p>å‡è®¾ä¸€ç»„ç½—é©¬ï¼ˆæ‹œå åº­ï¼‰å°†å†›å„ç‡é¢†ä¸€ç›´å†›é˜Ÿ <strong>å…±åŒ</strong> å›´æ”»ä¸€åº§åŸå¸‚ï¼Œä¸ºç®€åŒ–é—®é¢˜ï¼Œå„ç§å†›é˜Ÿçš„è¡ŒåŠ¨ç­–ç•¥åˆ†åˆ«ä¸º <strong>è¿›æ”»ä¸æ’¤é€€</strong> ä¸¤ç§ã€‚</p>
<p>æ¯ä¸ªæ”¯éƒ¨é˜Ÿçš„å°†å†›å¿…é¡»é€šè¿‡æŠ•ç¥¨æ¥è¾¾æˆä¸€è‡´ç­–ç•¥ï¼ˆæ‰€æœ‰å†›é˜Ÿä¸€èµ·è¿›æ”»æˆ–æ’¤é€€ï¼‰ï¼Œå› ä¸ºæ²¡æ”¯éƒ¨é˜Ÿä½ç½®ä¸åŒï¼Œæ‰€ä»¥éœ€è¦ <strong>ä¿¡ä½¿</strong> æ¥è¿›è¡Œæ²¡æ”¯éƒ¨é˜Ÿçš„äº’ç›¸è”ç³»ã€‚</p>
<p>æ­¤æ—¶æ¯æ”¯éƒ¨é˜Ÿå°†å†›å¯ä»¥æ ¹æ®è‡ªå·±çš„æŠ•ç¥¨å’Œå…¶ä»–å°†å†›æŠ•ç¥¨çš„ä¿¡æ¯æ¥å…±åŒçŸ¥é“æ‰€å†³å®šçš„è¡ŒåŠ¨ç­–ç•¥ã€‚</p>
<h3 id="å®é™…é—®é¢˜"><a href="#å®é™…é—®é¢˜" class="headerlink" title="å®é™…é—®é¢˜"></a>å®é™…é—®é¢˜</h3><h4 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h4><p>å‡è®¾åœ¨è¿™äº›8ä¸ªå°†å†›ä¸­å‡ºç°äº†1å›å¾’ï¼Œä»–ä»¬ä¸ä»…å¯èƒ½å‘è¾ƒä¸ºç³Ÿç³•çš„ç­–ç•¥è¿›è¡ŒæŠ•ç¥¨ï¼Œè¿˜å¯èƒ½é€‰æ‹©æ€§çš„ä¼ é€’æŠ•ç¥¨ä¿¡æ¯ï¼ˆå‡è®¾4ä½å°†å†›æŠ•çš„è¿›æ”»ï¼Œ4ä½å°†å†›æŠ•çš„æ’¤é€€ï¼Œé‚£ä¹ˆç»™è¿›æ”»çš„å°†å†›è¯´ä»–ä»¬æŠ•çš„éƒ½æ˜¯è¿›æ”»ï¼Œç»™æŠ•æ’¤é€€çš„å°†å†›è¯´æŠ•çš„éƒ½æ˜¯æ’¤é€€ï¼‰ã€‚</p>
<p><strong>é‚£ä¹ˆè¿™æ ·å„æ”¯å†›é˜Ÿçš„ä¸€ç›´åè°ƒå³ä¸€è‡´æ€§é­åˆ°äº†ç ´å</strong></p>
<h4 id="å¯é æ€§"><a href="#å¯é æ€§" class="headerlink" title="å¯é æ€§"></a>å¯é æ€§</h4><p>ç”±äºå„ä¸ªå°†å†›éœ€è¦é€šè¿‡ <strong>ä¿¡ä½¿è¿›è¡Œé€šè®¯</strong>ï¼Œé‚£ä¹ˆå›å¾’å°†å†›å¯èƒ½é€šè¿‡ä¼ªé€ çš„ä¿¡ä»¶ä»¥åŠä»¥å…¶ä»–å°†å†›çš„èº«ä»½å‘é€å‡çš„æŠ•ç¥¨ã€‚</p>
<p>å³ä½¿æˆ‘ä»¬ä¿è¯äº†æ‰€æœ‰å°†å†›éƒ½å¯é çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¸èƒ½æ’é™¤ä¿¡ä½¿è¢«æ•Œäººæˆªæ€æˆ–å›å˜ä»¥åŠæ›¿æ¢ç­‰æƒ…å†µï¼Œå› æ­¤å¾ˆé—¹ä¿è¯äººå‘˜çš„ <strong>å¯é æ€§</strong>ã€‚ï¼š</p>
<h3 id="æ‹œå åº­å®¹é”™"><a href="#æ‹œå åº­å®¹é”™" class="headerlink" title="æ‹œå åº­å®¹é”™"></a>æ‹œå åº­å®¹é”™</h3><p>å‡è®¾æ•´å¥—ä½“ç³»éƒ½æŒ‰ç…§ç†æƒ³åŒ–æ­£å¸¸æƒ…å†µä¸‹ï¼Œå°†å†›ä»¬ä»ç„¶å¯ä»¥é€šè¿‡ <strong>å¤šæ•°å†³å®šæˆ˜ç•¥</strong>ï¼Œè€Œè¿™å°†ä¼šè¢«ç§°ä¹‹ä¸º <strong>æ‹œå åº­å®¹é”™</strong></p>
<h2 id="Raftï¼ˆReliable-Replicated-Redundant-And-Fault-Tolerantï¼‰"><a href="#Raftï¼ˆReliable-Replicated-Redundant-And-Fault-Tolerantï¼‰" class="headerlink" title="Raftï¼ˆReliable,Replicated,Redundant,And Fault-Tolerantï¼‰"></a>Raftï¼ˆReliable,Replicated,Redundant,And Fault-Tolerantï¼‰</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Raft é›†ç¾¤ï¼ˆReaf clusterï¼‰ä¸­ä¸»è¦åˆ†ä¸º <strong>é¢†è¢–ï¼ˆleaderï¼‰ã€è¿½éšè€…ï¼ˆfollowerï¼‰ã€å€™é€‰äººï¼ˆcandidateï¼‰</strong>ã€‚</p>
<p>åœ¨ä¸€ä¸ª Raft é›†ç¾¤ä¸­ï¼Œæ­£å¸¸æƒ…å†µä¸‹éƒ½ä¼šæœ‰ä¸€ä¸ªé¢†è¢–ï¼Œå…¶ä»–éƒ½æ˜¯è¿½éšè€…ï¼Œé¢†è¢–ä¼šè´Ÿè´£æ‰€æœ‰çš„å¤–éƒ¨è¯·æ±‚ï¼ˆå¦‚æœä¸æ˜¯é¢†è¢–æœºå™¨æ”¶åˆ°ï¼Œåˆ™è¯·æ±‚å°†ä¼šè¢«å¯¼åˆ°é¢†è¢–ä¸­ï¼‰ã€‚</p>
<p>é¢†è¢–ä¼šæœ‰ä¸€ä¸ªå›ºå®šæ—¶é—´å‘é€æ¶ˆæ¯ï¼Œå³ â€œå¿ƒè·³ï¼ˆheartbeatï¼‰â€ï¼Œè®©è¿½éšè€…çŸ¥é“é¢†è¢–è¿˜åœ¨æ­£å¸¸è¿ä½œã€‚æ¯ä¸ªè¿½éšè€…éƒ½ä¼šè®¾è®¡ä¸€ä¸ªè®¡æ—¶æœºåˆ¶ï¼ˆtimeoutï¼‰ï¼Œå½“è¶…è¿‡ä¸€å®šï¼ˆé€šå¸¸åœ¨ 150msã€300msï¼‰æ—¶é—´æ²¡æœ‰æ”¶åˆ°é¢†è¢–çš„å¿ƒè·³ï¼Œé‚£ä¹ˆé›†ç¾¤å°†ä¼šè¿›å…¥åˆ°é€‰ä¸¾çŠ¶æ€ã€‚</p>
<h3 id="é¢†å¯¼é€‰ä¸¾"><a href="#é¢†å¯¼é€‰ä¸¾" class="headerlink" title="é¢†å¯¼é€‰ä¸¾"></a>é¢†å¯¼é€‰ä¸¾</h3><p>å‡è®¾é¢†è¢–æœºå™¨æ­»æœºï¼Œé‚£ä¹ˆå°±éœ€è¦é€‰æ‹©æ–°çš„é¢†è¢–ã€‚æ­¤æ—¶è¿›å…¥ä¸€ä¸ªæ–°çš„ä»»æœŸå¼€å§‹é€‰ä¸¾ï¼ŒæˆåŠŸå½“é€‰çš„é¢†è¢–å¼€å§‹å·¥ä½œï¼ŒçŸ¥é“ä»–æ­»äº†å‡ºç°æ•…éšœä¸ºæ­¢ï¼Œæ­¤æ—¶å°†å¼€å¯æ–°çš„ä¸€è½®é€‰ä¸¾ã€‚</p>
<p>é€‰ä¸¾æ˜¯ <strong>å€™é€‰äºº</strong> æ‰€å‘åŠ¨çš„ï¼Œå½“é¢†å¯¼å¿ƒè·³è¶…æ—¶çš„æ—¶å€™è¿½éšè€…å°±ä¼šå°†è‡ªå·±çš„ä»»æœŸç¼–å·+1ï¼Œæ¥è¡¨ç¤ºè‡ªå·±å‚åŠ ç«é€‰å¹¶æŠ•è‡ªå·±ä¸€ç¥¨ï¼Œå¹¶å‘å…¶ä»–æœåŠ¡å™¨æ‹‰ç¥¨ï¼ˆæ¯å°æœåŠ¡å™¨ä»»æœŸåªä¼šæŠ•ä¸€ç¥¨ï¼Œ<strong>å›ºå®šç»™æœ€æ—©æ‹‰ç¥¨è¿½éšè€…</strong>ï¼‰</p>
<p>å¦‚æœå€™é€‰äººæ”¶åˆ°äº†å…¶ä»–å€™é€‰äººçš„æ‹‰ç¥¨ï¼Œä¸”æ‹‰ç¥¨çš„ä»»æœŸç¼–å·å¤§äºè‡ªå·±çš„ä»»æœŸç¼–å·ï¼Œå°±ä¼šäººå®šä½è½é€‰å¹¶æˆä¸ºè¿½éšè€…ï¼Œä»¥æ­¤è®¤ä¸ºæ¥æ‹‰ç¥¨çš„å€™é€‰äººä¸ºé¢†è¢–ï¼Œå¦‚æœæœ‰å€™é€‰äººæ”¶åˆ°äº†è¿‡åŠçš„å®£åˆ¤å°±å½“é€‰ä¸ºæ–°çš„é¢†è¢–</p>
<blockquote>
<p>å‡è®¾åœ¨ REST æœåŠ¡å™¨è¶…æ—¶æœŸé™è¿‡äº†è¿˜æ²¡æœ‰é€‰å‡ºæ–°çš„é¢†è¢–æ—¶ï¼Œé‚£ä¹ˆä»»æœŸå°†ä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼Œå¼€å¯æ–°çš„ä¸€åœºé€‰ä¸¾ã€‚</p>
<blockquote>
<p>Raft çš„æ¯å°æœåŠ¡å™¨è¶…æ—¶æœŸé™éƒ½æ˜¯éšæœºçš„ï¼Œè¿™ä¹Ÿé™ä½äº†åŒæ—¶ç«é€‰çš„å‡ ç‡ï¼Œä¹Ÿé™ä½äº†ä¸¤ä¸ªç«é€‰äººå¾—ç¥¨ä¸è¿‡åŠçš„é€‰ä¸¾å¤±è´¥å‡ ç‡ã€‚</p>
<blockquote>
<p>è¿™åœºé€‰ä¸¾ä¹Ÿè®¸ä¸æ˜¯æœ€ä¸ºå…¬å¹³çš„ï¼Œå› ä¸ºå½“é¢†è¢–æ­»æœºçš„æ—¶å€™ï¼Œæ¯ä¸ªå·²å­˜å‚¨æŒ‡ä»¤å¿…å®šåœ¨æœåŠ¡å™¨ä¸­å·²ç»å†™å…¥è¿‡åŠã€‚è€Œé€‰ä¸¾æµç¨‹åˆ™æ˜¯ä¼šè®©è®°å½•è¾ƒä¸ºå®Œæ•´çš„å€™é€‰äººæ¥èƒœé€‰ï¼Œå› ä¸ºåœ¨å€™é€‰äººæ‹‰ç¥¨çš„æ—¶å€™ä¼šé€æ¼è‡ªå·±è®°å½•çš„æœ€æ–°ä¿¡æ¯ã€‚</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="è®°å½•å¤å†™"><a href="#è®°å½•å¤å†™" class="headerlink" title="è®°å½•å¤å†™"></a>è®°å½•å¤å†™</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210615040340.png"><br>è®°å½•å¤å†™ä¸»è¦çš„ä¸»è§’åœ¨é¢†è¢–èº«ä¸Šï¼Œåœ¨ Raft é›†ç¾¤ä¸­æœ‰ä¸€ä¸ªå¤å†™çš„çŠ¶æ€æœºï¼ˆState machineï¼‰æ¥æ‰§è¡Œå¤–æ¥çš„æŒ‡ä»¤ï¼Œè€Œé¢†è¢–æ¥å—æŒ‡ä»¤æ¥å†™å…¥è®°å½•ä¸­ã€‚</p>
<p>ä¹‹åå°†æŒ‡ä»¤è½¬å‘ç»™è¿½éšè€…ï¼Œå¦‚æœè¿½éšè€…æ²¡æœ‰ååº”ï¼Œé¢†è¢–ä¼šä¸æ–­çš„é‡æ–°å‘é€æŒ‡ä»¤ç»™æ¯ä¸ªè¿½éšè€…ï¼Œç›´åˆ°æ¯ä¸ªè¿½éšè€…å°†æ–°æŒ‡ä»¤å†™å…¥è®°å½•ä¸­ä¸ºæ­¢ã€‚</p>
<p>æœ€åé¢†è¢–æ”¶åˆ°è¿‡åŠè¿½éšè€…ç¡®è®¤å†™å…¥çš„ä¿¡æ¯åï¼Œå°†ä¼šå°†æŒ‡ä»¤è§†ä¸ºå·²å­˜å‚¨ï¼ˆcommittedï¼‰ï¼Œè¿½éšè€…å‘ç°çŠ¶æ€å˜æˆå·²å­˜å‚¨ï¼Œå°†ä¼šåœ¨çŠ¶æ€æœºä¸Šæ‰§è¡Œè¯¥å‘½ä»¤ã€‚</p>
<blockquote>
<p>å½“é¢†è¢–æ­»æœºçš„æ—¶å€™ï¼Œé¢†è¢–çš„æŸäº›æ–°æŒ‡ä»¤è¿˜æ²¡æœ‰åˆ°å†™å…¥é›†ç¾¤å½“ä¸­ï¼Œå› æ­¤ä¼šé€ æˆé›†ç¾¤è®°å½•å¤„äºä¸ä¸€è‡´çš„é—®é¢˜ï¼Œå› æ­¤ä¸ºè§£å†³æ­¤é—®é¢˜ï¼š</p>
<blockquote>
<p>æ–°é¢†è¢–ä¼šæ‹…æœ‰é‡è¿”ä¸€è‡´æ€§çš„è´£ä»»ï¼Œè®©æ¯ä¸ªè¿½éšè€…è®°å½•éƒ½å’Œä»–ä¸€è‡´ã€‚ä»–å°†æ¯ä¸ªè¿½éšè€…è®°å½•è¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾å‡ºä¸¤è€…ä¸€è‡´çš„æœ€åä¸€ä¸ªä¸ä¸€è‡´çš„æŒ‡ä»¤è¿›è¡Œåˆ é™¤ï¼Œå°†è‡ªå·±ä¹‹åçš„æŒ‡ä»¤æ‹·è´ä¸ªè¿½éšè€…ã€‚<br>å‡è®¾è¿½éšè€…å¸æœºï¼Œé‚£ä¹ˆç»™ä»–è½¬å‘çš„æ‰€æœ‰æŒ‡ä»¤éƒ½ä¼šè¢«å›åº”å¤±è´¥ï¼Œè€Œå‘é€ç«¯ä¼šæŒç»­é‡æ–°å‘é€ã€‚å½“è¿™å°è¿½éšè€…é‡æ–°åŠ å…¥é›†ç¾¤æ—¶ï¼Œå°±ä¼šæ”¶åˆ°è¿™äº›æŒ‡ä»¤å¹¶é‡æ–°å›åº”ï¼ˆå·²ç»å†™å…¥çš„æŒ‡ä»¤ä¸ä¼šè¢«é‡æ–°å†™å…¥ï¼‰ã€‚</p>
</blockquote>
</blockquote>
<h2 id="å¸ƒé²å°”å®šç†ï¼ˆBrewerâ€™s-theoremï¼‰"><a href="#å¸ƒé²å°”å®šç†ï¼ˆBrewerâ€™s-theoremï¼‰" class="headerlink" title="å¸ƒé²å°”å®šç†ï¼ˆBrewerâ€™s theoremï¼‰"></a>å¸ƒé²å°”å®šç†ï¼ˆBrewerâ€™s theoremï¼‰</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210615040330.png"></p>
<h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>å¸ƒé²å°”å®šç†ï¼ˆBrewerâ€™s theoremï¼‰ä¹Ÿè¢«ç§°ä¹‹ä¸ºCAPå®šç†ï¼ˆCAP theoremï¼‰ï¼Œä¸»è¦æŒ‡å‡ºå’‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„ï¼š</p>
<ol>
<li>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼Œæ‰§è¡ŒåŒä¸€ä¸ªä¸¾åŠ¨</li>
<li>å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½èƒ½è·å–åˆ°æ­£ç¡®çš„å“åº”</li>
<li>åˆ†åŒºå®¹é”™æ€§ï¼ˆPartition toleranceï¼‰ï¼Œä¿è¯æœåŠ¡å®•æœºæ—¶å…¶ä»–æœåŠ¡ä¾ç„¶å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡ï¼ˆç³»ç»Ÿä¸­ä»»æ„ä¿¡æ¯ä¸¢å¤±æˆ–å¤±è´¥ä¸ä¼šå½±å“ç³»ç»Ÿçš„ç»§ç»­è¿ä½œï¼‰ã€‚</li>
</ol>
<h3 id="ä¸‰ä¸ªåœºæ™¯"><a href="#ä¸‰ä¸ªåœºæ™¯" class="headerlink" title="ä¸‰ä¸ªåœºæ™¯"></a>ä¸‰ä¸ªåœºæ™¯</h3><p>é€šè¿‡ CAP å®šç†ï¼Œæˆ‘ä»¬æ— æ³•åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªç‰¹æ€§ï¼Œå› æ­¤æˆ‘ä»¬å‡è®¾ï¼š</p>
<h4 id="CP-ï¼ˆ-ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼‰"><a href="#CP-ï¼ˆ-ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼‰" class="headerlink" title="CP ï¼ˆ ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼‰"></a>CP ï¼ˆ ä¸€è‡´æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼‰</h4><p>CP å³ ä¸€è‡´æ€§ã€åˆ†åŒºå®¹é”™æ€§ï¼Œç‰ºç‰²æ‰äº†å¯ç”¨æ€§ä¿è¯äº†ä¸€è‡´æ€§ï¼Œå¯èƒ½ä¼šæœ‰å‡ ä¸ªèŠ‚ç‚¹ä¸å¯ç”¨ï¼Œé€šå¸¸é€‚ç”¨ä¸é“¶è¡Œç³»ç»Ÿã€‚</p>
<h4 id="APï¼ˆå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼‰"><a href="#APï¼ˆå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼‰" class="headerlink" title="APï¼ˆå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼‰"></a>APï¼ˆå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼‰</h4><p>AP æ˜¯å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼Œèˆå¼ƒæ‰äº†ä¸€è‡´æ€§ï¼Œä¿éšœæœåŠ¡å¯ç”¨ä½†å¯èƒ½ä¼šé€ æˆæ•°æ®çš„å†²çªï¼Œå¯é€‚ç”¨æµé‡è®¿é—®å¤§å¯¹ç³»ç»Ÿæ­£å¸¸æä¾›æœåŠ¡è¦æ±‚è¾ƒé«˜çš„ç³»ç»Ÿ;</p>
<h4 id="CAï¼ˆä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼‰"><a href="#CAï¼ˆä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼‰" class="headerlink" title="CAï¼ˆä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼‰"></a>CAï¼ˆä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼‰</h4><p>ä¸€æ—¦é›†ç¾¤ä¸­ä¸€å°æœåŠ¡æ— æ³•æ­£å¸¸æä¾›æœåŠ¡åˆ™ä¼šé€ æˆå½“å‰é›†ç¾¤å®Œå…¨å´©æºƒï¼Œé€‚ç”¨ä¸æŒ‘æˆ˜è€…ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/java/spring cloud/4.Spring cloud Reactor/">Spring cloud åº”ç”¨ç¨‹åºåˆ†å±‚ä¸å“åº”å¼</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/java/" rel="tag">java</a> <a class="article__tag-none-link" href="/tags/spring-cloud/" rel="tag">spring cloud</a>
			</span>
		
	</div>

	

	
		<h2 id="MVCï¼ˆModel-View-Controllerï¼‰"><a href="#MVCï¼ˆModel-View-Controllerï¼‰" class="headerlink" title="MVCï¼ˆModel-View-Controllerï¼‰"></a>MVCï¼ˆModel-View-Controllerï¼‰</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210610053652.png"><br>MVCï¼ˆModel View Controllerï¼‰æ˜¯åœ¨è½¯ä»¶å·¥ç¨‹ä¸­è¾ƒä¸ºå¸¸è§çš„ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œæ— è®ºæ˜¯ Spring cloud ä»¥åŠ Springã€Spring boot åŸºæœ¬ä¸Šæˆ‘ä»¬éƒ½ä»‹ç»è¿‡æ­¤æ¨¡å‹ã€‚</p>
<p>å¦‚æœè¦ç®€å•çš„ç†è§£ MVC çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸Šå›¾äº†è§£åˆ°ï¼Œé¦–å…ˆ <strong>Model</strong> æ˜¯æ‹¥æœ‰å¯¹æ•°æ®ç›´æ¥è®¿é—®çš„æƒåˆ©ï¼ˆä¾‹å¦‚æ•°æ®åº“è®¿é—®ï¼‰ã€‚</p>
<p>è€Œ <strong>Conttroller</strong> åˆ™æ˜¯å¯ä»¥æ§åˆ¶åº”ç”¨ç¨‹åºçš„æµç¨‹ï¼Œå¹¶å¯¹äº‹ä»¶ä½œå‡ºå“åº”ï¼Œè¿™ä¹ŸåŒ…æ‹¬äº†å¯¹ <strong>Model</strong> çš„æ“ä½œã€‚</p>
<p>æœ€ååˆ™æ˜¯ <strong>View</strong> ï¼Œä»–èƒ½å¤Ÿæ˜¾ç¤ºèµ„æ–™ï¼Œé€šå¸¸ä¸ºå‰ç«¯åº”ç”¨ã€‚åœ¨ä¸Šå›¾ä¸­ Controller æ“çºµ Model è¿›è¡Œæ•°æ®çš„æ›´æ–°æˆ–æ’å…¥ï¼Œä¹‹åäº¤ç»™ View è¿›è¡Œæ˜¾ç¤ºç»™ç”¨æˆ·ã€‚</p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210610053645.png"></p>
<p>å¦‚æœè¯´å‰é¢æˆ‘ä»¬ä»‹ç»çš„éƒ½æ˜¯ MVC æ¦‚è¿°ï¼Œé‚£ä¹ˆé€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥è¯¦ç»†çš„è¿›è¡Œç†è§£ã€‚é¦–å…ˆæµè§ˆå™¨ä¸€çœ‹æ˜¯çœ‹åˆ°çš„å¹¶ä¸æ˜¯ Viewï¼Œè€Œæ˜¯ é€šè¿‡ <strong>DispathcherServlet</strong> æ¥è°ƒç”¨è§†å›¾æ¸²æŸ“åè¿”å›ç»™æµè§ˆå™¨ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ <strong>DispathcheServlet</strong> ç»§æ‰¿äº <strong>HttpServlet</strong> ï¼Œä¸»è¦è´Ÿè´£åè°ƒå’Œç»„ç»‡ä¸åŒç»„ä»¶æ¥å®Œæˆè¯·æ±‚å¹¶è¿”å›å“åº”çš„å·¥ä½œï¼Œä»–çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>æµè§ˆå™¨å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ¥å—è¯·æ±‚å¹¶è½¬äº¤ç»™ DispatcherServlet è¿›è¡Œå¤„ç†</li>
<li>DispatcherServlet åŒ¹é…åœ¨æ§åˆ¶å™¨ä¸­é…ç½®çš„æ˜ å°„è·¯å¾„ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥å¤„ç†</li>
<li>View è¯·æ±‚å°† Model å’Œ View è§£ææˆ Viewï¼Œä¹‹åè°ƒç”¨ render() æ–¹æ³•æ ¹æ® Model å’Œ View ä¸­çš„æ•°æ®æ¸²æŸ“å‡ºé¡µé¢ã€‚</li>
</ol>
<h3 id="ä¸‰å±‚æ¶æ„"><a href="#ä¸‰å±‚æ¶æ„" class="headerlink" title="ä¸‰å±‚æ¶æ„"></a>ä¸‰å±‚æ¶æ„</h3><p>è¿™ä¸ MVC çš„ä¸‰å±‚æ¶æ„æœ‰å¾ˆå¤§çš„å…³ç³»ï¼Œæ‰€è°“ä¸‰å±‚æ¶æ„å³ è¡¨ç°å±‚ï¼ˆUIï¼‰ã€ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆServiceï¼‰ã€æ•°æ®è®¿é—®å±‚ï¼ˆDao\Repositoryï¼‰ä¸‰ç§ï¼Œä»–ä»¬åˆ†åˆ«è¡¨ç¤ºï¼š</p>
<blockquote>
<p>Responsitory æ˜¯å­˜å–å’Œç®¡ç†å¯¹è±¡ï¼Œè€Œ Dao åˆ™æ˜¯å­˜å–å¯¹è±¡</p>
</blockquote>
<ol>
<li>è¡¨ç°å±‚ï¼š<strong>ç”¨äºå±•ç¤ºç•Œé¢</strong>ï¼Œæ¥æ”¶ç”¨æˆ·è¯·æ±‚å¹¶è¿”å›æ•°æ®ï¼Œä¸ºå®¢æˆ·ç«¯æä¾›åº”ç”¨ç¨‹åºçš„è®¿é—®æ¥å£ï¼ˆViewï¼‰</li>
<li>ä¸šåŠ¡é€»è¾‘å±‚ï¼šä¹Ÿç§°ä¹‹ä¸ºæœåŠ¡å±‚ï¼Œè´Ÿè´£ä¸šåŠ¡é€»è¾‘çš„å¤„ç†ï¼Œ<strong>ä¸»è¦è°ƒç”¨Då“¦æ›¾å¯¹æ•°æ®è¿›è¡Œ CURD çš„æ“ä½œ</strong></li>
<li>æ•°æ®è®¿é—®å±‚ï¼šä¸æ•°æ®åº“è¿›è¡Œäº¤äº’çš„æŒä¹…å±‚ï¼Œè¢« Service è°ƒç”¨ï¼Œåœ¨ Spring Data JPA ä¸­åˆ™ç”± Hibernate è¿›è¡Œå®ç°ã€‚</li>
</ol>
<h2 id="WebFlux"><a href="#WebFlux" class="headerlink" title="WebFlux"></a>WebFlux</h2><blockquote>
<p>ååº”å¼æ˜¯å…³äºå¼‚æ­¥å’Œäº‹ä»¶é©±åŠ¨çš„éå µå¡åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”éœ€è¦å°‘é‡çº¿ç¨‹è¿›è¡Œå‚ç›´æ‰©å±•ï¼Œè€Œä¸æ˜¯æ°´å¹³æ‰©å±•ï¼ˆé›†ç¾¤ï¼‰ã€‚ååº”å¼ç³»ç»Ÿå…·æœ‰æŸäº›ç‰¹å¾ï¼Œå¯ä»¥ä½¿å…¶æˆä¸ºä½å»¶è¿Ÿã€é«˜ååº¦é‡å·¥ä½œçš„ç†æƒ³é€‰æ‹©ã€‚</p>
</blockquote>
<p>WebFlux æ˜¯åœ¨ Spring Framework 5.0ï¼ˆ5.0.0.M5ï¼‰æ‰€å¼•å…¥çš„ä¸€ç§ååº”å¼ Web æ¡†æ¶ã€‚WebFlux å¯ä»¥åœ¨èµ„æºæœ‰é™çš„æƒ…å†µä¸‹æé«˜ç³»ç»Ÿçš„ååº¦é‡å’Œå‚ç›´æ‰©å±•ï¼Œè¿™æ„å‘³ç€åœ¨åŒæ ·æƒ…å†µä¸‹ WebFlux çš„ååé‡æ˜æ˜¾ä¼˜äº MVCã€‚</p>
<h3 id="å“åº”å¼ï¼ˆååº”å¼ï¼‰ä¸å‘½ä»¤å¼"><a href="#å“åº”å¼ï¼ˆååº”å¼ï¼‰ä¸å‘½ä»¤å¼" class="headerlink" title="å“åº”å¼ï¼ˆååº”å¼ï¼‰ä¸å‘½ä»¤å¼"></a>å“åº”å¼ï¼ˆååº”å¼ï¼‰ä¸å‘½ä»¤å¼</h3><p>ä¸ºäº†åº”å¯¹é«˜å¹¶å‘ç¯å¢ƒä¸‹æœåŠ¡ç«¯å¼€å‘ï¼Œå¾®è½¯æå‡ºäº†ä¸€ä¸ªå®ç°å¼‚æ­¥ç¼–ç¨‹æ–¹æ¡ˆï¼Œå³ <strong>ååº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰</strong>ã€‚å…¶ä»–æŠ€æœ¯å’Œç¤¾åŒºä¸ºäº†è·Ÿä¸Šè„šæ­¥ï¼Œå› æ­¤å‘ Netifix ç­‰å…¬å¸éƒ½ä¹Ÿæä¾›äº†ç±»ä¼¼çš„æŠ€æœ¯ï¼Œè¿™ä½¿å¾— Java å¹³å°ä¹Ÿæœ‰äº†èƒ½å¤Ÿå®ç°ååº”å¼ç¼–ç¨‹çš„æ¡†æ¶</p>
<blockquote>
<p>å“åº”å¼ç¼–ç¨‹æˆ–ååº”å¼ç¼–ç¨‹ï¼ˆReactive programmingï¼‰æ˜¯ä¸€ä¸ªé¢å‘æ•°æ®æµå’Œ <strong>å˜åŒ–ä¼ æ’­</strong> çš„å£°æ˜å¼ç¼–ç¨‹èŒƒå¼ï¼ˆDeclarative programmingï¼‰ã€‚</p>
<blockquote>
<p>å“åº”å¼ç¼–ç¨‹ä¸å‘½ä»¤å¼ç¼–ç¨‹å¯¹ç«‹ï¼Œä»–çš„ç›®æ ‡æ˜¯è®©è®¡ç®—æœºæ˜ç™½ï¼Œè€Œéæµç¨‹ï¼Œå£°æ˜å¼ç¼–ç¨‹ä¸éœ€è¦å‘Šè¯‰ç”µè„‘é—®é¢˜ï¼Œ<strong>å³å‘Šè¯‰ç»“æœï¼Œè®©æœºå™¨è‡ªè¡Œè§£å†³</strong></p>
<blockquote>
<blockquote>
<p>è€Œå“åº”å¼ç¼–ç¨‹åˆ™æ˜¯æ˜¯æ„å‘³ç€å¼å­ <code>a=b+c</code>ï¼Œè¿™æ„å‘³ç€ a æ˜¯ç”± b å’Œ c è®¡ç®—è€Œå‡ºï¼Œå¦‚æœåç»­æœ‰å˜åŒ–ä¼šå½±å“åˆ° a çš„å€¼ï¼Œè¿™ä¹Ÿæ˜¯ <strong>å³å‘Šè¯‰ç»“æœï¼Œè®©æœºå™¨è‡ªè¡Œè§£å†³</strong> </p>
</blockquote>
<p>å‘½ä»¤å¼ç¼–ç¨‹æˆ–æŒ‡ä»¤å¼ç¼–ç¨‹ï¼ˆInperative programmingï¼‰ï¼Œ<strong>è¯¦ç»†å‘½ä»¤æœºå™¨å»å¤„ç†ä¸€ç§äº‹æƒ…è€Œè¾¾åˆ°ä½ æƒ³è¦çš„ç»“æœ</strong>ã€‚<br>å˜åŒ–ä¼ é€’æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºåœ¨å‘½ä»¤å¼å˜æˆä¸­ï¼Œå‡è®¾å¼å­ä¸º <code>a=b+c</code> é‚£ä¹ˆ a çš„å€¼å°±æ¥è‡ª bå’Œcè®¡ç®—å‡ºçš„ï¼Œå¦‚æœåç»­æœ‰å˜åŒ–ä¸ä¼šå½±å“åˆ°açš„å€¼ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»–æ˜¯ <strong>ç»†å‘½ä»¤æœºå™¨å»å¤„ç†ä¸€ç§äº‹æƒ…è€Œè¾¾åˆ°ä½ æƒ³è¦çš„ç»“æœ</strong></p>
</blockquote>
</blockquote>
</blockquote>
<p>Spring WebFlux æ˜¯ä¸€ä¸ªä»å¤´å¼€å§‹æ„å»ºçš„éå µå¡Webæ¡†æ¶ï¼Œå¯åˆ©ç”¨å¤šæ ¸ä¸‹ä¸€ä»£å¤„ç†å™¨å¹¶å¤„ç†å¤§é‡å¹¶å‘ã€‚è€Œ WebFlux ä¸ Spring MVC æ•°æ®æµçš„é€‰æ‹©ä¹Ÿå„ä¸ç›¸åŒï¼Œå‰è€…æ˜¯ <strong>Reactive Streames</strong>ï¼Œåè€…åˆ™æ˜¯ <strong>Servlet API</strong>ã€‚</p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210610053635.png"><br>è‡ªç„¶è€Œç„¶ï¼Œæ—¢ç„¶ WebFlux æ˜¯ç”¨çš„æ˜¯å“åº”å¼æ•°æ®æµï¼Œè€ŒSpring MVC é€‰æ‹©çš„æ˜¯ å‘½ä»¤å¼æ•°æ®æµï¼Œè‡ªç„¶è€Œç„¶ WebFlux ä¼šæ›´å¿«ã€‚æˆ‘è®¤ä¸ºä¸Šå›¾å¾ˆå¥½çš„è¯ é‡Šäº†è¿™ä¸€ç‚¹ï¼ŒSpring MVC æ˜¯ä¸€ä¸ª <strong>å“åº” -&gt; å‡†å¤‡æ•°æ® -&gt; è¿”å›æ•°æ®</strong> çš„ä¸€ä¸ªè¿‡ç¨‹ã€‚è€Œ WebFlux åˆ™æ˜¯ <strong>å“åº” -&gt; è¿”å›æ•°æ® -&gt; å¼€å¯ä¸€ä¸ªæ–°çš„ Work çº¿ç¨‹è¿›è¡Œå‡†å¤‡ -&gt; Work çº¿ç¨‹å®Œæˆå·¥ä½œ -&gt; è¿”å›ç»“æœ</strong> ä»è€Œè®©å¯¹æ–¹è§‰å¾— WebFlux ä¼šæ›´å¿«çš„ä¸€ç‚¹ã€‚</p>
<h3 id="Reactor"><a href="#Reactor" class="headerlink" title="Reactor"></a>Reactor</h3><p>Peactor æ¡†æ¶ç”± Pivotal åŸºäº <strong>ååº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰</strong> æ€æƒ³è¿›è¡Œå®ç°ï¼Œç¬¦åˆååº”å¼ç¼–ç¨‹çš„è§„èŒƒã€‚</p>
<h4 id="å“åº”å¼ç¼–ç¨‹"><a href="#å“åº”å¼ç¼–ç¨‹" class="headerlink" title="å“åº”å¼ç¼–ç¨‹"></a>å“åº”å¼ç¼–ç¨‹</h4><p>å“åº”å¼ç¼–ç¨‹ï¼ˆReactive Programmingï¼‰æ˜¯ä¸€ç§éå µå¡ä¸”äº‹ä»¶é©±åŠ¨æ•°æ®çš„å¼€å‘æ–¹æ¡ˆï¼Œä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µæ¥æ“ä½œæ•°æ®æµã€‚</p>
<blockquote>
<p>å‡½æ•°å¼ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹æ–¹å¼ï¼Œå°†è®¡ç®—æœºçš„è¿ç®—è§†ä¸ºå‡½æ•°è®¡ç®—ï¼Œå¦‚ä½•ç›´æ¥å’Œç”ŸåŠ¨å½¢è±¡çš„è¡¨ç°å‡ºå‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹ç‚¹å‘¢ï¼Œé‚£ä¹ˆä¸‹é¢çš„è¡¨è¾¾å¼å°±éå¸¸çš„æ¸…æ™°</p>
<blockquote>
<p><strong>è¿‡ç¨‹å¼ç¼–ç¨‹ï¼š</strong> var a &#x3D; 1 + 2;<br><strong>å‡½æ•°å¼ç¼–ç¨‹ï¼š</strong> var result &#x3D; subtract(multiply(add(1,2), 3), 4);</p>
</blockquote>
<p>å…¶å®å‡½æ•°å¼å˜æˆå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šï¼Œä»–å…¶å®å°±æ˜¯å°†ä¸€æ•°å¤åˆ¶ç»™å˜é‡æˆ–è€…ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œå°±è¿™ä¸ªæ„æ€ã€‚<br>å‡½æ•°å˜æˆæœ€ä¸»è¦çš„æ˜¯Î»æ¼”ç®— (Iambda calculus)ï¼Œè€ŒÎ»æ¼”ç®—å¯ä»¥ <strong>æ¥å—å‡½æ•°å…šç»„è¾“å‡ºï¼ˆå‚æ•°ï¼‰å’Œè¾“å‡ºï¼ˆè¿”å›å€¼ï¼‰</strong>ï¼Œç›¸æ¯”è¿‡ç¨‹åŒ–ç¼–ç¨‹ç›¸æ¯”ï¼Œ<strong>å‡½æ•°å¼ç¼–ç¨‹é‡Œçš„å‡½æ•°å¯ä»¥éšæ—¶è°ƒç”¨</strong></p>
</blockquote>
<table>
<thead>
<tr>
<th>äº‹ä»¶</th>
<th>æ–¹æ³•</th>
</tr>
</thead>
<tbody><tr>
<td>åŒ…å«å…ƒç´ ä¿¡æ¯</td>
<td>onNext()</td>
</tr>
<tr>
<td>åºåˆ—ç»“æŸæ¶ˆæ¯</td>
<td>onComplete()</td>
</tr>
<tr>
<td>åºåˆ—å‡ºé”™æ¶ˆæ¯</td>
<td>onError()</td>
</tr>
</tbody></table>
<p>è¿™æ˜¯é€šçŸ¥ä¸è®¢é˜…è€…å¯¹åº”çš„æ–¹æ³•ï¼Œä½†å¦‚æœæˆ‘ä»¬ç»§ç»­çœ¼ç¥å¯ä»¥äº†è§£åˆ°èƒŒå‹æœºåˆ¶ï¼ˆä¸æœ¬æ–‡æœ‰å…³ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>äº‹ä»¶</th>
<th>Iterable è¿­ä»£æ¨¡å¼ (æ‹‰\pull)</th>
<th>Observable è§‚å¯Ÿæ¨¡å¼(æ¨\push)</th>
</tr>
</thead>
<tbody><tr>
<td>è·å–æ•°æ®</td>
<td>T next()</td>
<td>onNext()</td>
</tr>
<tr>
<td>å¤„ç†å®Œæˆ</td>
<td>hasNext()</td>
<td>onCompleted()</td>
</tr>
<tr>
<td>å‘ç°å¼‚å¸¸</td>
<td>throws Exception</td>
<td>onError()</td>
</tr>
</tbody></table>
<blockquote>
<p>1.<strong>äº‹ä»¶å‘å¸ƒè€…ï¼ˆPublisherï¼‰</strong> ä¸»åŠ¨æ¨é€æ•°æ®ç»™ <strong>è®¢é˜…è€…ï¼ˆSubscriberï¼‰</strong>ï¼Œå‡ºå‘ onNext() æ–¹æ³•;<br>2.<strong>äº‹ä»¶å‘å¸ƒè€…</strong>å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™è§¦å‘ <strong>è®¢é˜…è€…</strong> çš„ onError() æ–¹æ³•è¿›è¡Œå¼‚å¸¸æ•è·å¤„ç†<br>3.<strong>äº‹ä»¶å‘å¸ƒè€…</strong>æ¯æ¬¡æ¨é€éƒ½è§¦å‘ä¸€æ¬¡ onNext() æ–¹æ³•ï¼Œå½“æ‰€æœ‰æ¨é€æ— å¼‚å¸¸æ—¶ï¼Œ onCompleted() æ–¹æ³•åœ¨åœ¨æœ€åè§¦å‘ä¸€æ¬¡ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä»è¢«è®¢é˜…è€…å’Œè®¢é˜…è€…ç†è§£ä¸ºæœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…ã€‚</p>
</blockquote>
<p>å¦‚æœ è¢«è®¢é˜…è€…å‘å¸ƒçš„æ¶ˆæ¯å¤ªå¿«äº†ï¼Œè¶…è¿‡äº†è®¢é˜…è€…çš„å¤„ç†é€Ÿåº¦ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦é€šè¿‡ <strong>èƒŒå‹æœºåˆ¶ï¼ˆBackpressureï¼‰ï¼Œä½¿å¾—è®¢é˜…è€…èƒ½å¤Ÿæ§åˆ¶æ¶ˆè´¹æ¶ˆæ¯çš„é€Ÿåº¦ã€‚</strong></p>
<p>å®é™…ä¸Šé™¤äº† <strong>è¿­ä»£æ¨¡å¼ (lterable)</strong> å…¶ä»–çš„éƒ½æ˜¯æˆ‘ä»¬ <strong>å“åº”å¼ç¼–ç¨‹APIçš„ä½¿ç”¨æ–¹å¼</strong>ï¼Œå®é™…ä¸Šæ¿€ç´ å’Œè§‚å¯Ÿè€…æ¨¡å¼(Observable)çš„æ‰©å±•ã€‚</p>
<h4 id="Reactive-Streams"><a href="#Reactive-Streams" class="headerlink" title="Reactive Streams"></a>Reactive Streams</h4><blockquote>
<p>ä»–ç”± Netifixï¼ŒTypeSafeã€Pivatolå…±åŒåˆ¶å®šï¼Œè¿™æ˜¯ Java å¹³å°ä¸Š RxJavaã€Scalaã€Akkaã€Springã€Reactor ç­‰é¡¹ç›®çš„ä¸»è¦ç»´æŠ¤è€…æ‰€å…±åŒå‘èµ·çš„ã€‚</p>
</blockquote>
<p>ååº”å¼æµï¼ˆReactive Streamsï¼‰æ˜¯ä¸€é¡¹å€¡è®®ï¼Œä¸»è¦ç”¨äºååº”å¼ç¼–ç¨‹ç›¸å…³çš„è§„èŒƒä»¥åŠæ¥å£æä¾›æ ‡å‡†ã€‚</p>
<p>ä»–ä¸»è¦æœ‰å››ä¸ªç»„ä»¶æ„æˆï¼Œåˆ†åˆ«ä¸ºå‘å¸ƒè€…ã€è®¢é˜…è€…ã€è®¢é˜…ã€å¤„ç†å™¨ç­‰ã€‚é™¤æ­¤è¿˜æœ‰ä¸‰ä¸ªæ¥å£æœ€ä¸ºä¸»è¦ï¼š</p>
<ol>
<li>Publisherï¼ˆäº‹ä»¶å‘å¸ƒè€…ï¼‰</li>
<li>Subscriberï¼ˆè®¢é˜…è€…ï¼‰</li>
<li>Subcriptionï¼ˆè®¢é˜…ï¼‰</li>
</ol>
<h4 id="Mono-ä¸-Flux"><a href="#Mono-ä¸-Flux" class="headerlink" title="Mono ä¸  Flux"></a>Mono ä¸  Flux</h4><p>Mono ä¸ Flux éƒ½æ˜¯äº‹ä»¶çš„å‘å¸ƒè€…ï¼Œä¹Ÿæ˜¯ Reactor çš„æ ¸å¿ƒç±»ï¼š</p>
<ul>
<li>Mono<ul>
<li>å®ç°äº† org.reactivestreams.<strong>Publisher</strong> æ¥å£ï¼Œç”¨äºè¿”å›å•ä¸ªæ•°æ®</li>
</ul>
</li>
<li>Flux<ul>
<li>åŒæ ·å®ç°äº† org.reactivestreams.<strong>Publisher</strong> æ¥å£ï¼Œç”¨äºè¿”å›å¤šä¸ªæ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<p>å¦‚æœæ ¹æ® ID æŸ¥è¯¢æŸä¸ª User å¯¹è±¡ï¼Œé‚£ä¹ˆè¿”å›çš„è‚¯å®šæ˜¯å•ä¸ªæ•°æ®ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ <code>Mono&lt;User&gt;</code></p>
<p>ä½†æ˜¯å¦‚æœè¦è·å–æ‰€æœ‰ Userï¼Œåˆ™è¿”å›çš„æ˜¯å¤šä¸ªæ•°æ®ï¼Œéœ€è¦ä½¿ç”¨ <code>Flux&lt;User&gt;</code>ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ Mono ä¸ Flux ä¹‹é—´å¯ä»¥ <strong>äº’ç›¸è½¬æ¢</strong>ï¼Œå¯¹ä¸€ä¸ª Flux åºåˆ—è¿›è¡ŒæŠ€æœ¯æ“ä½œï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ä¸€ä¸ª <code>Mono&lt;Long&gt;</code> å¯¹è±¡ï¼Œå°†å¤šä¸ª Mono åºåˆ—åˆå¹¶åœ¨ä¸€èµ·ï¼Œåˆ™å¾—åˆ°çš„æ˜¯ Flux å¯¹è±¡ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/java/spring cloud/3.Spring cloud Eureka/">Spring cloud Eureka</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/java/" rel="tag">java</a> <a class="article__tag-none-link" href="/tags/spring-cloud/" rel="tag">spring cloud</a>
			</span>
		
	</div>

	

	
		<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210525030152.png"></p>
<p>æœ¬æ–‡å°†ä¼šé€šè¿‡ Eureka æ¥è¿›è¡ŒæœåŠ¡ä¸­å¿ƒçš„æ²»ç†ï¼Œå¹¶å®ç°å‡º ä¸€ä¸ª <strong>æœåŠ¡ä¸­å¿ƒé›†ç¾¤ï¼ˆEureka Server â€¦â€¦ï¼‰</strong>ï¼Œä»¥åŠ <strong>æœåŠ¡æä¾›è€…é›†ç¾¤ï¼ˆService Provider â€¦â€¦ï¼‰</strong> è¿˜æœ‰ä¸€ä¸ª <strong>æœåŠ¡æä¾›è€…æ¶ˆè´¹è€…ï¼ˆService Consumerï¼‰</strong> ã€‚ä¹‹åé€šè¿‡ <strong>æœåŠ¡ä¸­å¿ƒ</strong> å†…çš„ <strong>Eureka</strong> æ¥è¿›è¡ŒæœåŠ¡æ²»ç†ï¼Œè®© <strong>æœåŠ¡æ¶ˆè´¹è€…ï¼ˆService Consumerï¼‰ è°ƒç”¨ æœåŠ¡æä¾›è€…ï¼ˆService Providerï¼‰</strong> æ¥æä¾›æœåŠ¡ã€‚</p>
<p>æˆ‘ä»¬é¦–å…ˆä½¿ç”¨ Eureka æ¥å®ç°å‡ºä¸€ä¸ª <strong>æœåŠ¡ä¸­å¿ƒï¼ˆEureka Serverï¼‰</strong> é›†ç¾¤ï¼Œä¹‹åé€šè¿‡ Eureaka æ‰€ <strong>æä¾›çš„æœåŠ¡æ³¨å†Œï¼ˆService Registerï¼‰</strong> åŠŸèƒ½æ¥æ³¨å†Œ <strong>æœåŠ¡æä¾›è€…ï¼ˆService Providerï¼‰</strong>ï¼Œæ¥å®ç°æœåŠ¡æä¾›è€…é›†ç¾¤ã€‚</p>
<p>åœ¨æ­¤å<strong>æœåŠ¡æ¶ˆè´¹è€…ï¼ˆService Consumerï¼‰</strong> ä½¿ç”¨ Eureka æ‰€æä¾›çš„ <strong>æœåŠ¡æ³¨å†ŒåŠŸèƒ½æ ¹æ®æœåŠ¡æä¾›è€…ï¼ˆService Providerï¼‰</strong> æ‰€æ³¨å†Œçš„åç§°æ¥è°ƒç”¨å®¢æˆ·ç«¯ <strong>Feign</strong> æ¥æ¶ˆè´¹ <strong>æœåŠ¡æä¾›è€…æ‰€æä¾›çš„æ¥å£</strong>ã€‚</p>
<p>Eureka æ˜¯ Netflix å…¨å®¶æ¡¶å†…é¡¹ç›®ï¼Œä»–åœ¨æ¯•é©¬å¨åœ¨2019å¹´10æœˆæ‰€å‘å¸ƒçš„ ã€Šé¢ è¦†æ€§å…¬å¸å’Œå•†ä¸šæ¨¡å¼ã€‹æŠ¥å‘Šä¸­ä¸é˜¿é‡Œå·´å·´åˆ†åˆ«æ’åç¬¬ä¸‰ï¼Œè€Œ Netflix æ’åç¬¬å…­ä½ï¼Œç™¾åº¦ã€è…¾è®¯åˆ†åˆ«æ’ååä¸€å’ŒåäºŒä½ã€‚</p>
<p>è™½ç„¶ Netlix æ’åä¸å¦‚ Alibabaï¼Œä½†ä»–å¯¹ Spring cloud çš„è´¡çŒ®è¦æ—©äº Alibabaï¼Œå› æ­¤Netflix å…¬å¸æ‰€å¼€æºçš„å„ç§é¡¹ç›®æ‰€ç»„æˆå¾®æœåŠ¡çš„æ ¸å¿ƒä¹Ÿä¸è¶³ä¸ºå¥‡ã€‚</p>
<p>è¡¨ç°å±‚çŠ¶æ€è½¬æ¢ï¼ˆRepresentational State Transferï¼ŒRESTï¼‰ç”± Roy Thomas Fielding äº 2000å¹´åœ¨åšå£«è®ºæ–‡ä¸­æ‰€æå‡ºçš„WWWè½¯ä»¶æ¶æ„é£æ ¼ï¼Œç›®çš„æ˜¯æ”¾ç™¾å¹´åœ¨ä¸åŒè½¯ä»¶æˆ–ç¨‹åºåœ¨ç½‘ç»œä¸­ç›¸äº’ä¼ é€’ä¿¡æ¯ï¼Œè€Œ Eureka åˆ™æ˜¯è¿™äº›é¡¹ç›®å†…åŸºäº REST æœåŠ¡ï¼Œä¸»è¦åŒ…å«äº† <strong>æœåŠ¡æ³¨å†Œä¸æœåŠ¡å‘ç°åŠŸèƒ½</strong>ã€‚</p>
<h2 id="æ„å»º"><a href="#æ„å»º" class="headerlink" title="æ„å»º"></a>æ„å»º</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210526225911.png"></p>
<h3 id="Spring-Assistant"><a href="#Spring-Assistant" class="headerlink" title="Spring Assistant"></a>Spring Assistant</h3><blockquote>
<p> è¿™ä» IDEA 2018 å°±åœæ­¢æ›´æ–°äº†</p>
</blockquote>
<p>é€šè¿‡ Spring Assistant æ ¹æ®è‡ªèº«ç¯å¢ƒè¿›è¡Œé€‰æ‹©ï¼Œå½“è¿›å…¥é€‰æ‹©ç‰ˆæœ¬å’Œä¾èµ–æ—¶ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹© <strong>Spring Cloud Discover -&gt; Eureka Server</strong>ã€‚</p>
<h3 id="Spring-Initializr"><a href="#Spring-Initializr" class="headerlink" title="Spring Initializr"></a>Spring Initializr</h3><p>æˆ–è€…è¯´æˆ‘ä»¬ç›´æ¥é€šè¿‡ IDEA è‡ªå¸¦çš„ <strong>Spring Initializr</strong>ï¼Œä¹‹åé€‰æ‹© <strong>Spring Cloud Discovery -&gt; Eureka Server</strong>ã€‚å½“æˆ‘ä»¬æ„å»ºå®Œæˆåï¼Œè‚¯å¯¹ä¼šå‡ºç°ä¸€å¤§å † maven é¡¹ç›®ä¾èµ–çš„é—®é¢˜ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨ <strong>Setting -&gt; Build, Execution, Deployment -&gt; Build Tools -&gt; Maven</strong> ä¸‹ä¿®æ”¹ <strong>User settings file</strong> æ‰€å¡«å†™çš„ <code>settings.xml</code> æ–‡ä»¶ï¼Œå¹¶å†™å…¥ä¸‹è¿°ä¿¡æ¯ï¼Œæ¥è®¾ç½® Alibaba é•œåƒï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>uk<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>Human Readable Name for this Mirror.<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://uk.maven.org/maven2/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>CN<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>OSChina Central<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.oschina.net/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>internal nexus repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://repo.maven.apache.org/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="æœåŠ¡ä¸­å¿ƒ"><a href="#æœåŠ¡ä¸­å¿ƒ" class="headerlink" title="æœåŠ¡ä¸­å¿ƒ"></a>æœåŠ¡ä¸­å¿ƒ</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210527035316.png"><br>æˆ‘ä»¬æ‰€å®ç°çš„æ˜¯ <strong>æœåŠ¡ä¸­å¿ƒé›†ç¾¤</strong>ï¼Œå’Œæ™®é€šçš„å•ç‚¹æœåŠ¡ä¸­å¿ƒä¸ä¸€æ ·çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¿éšœåœ¨ç³»ç»Ÿå´©æºƒæ—¶ï¼Œå¯ä»¥ç»´æŒç³»ç»Ÿçš„ <strong>æ›´é«˜çš„å¯ç”¨æ€§</strong>ï¼Œæ‰€ä»¥ä½¿ç”¨æœåŠ¡ä¸­å¿ƒé›†ç¾¤ï¼ˆè™½ç„¶æ˜¯æœåŠ¡ä¸­å¿ƒé›†ç¾¤ï¼Œä½†ä¾ç„¶å¯ä»¥é€šè¿‡æœ¬æ–‡æ¥å®ç°å•ç‚¹æœåŠ¡ä¸­å¿ƒï¼‰ã€‚</p>
<h3 id="Eureka-Server-demo"><a href="#Eureka-Server-demo" class="headerlink" title="Eureka Server demo"></a>Eureka Server demo</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªæ ‡å‡†çš„ Eureka æ¨¡æ¿æ¥è¿›è¡Œå‚è€ƒï¼Œå¹¶é€šè¿‡ä¸‹è¿°æ¨¡æ¿æ¥è¿›è¡Œä¿®æ”¹æ¥å®ç°å‡ºæˆ‘ä»¬çš„ <strong>æœåŠ¡ä¸­å¿ƒé›†ç¾¤</strong> ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸‹è¿°codeä¸éœ€è¦æ‰§è¡Œï¼ˆå› ä¸ºä½ å°±ç®—æ‰§è¡Œäº†å®ç°çš„ä¹Ÿæ˜¯å•ç‚¹æœåŠ¡ä¸­å¿ƒï¼‰ï¼š</p>
<h4 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h4><blockquote>
<p>src&#x2F;main&#x2F;resources&#x2F;application.properties</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># åº”ç”¨åç§°</span><br><span class="line">spring.application.name=Discovery Server</span><br><span class="line"></span><br><span class="line"># Spring åº”ç”¨ç«¯å£</span><br><span class="line">server.port=8000</span><br><span class="line"></span><br><span class="line"># èŠ‚ç‚¹åç§°</span><br><span class="line">eureka.instance.hostname=eureka-server.com</span><br><span class="line"></span><br><span class="line"># æ˜¯å¦æ³¨å†Œåˆ° Eureka Server (é»˜è®¤ trueï¼‰</span><br><span class="line">eureka.client.register-with-eureka=false</span><br><span class="line"></span><br><span class="line"># æ˜¯å¦æ³¨å†Œåˆ° Eureka Server è·å–æ³¨å†Œä¿¡æ¯ ï¼ˆé»˜è®¤ trueï¼‰</span><br><span class="line">eureka.client.fetch-registry=false</span><br><span class="line"></span><br><span class="line"># è®¾ç½® Eureka Server äº¤äº’åœ°å€ï¼ŒæŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡è¿›è¡Œä½¿ç”¨ï¼ˆå¤šä¸ªä»¥ â€œ,â€ åˆ†å‰²ï¼‰</span><br><span class="line">eureka.client.serviceUrl.defaultZone=http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br></pre></td></tr></table></figure>

<h4 id="DemoApplication"><a href="#DemoApplication" class="headerlink" title="DemoApplication"></a>DemoApplication</h4><blockquote>
<p>src&#x2F;main&#x2F;java&#x2F;com&#x2F;example&#x2F;demo&#x2F;DemoApplication.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@EnableEurekaServer</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="hosts"><a href="#hosts" class="headerlink" title="hosts"></a>hosts</h4><p>ä¸ºäº†è®©æ•ˆæœæ›´åŠ çš„æ¥è¿‘çœŸå®ç¯å¢ƒä¸‹å¤šå°æœåŠ¡å™¨å†…åº”ç”¨ååŒæœåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ å‡ ä¸ª <strong>è™šæ‹Ÿåœ°å€ï¼ˆDNSï¼‰</strong> æ¥åˆ›å»ºä¸€ä¸ªåªæœ‰æœ¬åœ°å¯ä»¥è®¿é—®çš„ URLï¼Œæ¥è¿›è¡Œæ¼”ç¤ºã€‚</p>
<p>åœ¨ Windows ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ <code>C:\Windows\System32\drivers\etc\hosts</code> æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1      abc.com</span><br></pre></td></tr></table></figure>

<p>è€Œæœ¬æ–‡ä½œè€…ä½¿ç”¨çš„æ˜¯ debian ç¯å¢ƒï¼Œå³ Linux ç³»ç»Ÿä¸‹åˆ™éœ€è¦ç®€å•çš„ä¿®æ”¹ <code>/etc/hosts</code> æ–‡ä»¶å³å¯ï¼Œå¹¶æ·»åŠ ï¼š</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1	eureka-server.com</span><br><span class="line">127.0.0.1	eureka-server-1.com</span><br><span class="line">127.0.0.1	eureka-server-2.com</span><br><span class="line">127.0.0.1   eureka-server-3.com</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†éªŒè¯å…¶æ˜¯å¦ç”Ÿæ•ˆï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ <code>ping xxx.com</code> è¿›è¡ŒæŸ¥çœ‹ã€‚</p>
<h4 id="Jar-Run"><a href="#Jar-Run" class="headerlink" title="Jar Run"></a>Jar Run</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210527035329.png"></p>
<p>ä¹‹åæˆ‘ä»¬åˆ†åˆ«åœ¨ <strong>eureka-server-1ã€eureka-server-2ã€eureka-server-3</strong> é¡¹ç›®ä¸‹æŒ‰ç…§æµç¨‹ç‚¹å‡» maven ä¾§æ ä¸‹çš„ <code>cleanã€package</code>ç­‰å‘½ä»¤ï¼Œä»¥æ­¤æ¥ä»£æ›¿ mvn æ‰§è¡Œ <code>mvn clean | mvn package</code>å‘½ä»¤ã€‚</p>
<p>å½“çš„åŒ…é¡¹ç›®ä¸º jar åï¼Œåˆ†åˆ«è¿›å…¥ <strong>eureka-server-1ã€2ã€3</strong> å†…è¯¥ jar åŒ…æ‰€åœ¨ä½ç½®ï¼Œå¹¶æŒ‡å®šæ ¹æ®ä¹‹å‰æ‰€åœ¨ hosts æ–‡ä»¶ä¸‹è®¾ç½®çš„DNSåç§°è¿è¡Œé¡¹ç›®ï¼ˆæœ‰å¤šå°‘æœåŠ¡é›†ç¾¤æå¤šå°‘ä¸ªï¼‰ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar demo-0.0.1-SNAPSHOT.jar --spring.profiles.active=eureka-server.com</span><br></pre></td></tr></table></figure>

<p>ä¹‹åè¿›å…¥åˆ°<code>http://eureka-server.com:8000/</code> å³å¯è®¿é—® Eureka æ‰€æä¾›çš„ä¿¡æ¯é¢æ¿ä¸­ã€‚</p>
<h3 id="eureka-server-1"><a href="#eureka-server-1" class="headerlink" title="eureka-server-1"></a>eureka-server-1</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210527035343.png"></p>
<blockquote>
<p>å¦‚æœä½ ç†è§£ä¸Šè¿°çš„ Eureka Server demo çš„é…ç½®å¹¶ç»“åˆä¸‹è¿° eureka-server-1~3 æ‰€éƒ¨ç½²çš„æœåŠ¡ä¸­å¿ƒé›†ç¾¤åœ¨ Eureka æ§åˆ¶é¢æ¿å’Œä¸Šå›¾åŸºæœ¬ç›¸ä¼¼ã€‚</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº”ç”¨åç§°</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">server-clustered</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Spring åº”ç”¨ç«¯å£</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8001</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°</span></span><br><span class="line"><span class="attr">eureka.instance.hostname</span>=<span class="string">eureka-server-1.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æ˜¯å¦æ³¨å†Œåˆ° Eureka Server (é»˜è®¤ trueï¼‰</span></span><br><span class="line"><span class="attr">eureka.client.register-with-eureka</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æ˜¯å¦æ³¨å†Œåˆ° Eureka Server è·å–æ³¨å†Œä¿¡æ¯ ï¼ˆé»˜è®¤ trueï¼‰</span></span><br><span class="line"><span class="attr">eureka.client.fetch-registry</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># è®¾ç½® Eureka Server äº¤äº’åœ°å€ï¼ŒæŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡è¿›è¡Œä½¿ç”¨ï¼ˆå¤šä¸ªä»¥ â€œ,â€ åˆ†å‰²ï¼‰</span></span><br><span class="line"><span class="attr">eureka.client.serviceUrl.defaultZone</span>=<span class="string">http://eureka-server-2.com:8002/eureka/,http://eureka-server-3.com:8003/eureka/</span></span><br></pre></td></tr></table></figure>

<h3 id="eureka-server-2"><a href="#eureka-server-2" class="headerlink" title="eureka-server-2"></a>eureka-server-2</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº”ç”¨åç§°</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">server-clustered</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Spring åº”ç”¨ç«¯å£</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8002</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°</span></span><br><span class="line"><span class="attr">eureka.instance.hostname</span>=<span class="string">eureka-server-2.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æ˜¯å¦æ³¨å†Œåˆ° Eureka Server (é»˜è®¤ trueï¼‰</span></span><br><span class="line"><span class="attr">eureka.client.register-with-eureka</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æ˜¯å¦æ³¨å†Œåˆ° Eureka Server è·å–æ³¨å†Œä¿¡æ¯ ï¼ˆé»˜è®¤ trueï¼‰</span></span><br><span class="line"><span class="attr">eureka.client.fetch-registry</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># è®¾ç½® Eureka Server äº¤äº’åœ°å€ï¼ŒæŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡è¿›è¡Œä½¿ç”¨ï¼ˆå¤šä¸ªä»¥ â€œ,â€ åˆ†å‰²ï¼‰</span></span><br><span class="line"><span class="attr">eureka.client.serviceUrl.defaultZone</span>=<span class="string">http://eureka-server-1.com:8001/eureka/,http://eureka-server-3.com:8003/eureka/</span></span><br></pre></td></tr></table></figure>

<h3 id="eureka-server-3"><a href="#eureka-server-3" class="headerlink" title="eureka-server-3"></a>eureka-server-3</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åº”ç”¨åç§°</span></span><br><span class="line"><span class="attr">spring.application.name</span>=<span class="string">server-clustered</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># Spring åº”ç”¨ç«¯å£</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8003</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># èŠ‚ç‚¹åç§°</span></span><br><span class="line"><span class="attr">eureka.instance.hostname</span>=<span class="string">eureka-server-3.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æ˜¯å¦æ³¨å†Œåˆ° Eureka Server (é»˜è®¤ trueï¼‰</span></span><br><span class="line"><span class="attr">eureka.client.register-with-eureka</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># æ˜¯å¦æ³¨å†Œåˆ° Eureka Server è·å–æ³¨å†Œä¿¡æ¯ ï¼ˆé»˜è®¤ trueï¼‰</span></span><br><span class="line"><span class="attr">eureka.client.fetch-registry</span>=<span class="string">true</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"># è®¾ç½® Eureka Server äº¤äº’åœ°å€ï¼ŒæŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡è¿›è¡Œä½¿ç”¨ï¼ˆå¤šä¸ªä»¥ â€œ,â€ åˆ†å‰²ï¼‰</span></span><br><span class="line"><span class="attr">eureka.client.serviceUrl.defaultZone</span>=<span class="string">http://eureka-server-1.com:8001/eureka/,http://eureka-server-2.com:8002/eureka/</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="æœåŠ¡æä¾›è€…"><a href="#æœåŠ¡æä¾›è€…" class="headerlink" title="æœåŠ¡æä¾›è€…"></a>æœåŠ¡æä¾›è€…</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210528034643.png"><br>æœåŠ¡æä¾›è€…ï¼ˆService providerï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæ˜¯é€šè¿‡æœåŠ¡ä¸­å¿ƒè¿›è¡Œæ³¨å†Œï¼Œä¹‹åä¸º <strong>æœåŠ¡æ¶ˆè´¹è€…</strong> æ¥æä¾›æœåŠ¡çš„ã€‚æˆ‘ä»¬å¯ä»¥ä»æœåŠ¡ä¸­å¿ƒï¼Œæ¥æ§åˆ¶ã€ç®¡ç†æ•´ä¸ªå¾®æœåŠ¡çš„è¿è¡Œã€è¿æ¥çŠ¶æ€ç­‰ã€‚</p>
<h3 id="Eureka-Provide-demo"><a href="#Eureka-Provide-demo" class="headerlink" title="Eureka Provide demo"></a>Eureka Provide demo</h3><h4 id="DemoApplication-1"><a href="#DemoApplication-1" class="headerlink" title="DemoApplication"></a>DemoApplication</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.netflix.eureka.EnableEurekaClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableEurekaClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬é€šè¿‡æ ¹æ®ä¹‹å‰ä¸€æ ·çš„é¡¹ç›®ä¾èµ–ï¼Œé€‰æ‹© Eureka Server å³å¯ï¼Œè¿›å…¥é¡¹ç›®ååœ¨å¯åŠ¨ç±»ä¸­åŠ å…¥ <code>@EnableEurekaClient</code> æ³¨è§£ï¼Œæ¥å¯ç”¨å…¶ Eureka æ³¨å†Œå’Œå‘ç°åŠŸèƒ½ã€‚</p>
<h4 id="application-properties-1"><a href="#application-properties-1" class="headerlink" title="application.properties"></a>application.properties</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">server-provide</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8000</span></span><br><span class="line"><span class="attr">provider.name</span>=<span class="string">provider0</span></span><br><span class="line"><span class="attr">eureka.client.serviceUrl.defaultZone</span>=<span class="string">http://eureka-server-3.com:8003/eureka/,http://eureka-server-2.com:8002/eureka/,http://eureka-server-1.com:8001/eureka/</span></span><br></pre></td></tr></table></figure>

<p>ä¹‹åæˆ‘ä»¬æ¥è®¾ç½®åç§°ä»¥åŠæ§åˆ¶å™¨éœ€è¦è·å–åˆ°çš„ä¿¡æ¯è¿›è¡Œé…ç½®ï¼Œä¹‹åé€šè¿‡ <code>eureka.client.serviceUrl.defaultZone</code>æ¥åŠ å…¥æœåŠ¡ä¸­å¿ƒã€‚</p>
<h4 id="HelloController"><a href="#HelloController" class="headerlink" title="HelloController"></a>HelloController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;provider.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String port;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/home&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> <span class="string">&quot;provider:&quot;</span> + name + <span class="string">&quot;port:&quot;</span> + port;</span><br><span class="line">        <span class="keyword">return</span> string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ§åˆ¶å™¨çš„ä¸»è¦ç”¨é€”æ˜¯æ¥æä¾›æ¥å£è®© <strong>æœåŠ¡æ¶ˆè´¹è€…</strong> è¿›è¡Œè·å–çš„ï¼Œé€šè¿‡<code>application.properties</code>é…ç½®æ–‡ä»¶å†…ç›¸åº”å†…å®¹å¹¶æ ¹æ®å…¶<code>@Vlue</code>æ³¨è§£ä»¥åŠ <code>@RestController</code>å¤„ç†HTTPè¯·æ±‚ï¼Œå¦‚æœä½ ä¸è§‰å¾—éº»çƒ¦å¯ä»¥ç”¨ä¸‹è¿°ä¸¤ä¸ªæ³¨è§£ä»£æ›¿ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br></pre></td></tr></table></figure>

<h4 id="Actuator-info"><a href="#Actuator-info" class="headerlink" title="Actuator info"></a>Actuator info</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210528033455.png"><br>Eureka åœ¨å…¶ä¿¡æ¯é¢æ¿ä¸­ Instances currently registered with Eureka ï¼ˆç›®å‰åœ¨Eureka æ³¨å†Œçš„å®ä¾‹ï¼‰ä¸€è§ˆä¸­çš„ Statusï¼ˆçŠ¶æ€ï¼‰ä¸‹ã€‚ä¸ºå¼€å‘è€…æä¾›äº†ä¸€ä¸ªä¾¿æ·æŸ¥è¯¢çš„å…¥å£ï¼Œå³ <code>UP (1) - 192.168.43.65:server-provide:8000</code> &#x3D;&gt; <a target="_blank" rel="noopener" href="http://192.168.43.65:8000/actuator/info">http://192.168.43.65:8000/actuator/info</a> è¿™æ˜¯æœåŠ¡æä¾›è€…çš„å½“å‰åœ¨æœåŠ¡ä¸­å¿ƒçš„é“¾æ¥çŠ¶æ€ã€‚</p>
<p>å½“æˆ‘ä»¬ç‚¹å‡»è·³è½¬æ—¶ï¼Œæ˜¯å¯ä»¥æ ¹æ®å…¶ <code>pom.xml</code> ä»¥åŠ <code>application.properties</code> æ–‡ä»¶å†…çš„é…ç½®ä¿¡æ¯å•ç‹¬å†™å…¥å…¶ JSON æ•°æ®çš„ï¼Œè™½ç„¶ Eureka é»˜è®¤çš„ä¸º <code>&#123;&#125;</code>ã€‚</p>
<p>ä¿®æ”¹æ·»åŠ åç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;app&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eureka-cloud-8000&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;company&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;jiangxue.org.cn&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;application&quot;</span><span class="punctuation">:</span> <span class="string">&quot;server-provide&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8000&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬éœ€è¦ä¿®æ”¹å…¶ <strong>application.properties</strong> å³ Spring çš„å…¨å±€é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">server-provide</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8000</span></span><br><span class="line"><span class="attr">provider.name</span>=<span class="string">localhost</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info.app.name</span>=<span class="string">eureka-cloud-8000</span></span><br><span class="line"><span class="attr">info.company.name</span>=<span class="string">jiangxue.org.cn</span></span><br><span class="line"><span class="attr">info.build.application</span>=<span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line"><span class="attr">info.build.port</span>=<span class="string">$&#123;server.port&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka.client.serviceUrl.defaultZone</span>=<span class="string">http://eureka-server-3.com:8003/eureka/</span></span><br></pre></td></tr></table></figure>

<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210528033534.png"><br>ä¹‹åæˆ‘ä»¬è¿˜éœ€è¦ä¿®æ”¹ <strong>pom.xml</strong> é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œåœ¨ <code>&lt;build&gt;&lt;/build&gt;</code>å…ƒç´ ä¸­çš„ <code>&lt;plugins&gt;</code> ä¸Šæ–¹ï¼ŒåŠ å…¥ <code>&lt;finalName&gt;</code>ä¿¡æ¯ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">finalName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¹‹åæˆ‘ä»¬å¯ä»¥é€‰æ‹©ç›´æ¥åœ¨ IDEA é‡Œé¢è¿è¡Œæˆ–é€šè¿‡ jar åŒ…æ–¹å¼è¿è¡Œï¼ˆ<strong>è™½ç„¶æ˜¯æœ¬åœ°ç¯å¢ƒä½†è¿˜æ˜¯è¦æ•´å‡ºå‡ åå°æœåŠ¡å™¨ååŒçš„æ•ˆæœ</strong>ï¼‰</p>
</blockquote>
<h4 id="Jar-run"><a href="#Jar-run" class="headerlink" title="Jar run"></a>Jar run</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210528033544.png"><br>å½“å…¨éƒ¨è¿è¡Œå®Œä¹‹åï¼Œæˆ‘ä»¬å°†ä¼šæœ‰ä¸‰å°æœåŠ¡ä¸­å¿ƒé›†ç¾¤ï¼Œä»¥åŠä¸¤å°æœåŠ¡æä¾›é›†ç¾¤ï¼Œé€šè¿‡è®¿é—®æˆ‘ä»¬æœåŠ¡æä¾›é›†ç¾¤çš„æ§åˆ¶å™¨å³ <a target="_blank" rel="noopener" href="http://192.168.43.65:8010/hey">http://192.168.43.65:8010/hey</a> éƒ½å¯ä»¥æ­£ç¡®è®¿é—®æ§åˆ¶å™¨å†…å®¹æ—¶ï¼Œå³å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡ã€‚</p>
<h3 id="eureka-provide-1"><a href="#eureka-provide-1" class="headerlink" title="eureka-provide-1"></a>eureka-provide-1</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">server-provide</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8010</span></span><br><span class="line"><span class="attr">provider.name</span>=<span class="string">localhost</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info.app.name</span>=<span class="string">eureka-cloud-$&#123;server.port&#125;</span></span><br><span class="line"><span class="attr">info.company.name</span>=<span class="string">jiangxue.org.cn</span></span><br><span class="line"><span class="attr">info.build.application</span>=<span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line"><span class="attr">info.build.port</span>=<span class="string">$&#123;server.port&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka.client.serviceUrl.defaultZone</span>=<span class="string">http://eureka-server-3.com:8003/eureka/,http://eureka-server-2.com:8002/eureka/,http://eureka-server-1.com:8001/eureka/</span></span><br></pre></td></tr></table></figure>

<h3 id="eureka-provide-2"><a href="#eureka-provide-2" class="headerlink" title="eureka-provide-2"></a>eureka-provide-2</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">server-provide</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8011</span></span><br><span class="line"><span class="attr">provider.name</span>=<span class="string">localhost</span></span><br><span class="line"></span><br><span class="line"><span class="attr">info.app.name</span>=<span class="string">eureka-cloud-$&#123;server.port&#125;</span></span><br><span class="line"><span class="attr">info.company.name</span>=<span class="string">jiangxue.org.cn</span></span><br><span class="line"><span class="attr">info.build.application</span>=<span class="string">$&#123;spring.application.name&#125;</span></span><br><span class="line"><span class="attr">info.build.port</span>=<span class="string">$&#123;server.port&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">eureka.client.serviceUrl.defaultZone</span>=<span class="string">http://eureka-server-3.com:8003/eureka/,http://eureka-server-2.com:8002/eureka/,http://eureka-server-1.com:8001/eureka/</span></span><br></pre></td></tr></table></figure>

<h2 id="æœåŠ¡æ¶ˆè´¹è€…"><a href="#æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="æœåŠ¡æ¶ˆè´¹è€…"></a>æœåŠ¡æ¶ˆè´¹è€…</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210528095543.png"></p>
<p>æœåŠ¡æ¶ˆè´¹è€…ä¸»è¦é€šè¿‡ä½¿ç”¨ <strong>Feign</strong> æ¥è¿›è¡Œå®ç°ï¼ŒFeign ç”± Retrofitã€JAXRS-2.0 å’Œ WebSocet æ‰€å¯å‘ï¼Œä¸»è¦ç”¨äº Java åˆ° HTPP å®¢æˆ·ç«¯ç»‘å®šå™¨ã€‚å› æ­¤æˆ‘ä»¬å°†ä¼šé€šè¿‡å¼•å…¥ Feign ä¾èµ–æ¥å®ç°æœåŠ¡æ¶ˆè´¹è€…ã€‚</p>
<p>åœ¨æ–°å»ºé¡¹ç›®æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ï¼Œéœ€è¦åœ¨ <strong>é€‰æ‹©ä¾å­˜å…³ç³»å†…é€‰æ‹©</strong> Spring Webã€Eureka Discovery Clientã€‚å½“ç„¶ä¹‹å‰çš„æœåŠ¡æä¾›è€…ä¹Ÿå¯ä»¥è¿™æ ·é€‰æ‹©ï¼Œä½†ä¸ºäº†æ›´åŠ æ–¹ä¾¿æˆ‘ä»¬é€šè¿‡é€‰æ‹© <strong>Eureka Server</strong> å•ä¸ªä¾å­˜å…³ç³»ä¹Ÿå¯ä»¥å®ç°ã€‚</p>
<h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210528093919.png"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ·»åŠ  spring-cloud-starter-openfeign maven ä¾èµ–åå¯èƒ½ä¼šæŠ¥é”™ï¼Œæ­¤æ—¶æˆ‘ä»¬åªéœ€è¦é€šè¿‡ç‚¹å‡» Reload ALL Maven Projects æŒ‰é’®æ¥ <strong>é‡æ–°åŠ è½½æ‰€æœ‰ Maven é¡¹ç›®</strong>ã€‚</p>
<h3 id="application-properties-2"><a href="#application-properties-2" class="headerlink" title="application.properties"></a>application.properties</h3><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.application.name</span>=<span class="string">service-consumer</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">9000</span></span><br><span class="line"><span class="attr">eureka.client.register-with-eureka</span>=<span class="string">false</span></span><br><span class="line"><span class="attr">eureka.client.serviceUrl.defaultZone</span>=<span class="string">http://eureka-server-3.com:8003/eureka/,http://eureka-server-2.com:8002/eureka/,http://eureka-server-1.com:8001/eureka/</span></span><br></pre></td></tr></table></figure>

<h3 id="DemoApplication-2"><a href="#DemoApplication-2" class="headerlink" title="DemoApplication"></a>DemoApplication</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.EnableFeignClients;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="meta">@EnableFeignClients</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(DemoApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä½¿ç”¨ <code>@EnableDiscoveryClients</code>æ¥å¯åŠ¨å®¢æˆ·ç«¯çš„æœåŠ¡æ³¨å†Œå’Œå‘ç°åŠŸèƒ½ï¼Œå¹¶ä»¥ <code>@enableFeignClients</code> æ³¨è§£æ¥å®ç°è¿œç¨‹æœåŠ¡è°ƒç”¨ã€‚</p>
<h3 id="MyFeignClient-interface"><a href="#MyFeignClient-interface" class="headerlink" title="MyFeignClient interface"></a>MyFeignClient interface</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.openfeign.FeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;server-provide&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyFeignClient</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨æ­¤å¤„çš„æ–¹æ³•å¿…é¡»ä¸æœåŠ¡æä¾›è€…ï¼ˆå³æœåŠ¡æä¾›è€… Controllerï¼‰çš„æ–¹æ³•ä¸€è‡´</p>
</blockquote>
<p>ä¹‹åæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå¹¶ä½¿ç”¨ <code>@FeignClient</code> æ³¨è§£æ¥é€šè¿‡ <strong>name</strong> å€¼åœ¨æœåŠ¡ä¸­å¿ƒè¿›è¡Œå¯»æ‰¾å¹¶è¿æ¥ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬çš„æœåŠ¡æä¾›è€…é›†ç¾¤åœ¨æœåŠ¡ä¸­å¿ƒæ‰€æ³¨å†Œçš„åç§°æ˜¯ <strong>server-provide</strong>ã€‚</p>
<h3 id="ConsumerController"><a href="#ConsumerController" class="headerlink" title="ConsumerController"></a>ConsumerController</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.MyFeignClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsumerController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MyFeignClient myFeignClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> myFeignClient.hello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210528094005.gif"><br>æœ€ç»ˆæˆ‘ä»¬å°†æœåŠ¡ä¸­å¿ƒé›†ç¾¤ã€æœåŠ¡æä¾›è€…é›†ç¾¤å¼€èµ·æ¥ï¼Œä»¥åŠåœ¨ IDEA ä¸­å¯åŠ¨æœåŠ¡æ¶ˆè´¹è€…ã€‚ä¹‹åé€šè¿‡è®¿é—® <a target="_blank" rel="noopener" href="http://localhost:9000/hey">http://localhost:9000/hey</a> åˆ·æ–°ä¸¤æ¬¡çœ‹çœ‹ã€‚</p>
<p>å¦‚æœç«¯å£å€¼ä» <strong>8010ï½8011</strong> ä¹‹é—´ä¸æ–­è°ƒæ¢ã€‚é‚£ä¹ˆæˆ‘ä»¬é€šè¿‡ Eureka æ¥è¿›è¡ŒæœåŠ¡æ²»ç†æ‰€å®ç°çš„å¾®æœåŠ¡æ¶æ„å®Œæˆã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/java/spring cloud/2.Spring cloud æ¦‚è¿°/">Spring cloud æ¦‚è¿°</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/java/" rel="tag">java</a> <a class="article__tag-none-link" href="/tags/spring-cloud/" rel="tag">spring cloud</a>
			</span>
		
	</div>

	

	
		<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210525030152.png"></p>
<p>Spring cloud æ˜¯ä¸€ä¸ªåŸºäº Spring boot çš„ä¸€ä¸ªå¿«é€Ÿå¼€å‘çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œæœ‰ä¸€å¥è¯æ˜¯ <strong>å°é¡¹ç›®ç”¨ spring bootï¼Œå¤§é¡¹ç›®ç”¨ spring cloud</strong>ï¼Œä»–ä¸»è¦ä¹ä¸ªéå¸¸é‡è¦ä¸”æ˜¾è‘—çš„ç‰¹å¾ã€‚</p>
<h2 id="REST"><a href="#REST" class="headerlink" title="REST"></a>REST</h2><p>åœ¨ä»‹ç»Spring cloud å„ç±»ç‰¹æ€§å’Œä¸»è¦é¡¹ç›®ä»¥åŠå¼€æºç”Ÿæ€ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£è¡¨ç°å±‚çŠ¶æ€è½¬æ¢ï¼ˆRESTï¼ŒRepresentational State Transferï¼‰ï¼Œç”± Roy T. Fieldingåšå£«äº 2000å¹´åœ¨åšå£«è®ºæ–‡ä¸­æå‡ºã€‚å…¶æä¾›å‡ºæ¥çš„ä¸»è¦æ˜¯ä¸€ç§äº’è”ç½‘è½¯ä»¶ <strong>è®¾è®¡é£æ ¼</strong>ï¼Œç›®çš„æ˜¯æ–¹ä¾¿è½¯ä»¶æˆ–ç¨‹åºåœ¨äº’è”ç½‘ä¸­äº’ç›¸ä¼ é€’ä¿¡æ¯ã€‚</p>
<p>åœ¨ Roy çš„åšå£«è®ºæ–‡ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶æ¸…æ¥šçš„å®šä¹‰äº†ä¸‹åˆ—å…­ç§çŸ¥é“åŸåˆ™ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å°†æ»¡è¶³ REST å…­ç§æŒ‡å¯¼åŸåˆ™çš„é£æ ¼ç§°ä¹‹ä¸º RESTfulï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯-æœåŠ¡å™¨ï¼ˆClient-Serverï¼‰</li>
<li>æ— çŠ¶æ€ï¼ˆStatelessï¼‰</li>
<li>ç¼“å­˜ (Cache)</li>
<li>ç»Ÿä¸€æ¥å£ï¼ˆUniform Interfaceï¼‰</li>
<li>åˆ†å±‚ç³»ç»Ÿï¼ˆLayered Systemï¼‰</li>
<li>æŒ‰éœ€ç¼–ç ï¼ˆCode On Demandï¼‰</li>
</ol>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm">https://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm</a></p>
</blockquote>
<p>åœ¨è¿™ä¹‹åæ ¹æ®è¿™ç¯‡è®ºæ–‡è¿›è¡Œäº†è¯¦ç»†å’Œç³»ç»Ÿçš„å®Œå–„ï¼Œä½¿å¾—æ›´åŠ å…·æœ‰äº†å¯è¯»æ€§ï¼š<a target="_blank" rel="noopener" href="https://restfulapi.net/">https://restfulapi.net/</a></p>
<h3 id="å®¢æˆ·ç«¯-æœåŠ¡å™¨ï¼ˆClient-Serverï¼‰"><a href="#å®¢æˆ·ç«¯-æœåŠ¡å™¨ï¼ˆClient-Serverï¼‰" class="headerlink" title="å®¢æˆ·ç«¯-æœåŠ¡å™¨ï¼ˆClient-Serverï¼‰"></a>å®¢æˆ·ç«¯-æœåŠ¡å™¨ï¼ˆClient-Serverï¼‰</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210608033023.png"><br>åœ¨RESTä¸­ï¼Œè¢«ç¬¬ä¸€ä¸ªæ·»åŠ çš„åˆ™æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„æ¶æ„é£æ ¼çº¦æŸï¼Œè€Œä»–çš„å…³æ³¨ç‚¹æ˜¯å®¢æˆ·ç«¯-æœåŠ¡å™¨çº¦æŸèƒŒåçš„åŸåˆ™ã€‚<strong>é€šè¿‡å°†ç”¨æˆ·ç•Œé¢ä¸å­˜æ•°æ®å­˜å‚¨é—®é¢˜è¿›è¡Œåˆ†å¼€ï¼Œ è¿™æé«˜äº†ç”¨æˆ·ç•Œé¢è·¨å¹³å°çš„ç§»æ¤æ€§ä»¥åŠç®€åŒ–äº†æœåŠ¡å™¨ç»„å»ºï¼Œæé«˜äº†æ‰©å±•æ€§ã€‚</strong></p>
<h3 id="æ— çŠ¶æ€ï¼ˆStatelessï¼‰"><a href="#æ— çŠ¶æ€ï¼ˆStatelessï¼‰" class="headerlink" title="æ— çŠ¶æ€ï¼ˆStatelessï¼‰"></a>æ— çŠ¶æ€ï¼ˆStatelessï¼‰</h3><p>æ ¹æ®å®¢æˆ·ç«¯å’Œ-æœåŠ¡å™¨é€šä¿¡ä¸­ï¼Œæˆ‘ä»¬å‡è®¾é€šä¿¡æœ¬è´¨æ˜¯æ— çŠ¶æ€ï¼ˆStatelessï¼‰çš„ï¼Œå³å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ¯ä¸ªè¯·æ±‚éƒ½ä¸ä¼šå­˜å‚¨ä¸Šä¸‹æ–‡ï¼ˆä¼šè¯å®Œå…¨ä¿ç•™åœ¨å®¢æˆ·æœºä¸Šï¼‰ã€‚</p>
<p>è€Œè¿™äº›çº¦æŸæ”¹å–„äº† å¯è§æ€§ã€å¯é æ€§ã€å¯æ‰©å±•æ€§ç­‰ï¼Œå…¶ä¸­æœ€ä¸ºæ˜æ˜¾çš„åˆ™æ˜¯å¯æ‰©å±•æ€§ã€‚</p>
<blockquote>
<p>This constraint induces the properties of visibility, reliability, and scalability. Visibility is improved because a monitoring system does not have to look beyond a single request datum in order to determine the full nature of the request. Reliability is improved because it eases the task of recovering from partial failures. Scalability is improved because not having to store state between requests allows the server component to quickly free resources, and further simplifies implementation because the server doesnâ€™t have to manage resource usage across requests.</p>
</blockquote>
<p>ä»–çš„ç¼ºç‚¹æ˜¯å¯èƒ½ä¼šå¢åŠ ä¸€ç³»åˆ—è¯·æ±‚ä¸­å‘é€çš„é‡å¤æ•°æ®ï¼Œä»è€Œé™ä½ç½‘ç»œæ€§èƒ½ç­‰æ–¹é¢ã€‚</p>
<h3 id="ç¼“å­˜-Cache"><a href="#ç¼“å­˜-Cache" class="headerlink" title="ç¼“å­˜ (Cache)"></a>ç¼“å­˜ (Cache)</h3><p>ç¼“å­˜å­˜åœ¨çš„æ„ä¹‰åˆ™æ˜¯åœ¨ REST ä¸­æé«˜ç½‘ç»œæ•ˆç‡ï¼Œç¼“å­˜ä¸»è¦è¢«çº¦æŸä¸ºè¯·æ±‚çš„å“åº”ä¸­å†…çš„æ•°æ®éšå¼ï¼ˆæˆ–æ˜¾ç¤ºï¼‰æ ‡è®°ä¸º <strong>å¯ç¼“å­˜æˆ–ä¸å¯ç¼“å­˜</strong>ã€‚</p>
<p>å¦‚æœæ˜¯å¯ç¼“å­˜çš„ï¼Œåˆ™åœ¨å®¢æˆ·ç«¯ç¼“å­˜æœ‰æƒä¸ºä»¥ååŒæ ·æ•ˆæœçš„è¯·æ±‚é‡æ–°åº”ç”¨è¯¥å“åº”æ•°æ®ã€‚</p>
<h3 id="ç»Ÿä¸€æ¥å£ï¼ˆUniform-Interfaceï¼‰"><a href="#ç»Ÿä¸€æ¥å£ï¼ˆUniform-Interfaceï¼‰" class="headerlink" title="ç»Ÿä¸€æ¥å£ï¼ˆUniform Interfaceï¼‰"></a>ç»Ÿä¸€æ¥å£ï¼ˆUniform Interfaceï¼‰</h3><p>åœ¨ REST æ¶æ„é£æ ¼ä¸­ä¸å…¶ä»–ç±»ä¼¼æ¶æ„é£æ ¼æœ‰æ˜æ˜¾åŒºåˆ†çš„å°±æ˜¯ç»„ä»¶ä¹‹é—´çš„ç»Ÿä¸€æ¥å£ï¼Œä»–ç®€åŒ–äº†æ•´ä¸ªç³»ç»Ÿæ¶æ„å¹¶æé«˜äº†äº¤äº’çš„å¯è§æ€§ã€‚</p>
<p>ä¸ºäº†å®ç°å’Œè·å¾—ç»Ÿä¸€æ¥å£ï¼Œéœ€è¦å¤šä¸ªæ¶æ„çº¦æŸæ¥æŒ‡å¯¼ç»„ä»¶çš„è¡Œä¸ºï¼Œè€Œ REST åˆ™æ˜¯ç”±å››ä¸ªæ¥å£çº¦æŸå®šä¹‰ï¼š</p>
<h4 id="èµ„æºè¯†åˆ«-identification-of-resources"><a href="#èµ„æºè¯†åˆ«-identification-of-resources" class="headerlink" title="èµ„æºè¯†åˆ« (identification of resources)"></a>èµ„æºè¯†åˆ« (identification of resources)</h4><p>è¯·æ±‚ä¸­åŒ…å«äº†å„ç§ç‹¬ç«‹èµ„æºçš„æ ‡è¯†ï¼Œå¦‚ Urlç­‰ã€‚é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥å°†è‡ªèº«çš„æ•°æ®åº“ä¿¡æ¯ä»¥ HTMLã€XMLã€JSONç­‰æ–¹å¼å‘é€ç»™å®¢æˆ·ç«¯ã€‚</p>
<h4 id="æ“çºµèµ„æº-manipulation-of-resources-through-representations"><a href="#æ“çºµèµ„æº-manipulation-of-resources-through-representations" class="headerlink" title="æ“çºµèµ„æº ( manipulation of resources through representations)"></a>æ“çºµèµ„æº ( manipulation of resources through representations)</h4><p>å½“å®¢æˆ·ç«¯æ‹¥æœ‰èµ„æºæ ‡è¯†åï¼Œå°±å¯ä»¥æ ¹æ®è¶³å¤Ÿçš„ä¿¡æ¯åˆ é™¤è¿™ä¸ªèµ„æº</p>
<h4 id="æè¿°ä¿¡æ¯-self-descriptive-messages"><a href="#æè¿°ä¿¡æ¯-self-descriptive-messages" class="headerlink" title="æè¿°ä¿¡æ¯ (self-descriptive messages)"></a>æè¿°ä¿¡æ¯ (self-descriptive messages)</h4><p>æ¯ä¸ªæ¶ˆæ¯éƒ½åŒ…å«äº†å¯ä»¥æè¿°æ¥å¦‚ä½•å¤„ç†è¿™ä¸ªä¿¡æ¯çš„æ–¹å¼ï¼Œå¦‚åª’ä½“ç±»å‹ï¼ˆmedia typeï¼‰ä»¥åŠæœ€åä¿®æ”¹æ—¶é—´ (modified time)</p>
<h3 id="åˆ†å±‚ç³»ç»Ÿï¼ˆLayered-Systemï¼‰"><a href="#åˆ†å±‚ç³»ç»Ÿï¼ˆLayered-Systemï¼‰" class="headerlink" title="åˆ†å±‚ç³»ç»Ÿï¼ˆLayered Systemï¼‰"></a>åˆ†å±‚ç³»ç»Ÿï¼ˆLayered Systemï¼‰</h3><p><img src="https://www.ics.uci.edu/~fielding/pubs/dissertation/layered_uccss.gif"><br>åˆ†å±‚ç³»ç»Ÿçš„æ ·å¼å…è®¸é€šè¿‡çº¦æŸç»„ä»¶è¡Œä¸ºä¸ºä½¿å¾—æ¯ä¸ªç»„ä»¶ <strong>â€ä¸èƒ½â€œ</strong> çœ‹åˆ°ä¸å…¶ç›´æ¥äº¤äº’çš„ç›´æ¥å±‚ä¹‹å¤–çš„å…¶ä»–å±‚ï¼Œå°†æ¶æ„ç”±åˆ†å±‚ç»„æˆã€‚2</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯å¾ˆå¤šæ–‡æ¡£éƒ½å°†  ç”¨è¶…åª’ä½“é©±åŠ¨åº”ç”¨çŠ¶æ€ï¼Œâ€œhypermedia as the engine of application stateâ€ å¤¹åœ¨é‡Œé¢ï¼Œå®é™…ä¸Šä»–çš„æ„æ€ä¸º â€è¶…åª’ä½“ <strong>ä½œä¸º</strong> åº”ç”¨ç¨‹åºçŠ¶æ€å¼•æ“â€œ</p>
</blockquote>
<h3 id="æŒ‰éœ€ç¼–ç ï¼ˆCode-On-Demandï¼‰"><a href="#æŒ‰éœ€ç¼–ç ï¼ˆCode-On-Demandï¼‰" class="headerlink" title="æŒ‰éœ€ç¼–ç ï¼ˆCode On Demandï¼‰"></a>æŒ‰éœ€ç¼–ç ï¼ˆCode On Demandï¼‰</h3><p>æŒ‰ç…§ Roy è®ºæ–‡æ¥ç†è§£ï¼ŒæŒ‰éœ€ç¼–ç åœ¨ REST å…¶å®æ˜¯ä¸€ä¸ªå¯é€‰çº¦æŸï¼Œå¹¶æä¾›äº†ä¸€ä¸ªéå¸¸ä¸é”™çš„ä¾‹å­ï¼š</p>
<blockquote>
<p>ä¾‹å¦‚ï¼Œå¦‚æœå·²çŸ¥ç»„ç»‡å†…çš„æ‰€æœ‰å®¢æˆ·ç«¯è½¯ä»¶éƒ½æ”¯æŒ Javaï¼Œåˆ™å¯ä»¥æ„å»ºè¯¥ç»„ç»‡å†…çš„æœåŠ¡ï¼Œä»¥ä¾¿é€šè¿‡ä¸‹è½½çš„Java ç±»æ¥è·å¾—å¢å¼ºåŠŸèƒ½çš„å¥½å¤„ã€‚</p>
<p>ä½†é—®é¢˜åœ¨äºç»„ç»‡çš„é˜²ç«å¢™å¯èƒ½ä¼šç»„ç»‡å¤–éƒ¨èµ„æºä¼ è¾“åˆ° Java å°ç¨‹åºï¼Œå¯¹äº Web çš„å…¶ä»–éƒ¨åˆ†ï¼ŒæŸäº›å®¢æˆ·ç«¯å¯èƒ½ä¸æ”¯æŒè¯¥ä»£ç ã€‚</p>
</blockquote>
<p>è€ŒæŒ‰éœ€ç¼–ç æ‰€æä¾›çš„ å¯é€‰çº¦æŸå°±å…è®¸æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªåœ¨ä¸€èˆ¬æƒ…å†µä¸‹æ”¯æŒæ‰€éœ€è¡Œä¸ºçš„æ¶æ„ã€‚</p>
<p>å½“ç„¶è¿™æ˜¯ä¸€ç§ç†è§£ï¼Œè€Œç¬¬äºŒç§ç†è§£å°±åå‘ä¸å®é™…ï¼Œå¤§å¤šæ•°å½¢å¼ä¸‹è¿”å›çš„èµ„æºéƒ½ä»¥ XMLæˆ–JSONè¡¨ç¤ºï¼Œä½†æ˜¯éœ€è¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªç”±çš„è¿”å›å¯æ‰§è¡Œä»£ç ã€‚</p>
<p>æ¥æ”¯æŒè‡ªå·±åº”ç”¨ç¨‹åºçš„éƒ¨åˆ†ï¼Œæ ¹æ®æŒ‰éœ€ç¼–ç çš„çº¦æŸè¿™æ˜¯å…è®¸çš„ï¼Œå› ä¸ºè¿™å±äº â€å¯é€‰çº¦æŸâ€œã€‚</p>
<blockquote>
<p>åº”ç”¨ä¸ Web æœåŠ¡</p>
<p>æˆ‘ä»¬å¯ä»¥æ ¹æ® REST çš„è®¾è®¡é£æ ¼ä¸º Web API è¿›è¡Œè®¾è®¡ï¼Œç¬¦åˆå…¶ç»Ÿä¸€æ¥å£çº¦æŸå³å¯ä»¥è¢«ç§°ä¹‹ä¸º â€RESTful APIâ€œï¼Œä»–ä¸»è¦å°±æ˜¯ä»¥ç»Ÿä¸€æ¥å£çš„ä¸‰ä¸ªçº¦æŸåŸåˆ™è€Œå®šä¹‰çš„ã€‚</p>
<p><strong>èµ„æºè¯†åˆ«</strong> æˆ‘ä»¬å¯ä»¥ç†è§£ä¸º èµ„æºåœ°å€çš„ URLï¼Œå¦‚ <code>http://example.com/resources</code><br><strong>ä¼ è¾“çš„èµ„æºï¼ˆæè¿°ä¿¡æ¯ï¼‰</strong>  WebæœåŠ¡æ¥å—ä¸è¿”å›çš„åª’ä½“ç±»å‹ï¼Œå¦‚ <code>JSONã€XML</code>ç­‰<br>è€Œå¯¹ <strong>æ“çºµèµ„æº</strong>åˆ™æ˜¯æ‰€æ”¯æŒçš„ä¸€ç³»åˆ—è¯·æ±‚æ–¹æ³•ï¼Œå¦‚ POSTã€GETã€PUTã€DELETE ç­‰ã€‚</p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210608033034.png"></p>
<p>å¦‚æœä½ è¯´ä½ è¦å®ç°ä¸€ä¸ª RESTè®¾è®¡é£æ ¼çš„ RESTful APIï¼Œåˆ™å¯ä»¥å‚ç…§ä¸‹è¿°ä¾‹å­ï¼š</p>
</blockquote>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. æ‰€æœ‰æ–‡ç« </span><br><span class="line">GET http://www.example.com/list</span><br><span class="line"></span><br><span class="line">2. é˜…è¯»æŸç¯‡æ–‡ç« </span><br><span class="line">GET http://www.example.com/list/&#123;id&#125;</span><br><span class="line"></span><br><span class="line">3. å‘å¸ƒæ–‡ç« </span><br><span class="line">POST http://www.example.com/list/release</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ¨èé˜…è¯» <a target="_blank" rel="noopener" href="https://restfulapi.net/resource-naming/">https://restfulapi.net/resource-naming/</a></p>
</blockquote>
<h2 id="ç‰¹å¾"><a href="#ç‰¹å¾" class="headerlink" title="ç‰¹å¾"></a>ç‰¹å¾</h2><blockquote>
<p>Spring cloud å¾ˆæ—©å°±æä¾›äº†ä¸‹è¿°ç‰¹å¾çš„å®ç°ï¼Œä½†ç”±äºæ—©æœŸç›¸å…³ä»£ç å’Œä»‹ç»å­˜åœ¨ä¸ Spring cloud çš„å­é¡¹ç›® Spring Cloud Cluster ä¸­ï¼Œåˆ°æœ€åè¢«è¿ç§»è‡³ Spring Integration ä¸­ã€‚</p>
<p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ Spring cloud åœ¨å®˜æ–¹æ–‡æ¡£ä¸­è¯´äº†è‡ªå·±çš„ xx ç‰¹å¾ï¼Œä½†åˆå¾ˆéš¾æ‰¾åˆ°ç›¸å…³æ–‡æ¡£çš„åŸå› ï¼Œè¿™æ˜¯å› ä¸ºäººå®¶æ—©å°±æŠŠä»£ç å’Œæ–‡æ¡£è¿ç§»åˆ°äº† Spring Integration ä¸­äº†ã€‚</p>
</blockquote>
<h3 id="åˆ†å¸ƒå¼-ç‰ˆæœ¬åŒ–ç®¡ç†ï¼ˆDistributed-x2F-versioned-configurationï¼‰"><a href="#åˆ†å¸ƒå¼-ç‰ˆæœ¬åŒ–ç®¡ç†ï¼ˆDistributed-x2F-versioned-configurationï¼‰" class="headerlink" title="åˆ†å¸ƒå¼\ç‰ˆæœ¬åŒ–ç®¡ç†ï¼ˆDistributed&#x2F;versioned configurationï¼‰"></a>åˆ†å¸ƒå¼\ç‰ˆæœ¬åŒ–ç®¡ç†ï¼ˆDistributed&#x2F;versioned configurationï¼‰</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210525113032.png"></p>
<blockquote>
<p>Spring cloud Config ä¸ Spring cloud Bus ç»å¸¸ä¸€èµ·æ­é…ä½¿ç”¨ï¼Œè¿™å¯ä»¥è®©ä»–æ— éœ€é‡æ–°å¯åŠ¨æœåŠ¡å¯ä»¥åˆ·æ–°é…ç½®æ–‡ä»¶çš„ä¿¡æ¯ã€‚</p>
</blockquote>
<p>é€šè¿‡ Spring Cloud Config æ¥ç»Ÿä¸€ç®¡ç†æœåŠ¡é…ç½®ï¼Œå¯ä»¥å°†æ‰€æœ‰æœåŠ¡çš„é…ç½®æ–‡ä»¶ <strong>æ”¾ç½®åœ¨æœ¬åœ°ä»“åº“æˆ–è€…è¿œç¨‹ä»“åº“ä¸­</strong>ã€‚è®©Spring cloud config é…ç½®ä¸­å¿ƒæ¥è´Ÿè´£è¯»å–ä»“åº“çš„é…ç½®æ–‡ä»¶ï¼Œè€Œå®¢æˆ·ç«¯ï¼ˆæœåŠ¡ï¼‰ä»é…ç½®ä¸­å¿ƒè¯»å–é…ç½®ã€‚</p>
<h3 id="æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼ˆService-registration-and-discoveryï¼‰"><a href="#æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼ˆService-registration-and-discoveryï¼‰" class="headerlink" title="æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼ˆService registration and discoveryï¼‰"></a>æœåŠ¡æ³¨å†Œå’Œå‘ç°ï¼ˆService registration and discoveryï¼‰</h3><p>æœåŠ¡æ²»ç†ç»„ä»¶ä¸»è¦ç”± Eurakeã€Consul ç­‰è¿›è¡Œï¼Œä»–åœ¨æ­¤ç›¸å½“äºäº¤æ˜“çš„ä¿¡æ¯å‘˜ï¼Œå¯ä»¥ <strong>å‘ç°</strong> æœåŠ¡æä¾›è€…ï¼ˆService Providerï¼‰ï¼Œè¿˜å¯ä»¥å°†è‡ªå·±æ³¨å†Œåˆ° <strong>æœåŠ¡ä¸­å¿ƒï¼ˆEureka Serverï¼‰ä¸­</strong></p>
<h3 id="è·¯ç”±ï¼ˆRoutingï¼‰"><a href="#è·¯ç”±ï¼ˆRoutingï¼‰" class="headerlink" title="è·¯ç”±ï¼ˆRoutingï¼‰"></a>è·¯ç”±ï¼ˆRoutingï¼‰</h3><p>é€šè¿‡æ™ºèƒ½è·¯ç”±ç½‘ç®¡ç»„ä»¶ Zuulã€Spring Cloud Gateway æ¥å®ç°æ™ºèƒ½è·¯ç”±å’Œè¯·æ±‚è¿‡æ»¤åŠŸèƒ½ã€‚å†…éƒ¨æœåŠ¡æ¥å£é€šè¿‡ç½‘å…³ç»Ÿä¸€å¯¹å¤–æš´éœ²ï¼Œæ¥é¿å…å†…éƒ¨æœåŠ¡æ•æ„Ÿä¿¡æ¯ä¿¡æ¯åœ¨æœªç»æˆæƒæƒ…å†µä¸‹å¯¹å¤–æš´éœ²ã€‚</p>
<h3 id="æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡ï¼ˆService-to-service-callsï¼‰"><a href="#æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡ï¼ˆService-to-service-callsï¼‰" class="headerlink" title="æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡ï¼ˆService to service callsï¼‰"></a>æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡ï¼ˆService to service callsï¼‰</h3><blockquote>
<p>Service to service calls åœ¨å®˜æ–¹æ–‡æ¡£ä¸­å¹¶æ²¡æœ‰è¿›è¡Œæ¦‚è¿°ï¼Œæ‰€ä»¥æœ¬æ–‡ä»…æ˜¯ä¸ªäººè§‚ç‚¹ã€‚</p>
</blockquote>
<p>Spring cloud ä¸­æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡ç»„è¦é€šè¿‡ Eureka ç»„ä»¶æ¥è°ƒç”¨å¾®æœåŠ¡çš„é¡ºåºã€‚</p>
<h3 id="è´Ÿè½½å‡è¡¡ï¼ˆLoad-balancingï¼‰"><a href="#è´Ÿè½½å‡è¡¡ï¼ˆLoad-balancingï¼‰" class="headerlink" title="è´Ÿè½½å‡è¡¡ï¼ˆLoad balancingï¼‰"></a>è´Ÿè½½å‡è¡¡ï¼ˆLoad balancingï¼‰</h3><p>è´Ÿè½½å‡è¡¡ä¸»è¦å¯ä»¥é€šè¿‡ Feignã€Ribbonæ¥å®ç°è´Ÿè½½å‡è¡¡ã€‚</p>
<h3 id="æ–­è·¯å™¨ï¼ˆCircuit-Breakersï¼‰"><a href="#æ–­è·¯å™¨ï¼ˆCircuit-Breakersï¼‰" class="headerlink" title="æ–­è·¯å™¨ï¼ˆCircuit Breakersï¼‰"></a>æ–­è·¯å™¨ï¼ˆCircuit Breakersï¼‰</h3><p>æ–­è·¯å™¨ä½¿ç”¨æœåŠ¡å®¹é”™ç»„ä»¶ Hystrixã€Resilience4jæ¥æ§åˆ¶æœåŠ¡çš„APIæ¥å£è£æ®µï¼Œä»¥å®ç°æ•…éšœè½¬ç§»ã€æœåŠ¡é™æµã€æœåŠ¡é™çº§ç­‰åŠŸèƒ½ã€‚é˜²æ­¢å¾®æœåŠ¡ç³»ç»Ÿå‘ç”Ÿ <strong>é›ªå´©æ•ˆåº”</strong>ï¼Œå¯ä»¥ä½¿ç”¨ Hystrix Dashboard ç»„ä»¶ç›‘æ§ <strong>å•ä¸ªèæ–­çŠ¶æ€</strong>ï¼Œä½¿ç”¨ Hystrix Turbine ç»„ä»¶ç›‘æ§ <strong>å¤šä¸ªæœåŠ¡çš„èæ–­çŠ¶æ€</strong>ã€‚</p>
<h3 id="å…¨å±€é”ï¼ˆGlobal-locksï¼‰"><a href="#å…¨å±€é”ï¼ˆGlobal-locksï¼‰" class="headerlink" title="å…¨å±€é”ï¼ˆGlobal locksï¼‰"></a>å…¨å±€é”ï¼ˆGlobal locksï¼‰</h3><p>ä¹Ÿè®¸å¯ä»¥é€šè¿‡ <a target="_blank" rel="noopener" href="https://github.com/spring-cloud-samples/locks#readme">https://github.com/spring-cloud-samples/locks#readme</a> æ¥è¿›è¡Œäº†è§£ Spring cloud å…¨å±€é”çš„ä½œç”¨ã€‚</p>
<p>å…¨å±€é”ï¼ˆGlobal locksï¼‰æ˜¯å¯¹æŸéƒ¨åˆ†è¿›è¡ŒåŠ é”ï¼Œå½“ä½ åªéœ€è¦å°†æŸä¸ªéƒ¨åˆ†åªå¤„äº <strong>åªè¯»çŠ¶æ€</strong> æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ï¼Œä¹‹åè¿™äº›éƒ¨åˆ†è¿›è¡Œæ›´æ–°ã€åˆ é™¤ç­‰å°†ä¼šé€ æˆé˜»å¡ã€‚</p>
<h3 id="é¢†å¯¼é€‰ä¸¾å’Œé›†ç¾¤çŠ¶æ€ï¼ˆLeadership-election-and-cluster-stateï¼‰"><a href="#é¢†å¯¼é€‰ä¸¾å’Œé›†ç¾¤çŠ¶æ€ï¼ˆLeadership-election-and-cluster-stateï¼‰" class="headerlink" title="é¢†å¯¼é€‰ä¸¾å’Œé›†ç¾¤çŠ¶æ€ï¼ˆLeadership election and cluster stateï¼‰"></a>é¢†å¯¼é€‰ä¸¾å’Œé›†ç¾¤çŠ¶æ€ï¼ˆLeadership election and cluster stateï¼‰</h3><p>é¢†å¯¼é€‰ä¸¾å’Œé›†ç¾¤çŠ¶æ€ï¼ˆLeadership election and cluster stateï¼‰ç”± <strong>Spring Cloud Cluster</strong> æ‰€æä¾›åˆ†å¸ƒå¼ç³»ç»Ÿé›†ç¾¤åŠŸèƒ½ï¼Œä»¥åŠåŒ…å«äº†é¢†å¯¼é€‰ä¸¾ã€é›†ç¾¤çŠ¶æ€ä»¥åŠå…¨å±€é”ã€‚</p>
<p>è¿™äº›éƒ½è¢« Spring Integration ä¸­çš„ä»£ç å–ä»£ã€‚</p>
<h3 id="åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’ï¼ˆDistributed-messagingï¼‰"><a href="#åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’ï¼ˆDistributed-messagingï¼‰" class="headerlink" title="åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’ï¼ˆDistributed messagingï¼‰"></a>åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’ï¼ˆDistributed messagingï¼‰</h3><p>é€šè¿‡æ¶ˆæ¯æ€»çº¿ï¼ˆBusï¼‰ç»„ä»¶ï¼Œæ•°æ®æµæ“ä½œç»„ä»¶å¯ä»¥ Redisã€RabbitMQã€Kafkaç­‰è¿›è¡Œå°è£…ï¼Œ<strong>æ¥å®ç°æ¶ˆæ¯çš„æ¥æ”¶å’Œå‘é€</strong>ã€‚</p>
<h2 id="ä¸»è¦é¡¹ç›®"><a href="#ä¸»è¦é¡¹ç›®" class="headerlink" title="ä¸»è¦é¡¹ç›®"></a>ä¸»è¦é¡¹ç›®</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210525113017.png"></p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210608202600.png"><br>ä¸‹è¿°æœ‰äº›å¹¶ä¸å®Œå…¨æ˜¯ Spring cloud è‡ªå·±çš„ï¼Œè€Œæ˜¯é€šè¿‡æ ¹æ® Spring boot é£æ ¼å¯¹è¿™äº›ç»„ä»¶è¿›è¡Œå°è£…ï¼Œå±è”½äº†å¤æ‚çš„é…ç½®å’ŒåŸç†ï¼Œæœ€ç»ˆç»™å¼€å‘äººå‘˜æä¾›äº†ä¸€ä¸ªç®€å•æ˜“æ‡‚å’Œæ˜“éƒ¨ç½²ä»¥åŠå¹³æ»‘çš„çš„å¾®æœåŠ¡æ¡†æ¶ã€‚</p>
<h3 id="Spring-Cloud-Config"><a href="#Spring-Cloud-Config" class="headerlink" title="Spring Cloud Config"></a>Spring Cloud Config</h3><p>Spring cloud config æ˜¯ spring cloud çš„é…ç½®ç®¡ç†å·¥å…·ï¼Œé€šè¿‡æ­¤é¡¹ç›®å¯ä»¥å°†é…ç½®ä¿¡æ¯æ”¾åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸­ï¼Œä»è€Œé›†ä¸­ç®¡ç†é›†ç¾¤é…ç½®ã€‚é™¤æ­¤ä¹‹å¤–è¿˜å¯æ”¯æŒï¼šæœ¬åœ°å­˜å‚¨ã€gitã€subversion ä¸‰ç§æ–¹å¼ï¼Œ<strong>è¿™äº›èµ„æºè¿˜å¯ç›´æ¥æ˜ å°„åˆ° Spring ç¯å¢ƒ</strong>ã€‚</p>
<h3 id="Spring-Cloud-Netflix"><a href="#Spring-Cloud-Netflix" class="headerlink" title="Spring Cloud Netflix"></a>Spring Cloud Netflix</h3><p>å„ç§ Netifix OSSç»„ä»¶ï¼Œç”± Eurekaï¼ŒHystrix ï¼ŒZuulï¼ŒArchaius ç­‰é›†æˆã€‚</p>
<h3 id="Spring-Coud-Bus"><a href="#Spring-Coud-Bus" class="headerlink" title="Spring Coud Bus"></a>Spring Coud Bus</h3><p>å°† <strong>æœåŠ¡å®ä¾‹ä¸åˆ†å¸ƒå¼æ¶ˆæ¯ä¼ é€’</strong> è¿æ¥åœ¨ä¸€èµ·çš„ <strong>äº‹ä»¶æ€»çº¿</strong>ï¼Œå¯ä»¥åœ¨é›†ç¾¤ä¸­ä¼ æ’­çŠ¶æ€æ›´æ”¹ï¼ˆå¦‚é…ç½®æ›´æ”¹ï¼‰ï¼Œè¿˜å¯ä¸ Spring Cloud Config è”åˆå®ç°çƒ­éƒ¨ç½²ã€‚</p>
<h3 id="Spring-Cloud-Cloudfoundry"><a href="#Spring-Cloud-Cloudfoundry" class="headerlink" title="Spring Cloud Cloudfoundry"></a>Spring Cloud Cloudfoundry</h3><p>Spring cloud é›†æˆäº† Foundry ï¼Œä»–æ˜¯ç”± VMware ç¬¬ä¸€ä¸ªä¸šç•Œæ¨å‡ºçš„å¼€æº Paasï¼ˆPlatform as a Serviceï¼Œå¹³å°å³æœåŠ¡ï¼‰çš„äº‘å¹³å°ã€‚æ”¯æŒå¤šç§æ¡†æ¶ã€è¯­è¨€ã€è¿è¡Œç¯å¢ƒã€å¹³å°åŠåº”ç”¨æœåŠ¡ï¼ŒåŸºäºè¿™äº›å¯è®©å¼€å‘äººå‘˜å¿«é€Ÿåœ¨å‡ ç§’ä¸­èƒ½è¿›è¡Œéƒ¨ç½²å’Œæ‰©å±•ï¼Œæä¾›äº†æœåŠ¡å‘ç°ï¼Œè¿˜å¯ä»¥è½»æ¾çš„å®ç° SSOã€OAuth2ä¿æŠ¤èµ„æºã€‚</p>
<h3 id="Spring-Cloud-Open-Service-Broker"><a href="#Spring-Cloud-Open-Service-Broker" class="headerlink" title="Spring Cloud Open Service Broker"></a>Spring Cloud Open Service Broker</h3><p>ä¸ºå®ç°æ„å»º Open Service Broker APIï¼ˆå¼€æ”¾æœåŠ¡å™¨ä»£ç†æ¥å£ï¼‰ï¼Œå¯ä»¥ä¸ºå¼€å‘äººå‘˜èƒ½å¤Ÿä¸ºå¼€å‘äººå‘˜å¯¹å¹³å°ï¼ˆå¦‚Spring Foundryã€Kubernetesï¼‰ä¸­è¿è¡Œçš„åº”ç”¨æä¾›æœåŠ¡ã€‚</p>
<h3 id="Spring-Cloud-Cluster"><a href="#Spring-Cloud-Cluster" class="headerlink" title="Spring Cloud Cluster"></a>Spring Cloud Cluster</h3><p>æä¾›äº†åˆ†å¸ƒå¼ç³»ç»Ÿé›†ç¾¤æ‰€éœ€è¦çš„åŸºç¡€åŠŸèƒ½æ”¯æŒï¼Œå¦‚é€‰ä¸¾ã€é›†ç¾¤çŠ¶æ€ä¸€è‡´æ€§ã€å…¨å±€é”ã€Tokens ç­‰å¸¸è§çŠ¶æ€æ¨¡å¼çš„æŠ½è±¡å’Œå®ç°ã€‚</p>
<h3 id="Spring-Cloud-Consul"><a href="#Spring-Cloud-Consul" class="headerlink" title="Spring Cloud Consul"></a>Spring Cloud Consul</h3><blockquote>
<p>Consul æ˜¯ç”± HashiCorp å…¬å¸æ‰€ä½¿ç”¨ Go æ‰€å¼€å‘çš„æœåŠ¡æ²»ç†é¡¹ç›®</p>
</blockquote>
<p>Spring cloud Consul ä¸»è¦å°è£…äº† Consul æ¥å®ç°æœåŠ¡æ²»ç†ã€å¥åº·æ£€æŸ¥ã€key-Values å­˜å‚¨ã€æ•°æ®ä¸­å¿ƒé›†ç¾¤çš„å‘¢ä¸ªã€‚</p>
<h3 id="Spring-Cloud-Security"><a href="#Spring-Cloud-Security" class="headerlink" title="Spring Cloud Security"></a>Spring Cloud Security</h3><p>æä¾›å¯¹ Zuul ä»£ç†ä¸­å¤æ‚å‡è¡¡çš„ OAuth2ã€REST å®¢æˆ·ç«¯å’Œèº«ä»½éªŒè¯å¤´ä¸­ç»§çš„æ”¯æŒã€‚</p>
<h3 id="Spring-Cloud-Sleuth"><a href="#Spring-Cloud-Sleuth" class="headerlink" title="Spring Cloud Sleuth"></a>Spring Cloud Sleuth</h3><p>Spring cloud sleuth ä¸º spring cloud æœåŠ¡ä¹‹é—´çš„è°ƒç”¨æä¾›äº†é“¾è·¯è¿½è¸ªï¼Œå°è£…äº† Dapperã€Log-based è¿½è¸ªï¼ˆELKï¼‰ã€Zipkin å’Œ HTrace æ“ä½œã€‚</p>
<h3 id="Spring-Cloud-Data-Flow"><a href="#Spring-Cloud-Data-Flow" class="headerlink" title="Spring Cloud Data Flow"></a>Spring Cloud Data Flow</h3><p>é’ˆå¯¹ç°ä»£è¿è¡Œæ—¶å¯ç»„åˆçš„å¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„åŸç”Ÿç¼–æ’æœåŠ¡ï¼Œæ˜“ç”¨äº DSLã€æ‹–æ”¾ GUI å’Œ restAPI ä¸€èµ·ç®€åŒ–äº†åŸºäºå¾®æœåŠ¡çš„æ•°æ®ç®¡é“æ•´ä½“ç¼–æ’ã€‚å³æä¾›äº†ç»Ÿä¸€å˜æˆæ¨¡å‹å’Œæ‰˜ç®¡æœåŠ¡ï¼Œç”¨äºå¼€å‘å’Œæ‰§è¡Œ ETLã€ä¸€ç§ç”¨äºå¤„ç†å¤§è§„æ¨¡æ•°æ®çš„æ¨¡å¼ã€‚</p>
<h3 id="Spring-Cloud-Stream"><a href="#Spring-Cloud-Stream" class="headerlink" title="Spring Cloud Stream"></a>Spring Cloud Stream</h3><p>ä¸€ä¸ªè½»é‡çº§äº‹ä»¶é©±åŠ¨çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œç”¨äºå¿«é€Ÿæ„å»ºå¯ä»¥é“¾æ¥åˆ°å¤–éƒ¨ç³»ç»Ÿçš„åº”ç”¨ç¨‹åºã€‚åŸºäº Spring boot åˆ›å»ºï¼Œé€šè¿‡äº‹ä»¶è§¦å‘ä»»åŠ¡ï¼Œå°è£…äº† Redisã€Rabbitã€Kafkaç­‰å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ï¼Œç”¨æ¥åˆ›å»ºå·¥ä¸šçº§çš„ Spring åº”ç”¨ã€‚</p>
<h3 id="Spring-Cloud-Stream-Application"><a href="#Spring-Cloud-Stream-Application" class="headerlink" title="Spring Cloud Stream Application"></a>Spring Cloud Stream Application</h3><p>Spring cloud Stream åº”ç”¨ç¨‹åºæ˜¯ç°æˆçš„ Spring å¼•å¯¼åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨ spring cloud stream ä¸­çš„ binder æŠ½è±¡æä¾›ä¸å¤–éƒ¨ä¸­é—´ä»¶ç³»ç»Ÿï¼ˆApacheKafkaã€RabbitMQâ€¦â€¦ï¼‰çš„é›†æˆã€‚</p>
<h3 id="Spring-Cloud-Task"><a href="#Spring-Cloud-Task" class="headerlink" title="Spring Cloud Task"></a>Spring Cloud Task</h3><p>ä¸€ä¸ªçŸ­æš‚çš„å¾®æœåŠ¡æ¡†æ¶ï¼Œä¸»è¦ç”¨äºè¿›è¡Œå¾®æœåŠ¡çš„ä»»åŠ¡ç®¡ç†å’Œè°ƒåº¦ç­‰ã€‚</p>
<h3 id="Spring-Cloud-Task-App-Starters"><a href="#Spring-Cloud-Task-App-Starters" class="headerlink" title="Spring Cloud Task App Starters"></a>Spring Cloud Task App Starters</h3><p>Spring cloud ä»»åŠ¡åº”ç”¨å¯åŠ¨ç¨‹åºæ˜¯ spring boot åº”ç”¨ç¨‹åºï¼Œå¯ä»¥æ˜¯ä»»ä½•è¿›ç¨‹ï¼ŒåŒ…æ‹¬ä¸ä¼šæ°¸è¿œè¿è¡Œçš„ Spring æ‰¹å¤„ç†ä½œä¸šï¼Œä»–ä»¬å¯ä»¥åœ¨æœ‰é™çš„æ•°æ®å¤„ç†å‘¨æœŸå <strong>ç»“æŸæˆ–åœæ­¢</strong></p>
<h3 id="Spring-Cloud-Zookeeper"><a href="#Spring-Cloud-Zookeeper" class="headerlink" title="Spring Cloud  Zookeeper"></a>Spring Cloud  Zookeeper</h3><p>Spring cloud é›†æˆäº† Zookeeperï¼Œä»–æ˜¯ Hadoop å’Œ Hbase çš„é‡è¦ç»„ä»¶ï¼Œ<strong>æä¾›äº†é…ç½®ç»´æŠ¤ã€åŸŸåæœåŠ¡ã€åˆ†å¸ƒå¼åŒæ­¥ã€ç»„æœåŠ¡ã€æœåŠ¡æ²»ç†ç­‰åŠŸèƒ½</strong>ã€‚</p>
<h3 id="Spring-Cloud-Connectors"><a href="#Spring-Cloud-Connectors" class="headerlink" title="Spring Cloud Connectors"></a>Spring Cloud Connectors</h3><p>ä½¿å„ç§å¹³å°ä¸Šçš„PaaSï¼ˆPlatform as a Serviceï¼Œå¹³å°å³æœåŠ¡ï¼‰åº”ç”¨ç¨‹åºèƒ½å¤Ÿè½»æ¾åœ°è¿æ¥åˆ°åç«¯æœåŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡ä»–æ¥é“¾æ¥åˆ°æœåŠ¡å’Œä»äº‘å¹³å°è·å–æ“ä½œçš„è¿‡ç¨‹ï¼Œæ‹¥æœ‰å¾ˆå¼ºçš„æ‰©å±•æ€§ï¼Œå¯ç”¨äºæ„å»ºäº‘å¹³å°ã€‚</p>
<h3 id="Spring-Cloud-Starters"><a href="#Spring-Cloud-Starters" class="headerlink" title="Spring Cloud Starters"></a>Spring Cloud Starters</h3><p>ä¸€ä¸ª Spring boot é£æ ¼çš„å¯åŠ¨åº”ç”¨é¡¹ç›®ï¼Œå¯ä»¥ç®€åŒ– Spring Cloud ä½¿ç”¨è€…çš„ä¾èµ–ç®¡ç†å…³ç³»ï¼ˆåœ¨ Angel.SR2ä¹‹ååœæ­¢ä¸ºä¸€ä¸ªé¡¹ç›®ï¼Œå¹¶ä¸å…¶ä»–é¡¹ç›®åˆå¹¶ï¼‰ï¼Œä¸º Spring cloud æä¾›äº†ä¸€ä¸ª <strong>å¼€ç®±å³ç”¨</strong> çš„ä¾èµ–ç®¡ç†ã€‚</p>
<h3 id="Spring-Cloud-CLI"><a href="#Spring-Cloud-CLI" class="headerlink" title="Spring Cloud CLI"></a>Spring Cloud CLI</h3><p>Spring boot CLI æ’ä»¶ï¼Œç”¨äºåœ¨ Groovy ä¸­å¿«é€Ÿåˆ›å»º SPring Clound ç»„ä»¶åº”ç”¨ç¨‹åºï¼Œå³é€šè¿‡ Spring cloud CLI å¯ä»¥ <strong>å¿«é€Ÿæ„å»ºäº‘ç»„ä»¶</strong>ã€‚</p>
<h3 id="Spring-Clound-Contract"><a href="#Spring-Clound-Contract" class="headerlink" title="Spring Clound Contract"></a>Spring Clound Contract</h3><p>Spring cloud é€šè¿‡ CDC (Customer Driven Contractsï¼Œå®¢æˆ·é©±åŠ¨åˆåŒ)å¼€å‘ï¼ŒåŸºäºJVMï¼ˆJava è™šæ‹Ÿæœºï¼ŒJava virtual machineï¼‰çš„åº”ç”¨æä¾›äº†æ”¯æŒï¼Œä¸ºTDDï¼ˆæµ‹è¯•é©±åŠ¨å¼€å‘ï¼‰æä¾›ä¸€ç§æ–°çš„åŸºäºæ¥å£çš„æµ‹è¯•æ–¹æ³•ã€‚</p>
<h3 id="Spring-Cloud-Gateway"><a href="#Spring-Cloud-Gateway" class="headerlink" title="Spring Cloud Gateway"></a>Spring Cloud Gateway</h3><p>Spring cloud Gateway æ˜¯ä¸€ä¸ªåŸºäºProject Reactor é¡¹ç›®ï¼Œä¸º Spring cloud æä¾›äº†ä¸€ç§ç®€å•å’Œæœ‰æ•ˆçš„æ–¹å¼æ¥å¯¹ <strong>ä¸ºæœåŠ¡çš„ API è¿›è¡Œè·¯ç”±</strong>ã€‚</p>
<h3 id="Spring-Cloud-OpenFeign"><a href="#Spring-Cloud-OpenFeign" class="headerlink" title="Spring Cloud OpenFeign"></a>Spring Cloud OpenFeign</h3><p>Spring cloud OpenFeign ç”±äºå°è£…å£°æ˜è¯• Web Service å®¢æˆ·ç«¯çš„ Feignï¼Œå¯ä»¥è®©ç¼–å†™ Web Service client å˜å¾—å®¹æ˜“ã€‚æ”¯æŒ Feign æ³¨è§£å’Œ JAX-RS æ³¨è§£ï¼Œæ”¯æŒçƒ­æ’æ‹”çš„ç¼–ç å™¨å’Œè§£ç å™¨ï¼Œå¹¶æ”¯æŒ Feign åœ¨ Spring MVC ä¸­ä½¿ç”¨ï¼Œç”±äºæ•´åˆäº† Ribbon å’Œ Eureka å¯ä»¥åœ¨ä½¿ç”¨ Feighn æ—¶æä¾›è´Ÿè½½å‡è¡¡ã€‚</p>
<h3 id="Spring-Cloud-Pipelines"><a href="#Spring-Cloud-Pipelines" class="headerlink" title="Spring Cloud Pipelines"></a>Spring Cloud Pipelines</h3><p>Spring Cloud Pipelines æä¾›äº†ä¸€ä¸ªå¯é çš„éƒ¨ç½²ç®¡é“ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€äº›æ­¥éª¤ï¼Œæ¥ç¡®ä¿åº”ç”¨ç¨‹åºå¯ä»¥é›¶åœæœºçš„æ–¹å¼éƒ¨ç½²ï¼Œå¹¶ä¸”åœ¨å‡ºç°é—®é¢˜æ—¶å¯ä»¥è½»æ¾çš„å›æ»šã€‚</p>
<h3 id="Spring-Cloud-Function"><a href="#Spring-Cloud-Function" class="headerlink" title="Spring Cloud Function"></a>Spring Cloud Function</h3><p>Spring Cloud Function æä¾›äº†ä¸€é€šç”¨çš„æ¨¡å‹ï¼Œåœ¨ç±»ä¼¼ä¸ AWS Lambda è¿™ç§ FaaSï¼ˆFunction as a Serviceï¼Œå‡½æ•°é©±åŠ¨æœåŠ¡ï¼‰å¹³å°ä¸Šéƒ¨ç½²å‡½æ•°è½¯ä»¶ã€‚</p>
<h2 id="Netfix-é¡¹ç›®"><a href="#Netfix-é¡¹ç›®" class="headerlink" title="Netfix é¡¹ç›®"></a>Netfix é¡¹ç›®</h2><p>é™¤äº† Spring cloud é¡¹ç›®æœ¬èº«ï¼Œå…¶ä»–å‚å•†ä¹Ÿå¯¹å…¶å¾®æœåŠ¡ç­‰å¼€æºäº§å“ä½œå‡ºå·¨å¤§çš„å…¬å¸ï¼Œå¦‚ Netfix å’Œ Alibaba ç­‰å…¬å¸ï¼Œä½† Netfix è¦æ—©äº Alibaba å¯¹å¾®æœåŠ¡åŠå…¶ç›¸å…³äº§å“æˆ–é¡¹ç›®çš„è´¡çŒ®ã€‚</p>
<p>Spring Cloud é›†æˆäº† Netfix å…¬å¸æ‰€å¼€æºçš„å„ç§é¡¹ç›®å’Œç»„å»ºå…¶ä¸­ä¸»è¦ä»¥ Eurekaã€Hystrixã€Zuulã€Archaius ä½œä¸ºä¸ºä»£è¡¨é¡¹ç›®ã€‚</p>
<h3 id="Eureka"><a href="#Eureka" class="headerlink" title="Eureka"></a>Eureka</h3><p>Eureka æ˜¯ä¸€ä¸ªåŸºäº REST æœåŠ¡çš„æœåŠ¡æ²»ç†ç»„ä»¶ï¼Œä¸»è¦åŒ…å«äº†æœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°ä¸¤ä¸ªæœ€ä¸ºæ ¸å¿ƒçš„åŠŸèƒ½ã€‚</p>
<h3 id="Hystrix"><a href="#Hystrix" class="headerlink" title="Hystrix"></a>Hystrix</h3><p>Spring cloud å¯ä»¥æ•´åˆ Hystrix æ¥å¯¹å¾®æœåŠ¡è¿›è¡Œå®¹é”™ç®¡ç†ï¼Œå³ä½¿å°†æœåŠ¡åšæˆé›†ç¾¤ä¹Ÿä¸ 100% ä¿è¯å®‰å…¨å¯ç”¨ã€‚ä¸ºäº†é˜²æ­¢æœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¾èµ–æ€§ï¼Œ<strong>å•ä¸ªæœåŠ¡å‡ºç°æ•…éšœ</strong> ä»è€Œå¯¼è‡´æ•´ä¸ªä¸ºæœåŠ¡ç³»ç»Ÿå´©æºƒï¼Œåˆ™éœ€è¦è¿›è¡Œå®¹é”™ç®¡ç†ã€‚</p>
<h3 id="Zuul"><a href="#Zuul" class="headerlink" title="Zuul"></a>Zuul</h3><p>Zuul ä¸º Spring cloud æä¾›äº†è·¯ç”±å’Œè¿‡æ»¤çš„åŠŸèƒ½ï¼Œä»–æ˜¯ä¸€ç§æœåŠ¡çš„ç»Ÿä¸€å…¥å£ï¼Œé™¤æ­¤è¿˜æä¾›äº†åŠ¨æ€è·¯ç”±ã€ç›‘æ§ã€æˆæƒã€å®‰å…¨ã€è°ƒåº¦ç­‰åŠŸèƒ½ã€‚</p>
<h3 id="Archaius"><a href="#Archaius" class="headerlink" title="Archaius"></a>Archaius</h3><p>Spring cloud æ•´åˆäº† Archaius æ¥è¿›è¡Œ ç®¡ç†å’Œé…ç½® APIï¼ŒArchaius æä¾›äº†åŠ¨æ€ç±»å‹åŒ–å±æ€§ã€çº¿ç¨‹å®‰å…¨é…ç½®æ“ä½œï¼Œè½®è¯¢æ¡†æ¶ï¼Œå›è°ƒæœºåˆ¶ç­‰åŠŸèƒ½ã€‚</p>
<blockquote>
<p>Archaius å¯ä»¥å®ç°å‡ºåŠ¨æ€è·å–é…ç½®ï¼Œå¦‚é»˜è®¤æ¯éš”60sä»é…ç½®æºè¯»å–ä¸€æ¬¡å†…å®¹ï¼Œ<strong>è¿™æ ·åœ¨ä¿®æ”¹é…ç½®æ–‡ä»¶åä¸éœ€è¦é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œå³å¯ä½¿å¾—ä¿®æ”¹çš„å†…å®¹ç”Ÿæ•ˆ</strong></p>
</blockquote>
<h2 id="Alibaba-é¡¹ç›®"><a href="#Alibaba-é¡¹ç›®" class="headerlink" title="Alibaba é¡¹ç›®"></a>Alibaba é¡¹ç›®</h2><p>åœ¨ 2019å¹´10æœˆæ‰€å‘å¸ƒçš„ã€Šé¢ è¦†æ€§å…¬å¸å’Œå•†ä¸šæ¨¡å¼ã€‹æŠ¥å‘Šä¸­ï¼ŒAlibaba ä»¥ 15% æˆåŠŸä½å±…ç¬¬ä¸‰ä½ï¼Œç™¾åº¦ã€è…¾è®¯ç­‰å‡ä½åˆ—ç¬¬åå’Œç¬¬åä¸€ä½ã€‚</p>
<h3 id="Sentinel"><a href="#Sentinel" class="headerlink" title="Sentinel"></a>Sentinel</h3><p>Sentinel æ˜¯ä¸€ä¸ªæµæ§åˆ¶ç»„ä»¶ï¼Œå¯ä»¥å°†æµé‡ä½œä¸ºåˆ‡å…¥ç‚¹ï¼Œä»æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªé˜¶æ®µä¿è¯æœåŠ¡çš„ç¨³å®šæ€§ã€‚</p>
<h3 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h3><p>Nacos æ˜¯ä¸€ä¸ªæœåŠ¡æ²»ç†çš„é¡¹ç›®ï¼Œä¸ Eurekaã€Consul ä¸€æ ·ï¼Œæä¾›äº†åŠ¨æ€æœåŠ¡å‘ç°ã€é…ç½®ç®¡ç†å’ŒæœåŠ¡ç®¡ç†å¹³å°ã€‚</p>
<h3 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h3><p>RocketMQ æ˜¯åŸºäºåˆ†å¸ƒå¼é«˜å¯ç”¨é›†ç¾¤æä¾›çš„ä½å»¶è¿Ÿã€é«˜å¯é çš„æ¶ˆæ¯å‘å¸ƒ&#x2F;è®¢é˜…æœåŠ¡ï¼Œç±»ä¼¼ä¸ RabbitMQ çš„ä¸€ç§æ¶ˆæ¯ä¸­é—´ä»¶ã€‚</p>
<h3 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h3><p>Dubbo æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€è½»é‡çº§çš„å¼€æº Java æœåŠ¡æ¡†æ¶ï¼Œæä¾›äº†é¢å‘æ¥å£ä»£ç†çš„é«˜æ€§èƒ½RPCï¼ˆRomote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰ï¼Œæ™ºèƒ½å®¹é”™ã€è´Ÿè½½å‡è¡¡ã€æœåŠ¡è‡ªåŠ¨æ³¨å†Œå’Œå‘ç°ã€è¿è¡ŒæœŸæµé‡è°ƒæ•´ã€å¯è§†åŒ–æœåŠ¡æ²»ç†ä¸è¿ç»´ç­‰ã€‚</p>
<h3 id="Seata"><a href="#Seata" class="headerlink" title="Seata"></a>Seata</h3><p>Seataæ˜¯ä¸€æ¬¾åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºåœ¨å¾®æœåŠ¡æ¶æ„ä¸‹æä¾›é«˜æ€§èƒ½å’Œç®€å•æ˜“ç”¨çš„åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚</p>
<h3 id="Alibaba-Cloud-ACM"><a href="#Alibaba-Cloud-ACM" class="headerlink" title="Alibaba Cloud ACM"></a>Alibaba Cloud ACM</h3><p>Alibaba Cloud ACM æ˜¯ä¸€ä¸ªåº”ç”¨é…ç½®ä¸­å¿ƒï¼Œç”¨äºåˆ†å¸ƒå¼æ¶æ„ç¯å¢ƒä¸­å¯¹ <strong>åº”ç”¨é…ç½®è¿›è¡Œé›†ä¸­çš„ç®¡ç†å’Œæ¨é€ã€‚</strong></p>
<h3 id="Alibaba-Cloud-SchedulerX"><a href="#Alibaba-Cloud-SchedulerX" class="headerlink" title="Alibaba Cloud SchedulerX"></a>Alibaba Cloud SchedulerX</h3><blockquote>
<p>Cron æ˜¯ä¸€ä¸ªåŸºäºæ—¶é—´çš„ä»»åŠ¡ç®¡ç†ç³»ç»Ÿï¼Œå¯é€šè¿‡ cron åœ¨å›ºå®šæ—¶é—´ã€æ—¥æœŸã€é—´éš”çš„æƒ…å†µä¸‹è¿è¡Œä»»åŠ¡ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ä»–çš„è¡¨è¾¾å¼ç‰¹åˆ«çš„ä¸å…·æœ‰å¯è¯»æ€§ï¼š</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æ–‡ä»¶æ ¼å¼èªªæ˜</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">â”Œâ”€â”€åˆ†é˜ï¼ˆ0 - 59ï¼‰</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">â”‚ â”Œâ”€â”€å°æ™‚ï¼ˆ0 - 23ï¼‰</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">â”‚ â”‚ â”Œâ”€â”€æ—¥ï¼ˆ1 - 31ï¼‰</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">â”‚ â”‚ â”‚ â”Œâ”€æœˆï¼ˆ1 - 12ï¼‰</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">â”‚ â”‚ â”‚ â”‚ â”Œâ”€æ˜ŸæœŸï¼ˆ0 - 6ï¼Œè¡¨ç¤ºä»å‘¨æ—¥åˆ°å‘¨å…­ï¼‰</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">â”‚ â”‚ â”‚ â”‚ â”‚</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">*  *  *  *  * è¢«åŸ·è¡Œçš„å‘½ä»¤</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>å¦‚ <code>1-6 * * * * echo hello world</code> åŠæ¯å°æ—¶çš„ 1ï½6åˆ†é’Ÿå†…ï¼Œéƒ½ä¼šéƒ½ä¼šæ‰“å° Hello,worldç¬¦å·ã€‚</p>
<p>æ›´å¤šå¯å‚è€ƒ <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Cron">https://zh.wikipedia.org/wiki/Cron</a></p>
</blockquote>
<p>åŸºäº Cron è¡¨è¾¾å¼çš„ä»»åŠ¡è°ƒåº¦æœåŠ¡ï¼Œå¯ä»¥æä¾›ç§’çº§ã€ç²¾å‡†ã€é«˜å¯é ã€é«˜å¯ç”¨çš„å®šæ—¶ä»»åŠ¡è°ƒåº¦åŠŸèƒ½ï¼Œå¯ä»¥æ”¯æŒ  cronã€fixed_rateã€second_delay å®šæ—¶è°ƒåº¦ï¼Œèƒ½ç²¾ç¡®åˆ°ç§’çº§åˆ«ã€‚</p>
<h2 id="æ¶æ„å¯¹æ¯”"><a href="#æ¶æ„å¯¹æ¯”" class="headerlink" title="æ¶æ„å¯¹æ¯”"></a>æ¶æ„å¯¹æ¯”</h2><h3 id="Spring-cloud"><a href="#Spring-cloud" class="headerlink" title="Spring cloud"></a>Spring cloud</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210525113017.png"></p>
<h3 id="Dubbo-1"><a href="#Dubbo-1" class="headerlink" title="Dubbo"></a>Dubbo</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210525161842.png"></p>
<p>Dubbo æ¯” Spring cloud <strong>å°‘äº†å¾ˆå¤šé…å¥—é¡¹ç›®ï¼ˆå› ä¸ºä¸æ˜¯ spring å…¨å®¶æ¡¶å†…çš„ï¼‰</strong>ï¼Œæ‰€ä»¥ Dubbo ä¸“æ³¨ä¸ RPC é¢†åŸŸï¼Œæœªæ¥å°†ä¼šæˆä¸ºå¾®æœåŠ¡ç”Ÿæ€ä½“ç³»ä¸­ä¸€ä¸ªé‡è¦çš„ <strong>ç»„ä»¶</strong>ï¼Œè€Œä¸æ˜¯ <strong>å¾®æœåŠ¡çš„å…¨é¢è§£å†³æ–¹æ¡ˆ</strong>ã€‚</p>
<h3 id="lstio"><a href="#lstio" class="headerlink" title="lstio"></a>lstio</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210525161902.png"><br>lstio ä¸»è¦ä½¿ç”¨ç½‘æ ¼æœåŠ¡ Service Mesh æ¶æ„æ¥å®ç°ï¼Œå› æ­¤åœ¨ lstio ä¸­ï¼ŒæœåŠ¡ä¹‹é—´çš„é€šä¿¡ä¸»è¦é€šè¿‡ Envoy ä»£ç†æ¥ä½¿ç”¨ <strong>HTTP&#x2F;1.1ã€HTTP2ã€gRPCã€TCP</strong> æ¥è¿›è¡Œï¼ŒPilotã€Mixerã€Citadel æ¥ç»„æˆçš„æ§åˆ¶å¹³å°ã€‚</p>
<h4 id="pilot"><a href="#pilot" class="headerlink" title="pilot"></a>pilot</h4><p>ä¸º Envoy æä¾›æœåŠ¡å‘ç°ã€æµé‡ç®¡ç†ã€æ™ºèƒ½è·¯ç”±ã€é”™è¯¯å¤„ç†ï¼ˆå«è¶…æ—¶ã€é‡è¯•ã€èæ–­ï¼‰çš„åŠŸèƒ½ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥é€šè¿‡ Pilot çš„ API ç®¡ç†ç½‘ç»œç›¸å…³çš„èµ„æºå¯¹è±¡ã€‚Pilot ä¼šæ ¹æ®ç”¨æˆ·çš„é…ç½®å’ŒæœåŠ¡çš„ä¿¡æ¯å°†ç½‘ç»œæµé‡ç®¡ç†ä¿¡æ¯åˆ†å‘åˆ°å„ä¸ª Envoy ä¸­ã€‚</p>
<h4 id="Mixer"><a href="#Mixer" class="headerlink" title="Mixer"></a>Mixer</h4><p>ä¸»è¦ä¸ºæ•´ä¸ª é›†ç¾¤æ‰§è¡Œè®¿é—®æ§åˆ¶ã€è·¨æœåŠ¡ç½‘æ ¼ä½¿ç”¨ç­–ç•¥ï¼ˆPolicyï¼‰ã€ç®¡ç†ï¼ˆRate Limitã€Quotaï¼‰bing souji cong  Envoy ä»£ç†å’Œå…¶ä»–æœåŠ¡è‡ªåŠ¨æ¢æµ‹åˆ°çš„æ•°æ®ï¼ŒMixer åŒ…å«äº†ä¸€ä¸ªéå¸¸çµæ´»çš„æ¨¡å‹æ’ä»¶ã€‚<strong>å¯ä»¥ä¸å„ç§ä¸»æœºç¯å¢ƒå’Œåç«¯åŸºç¡€æ¶æ„è¿›è¡Œäº¤äº’ï¼Œä»–æ˜¯ä¸€ä¸ªç‹¬ç«‹äºå¹³å°çš„ç»„ä»¶</strong>ã€‚</p>
<h4 id="Citadel"><a href="#Citadel" class="headerlink" title="Citadel"></a>Citadel</h4><p>æä¾›äº†æœåŠ¡ä¹‹é—´çš„è®¤è¯å’Œè¯ä¹¦ç®¡ç†ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å‡çº§åˆ° TLS åè®®</p>
<h4 id="Sidecar"><a href="#Sidecar" class="headerlink" title="Sidecar"></a>Sidecar</h4><p>åœ¨åŸæœ‰çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä¹‹é—´æ·»åŠ äº†ä¸€ä¸ªä»£ç†ç¨‹åºã€‚</p>
<h4 id="Envoy"><a href="#Envoy" class="headerlink" title="Envoy"></a>Envoy</h4><p>æä¾›äº†æœåŠ¡å‘ç°ï¼Œè´Ÿè½½å‡è¡¡å’Œè·¯ç”±è¡¨åŠ¨æ€æ›´æ–°çš„ APIè¿™äº›åˆ†åˆ«è§£å†³äº† lstio å’Œ Envoy çš„é—®é¢˜ï¼ŒProxy ä½œä¸º SideCar ä¼šå’Œæ§åˆ¶ä¸­å¿ƒåŠ¨å¿ƒï¼Œæ¥è·å–éœ€è¦çš„æœåŠ¡ä¹‹é—´çš„ä¿¡æ¯ï¼Œä»¥åŠå›æŠ¥æœåŠ¡è°ƒç”¨çš„  Metricsï¼ˆæŒ‡æ ‡ï¼‰ æ•°æ®</p>
<h1 id="Sprng-cloud-ä¼˜ç¼ºç‚¹"><a href="#Sprng-cloud-ä¼˜ç¼ºç‚¹" class="headerlink" title="Sprng cloud ä¼˜ç¼ºç‚¹"></a>Sprng cloud ä¼˜ç¼ºç‚¹</h1><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210528095543.png"></p>
<h2 id="å¾®æœåŠ¡ä¼˜ç‚¹"><a href="#å¾®æœåŠ¡ä¼˜ç‚¹" class="headerlink" title="å¾®æœåŠ¡ä¼˜ç‚¹"></a>å¾®æœåŠ¡ä¼˜ç‚¹</h2><h3 id="æ¨¡å—åŒ–å¼€å‘"><a href="#æ¨¡å—åŒ–å¼€å‘" class="headerlink" title="æ¨¡å—åŒ–å¼€å‘"></a>æ¨¡å—åŒ–å¼€å‘</h3><p>ä»¥ä¸Šå›¾ä½œä¸ºå‚è€ƒï¼Œæˆ‘ä»¬å¯ä»¥é¦–å…ˆå¾—çŸ¥å¾®æœåŠ¡æ˜¯ä»¥ <strong>åˆ†å¸ƒå¼</strong> ä½œä¸ºå¿…è¦æŠ€æœ¯ã€‚æœ‰å¤šä¸ªå¾®å°æœåŠ¡æ‰€ç»„æˆçš„ä¸€ä¸ªåº”ç”¨ï¼Œç”±äºä»–å°†ä¸€ä¸ªåŠŸèƒ½åˆ’åˆ†ä¸ºä¸€ä¸ªå¾ˆå°çš„æœåŠ¡ï¼Œå¯ä»¥å°†ä¸€ä¸ªå¾®æœåŠ¡äº¤ç»™ä¸åŒçš„å¼€å‘äººå‘˜æˆ–å›¢é˜Ÿè¿›è¡Œå¼€å‘ã€‚</p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210530202957.png"></p>
<p>ä¹Ÿå°±æ˜¯è¯´ä¸åŒçš„å¼€å‘å›¢é˜Ÿå¯ä»¥åŒæ—¶å®Œæˆå¤šä¸ªå±äºè‡ªå·±ä»»åŠ¡èŒƒå›´å†…çš„ â€œå¾®æœåŠ¡â€ï¼Œè¿›è¡Œé¡¹ç›®å¼€å‘ï¼Œå› æ­¤å¯ä»¥ <strong>æ˜“äºå¼€å‘å’Œç»´æŠ¤</strong>ï¼Œè€Œä¸æ˜¯å‘å•ä¸€åº”ç”¨ä¸€æ ·ä¸€ä¸ªé¡¹ç›®å‡ ç™¾ä¸ªæ–‡ä»¶å¤¹ï¼Œéƒ½æ¶‰åŠä¸åŒçš„åŠŸèƒ½å’ŒæœåŠ¡ã€‚</p>
<h3 id="ä»£ç é‡"><a href="#ä»£ç é‡" class="headerlink" title="ä»£ç é‡"></a>ä»£ç é‡</h3><p>ä¸å•ä¸ªæœåŠ¡ç›¸æ¯”ï¼Œå¾®æœåŠ¡ç”±äºåŠŸèƒ½åªé’ˆå¯¹ä¸€ä¸ªåŠŸèƒ½æ‰€è¿›è¡Œæä¾›æœåŠ¡ã€‚å› æ­¤ä»£ç é‡ä¸ä¼šåƒæ­£å¸¸çš„å•ä¸€åº”ç”¨è¾ƒå¤šï¼Œæ‰€ä»¥é¡¹ç›®çš„å¯åŠ¨é€Ÿåº¦æ˜¯æ¯”å•ä¸€åº”ç”¨è¾ƒå¿«çš„ã€‚ï¼ˆä½†è¿™ä¹Ÿä¸ç®—æ˜¯ä¼˜ç‚¹ï¼Œå› ä¸ºå¯åŠ¨æ—¶è¿˜å¾ˆéº»çƒ¦ï¼Œä¸€ä¸ªä¸€ä¸ªå¯åŠ¨å¤šä¸ªå¾®æœåŠ¡ï¼‰</p>
<h3 id="æ˜“äºæ›´æ–°è¿­ä»£"><a href="#æ˜“äºæ›´æ–°è¿­ä»£" class="headerlink" title="æ˜“äºæ›´æ–°è¿­ä»£"></a>æ˜“äºæ›´æ–°è¿­ä»£</h3><p>å¦‚æœåªæ˜¯å°å‹çš„é¡¹ç›®è¿­ä»£çš„è¯ï¼Œé‚£ä¹ˆå¾®æœåŠ¡ç”±äºæ˜¯å¤šä¸ªæœåŠ¡åº”ç”¨ç»„æˆçš„ä¸€ä¸ªåºå¤§æœåŠ¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ ¹æ®ç›®æ ‡ <strong>åŠŸèƒ½å¯¹åº”çš„å¾®æœåŠ¡</strong> æ¨¡å—ç›´æ¥è¿›è¡Œä¿®æ”¹åä¸Šä¼ ã€‚ä¸éœ€è¦å‘å•ä½“åº”ç”¨ä¸€æ ·ç›´æ¥æš‚åœé¡¹ç›®å¹¶è¿›è¡Œä¿®æ”¹åå‘å¸ƒã€‚</p>
<h3 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a>æŠ€æœ¯æ ˆ</h3><p>ç”±äºå¾®æœåŠ¡æ˜¯ä»¥ä¸šåŠ¡å•ä¸€æ€§ä¸ºåŸåˆ™çš„å¼€å‘æ¨¡å¼ï¼Œå› æ­¤ä»–çš„å¼€å‘ä¹Ÿä¸ä¼šæ˜¯ç»Ÿä¸€ä¸€ç§è¯­è¨€ï¼Œä»–å¯ä»¥æ˜¯å¤šä¸ªï¼Œä¸”ä¸å†²çªã€‚</p>
<h3 id="è§£è€¦"><a href="#è§£è€¦" class="headerlink" title="è§£è€¦"></a>è§£è€¦</h3><p>è§£è€¦æ˜¯åœ¨è®¾è®¡æ¨¡å¼ä¸­è¾ƒä¸ºå¸¸è§çš„åè¯ä¹‹ä¸€ï¼Œå„ç±»ä¹¦ç±ä¸­ç»å¸¸å‡ºç°ä½†å°±æ˜¯ä¸ç»™ä½ è§£é‡Šã€‚è§£è€¦é€šä¿—æ¥è¯´å°±æ˜¯ä¸¤ä¸ªä¸œè¥¿ <strong>åŸæ¥äº’ç›¸å½±å“</strong>ï¼Œç°åœ¨ç„¶ä»–ä»¬ <strong>åˆ†åˆ«å‘å±•</strong>ï¼Œä½†ä¸æ˜¯å®Œå…¨çš„åˆ†åˆ«å‘å±•ï¼Œè€Œæ˜¯åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šé™ä½ä¸¤è€…äº’ç›¸çš„ä¾èµ–å…³ç³»ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯æœ€å°èŒè´£ï¼Œæ¯ä¸ªåœ°æ–¹åšä¸€ä»¶äº‹æƒ…ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ <strong>æ¾è€¦åˆ</strong> ä¹Ÿå¯ä»¥è¢«ç§°ä¹‹ä¸º <strong>è§£è—•</strong>ï¼Œç¬é—´è®©æ­¤å˜å¾—é«˜ç«¯å¤§æ°”ä¸Šæ¡£æ¬¡ã€‚å› æ­¤é™¤äº†æ¾è€¦åˆå¤–ï¼Œ</p>
<blockquote>
<p>ä»–è¿˜æœ‰ä¸€ä¸ªåæ„ä¸º <strong>ç´§è€¦åˆ</strong>ï¼ŒæŒ‡çš„æ˜¯ä¸¤ä¸ªæ¨¡å—ä¹‹é—´ç›¸äº’å½±å“ä¸”å…³ç³»ç´§å¯†ï¼Œå­˜åœ¨ç€äº’ç›¸å…³ç³»è°ƒç”¨ã€‚</p>
</blockquote>
<h3 id="å…·æœ‰å¼¹æ€§"><a href="#å…·æœ‰å¼¹æ€§" class="headerlink" title="å…·æœ‰å¼¹æ€§"></a>å…·æœ‰å¼¹æ€§</h3><p>ç”±äºå¾®æœåŠ¡éå¸¸å¯ä»¥ç®€å•çš„å®ç° <strong>æœåŠ¡é›†ç¾¤</strong>ï¼Œé€šè¿‡ <strong>æœåŠ¡æ²»ç†ç»„ä»¶</strong>æ¥å®ç°æœåŠ¡çš„æ²»ç†ï¼Œé€šå¸¸éƒ½æ˜¯ä¸¤ä¸‰ä¸ªé›†ç¾¤ä¸€èµ·å·¥ä½œã€‚ä¸€å°è¹¦äº†è¿˜æœ‰å¦ä¸€å°ï¼Œå¦ä¸€å°è¹¦äº†åˆæ¢ä¸‹ä¸€å°çš„å±€é¢ï¼Œå¯ä»¥ä¿è¯æœåŠ¡çš„æ­£å¸¸è¿è¡Œã€‚é™¤æ­¤ä¹‹å¤–è¿˜å…·æœ‰æ°´å¹³æ‰©å±•ç‹¬ç«‹ä»¥åŠæ‰©å±•æ€§é«˜ç­‰ä¼˜ç‚¹ã€‚</p>
<h2 id="å¾®æœåŠ¡ç¼ºç‚¹"><a href="#å¾®æœåŠ¡ç¼ºç‚¹" class="headerlink" title="å¾®æœåŠ¡ç¼ºç‚¹"></a>å¾®æœåŠ¡ç¼ºç‚¹</h2><h3 id="åˆ†å¸ƒå¼å¤æ‚æ€§"><a href="#åˆ†å¸ƒå¼å¤æ‚æ€§" class="headerlink" title="åˆ†å¸ƒå¼å¤æ‚æ€§"></a>åˆ†å¸ƒå¼å¤æ‚æ€§</h3><p>å¯¹å¾®æœåŠ¡æ¥è¯´åˆ†å¸ƒå¼æ¶æ„æ˜¯ä¸€ä¸ªéå¸¸å¿…è¦çš„æŠ€æœ¯ï¼Œä½†å› ä¸ºåˆ†å¸ƒå¼ä¾èµ–æœåŠ¡è¾ƒå¤šï¼Œä¸€æ—¦å…¶ä¸­æŸä¸ª <strong>ä¾èµ–æœåŠ¡</strong> ä»¥åŠç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›éƒ½ä¼šå¸¦æ¥æŒ‘æˆ˜ã€‚</p>
<h3 id="åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"><a href="#åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜"></a>åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜</h3><p>æ‰€è°“åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜å¯ä»¥åˆ†ä¸º <strong>å¯é äº‹ä»¶æ¨¡å¼ï¼ˆReliable Event Modeï¼‰ã€è¡¥å¿æ¨¡å¼ï¼ˆConfirm Cancelï¼‰ã€TCCï¼ˆTry Confirm Cancelï¼‰</strong> ä¸‰ç§ï¼Œç”¨äºè§£å†³åˆ†å¸ƒå¼çš„ <strong>äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜</strong>ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“ä¸ºä»€ä¹ˆè¦æœ‰æœåŠ¡ä¸€è‡´æ€§ï¼Œå‡è®¾ä½ åœ¨ Wechat ä¸­å°† 100RMB è½¬è´¦ç»™ Bï¼Œé‚£ä¹ˆ B çš„ Wechat é’±åŒ…å°±ä¼šå¤š 100RMBã€‚ä½†å¦‚æœè¿™ä¸ªè¿‡ç¨‹ä¸­ Wechat æœåŠ¡å´©äº†ï¼Œé‚£ä½ å°†ä¼šå°‘ 100RMBï¼Œè€ŒBçš„é’±åŒ…æ•°é¢ä¸å˜ã€‚</p>
<h4 id="å¯é äº‹ä»¶æ¨¡å¼ï¼ˆReliable-Event-Modeï¼‰"><a href="#å¯é äº‹ä»¶æ¨¡å¼ï¼ˆReliable-Event-Modeï¼‰" class="headerlink" title="å¯é äº‹ä»¶æ¨¡å¼ï¼ˆReliable Event Modeï¼‰"></a>å¯é äº‹ä»¶æ¨¡å¼ï¼ˆReliable Event Modeï¼‰</h4><p>ä»–ä¹Ÿè¢«ç§°ä¹‹ä¸º å¯é äº‹ä»¶è®°å½•åè®®ï¼ˆRELPï¼ŒReliable Event Logging Protocolï¼‰ï¼Œæ˜¯ä¸€ç§ç”¨äºè®¡ç®—æœºç½‘ç»œä¸­è®°å½• <strong>è®¡ç®—æœºæ•°æ®çš„ç½‘ç»œåè®®</strong>ã€‚</p>
<p>ä»–å¯ä»¥æä¾›æ¶ˆæ¯çš„å¯é ä¼ é€’ï¼Œå¸¸ç”¨ä¸ä¸èƒ½è®©æ•°æ®ä¸¢å¤±çš„ç¯å¢ƒï¼Œå¦‚è½¬è´¦ã€‚åœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦è®¤æ¸… <strong>å¯é äº‹ä»¶è®°å½•åè®®å’Œå¯é äº‹ä»¶æ¨¡å¼</strong>ï¼Œåœ¨é€šå¸¸çš„æƒ…å†µä¸‹ï¼Œ<strong>å¯é äº‹ä»¶æ¨¡å¼æ˜¯å¯é äº‹ä»¶è®°å½•åè®®çš„å®ç°</strong></p>
<p>ä¸€èˆ¬æƒ…å†µä¸‹äº‹ä»¶æ“ä½œå¯ä»¥è¢«åˆ†ä¸ºä¸‰ç§å¯èƒ½ï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<ol>
<li>æ“ä½œæˆåŠŸï¼ŒæŠ•é€’äº‹ä»¶</li>
<li>æ“ä½œå¤±è´¥ï¼ŒæŠ•é€’äº‹ä»¶å¤±è´¥</li>
<li>æ“ä½œæˆåŠŸï¼ŒæŠ•é€’å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ | å›æ»š</li>
</ol>
<h5 id="æœ¬åœ°äº‹ä»¶è¡¨"><a href="#æœ¬åœ°äº‹ä»¶è¡¨" class="headerlink" title="æœ¬åœ°äº‹ä»¶è¡¨"></a>æœ¬åœ°äº‹ä»¶è¡¨</h5><p>å› æ­¤å¯é äº‹ä»¶æ¨¡å¼ä¸»è¦é€šè¿‡ <strong>æœ¬åœ°äº‹ä»¶è¡¨å’Œå¤–éƒ¨äº‹ä»¶è¡¨</strong> ä¸¤è€…æ¥å°±è¿›è¡Œå¯é äº‹ä»¶æŠ•é€’ã€‚</p>
<p>æœ¬åœ°äº‹ä»¶è¡¨é€šè¿‡å°†äº‹ä»¶å’Œä¸šåŠ¡æ•°æ®ä¿å­˜åœ¨åŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œæ¥ä»¥ä¸€ä¸ªé¢å¤–çš„ <strong>äº‹ä»¶æ¢å¤æœåŠ¡</strong> æ¥æ¢å¤äº‹ä»¶ã€‚</p>
<blockquote>
<p>åŸå­æ€§æŒ‡ä¸€ä¸ªæ“ä½œä¸å¯ä¸­æ–­ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥çš„åŸåˆ™å³ç§°ä¹‹ä¸º åŸå­æ€§ã€‚</p>
</blockquote>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210531112717.png"></p>
<p>è¿™äº›éƒ½å°†ä¼šç”±æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯æ›´æ–°ä¸šåŠ¡çš„å‘å¸ƒäº‹ä»¶ä¸­çš„ä¸å¯ä¸­æ–­ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œå³åŸå­æ€§ã€‚</p>
<h5 id="å¤–éƒ¨äº‹ä»¶è¡¨"><a href="#å¤–éƒ¨äº‹ä»¶è¡¨" class="headerlink" title="å¤–éƒ¨äº‹ä»¶è¡¨"></a>å¤–éƒ¨äº‹ä»¶è¡¨</h5><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210531112826.png"><br>å¤–éƒ¨äº‹ä»¶è¡¨æ˜¯é’ˆå¯¹æœ¬åœ°äº‹ä»¶è¡¨å‡ºç°çš„é—®é¢˜ï¼Œå•ä¸ªæå‡ºå¤–éƒ¨äº‹ä»¶è¡¨çš„æ–¹æ³•ã€‚å°† <strong>äº‹ä»¶æŒä¹…è¯åˆ°å¤–éƒ¨äº‹ä»¶ç³»ç»ŸæœåŠ¡ä¸­</strong>ï¼Œäº‹ä»¶ç³»ç»Ÿéœ€è¦æä¾›ä¸€ä¸ªå®æ—¶çš„äº‹ä»¶æœåŠ¡ä»¥ç”¨äºæ¥æ”¶ <strong>ä¸ºæœåŠ¡å‘å¸ƒçš„äº‹ä»¶</strong> ã€‚ä¸æ­¤åŒæ—¶è¿˜éœ€è¦æä¾›ä¸€ä¸ªæ¢å¤æœåŠ¡æ¥ç¡®å®šå’Œæ¢å¤äº‹ä»¶ã€‚</p>
<p>äº‹ç‰©æäº¤å‰ï¼Œä¸šåŠ¡ç³»ç»Ÿä¼šé€šè¿‡å®æ—¶äº‹ä»¶æœåŠ¡å‘ç³»ç»Ÿè¯·æ±‚å‘é€äº‹ä»¶ï¼Œäº‹ä»¶ç³»ç»Ÿ <strong>åªè®°å½•äº‹ä»¶ä½†å¹¶ä¸å‘é€</strong>ã€‚</p>
<p>ä¹‹åä¸šåŠ¡æœåŠ¡æäº¤åï¼Œé€šè¿‡å®æ—¶äº‹ä»¶æœåŠ¡å‘ &#x3D;&gt;<strong>äº‹ä»¶ç³»ç»Ÿ</strong> ç¡®è®¤å‘å¸ƒï¼Œäº‹ä»¶å¾—åˆ°ç¡®è®¤å <strong>äº‹ä»¶ç³»ç»Ÿ</strong> è¿›è¡Œå‘å¸ƒåˆ°æ¶ˆæ¯ä»£ç†ã€‚</p>
<p>å½“ä¸šåŠ¡ç³»ç»Ÿå›æ»šæ—¶ï¼Œé€šè¿‡å®æ—¶äº‹ä»¶å‘æ—¶é—´ç³»ç»Ÿ<strong>å»å–æ¶ˆ</strong>äº‹ä»¶ã€‚å‡è®¾äº‹ä»¶ç³»ç»Ÿçš„äº‹ä»¶æ¢å¤æœåŠ¡å®šæœŸæ‰¾åˆ°æœªç¡®å®šå‘é€äº‹ä»¶å‘ä¸šåŠ¡æœåŠ¡æŸ¥è¯¢çŠ¶æ€æ—¶ï¼Œæ ¹æ®ä¸šåŠ¡æœåŠ¡è¿”å›çš„çŠ¶æ€æ¥å†³å®šäº‹ä»¶æ˜¯å¦éœ€è¦å‘å¸ƒã€‚</p>
<h4 id="è¡¥å¿æ¨¡å¼ï¼ˆConfirm-Cancelï¼‰"><a href="#è¡¥å¿æ¨¡å¼ï¼ˆConfirm-Cancelï¼‰" class="headerlink" title="è¡¥å¿æ¨¡å¼ï¼ˆConfirm Cancelï¼‰"></a>è¡¥å¿æ¨¡å¼ï¼ˆConfirm Cancelï¼‰</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210601041306.png"><br>è¡¥å¿æ¨¡å¼ä¸»è¦æœ‰ <strong>ä¸šåŠ¡å¼‚å¸¸å’ŒæŠ€æœ¯å¼‚å¸¸</strong> ä¸¤ä¸ªæ¦‚å¿µï¼Œæ˜¯è‡ªèº«ä¸šåŠ¡æ‰€é€ æˆçš„ã€‚è€ŒæŠ€æœ¯å¼‚å¸¸åˆ™æ˜¯éä¸šåŠ¡é€»è¾‘äº§ç”Ÿçš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œå¦‚ç½‘ç»œå¼‚å¸¸ç­‰ã€‚</p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210601041315.png"><br>å› æ­¤è¡¥å¿æ¨¡å¼éœ€è¦ä½¿ç”¨ä¸€ä¸ª <strong>é¢å¤–çš„åè°ƒæœåŠ¡æ¥åè°ƒå¾®æœåŠ¡ä¿è¯ä¸€è‡´æ€§</strong>ï¼Œè¿™æ—¶å€™åè°ƒæœåŠ¡é€šè¿‡æŒ‰ç…§é¡ºåºè°ƒç”¨æœåŠ¡ï¼Œå¦‚æœæŸä¸ªæœåŠ¡å‡ºç°å¼‚å¸¸åˆ™ç›´æ¥å–æ¶ˆä¹‹å‰æ‰€æœ‰å·²ç»æˆåŠŸè°ƒç”¨çš„æœåŠ¡(æ‰€ä»¥ä»–ä¹Ÿå…·æœ‰åŸå­æ€§)ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´å½“æ•°æ®æ–‡ä»¶ä¸ºç©ºæ—¶æäº¤ï¼Œé‚£ä¹ˆä¹‹å‰æ‰€å¡«å†™çš„ç«¯å£ä¿¡æ¯ä»¥åŠæäº¤æ•°æ®éƒ½å°†ä¼šè¢«å–æ¶ˆï¼Œè€Œè¿™æ‰€å–æ¶ˆçš„å°±æ˜¯ä¸€ä¸ª <strong>è¡¥å¿</strong></p>
<h4 id="TCC-æ¨¡å¼ï¼ˆTry-Confirm-Cancelï¼‰"><a href="#TCC-æ¨¡å¼ï¼ˆTry-Confirm-Cancelï¼‰" class="headerlink" title="TCC æ¨¡å¼ï¼ˆTry Confirm Cancelï¼‰"></a>TCC æ¨¡å¼ï¼ˆTry Confirm Cancelï¼‰</h4><p>TCC æ¨¡å¼ç”± Tryã€Confirmã€Cancel ä¸‰ä¸ªæ¥å£ï¼Œä¸€ä¸ªå®Œæ•´çš„ TCCåº”ç”¨ç”± <strong>ä¸»ä¸šåŠ¡ã€è‹¥å¹²ä¸ªä¸šåŠ¡æœåŠ¡</strong> ç»„æˆå’Œå‘èµ·ï¼Œå¹¶æœ€åé€šè¿‡ä¸»ä¸šåŠ¡å®Œæˆæ•´ä¸ªæ´»åŠ¨ã€‚</p>
<p>TCC ä¸‰ä¸ªæ¥å£åˆ†åˆ«æ„æ€ä¸ºï¼š</p>
<ol>
<li>tryï¼šå®Œæˆæ‰€æœ‰ä¸šåŠ¡æ£€æŸ¥ï¼Œé¢„ç•™å¿…é¡»å­˜åœ¨çš„ä¸šåŠ¡èµ„æº</li>
<li>Confirmï¼šæ‰§è¡Œä¸šåŠ¡ï¼Œä¸åšä»»ä½•ä¸šåŠ¡çš„æ£€æŸ¥å’Œåˆ†æï¼Œåªæ˜¯ç”¨ try é˜¶æ®µæ‰€é¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼ŒConfirm æ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ã€‚</li>
</ol>
<blockquote>
<p>å¹‚ç­‰æ€§ï¼Œå°±æ˜¯è¯´ä¸€ä¸ªç³»ç»Ÿï¼Œåœ¨åŒæ ·æƒ…å†µä¸‹ä¸€æ¬¡è¯·æ±‚å’Œ <strong>é‡å¤</strong> å¤šæ¬¡è¯·æ±‚å¯¹èµ„æºé€ æˆä¸€è‡´çš„å°±æ˜¯å¹‚ç­‰æ€§ã€‚</p>
</blockquote>
<ol start="3">
<li>Cancel é‡Šæ”¾ try é˜¶æ®µé¢„ç•™èµ„æºï¼ˆæ»¡è¶³å¹‚ç­‰æ€§ï¼Ÿï¼‰</li>
</ol>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210601041321.png"></p>
<p>ä¸»ä¸šåŠ¡æœåŠ¡è°ƒç”¨æ‰€æœ‰çš„ä¸šåŠ¡çš„ try æ“ä½œï¼Œä¹‹ååœ¨æ´»åŠ¨ç®¡ç†å™¨ä¸­ç™»è®°æ‰€æœ‰ä¸šåŠ¡æœåŠ¡ï¼Œå½“æ‰€æœ‰ä¸šåŠ¡æœåŠ¡çš„ try æ“ä½œéƒ½è°ƒç”¨æˆå¤Ÿåæˆ–ä»æŸä¸ªä¸šåŠ¡æœåŠ¡çš„ try æ“ä½œå¤±è´¥è¿›å…¥ confirm é˜¶æ®µã€‚</p>
<p>æ´»åŠ¨ç®¡ç†å™¨æ ¹æ® try æ‰§è¡Œç»“æœæ¥æ‰§è¡Œ confirm or cencel æ“ä½œï¼Œå¦‚æœ try æ“ä½œæ‰€æœ‰éƒ½æˆåŠŸåˆ™ä»æ´»åŠ¨ç®¡ç†å™¨ä¸­è°ƒç”¨æ‰€æœ‰ confirm æ“ä½œï¼Œå¦åˆ™å°†è°ƒç”¨ cancel æ¥é‡Šæ”¾ try é¢„ç•™èµ„æºã€‚</p>
<h3 id="åˆ†å¸ƒå¼åŒæ­¥è°ƒç”¨"><a href="#åˆ†å¸ƒå¼åŒæ­¥è°ƒç”¨" class="headerlink" title="åˆ†å¸ƒå¼åŒæ­¥è°ƒç”¨"></a>åˆ†å¸ƒå¼åŒæ­¥è°ƒç”¨</h3><p>åˆ†å¸ƒå¼çš„åŒæ­¥è°ƒç”¨åŠä¸»è¦æ˜¯åœ¨ä¸ç¡®å®šç¯å¢ƒä¸­æ— æ³•ä¿è¯æ‰€ä¾èµ–æœåŠ¡ï¼Œä½†å¯ä»¥ä¿è¯è‡ªå·±å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡çš„æƒ…å†µã€‚</p>
<h4 id="SEDA"><a href="#SEDA" class="headerlink" title="SEDA"></a>SEDA</h4><p>é˜¶æ®µå¼æœåŠ¡å™¨æ¨¡å‹ï¼ˆSEDAï¼ŒStaged event-driven architencureï¼‰ä»–æ˜¯ä¸€ä¸ªè½¯ä»¶æ¶æ„æ¨¡å‹ï¼Œå¯ä»¥å°†å¤æ‚çš„äº‹ä»¶é©±åŠ¨çš„åº”ç”¨åˆ†è§£ä¸ºä¸€ç³»åˆ—é€šè¿‡é˜Ÿåˆ—é“¾æ¥çš„é˜¶æ®µï¼ˆStageï¼‰ã€‚</p>
<p>åœ¨ä¸Šè¿°ä¸­ â€œåˆ†å¸ƒå¼çš„åŒæ­¥è°ƒç”¨åŠä¸»è¦æ˜¯åœ¨ä¸ç¡®å®šç¯å¢ƒä¸­æ— æ³•ä¿è¯æ‰€ä¾èµ–æœåŠ¡ï¼Œä½†å¯ä»¥ä¿è¯è‡ªå·±å¯ä»¥æ­£å¸¸æä¾›æœåŠ¡çš„æƒ…å†µã€‚â€å°±å¯ä»¥é€šè¿‡ä½¿ç”¨ SEDA è¿›è¡Œè§£å†³ã€‚</p>
<p>æ‹¥ç”¨ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ <strong>å°†è¯·æ±‚å‡ºæ¥è¿‡ç¨‹åˆ’åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œä¸åŒèµ„æºæ¶ˆè€—é˜¶æ®µï¼Œå¹¶ä½¿ç”¨ä¸åŒæ•°é‡çš„çº¿ç¨‹è¿›è¡Œå¤„ç†</strong>ã€‚</p>
<h3 id="æ¥å£è°ƒæ•´"><a href="#æ¥å£è°ƒæ•´" class="headerlink" title="æ¥å£è°ƒæ•´"></a>æ¥å£è°ƒæ•´</h3><p>ç”±äºå¾®æœåŠ¡æ•°é‡å¯èƒ½ä¼šæœ‰å¾ˆå¤šï¼Œå› æ­¤å¦‚æœéœ€è¦è°ƒæ•´æ¥å£æ—¶åˆ™éœ€è¦è¯è´¹å¾ˆå¤§çš„æ—¶é—´ã€‚é™¤äº†è°ƒæ•´å¤–è¿˜éœ€è¦å†™å…¶æ¥å£æ–‡æ¡£ï¼Œæ¥è¿›è¡Œç®¡ç†ã€‚</p>
<p>è€Œæ¥å£æ–‡æ¡£å¯ä»¥ä»ä¸­å¿ƒç‚¹å¼•å…¥å¾ˆå¤šä¸‹æ¸¸é—®é¢˜ï¼Œå¦‚æ¥å£æ–‡æ¡£çš„ç®¡ç†å’Œæ›´æ–°ç­‰ã€‚</p>
<h1 id="Spring-cloud-å¾®æœåŠ¡è®¾è®¡åŸåˆ™"><a href="#Spring-cloud-å¾®æœåŠ¡è®¾è®¡åŸåˆ™" class="headerlink" title="Spring cloud å¾®æœåŠ¡è®¾è®¡åŸåˆ™"></a>Spring cloud å¾®æœåŠ¡è®¾è®¡åŸåˆ™</h1><h2 id="AKF-å¯æ‰©å±•æ€§åŸåˆ™"><a href="#AKF-å¯æ‰©å±•æ€§åŸåˆ™" class="headerlink" title="AKF å¯æ‰©å±•æ€§åŸåˆ™"></a>AKF å¯æ‰©å±•æ€§åŸåˆ™</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210601161731.png"><br>Spring cloud çš„å•ä¸€è®¾è®¡åŸåˆ™å¯ä»¥è®©å¾®æœåŠ¡æ›´åŠ ä¼˜é›…ã€‚åœ¨è¿™ä¸ªåŸåˆ™ä¹‹ä¸‹æ‰€å¼€å‘çš„å¾®æœåŠ¡é¡¹ç›®é€šå¸¸ <strong>åªå…³æ³¨å•ä¸€çš„åŠŸèƒ½ï¼Œæœ‰é™çš„ä¸šåŠ¡é€»è¾‘</strong> æœ€ç»ˆå®Œæˆä¸€ä¸ªæœ‰é™çš„ä¸šåŠ¡é€»è¾‘ã€‚</p>
<p>å°±æ¯”å¦‚ AKF æ‹†åˆ†åŸåˆ™å³ <strong>æ‰©å±•ç«‹æ–¹ä½“ï¼ˆScalability Cubeï¼‰æˆ– AKF Scale Cube</strong>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ AKF å¹¶ä¸æ˜¯ä»€ä¹ˆå•è¯ç¼©å†™ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¬å¸çš„åç§°ã€‚</p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210601161741.png"><br>æˆ‘ä»¬å¯ä»¥ç›´æ¥æ¦‚æ‹¬ä¸‹è¿™ä¸‰ä¸ªè½´çš„ä¸»è¦å·¦å³ï¼Œå…¶ä¸­Yè½´æ˜¯åŠŸèƒ½åˆ’åˆ†ä»¥åŠåŸºäºä¸åŒä¸šåŠ¡ä¹‹é—´çš„åˆ’åˆ†ã€‚è€Œ Xè½´åˆ™æ˜¯æ°´å¹³æ‰©å±•ï¼ŒåŒ—å…¶åæ›°æ°´å¹³å¤åˆ¶ï¼Œæ¥ç ¸é’±è§£å†³é—®é¢˜ï¼ˆåŠ æœåŠ¡å™¨ï¼‰ã€‚æœ€åå°±æ˜¯Zè½´ï¼ŒZè½´ä¸»è¦å·¦å³å°±æ˜¯æ•°æ®åŒºåˆ†ï¼Œæ¥å…³æ³¨æœåŠ¡å’Œæ•°æ®çš„ä¼˜å…ˆçº§è¿›è¡Œåˆ’åˆ†ã€‚</p>
<h3 id="Y-Axis"><a href="#Y-Axis" class="headerlink" title="Y Axis"></a>Y Axis</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210602025515.png"><br>Y è½´ä¼šä¼šæ ¹æ®åŸºäºä¸åŒä¸šåŠ¡ä¹‹é—´çš„æ•´ä½“åº”ç”¨æ‹†åˆ†ä¸ºå¤šä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡ä¸»è¦ä¼šå®ç°ä¸€ä¸ªå•ä¸ªåŠŸèƒ½ã€‚ä¹‹åä»¥ Eureka æœåŠ¡æ²»ç†ä¸ºä¾‹ï¼Œé€šè¿‡æœåŠ¡ä¸­å¿ƒæ¥è¿›è¡Œæ²»ç†ï¼Œæœ€ç»ˆæ¶æ„å¦‚ä¸Šæ‰€ç¤ºã€‚</p>
<h3 id="X-Axis"><a href="#X-Axis" class="headerlink" title="X Axis"></a>X Axis</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210602025526.png"><br>X è½´ä¸»è¦æ˜¯æ°´å¹³æ‰©å±•ï¼Œé€šè¿‡å¤åˆ¶æœåŠ¡ä¸æ•°æ®æ¥è§£å†³å¯ç”¨æ€§åŠå¾®æœåŠ¡é›†ç¾¤çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´å°†å¾®æœåŠ¡è¿è¡Œå¤šä¸ªå®ä¾‹ï¼ˆé›†ç¾¤ï¼‰ï¼Œæ¥é€šè¿‡é›†ç¾¤è´Ÿè½½å‡è¡¡çš„æ¨¡å¼æ¥æå‡æœåŠ¡æ•´ä½“çš„å¯ç”¨æ€§ã€‚</p>
<h3 id="Z-Axis"><a href="#Z-Axis" class="headerlink" title="Z Axis"></a>Z Axis</h3><p>Zè½´ä¸»è¦å°±æ˜¯åŒºåˆ†æ•°æ®ï¼Œé€šå¸¸Zè½´æ‰©å±•æœ‰ä¸¤ç§æ–¹æ¡ˆåˆ†åˆ«ä¸º <strong>å•å…ƒåŒ–æ¶æ„ä»¥åŠæ•°æ®åˆ†åŒº</strong> ä¸¤ç§ï¼Œä»¥å¤§æ•°æ®æ—¶ä»£çš„ä»Šå¤©å¯èƒ½ä¸¤è€…éƒ½ä¼šè¢«ä½¿ç”¨ï¼Œ</p>
<p><strong>å•å…ƒåŒ–æ¶æ„</strong><br><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210602025537.png"><br>å•å…ƒåŒ–æ¶æ„çš„é€‰æ‹©ä¸»è¦æ ¹æ®æœåŠ¡çš„ç±»å‹ä»¥åŠå¯¹è±¡å•å…ƒæ˜¯å¦ç¬¦åˆæ¥è¿›è¡ŒåŒºåˆ†ï¼Œå¦‚å®¢æˆ·ç«¯å¯¹æœåŠ¡ç«¯èŠ‚ç‚¹çš„é€‰æ‹©éƒ½å°†æ˜¯å•å…ƒè‡ªæˆä¸€ä½“ã€‚</p>
<p><strong>æ•°æ®åˆ†åŒº</strong><br><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210602025543.png"><br>æ•°æ®åŒºåˆ†ä¹Ÿå«åˆ†åŒºï¼ˆShardï¼‰ï¼Œä»–å…¶å®å°±æ˜¯åŒºåˆ†æ•°æ®çš„ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥æ ¹æ®å¹´é¾„ã€æ³¨å†Œæ—¶é—´æ¥åŒºåˆ†æ•°æ®ã€‚é€šå¸¸ä¼šåŒ…å«ä¸€ä¸‹å‡ ä¸ªæ•°æ®åˆ’åˆ†çš„æ–¹å¼ï¼Œè¿™ä¹Ÿæ˜¯æœ€ä¸ºå¸¸è§çš„ï¼š</p>
<ol>
<li>æ•°æ®ç±»å‹</li>
<li>æ•°æ®èŒƒå›´</li>
<li>æ•°æ®çƒ­åº¦</li>
<li>æ•°æ®åˆ†åŒº</li>
</ol>
<p>è¿™å››ç§æœ€ä¸ºå¸¸è§çš„æˆ‘ä»¬å¯ä»¥åœ¨å¾ˆå¤šå¤§å‹åº”ç”¨ä¸­çœ‹åˆ°ï¼Œå¦‚ bliblibli å¼¹å¹•ç½‘ï¼Œå› ä¸ºå’±ä»¬ä¹Ÿæ²¡æœ‰çœ‹è¿‡ä»–ä»¬çš„æºä»£ç ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥éšä¾¿ä»¥è‚‰çœ¼å¯è§çš„è§‚å¯Ÿä¸‹ï¼Œå°±ä¼šå‘ç°ä»–ä»¬åšäº†ä¸€ä¸ªéå¸¸ç»†è‡´çš„æ•°æ®åŒºåˆ†ã€‚</p>
<h2 id="æœåŠ¡è‡ªæ²»"><a href="#æœåŠ¡è‡ªæ²»" class="headerlink" title="æœåŠ¡è‡ªæ²»"></a>æœåŠ¡è‡ªæ²»</h2><p>è¯´åˆ° Spring cloudï¼Œæˆ‘ä»¬ä»ç¬¬ä¸‰èŠ‚åˆ°ç°åœ¨å°±ä¸€ç›´è¯´ä»–å¤šä¹ˆå¤šä¹ˆæœåŠ¡è‡ªæ²»ï¼Œçœ‹ä¸Šå»éå¸¸é«˜ç«¯ä¸”éš¾æ‡‚ã€‚å®é™…ä¸ŠæœåŠ¡è‡ªæ²»ç®€å•æ¥è®²å°±æ˜¯ <strong>æ¯ä¸ªå¾®æœåŠ¡éƒ½å…·æœ‰ç‹¬ç«‹æ€§è´¨ï¼ŒåŠè¿è¡Œã€å¼€å‘ã€æµ‹è¯•ã€æ„å»ºã€éƒ¨ç½²</strong> ä¸”åŒ…å«æ•°æ®åº“éƒ½å¯ç‹¬ç«‹è¿è¡Œçš„æœåŠ¡ã€‚è€Œè¿‡å¤šæˆ–ä¾èµ–å…¶ä»–å¾®æœåŠ¡ï¼Œå¹¶ä¸å…¶é«˜åº¦è§£è€¦ï¼Œé™¤æ­¤ä¹‹å¤–æˆ‘ä»¬å°†æ­¤ç§°ä¹‹ä¸º æœåŠ¡è‡ªæ²»ã€‚</p>
<p>æœåŠ¡è‡ªæ²»ä¹Ÿæ˜¯åå‰¯å…¶å®çš„å¾®æœåŠ¡è®¾è®¡åŸåˆ™ï¼Œå› ä¸ºä»–å¯ä»¥æ‰“æ¥å¾ˆå¤šçš„å¥½å¤„ï¼Œå¦‚å›¢é˜Ÿåä½œã€æŠ€æœ¯æ ˆã€åç»­è¿­ä»£ã€æŒç»­é›†æˆç­‰å¤šç§ä¼˜åŠ¿ã€‚</p>
<h2 id="è½»é‡çº§é€šä¿¡"><a href="#è½»é‡çº§é€šä¿¡" class="headerlink" title="è½»é‡çº§é€šä¿¡"></a>è½»é‡çº§é€šä¿¡</h2><p>è½»é‡çº§æ¥å£é€šä¿¡ä¸»è¦å¯¹å…¶è¦æ±‚å°±æ˜¯ä½“é‡è¾ƒè½»ï¼Œå¯ä»¥è·¨è¯­è¨€å’Œè·¨å¹³å°ä¹‹é—´çš„é€šä¿¡ï¼Œä»¥åŠå¯ä»¥ä¸å—æŠ€æœ¯é™åˆ¶ï¼Œå®ç°ä¸åŒé€šä¿¡åè®®ä¹‹é—´çš„é€šä¿¡ï¼Œå¦‚ï¼šRESTã€RPCã€AMQPã€STOMPã€MQTTç­‰ã€‚</p>
<h2 id="æ¥å£æ˜ç¡®åŸåˆ™"><a href="#æ¥å£æ˜ç¡®åŸåˆ™" class="headerlink" title="æ¥å£æ˜ç¡®åŸåˆ™"></a>æ¥å£æ˜ç¡®åŸåˆ™</h2><p>è€Œæ¥å£æ˜ç¡®åŸåˆ™ï¼Œåˆ™æ˜¯ä¸ºäº†ç¡®ä¿ä¹‹åå¾®æœåŠ¡ä¹‹é—´ä¸æ–­çš„å®Œå–„ï¼Œå¯¼è‡´å› ä¸ºæŸä¸ªæ¥å£çš„å˜åŒ–è€Œå…¶ä»–æœåŠ¡é›†ç¾¤éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œä¸ºäº†é¿å…æ­¤ç±»ä»¤äººçƒ¦æ¼çš„äº‹æƒ…å†æ¬¡å‘ç”Ÿï¼Œåˆ™éœ€è¦è®©è¿™äº›æ¥å£åœ¨è®¾è®¡å¼€å‘çš„æ—¶å€™æ›´åŠ çš„å…·æœ‰é€šç”¨æ€§ã€‚</p>
<h2 id="å®¹é”™æ€§è®¾è®¡åŸåˆ™"><a href="#å®¹é”™æ€§è®¾è®¡åŸåˆ™" class="headerlink" title="å®¹é”™æ€§è®¾è®¡åŸåˆ™"></a>å®¹é”™æ€§è®¾è®¡åŸåˆ™</h2><p>å®¹é”™æ€§è®¾è®¡åŸåˆ™ä¹Ÿè¢«ç§°ä¹‹ä¸ºå¼¹æ€§è®¾è®¡ï¼Œå³ä¾èµ–æœåŠ¡å®•æœºã€ç½‘ç»œæˆ–ç¡¬ä»¶å‡ºç°é—®é¢˜æ—¶å¯ä»¥æš‚åœä½¿ç”¨æœåŠ¡ï¼Œåˆ‡æ¢ä¸‹ä¸€ä¸ªèµ„æºï¼Œåœ¨åç»­æˆ‘ä»¬å°†ä¼šä»¥é›†ç¾¤çš„æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜ã€‚é™¤æ­¤ä¹‹å¤–ä¹Ÿæœ‰å¾ˆå¤šæˆç†Ÿå¯é çš„æ–¹æ¡ˆè¿›è¡Œé€‰æ‹©ï¼Œå¦‚ Hystrix å»¶è¿Ÿå’Œå®¹é”™åº“ã€‚</p>
<h2 id="è‡ªåŠ¨åŒ–åŸåˆ™"><a href="#è‡ªåŠ¨åŒ–åŸåˆ™" class="headerlink" title="è‡ªåŠ¨åŒ–åŸåˆ™"></a>è‡ªåŠ¨åŒ–åŸåˆ™</h2><h3 id="è‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#è‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="è‡ªåŠ¨åŒ–æµ‹è¯•"></a>è‡ªåŠ¨åŒ–æµ‹è¯•</h3><p>è‡ªåŠ¨åŒ–åŸåˆ™ä¸»è¦ä¼šåˆ†ä¸ºè‡ªåŠ¨åŒ–æµ‹è¯•ã€è‡ªåŠ¨åŒ–ç›‘æ§å’Œè‡ªåŠ¨åŒ–éƒ¨ç½²ç­‰ä¸‰ç§éå¸¸ä¸»è¦çš„è‡ªåŠ¨åŒ–æ–¹æ¡ˆã€‚å…¶ä¸­è‡ªåŠ¨åŒ–æµ‹è¯•å¯ä»¥å‡è½»æµ‹è¯•è´Ÿæ‹…ï¼Œå¯ä»¥ä¿éšœå¾®æœåŠ¡çš„æ¨¡å—åœ¨é«˜æµé‡çš„æƒ…å†µä¸‹å¯è®¿é—®ã€‚</p>
<h3 id="è‡ªåŠ¨åŒ–ç›‘æ§"><a href="#è‡ªåŠ¨åŒ–ç›‘æ§" class="headerlink" title="è‡ªåŠ¨åŒ–ç›‘æ§"></a>è‡ªåŠ¨åŒ–ç›‘æ§</h3><p>è€Œè‡ªåŠ¨åŒ–ç›‘æ§åˆ™æ˜¯ç›‘æ§å¾®æœåŠ¡çŠ¶æ€ï¼Œå‘ç°é—®é¢˜ä»¥åŠé”™è¯¯è®¡æ•°ç­‰æ¥ä¾¿äºè§£å†³å’Œå‘ç°é—®é¢˜ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ç›‘æ§çŠ¶æ€æ¥è°ƒæ•´è´Ÿè½½ï¼Œæ¥ä¿è¯æœåŠ¡çš„ç¨³å®šæ€§å’Œé«˜å¯ç”¨ç­‰ã€‚åœ¨ Spring cloud é¡¹ç›®ä¸­ï¼Œæä¾›äº†ä¸€ä¸ªä¸ºæœåŠ¡å¯ç”¨æ€§ç›‘æ§ Spring Boot Admin ç»„ä»¶ã€‚</p>
<h3 id="è‡ªåŠ¨åŒ–éƒ¨ç½²"><a href="#è‡ªåŠ¨åŒ–éƒ¨ç½²" class="headerlink" title="è‡ªåŠ¨åŒ–éƒ¨ç½²"></a>è‡ªåŠ¨åŒ–éƒ¨ç½²</h3><p>è‡ªåŠ¨åŒ–éƒ¨ç½²æŒ‡çš„æ˜¯å°†ä»£ç è‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæ¥å‡å°‘é¡¹ç›®å‘å¸ƒçš„æ—¶é—´ï¼Œç›®å‰å¯ä»¥é€šè¿‡ Jenkins + Fastlane æ¥æ­é…ä½¿ç”¨ã€‚</p>
<h1 id="Spring-cloud-ä¸šåŠ¡æ‹†åˆ†ä¸ç®¡ç†æ¨¡å¼"><a href="#Spring-cloud-ä¸šåŠ¡æ‹†åˆ†ä¸ç®¡ç†æ¨¡å¼" class="headerlink" title="Spring cloud ä¸šåŠ¡æ‹†åˆ†ä¸ç®¡ç†æ¨¡å¼"></a>Spring cloud ä¸šåŠ¡æ‹†åˆ†ä¸ç®¡ç†æ¨¡å¼</h1><h2 id="Domain-Driver-Designï¼ˆDDDï¼‰"><a href="#Domain-Driver-Designï¼ˆDDDï¼‰" class="headerlink" title="Domain Driver Designï¼ˆDDDï¼‰"></a>Domain Driver Designï¼ˆDDDï¼‰</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210603031247.png"><br>åœ¨å¾®æœåŠ¡è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šå­˜åœ¨ä¸€ç§ä¸çŸ¥é“å¦‚ä½•è¿›è¡Œåˆ’åˆ†çš„é—®é¢˜ï¼Œåˆ°åº•æ˜¯æ ¹æ®åŠŸèƒ½ã€ç»„ç»‡ç»“æ„è¿›è¡Œåˆ’åˆ†è¿˜æ˜¯å…¶ä»–æ–¹å¼ã€‚</p>
<p>è€Œä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDomain Driver Designï¼‰æä¾›äº†ä¸€ç§åˆ’åˆ†æ–¹æ³•è®ºï¼Œè¯´ç™½äº†å°±æ˜¯å¯ä»¥è§£å†³å¾®æœåŠ¡åˆ’åˆ†æ—¶é‡åˆ°çš„é—®é¢˜ã€‚</p>
<p>é¦–å…ˆï¼ŒDDD ä¸»è¦ç»“æ„ä¸ºå››å±‚ï¼Œåˆ†åˆ«ä¸º <strong>åŸºç¡€è®¾æ–½å±‚ (Infrastructure)ã€é¢†åŸŸå±‚ (Domain)ã€åº”ç”¨å±‚ (Application)ã€ç”¨æˆ·ç•Œé¢å±‚ (Interfaces)ï¼ˆä¹Ÿè¢«ç§°ä¸ºè¡¨ç¤ºå±‚ã€å±•ç°å±‚ã€æ¥å£å±‚ï¼‰</strong></p>
<h3 id="é¢†åŸŸ"><a href="#é¢†åŸŸ" class="headerlink" title="é¢†åŸŸ"></a>é¢†åŸŸ</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ DDD æ¥æŒ‡å¯¼æˆ‘ä»¬çš„åˆ’åˆ†æ–¹æ³•ï¼Œè€Œä¸æ˜¯è®©ä»–ä¸»å¯¼æˆ‘ä»¬ï¼Œä»è€Œè®©æˆ‘ä»¬æ›´åŠ å›°æƒ‘ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦çŸ¥é“ä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯ <strong>åˆ†æ¸…é—®é¢˜å’Œæ–¹æ¡ˆ</strong>ï¼Œé—®é¢˜æ˜¯éœ€è¦è§£å†³çš„ï¼Œè€Œæ–¹æ¡ˆæ˜¯ç”¨æ¥è§£å†³é—®é¢˜çš„ã€‚</p>
<p><strong>å½“è°ˆè®ºé¢†åŸŸçš„æ—¶å€™ï¼ˆå«å­åŸŸã€é€šç”¨å­åŸŸï¼‰å®é™…ä¸Šéƒ½æ˜¯åœ¨è®¨è®ºé—®é¢˜åŸŸ</strong>ï¼Œè€Œé—®é¢˜åŸŸå°±æ˜¯ <strong>æˆ‘ä»¬éœ€è¦è§£å†³ä»€ä¹ˆé—®é¢˜</strong></p>
<p>è€Œåˆ° <strong>é™ç•Œä¸Šä¸‹æ–‡ã€èšåˆã€å®ä½“ã€ä»“åº“</strong> è¿™äº›å®é™…ä¸Šæ˜¯åœ¨ <strong>è°ˆè®ºè§£å†³æ–¹æ¡ˆ</strong> æ¥è§£å†³é¢†åŸŸæ—¶æå‡ºçš„é—®é¢˜ã€‚</p>
<p>åœ¨æœç´¢é¢†åŸŸä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä»å…¶ä¸»é¡µé¢ä¸­æ¥çœ‹å‡ºé‡åˆ°çš„ä¸€äº›éå¸¸å…¸å‹çš„é—®é¢˜ï¼š</p>
<ol>
<li>å¦‚ä½•ä¿æŒçŸ¥ååº¦</li>
<li>å¦‚ä½•è®©æœç´ å˜å¾—æ›´ç²¾å‡†</li>
<li>å¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„åº¦è¿›è¡Œè¥é”€</li>
</ol>
<p>è€Œè¿™äº›é—®é¢˜çš„è§£å†³é—®é¢˜çš„æ–¹æ¡ˆå¯ä»¥æ˜¯ï¼š</p>
<ol>
<li>ä¸æµè§ˆå™¨ä¹‹é—´è¿›è¡Œç»‘å®š</li>
<li>åŠ å¤§æ•°æ®çˆ¬å–å’Œå…³é”®è¯çš„å®šä½</li>
<li>ä¸æœç´¢ç»“æœä¸­å¸ƒå±€ä¸€è‡´</li>
</ol>
<h3 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h3><p>åœ¨è®¾è®¡ä¸­ï¼Œä¸»è¦è§£å†³çš„å°±æ˜¯è®©é¢†åŸŸä¸“å®¶å’ŒæŠ€æœ¯ä¸“å®¶æ·±å…¥åˆä½œï¼Œå¹¶å»ºç«‹ä¸€ä¸ªè½¯ä»¶é—®é¢˜ææ¨¡å‹ï¼Œè€Œè¿™ä¸ªæ¨¡å‹ä¸»è¦å¯ä»¥è§£å†³ï¼š</p>
<ol>
<li>å¯ä»¥è¡¨è¾¾é¢†åŸŸæ¦‚å¿µå’Œä¸šåŠ¡æµç¨‹</li>
<li>æ¯ä¸ªé¢†åŸŸéƒ½æœ‰è‡ªå·±çš„è§£å†³æ–¹æ¡ˆ</li>
</ol>
<p>è¿™å°±æ˜¯è®¾è®¡åœ¨ DDD ä¸»è¦çš„ä½œç”¨ï¼ŒDDD æ˜¯ä¸€ç§åŸºäºé¢†åŸŸä¸ºä¸­å¿ƒæ¥é©±åŠ¨çš„è½¯ä»¶çš„å¼€å‘æ€æƒ³ï¼Œå¯ä»¥é€šè¿‡æ­¤æ¥å¸®åŠ©æˆ‘ä»¬è§£å†³å¤æ‚çš„ä¸šåŠ¡é—®é¢˜ï¼Œå› æ­¤éœ€è¦å¯¹æ¯ä¸ª <strong>é¢†åŸŸæå‡ºé—®é¢˜æ¥å¯¹åº”ä¸€ä¸ªé¢†åŸŸæ¨¡å‹ï¼Œæ¥è§£å†³é—®é¢˜</strong>ã€‚</p>
<h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p>åœ¨ DDD ä¸­ï¼Œä¸»è¦å°†æ¨¡å‹åˆ’åˆ†ä¸ºå››å±‚ï¼Œåˆ†åˆ«ä¸ºåŸºç¡€å±‚ï¼ˆInfrastructureï¼‰ã€é¢†åŸŸå±‚ï¼ˆDomainï¼‰ã€åº”ç”¨å±‚ï¼ˆApplicationï¼‰ã€ç”¨æˆ·ç•Œé¢å±‚ï¼ˆInterfacesï¼‰ï¼Œè¿™äº›è¢«ç®€ç§°ä¸º IDAIã€‚</p>
<p>é€šä¿—æ¥è®²æ¨¡å‹å°±æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆç©ºé—´ï¼Œæ˜¯ä¸€ä¸ªä¸ºäº†å‡†ç¡®å®šä¹‰éœ€è¦é—®é¢˜è€Œæ„é€ çš„ä¸€ä¸ªæŠ½è±¡æ¨¡å‹ã€‚è€Œæ¨¡å‹ä¸»è¦å¯ä»¥è§£å†³ç±»ä¼¼ä¸ä¸šåŠ¡é¢†åŸŸé—®é¢˜ï¼Œä»¥åŠåˆ†ææ»¡è¶³ç³»ç»Ÿçš„åŠŸèƒ½æ€§è¦æ±‚å³ IDAIã€‚</p>
<h3 id="ä¸“å®¶"><a href="#ä¸“å®¶" class="headerlink" title="ä¸“å®¶"></a>ä¸“å®¶</h3><p>é€šè¿‡é¢†åŸŸæå‡ºçš„é—®é¢˜æˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼Œè¿™äº›é—®é¢˜çš„æå‡ºåŸºæœ¬ä¸Šä¸æ˜¯å¼€å‘äººå‘˜éå¸¸æ“…é•¿çš„ï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦ <strong>é¢†åŸŸä¸“å®¶</strong> æ¥æå‡ºé—®é¢˜ï¼Œç”± <strong>æŠ€æœ¯ä¸“å®¶</strong> è§£å†³é—®é¢˜ï¼Œè¿™ä¹Ÿæ˜¯ DDD æˆåŠŸå®æ–½çš„ä¸»è¦æ¡ä»¶ã€‚</p>
<h2 id="äº‹åŠ¡ç®¡ç†æ¨¡å¼"><a href="#äº‹åŠ¡ç®¡ç†æ¨¡å¼" class="headerlink" title="äº‹åŠ¡ç®¡ç†æ¨¡å¼"></a>äº‹åŠ¡ç®¡ç†æ¨¡å¼</h2><p>äº‹ç‰©ç®¡ç†æ¨¡å¼ï¼ˆACIDï¼ŒAtomicity Consistency Isolation Durabilityï¼‰è¦æ¯” DDD æ›´å¥½ç†è§£ï¼Œä»–åœ¨ä¸Šä¸€ç« å°±ä»¥ä¸€å°éƒ¨åˆ†çš„å½¢å¼å‡ºç°äº†ï¼Œå½“æ—¶æˆ‘ä»¬æ‰€ä»‹ç»çš„æ˜¯åŸå­æ€§ï¼ˆAtomicityï¼‰ã€‚</p>
<p>ä¸€ä¸ªé€»è¾‘å·¥ä½œå•å…ƒéœ€è¦æˆä¸ºäº‹ç‰©ï¼Œéœ€è¦æ»¡è¶³ ACIDå±æ€§ï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<ol>
<li>Aï¼šåŸå­æ€§ï¼ˆAtomicityï¼‰ï¼Œäº‹ç‰©æ“ä½œä¸­ï¼Œè¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆéƒ½ä¸åš</li>
<li>Cï¼šä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼Œäº‹åŠ¡æ‰§è¡Œå®Œåï¼Œä»åŒæ ·çŠ¶æ€ï¼Œè½¬å‘å¦ä¸€ä¸ªåŒæ ·çš„çŠ¶æ€ï¼ˆå¯ä»¥ç†è§£ä¸ºè¦ä¹ˆæ˜¯å…¨éƒ¨æ‰§è¡Œä¸­ï¼Œè¦ä¹ˆæ˜¯å…¨éƒ¨æš‚åœä¸­ï¼‰</li>
<li>I ï¼šéš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼Œäº‹åŠ¡æ‰§è¡Œæ—¶ä¸è¢«æ‰“æ‰°</li>
<li>Dï¼šæŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼Œäº‹åŠ¡æäº¤åï¼Œå¯¹æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…æ€§çš„ã€‚</li>
</ol>
<h3 id="2-x2F-3PC"><a href="#2-x2F-3PC" class="headerlink" title="2&#x2F;3PC"></a>2&#x2F;3PC</h3><p>2&#x2F;3PC ç®—æ³•æ¨¡å¼ï¼ˆTwo &#x2F; Three Phase Commitï¼ŒäºŒ&#x2F;ä¸‰é˜¶æ®µæäº¤ï¼‰ä¸»è¦æ˜¯ä¸ºäº†è®©åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨äº‹åŠ¡å¤„ç†æ—¶ <strong>å¯ä»¥å®ç° ACIDå±æ€§</strong> æ‰€è®¾è®¡çš„ç®—æ³•ã€‚</p>
<h4 id="2PC"><a href="#2PC" class="headerlink" title="2PC"></a>2PC</h4><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥å°†ä»–çœ‹æˆä¸¤ä¸ªé˜¶æ®µï¼Œä¸€ä¸ªæ˜¯ <strong>æ¬²æäº¤</strong>ï¼Œè€Œå¦ä¸€ä¸ªåˆ™æ˜¯ <strong>æäº¤</strong> é˜¶æ®µï¼Œå…¶ä¸­ï¼š</p>
<h5 id="æ¬²æäº¤é˜¶æ®µ"><a href="#æ¬²æäº¤é˜¶æ®µ" class="headerlink" title="æ¬²æäº¤é˜¶æ®µ"></a>æ¬²æäº¤é˜¶æ®µ</h5><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210603031254.png"><br>æ¬²æäº¤é˜¶æ®µä»åå­—å°±å¯ä»¥çœ‹å‡ºä»–å¹¶ä¸æ˜¯çœŸæ­£çš„æäº¤é˜¶æ®µï¼Œè€Œæ˜¯å¤„äºå‘èµ„æºç®¡ç†å™¨è¯¢é—®æ˜¯å¦å¯ä»¥æäº¤ï¼Œè¿™å…¶ä¸­ä¸»è¦åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ol>
<li>å‘æ‰€æœ‰èµ„æºç®¡ç†å™¨å‘é€è¯¢é—®</li>
<li>èµ„æºç®¡ç†å™¨æ‰§è¡Œäº‹ç‰©æ“ä½œï¼Œå¦‚èµ„æºä¸Šé”ç­‰</li>
<li>è¿”å›ä¿¡æ¯ç»™äº‹ç‰©ç®¡ç†å™¨ï¼ˆæˆåŠŸæƒ…å†µä¸‹ï¼‰</li>
</ol>
<h5 id="æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µ"><a href="#æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µ" class="headerlink" title="æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µ"></a>æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µ</h5><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210603031315.png"><br>æ‰§è¡Œäº‹åŠ¡æäº¤é˜¶æ®µå¯ä»¥ç†è§£ä¸ºæ¬²æäº¤é˜¶æ®µåçš„ä¸€ä¸ªè¿‡ç¨‹ï¼Œä»–çš„ä¸»è¦æœ‰å››ä¸ªæµç¨‹ï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<ol>
<li>è¯·æ±‚æäº¤ï¼šäº‹åŠ¡ç®¡ç†å™¨å‘èµ„æºç®¡ç†å™¨å‘å‡ºæäº¤è¯·æ±‚</li>
<li>äº‹åŠ¡æäº¤ï¼šèµ„æºç®¡ç†å™¨æ”¶åˆ°è¯·æ±‚åï¼Œå¼€å§‹äº‹åŠ¡æäº¤æ“ä½œï¼Œå®Œæˆåé‡Šæ”¾äº‹åŠ¡èµ„æº</li>
<li>åé¦ˆç»“æœï¼šå®Œæˆäº‹åŠ¡æäº¤ä¹‹åï¼Œå‘äº‹åŠ¡ç®¡ç†å™¨å‘é€ <strong>å·²æäº¤ï¼ˆACKï¼‰</strong> æ¶ˆæ¯</li>
<li>å®Œæˆäº‹åŠ¡ï¼šäº‹åŠ¡ç®¡ç†å™¨æ”¶åˆ°äº†æ‰€æœ‰èµ„æºç®¡ç†å™¨åé¦ˆçš„ ACK åå³å®Œæˆæäº¤ã€‚</li>
</ol>
<p>å‡å¦‚å…¶ä¸­æŸä¸ªèµ„æºç®¡ç†å™¨è¿”å›äº†æœªæäº¤ï¼Œæˆ–è€…è¯´ç­‰å¾…è¶…æ—¶ï¼Œé‚£ä¹ˆå°†ä¼šä¸­æ–­äº‹åŠ¡ï¼Œå…¶æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å‘é€äº‹åŠ¡è¯·æ±‚ï¼šäº‹åŠ¡ç®¡ç†å™¨å‘èµ„æºç®¡ç†å™¨å‘é€å›æ»šè¯·æ±‚</li>
<li>äº‹åŠ¡å›æ»šï¼šèµ„æºç®¡ç†å™¨é€šè¿‡æ’¤é”€ä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡å›æ»šï¼Œé‡Šæ”¾äº‹åŠ¡èµ„æº</li>
<li>åé¦ˆäº‹åŠ¡å›æ»šç»“æœï¼šå®Œæˆäº‹åŠ¡å›æ»šåå‘é€ ACK ï¼ˆåè°ƒè€…å‘å¸ƒï¼‰æ¶ˆæ¯</li>
<li>ä¸­æ–­äº‹åŠ¡ï¼šå½“äº‹åŠ¡ç®¡ç†å™¨æ”¶åˆ°äº†æ¥è‡ªæ‰€æœ‰å‚ä¸è€…åé¦ˆçš„ ACK æ¶ˆæ¯åä¸­æ–­æœåŠ¡ã€‚</li>
</ol>
<h5 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h5><h6 id="å µå¡"><a href="#å µå¡" class="headerlink" title="å µå¡"></a>å µå¡</h6><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210603031323.png"><br>å°½ç®¡ 2PC çœ‹ä¼¼éå¸¸çš„ä¼˜ç§€ï¼Œä½†æ˜¯å¦‚æœè®¤çœŸå“ä¸€ä¸‹å°±ä¼šå‘ç°ï¼Œè¿™ä¹ˆå¤šèµ„æºç®¡ç†å™¨ï¼Œå¦‚æœåªæœ‰ä¸­æŸä¸ªèµ„æºç®¡ç†å™¨åœ¨æ‰§è¡Œäº‹ç‰©æäº¤é˜¶æ®µçš„æ—¶å€™ï¼Œè¿”å›äº† <strong>æœªæäº¤</strong>ï¼Œä¹‹åçš„æ‰€æœ‰æäº¤æ˜¯ä¸æ˜¯éƒ½éœ€è¦è¿›è¡Œç­‰å¾…è€Œæ— æ³•ç»§ç»­å®Œæˆæ“ä½œï¼Ÿ</p>
<h6 id="å•ç‚¹"><a href="#å•ç‚¹" class="headerlink" title="å•ç‚¹"></a>å•ç‚¹</h6><p>å•ç‚¹å³ä¸€æ—¦äº‹åŠ¡ç®¡ç†å™¨å‡ºç°äº†é—®é¢˜ï¼Œé‚£ä¹ˆæ•´ä¸ª 2PC çš„æäº¤å°†æ— æ³•è¿è½¬ã€‚æˆ–è€…è¯´ä¸€æ—¦åœ¨æäº¤çš„æ—¶å€™å‡ºç°äº†é—®é¢˜ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„èµ„æºç®¡ç†å™¨éƒ½ä¼šå¤„äºé”å®šçŠ¶æ€ï¼Œä»è€Œæ— æ³•ç»§ç»­æä¾›æœåŠ¡ã€‚</p>
<h4 id="3PC"><a href="#3PC" class="headerlink" title="3PC"></a>3PC</h4><p>3PC å’Œ 2PC ä¸åŒä¹‹å¤„åœ¨äºä»–æœ‰ä¸‰ä¸ªé˜¶æ®µï¼Œåˆ†åˆ«ä¸º <strong>æ¬²æäº¤ï¼ˆPreCommitï¼‰ã€å¯ä»¥æäº¤ï¼ˆCanCommitï¼‰ã€æäº¤ï¼ˆdoCommitï¼‰</strong>ã€‚åœ¨3PC ä¸­ä¸‰ä¸ªé˜¶æ®µéƒ½æœ‰ä¸€ä¸ªæ ¸å¿ƒçš„ç†å¿µï¼Œå³ <strong>è¯¢é—®æ—¶ä¸ä¼šé”å®šèµ„æºç®¡ç†å™¨ï¼Œé™¤éæ‰€æœ‰äºº Ack äº†æ‰å¼€å§‹é”</strong>ï¼Œå› æ­¤ä»–è§£å†³äº† 2PC çš„å µå¡é—®é¢˜ã€‚</p>
<p>è€Œå•ç‚¹é—®é¢˜ 3PC åˆ™é€šè¿‡å‡è®¾èµ„æºç®¡ç†å™¨æ— æ³•å³æ—¶æ¥æ”¶åˆ°æ¥è‡ªäº‹åŠ¡ç®¡ç†å™¨çš„ä¿¡æ¯ï¼Œä»–ä»¬ä¼šé»˜è®¤æ‰§è¡Œ doCommit ï¼Œè€Œä¸ä¼šä¸€ç›´å¡åœ¨é‚£é‡Œä¸åŠ¨ï¼Œæœ€ç»ˆå¯¼è‡´æ— æ³•æä¾›æœåŠ¡ã€‚</p>
<h3 id="TTY-Try-Confirm-Cancel"><a href="#TTY-Try-Confirm-Cancel" class="headerlink" title="TTY Try-Confirm-Cancel"></a>TTY Try-Confirm-Cancel</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210604031506.png"><br>TTY ä¸»è¦æœ‰ä¸‰ä¸ªæ¥å£ï¼Œåˆ†åˆ«ä¸º å°è¯•ï¼ˆTryï¼‰ã€ç¡®è®¤ï¼ˆConfirmï¼‰ã€å–æ¶ˆï¼ˆCancelï¼‰ã€‚ä¼šæ¯” 2&#x2F;3PC æ›´åŠ å¥½ç†è§£ï¼Œå› æ­¤ä»–ä¸‰ä¸ªé˜¶æ®µåŠŸèƒ½å¦‚ä¸‹ï¼š</p>
<ol>
<li>Tryï¼šæ£€æŸ¥æ‰€æœ‰ä¸šåŠ¡çš„ <strong>ä¸€è‡´æ€§</strong>ã€å¹¶é¢„ç•™ä¸šåŠ¡èµ„æºä¿è¯åœ¨äº‹åŠ¡æ‰§è¡Œæ—¶ä¸ä¼šè¢«å…¶ä»–äº‹åŠ¡æ‰“æ‰°</li>
<li>Confirmï¼šä½¿ç”¨ Try é˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºæ¥æ‰§è¡Œä¸šåŠ¡</li>
<li>Cancelï¼šå–æ¶ˆæ‰§è¡Œä¸šåŠ¡ï¼Œå¹¶é‡Šæ”¾ Try  é˜¶æ®µé¢„ç•™èµ„æº</li>
</ol>
<h3 id="æ¶ˆæ¯ä¸­é—´ä»¶æ¨¡å¼"><a href="#æ¶ˆæ¯ä¸­é—´ä»¶æ¨¡å¼" class="headerlink" title="æ¶ˆæ¯ä¸­é—´ä»¶æ¨¡å¼"></a>æ¶ˆæ¯ä¸­é—´ä»¶æ¨¡å¼</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210604031513.png"><br>é€šè¿‡å¼•å…¥æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¯ä»¥è¿›è¡Œå¼‚æ­¥å¤„ç†ã€ç³»ç»Ÿè§£è€¦ã€äº‹åŠ¡ç®¡ç†ã€‚ä»è€Œè§£å†³å¤šä¸ªç³»ç»Ÿä¹‹é—´åŒæ­¥é€šä¿¡æ‰€é€ æˆçš„é˜»å¡ï¼Œå¹¶å°†è¿™äº›è€¦åˆåœ¨ä¸€èµ·ã€‚æ¶ˆæ¯ä¸­é—´ä»¶æ¨¡å¼ä¸ TCC åŒæ ·æ˜¯æœ€ç»ˆä¸€è‡´æ€§æ¥ç®¡ç†äº‹åŠ¡ï¼Œè€Œ 2&#x2F;3PC åˆ™æ˜¯å¼ºä¸€è‡´ã€‚ </p>
<p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªè¦ç´ ï¼Œåˆ†åˆ«æ˜¯å°†æ•°æ®æ¶ˆæ¯æŠ•é€’åˆ°ä¸­é—´ä»¶æœåŠ¡å™¨ä¸­ï¼Œé€šè¿‡æ¶ˆæ¯ç¡®è®¤æœºåˆ¶ä¿è¯æˆåŠŸæŠ•é€’ã€‚ç„¶åé€šè¿‡æ¶ˆè´¹è€…å¯ä»¥æ­£å¸¸ä½¿ç”¨æ¶ˆæ¯ï¼Œæœ€åæ¥ä¿è¯ç¬¬ä¸€ä¸ªäº‹åŠ¡å…ˆæ‰§è¡Œã€‚</p>
<p>ç›®å‰ä¸–é¢ä¸Šä¸»æµçš„æ¶ˆæ¯ä¸­é—´ä»¶æœ‰ Redisã€ActiveMQã€RabbitMQã€RocketMQã€Kafkaç­‰ã€‚</p>
<h3 id="Saga-æ¨¡å¼"><a href="#Saga-æ¨¡å¼" class="headerlink" title="Saga æ¨¡å¼"></a>Saga æ¨¡å¼</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210604031520.png"><br>Sagaæ˜¯æ ¹æ® Hector å’Œ Kenneth ä¸ 1987 å¹´æ‰€å‘è¡¨çš„è®ºæ–‡ ã€Šsagasã€‹ä½œä¸ºç†è®ºåŸºç¡€è€Œå‡ºç°çš„è¡¥å¿åè®®ã€‚</p>
<p>Saga æ¨¡å¼å…¶ä¸»è¦çš„å°±æ˜¯ <strong>å°†é•¿äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªä¸”å¯äº¤é”™è¿è¡Œçš„å­äº‹åŠ¡åˆé›†</strong> è€Œè¿™äº›å­äº‹åŠ¡éƒ½ä¿æŒä¸€å®šçš„ä¸€è‡´æ€§ï¼Œéƒ½å°†ç”± saga äº‹åŠ¡åè°ƒå™¨æ¥è¿›è¡Œåè°ƒã€‚</p>
<p>å¦‚æœæ¯ä¸€ä¸ªå­äº‹åŠ¡éƒ½æ­£å¸¸ç»“æŸï¼Œåˆ™æ•´ä¸ªäº‹åŠ¡å®Œæˆã€‚å‡è®¾æœ‰æŸä¸ªå­äº‹åŠ¡å¤±è´¥ï¼Œé‚£ä¹ˆåˆ™æ•´ä¸ªäº‹åŠ¡å¤±è´¥ï¼Œå¹¶æ ¹æ®ç›¸åé¡ºåºæ¥æ‰§è¡Œè¡¥å¿æ­¥éª¤ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒSaga ç”±ä¸€ç³»åˆ—çš„ T äº‹åŠ¡ç»„æˆï¼Œæ¯ä¸ª Téƒ½å¯¹åº”ä¸€ä¸ªè¡¥å¿åŠ¨ä½œ Cï¼Œç”¨äºæ’¤é”€ T æ‰€é€ æˆçš„ç»“æœã€‚</p>
<h4 id="æ¢å¤ç­–ç•¥"><a href="#æ¢å¤ç­–ç•¥" class="headerlink" title="æ¢å¤ç­–ç•¥"></a>æ¢å¤ç­–ç•¥</h4><h5 id="å‘åæ¢å¤"><a href="#å‘åæ¢å¤" class="headerlink" title="å‘åæ¢å¤"></a>å‘åæ¢å¤</h5><p>å‘åæ¢å¤ï¼ˆbackward recoveryï¼‰ï¼Œè¡¥å¿æ‰€æœ‰å·²å®Œæˆäº‹åŠ¡ã€‚å¦‚æœæŸä¸€ä¸ªå­ä»»åŠ¡å¤±è´¥ï¼Œåˆ™ä¹‹å‰æ‰€æœ‰æˆåŠŸçš„å­äº‹ç‰©å³ <strong>æ•´ä¸ªsagaæ‰§è¡Œç»“æœæ’¤é”€</strong>ã€‚</p>
<h5 id="å‘å‰æ¢å¤"><a href="#å‘å‰æ¢å¤" class="headerlink" title="å‘å‰æ¢å¤"></a>å‘å‰æ¢å¤</h5><p>å‘å‰æ¢å¤ï¼ˆforward recoveryï¼‰ï¼Œå°†å¤±è´¥çš„äº‹åŠ¡é‡è¯•ï¼Œå‡è®¾æ‰€æœ‰å¤±è´¥çš„ä¸šåŠ¡æœ€ç»ˆéƒ½ä¼šæˆåŠŸï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹å°±æ²¡æœ‰è¡¥å¿äº‹åŠ¡ä»€ä¹ˆäº‹æƒ…äº†ï¼Œå¸¸è§ä¸å¿…é¡»æˆåŠŸçš„åœºæ™¯ã€‚â€˜</p>
<h3 id="Paxos-ä¸€è‡´æ€§ç®—æ³•"><a href="#Paxos-ä¸€è‡´æ€§ç®—æ³•" class="headerlink" title="Paxos ä¸€è‡´æ€§ç®—æ³•"></a>Paxos ä¸€è‡´æ€§ç®—æ³•</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210604031525.png"><br>Paxos ç®—æ³•ç”± Lamport æ‰€æå‡ºçš„ä¸€ç§åŸºäºæ¶ˆæ¯ä¼ é€’çš„åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•ï¼Œä¹Ÿè¢«è®¤ä¸ºæ˜¯ç±»ä¼¼ç®—æ³•ä¸­æœ€ä¸ºæœ‰æ•ˆçš„ï¼Œå› æ­¤ä½¿å…¶è·å¾—äº† 2013å¹´å›¾çµå¥–ï¼Œä»–çš„ä¸»è¦ä½œç”¨å°±æ˜¯ <strong>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å°±æŸä¸ªå€¼ï¼Œæ¥è¾¾æˆä¸€è‡´</strong>ã€‚</p>
<h4 id="è§’è‰²"><a href="#è§’è‰²" class="headerlink" title="è§’è‰²"></a>è§’è‰²</h4><p>é¦–å…ˆåœ¨ Paxos ç®—æ³•ä¸­æœ€ç»ˆè¦çš„å°±æ˜¯è§’è‰²ï¼Œéå¸¸é‡è¦ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<ol>
<li>æè®®è€…ï¼ˆProposerï¼‰</li>
<li>å†³ç­–è€…ï¼ˆAcceptor ï¼‰</li>
<li>å­¦ä¹ è€…ï¼ˆLearnerï¼‰</li>
</ol>
<h4 id="å†³ç­–"><a href="#å†³ç­–" class="headerlink" title="å†³ç­–"></a>å†³ç­–</h4><p>é¦–å…ˆï¼Œ<strong>æè®®è€…ï¼ˆProposerï¼‰</strong> æå‡ºè®®æ¡ˆï¼ˆProposalï¼‰ï¼Œä¿¡æ¯ä¸­åŒ…å«äº†æ¡ˆä»¶ç¼–å·ï¼ˆProposer idï¼‰ä»¥åŠæè®®çš„å€¼ï¼ˆValueï¼‰</p>
<p>ä¹‹å <strong>å†³ç­–è€…ï¼ˆAcceptorï¼‰</strong> å‚ä¸å†³ç­–ï¼Œå›åº” <strong>æè®®è€…ï¼ˆProposerï¼‰</strong> ææ¡ˆï¼Œå¦‚æœæ”¶åˆ°çš„ææ¡ˆï¼ˆProposalï¼‰è·å¾—å¤šæ•° <strong>æè®®è€…ï¼ˆAcceptorï¼‰</strong> çš„æ¥å—ï¼Œåˆ™è¯¥ææ¡ˆè¢«æ‰¹å‡†</p>
<p>æœ€å <strong>å­¦ä¹ è€…ï¼ˆLearnerï¼‰</strong> æ¥å­¦ä¹ ä»ä¼šè®®ä¸­è·å¾—åˆ°è¾¾æˆä¸€è‡´çš„ææ¡ˆï¼ˆvalueï¼‰ã€‚</p>
<blockquote>
<p>2F+1 æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼Œå‡è®¾è¦æ˜¯å†³ç­–è€… 5ä¸ª åŒæ„ 5ä¸ªæ‹’ç»ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæ„æˆä¼šè®®çš„å†³ç­–ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæœ‰2å€çš„ å†³ç­–è€… äººæ•°å¹¶åŠ ä¸€ï¼Œå°±å¯ä»¥ä¿è¯ä¿¡æ¯çš„æ­£ç¡®ï¼Œä½¿å¾—ä¼šè®®æ­£å¸¸è¿›è¡Œã€‚</p>
</blockquote>
<p>Paxos ç®—æ³•å…è®¸è¿è¡Œåœ¨å®•æœºæ•…éšœçš„å¼‚æ­¥ç³»ç»Ÿå†…ï¼Œä¹Ÿä¸è¦æ±‚å¯é çš„æ¶ˆæ¯ä¼ é€’ï¼Œä»–ä½¿ç”¨äº†å¤šæ•°æœºåˆ¶ä¿è¯äº† 2Fï¼ˆfaultyï¼‰+1 çš„å®¹é”™ï¼Œå³ 2Fï¼ˆfaultyï¼‰+1 ä¸ªèŠ‚ç‚¹æœ€å¤šå…è®¸ F ä¸ªèŠ‚ç‚¹å‡ºç°é—®é¢˜ã€‚</p>
<h1 id="Spring-cloud-è·¨æœåŠ¡æŸ¥è¯¢ä¸å¾®æœåŠ¡éƒ¨ç½²æ¦‚è¿°"><a href="#Spring-cloud-è·¨æœåŠ¡æŸ¥è¯¢ä¸å¾®æœåŠ¡éƒ¨ç½²æ¦‚è¿°" class="headerlink" title="Spring cloud è·¨æœåŠ¡æŸ¥è¯¢ä¸å¾®æœåŠ¡éƒ¨ç½²æ¦‚è¿°"></a>Spring cloud è·¨æœåŠ¡æŸ¥è¯¢ä¸å¾®æœåŠ¡éƒ¨ç½²æ¦‚è¿°</h1><h2 id="è·¨æœåŠ¡ä¹‹é—´æŸ¥è¯¢"><a href="#è·¨æœåŠ¡ä¹‹é—´æŸ¥è¯¢" class="headerlink" title="è·¨æœåŠ¡ä¹‹é—´æŸ¥è¯¢"></a>è·¨æœåŠ¡ä¹‹é—´æŸ¥è¯¢</h2><p>åœ¨å¾®æœåŠ¡ä¸­ï¼Œå¦‚æœéœ€è¦æœåŠ¡ä¹‹é—´ä¸æœåŠ¡ä¹‹é—´è¿›è¡Œæ•°æ®çš„æŸ¥è¯¢ï¼Œå¯ä»¥è¢«ç§°ä¹‹ä¸º â€œè·¨æœåŠ¡â€ï¼Œè€Œè¿›è¡Œè¿™ä¸ªè¿‡ç¨‹çš„æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«ä¸º API å’Œ CQRSæ¨¡å¼ä¸¤ç§ã€‚</p>
<h3 id="API-ç»„åˆå™¨æ¨¡å¼"><a href="#API-ç»„åˆå™¨æ¨¡å¼" class="headerlink" title="API  ç»„åˆå™¨æ¨¡å¼"></a>API  ç»„åˆå™¨æ¨¡å¼</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210605021404.png"><br>API ç»„åˆå™¨æ¨¡å¼ç”±ä¸¤ä¸ªæˆ–å¤šä¸ªæœåŠ¡æä¾›è€…ç»„æˆï¼ŒæœåŠ¡æä¾›è€…æ‹¥æœ‰æ•°æ®æœåŠ¡ï¼ˆå³æ•°æ®åº“ï¼‰ï¼ŒAPI ç»„åˆå™¨é€šè¿‡æŸ¥è¯¢æ¯ä¸ªæœåŠ¡æä¾›è€…çš„ API ç»“æœå¹¶ç»„åˆï¼Œæ¥å®ç°ä»å¤šä¸ªæœåŠ¡æ£€ç´¢æ•°æ®åº“çš„æŸ¥è¯¢ã€‚</p>
<h3 id="CQRS"><a href="#CQRS" class="headerlink" title="CQRS"></a>CQRS</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210605021412.png"><br>å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼ˆCQRSï¼ŒCommand Query Responsibility Segregationï¼‰ï¼Œæ˜¯ç”± Eiffel è¯­è¨€ä¹‹çˆ¶ Betrand Meyer æå‡ºçš„æ¦‚å¿µï¼Œç®€å•æ¥è®²å°±æ˜¯å°†ä¸šåŠ¡ä¸Šåˆ†ç¦»äº† <strong>è¯»ï¼ˆqueryï¼‰å’Œå†™ï¼ˆcommandï¼‰çš„è¡Œä¸º</strong>ï¼Œå°±æ¯”äººçš„ç¡å’Œé†’æ˜¯ä¸¤ç§è¡Œä¸ºã€‚</p>
<ol>
<li>å‘½ä»¤ï¼ˆCommandï¼‰ï¼Œä¸è¿”å›ä»»ä½•ç»“æœï¼ˆvoidï¼‰ï¼Œä½†ä¼šæ”¹å˜å¯¹è±¡çŠ¶æ€ï¼ŒæŒ‡å¢åŠ ã€åˆ é™¤ã€ä¿®æ”¹</li>
<li>æŸ¥è¯¢ï¼ˆQueryï¼‰ç”¨äºè¿”å›ç»“æœï¼ˆvoidï¼‰ï¼Œä¸ä¼šæ”¹å˜å¯¹è±¡çŠ¶æ€</li>
</ol>
<p>å› æ­¤ CQRS ä¸­ä¸»è¦å¼ºè°ƒ <strong>è¯»ï¼ˆQueryï¼‰å’Œå†™ï¼ˆCommandï¼‰çš„åˆ†ç¦»</strong> ï¼Œå¯èƒ½å½“æŸ¥è¯¢æ•°æ®ä¼šæœ‰ä¸€äº›é—®é¢˜ï¼Œå¦‚æ—¶é—´è¿‡æ—¶çš„æ•°æ®é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨äº‹ä»¶ï¼ˆEventï¼‰æœºåˆ¶æ¥è§£å†³é—®é¢˜å¹¶ä¿®æ”¹æŸ¥è¯¢æ•°æ®æºã€‚</p>
<h2 id="å¾®æœåŠ¡éƒ¨ç½²"><a href="#å¾®æœåŠ¡éƒ¨ç½²" class="headerlink" title="å¾®æœåŠ¡éƒ¨ç½²"></a>å¾®æœåŠ¡éƒ¨ç½²</h2><h3 id="éƒ¨ç½²æ¨¡å¼"><a href="#éƒ¨ç½²æ¨¡å¼" class="headerlink" title="éƒ¨ç½²æ¨¡å¼"></a>éƒ¨ç½²æ¨¡å¼</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210606003230.png"><br>å¾®æœåŠ¡çš„éƒ¨ç½²ä¸»è¦å¯ä»¥åˆ†ä¸ºå››ç§ï¼Œè¿™å››å‘¨éƒ¨ç½²æ¨¡å¼ä¸­ä¸»è¦é€šè¿‡ä¸‹è¿°æ–¹å¼è¿›è¡Œï¼š</p>
<ol>
<li>WARã€JAR åŒ…è¿è¡Œ</li>
<li>æœåŠ¡éƒ¨ç½²è™šæ‹Ÿæœºè¿è¡Œ</li>
<li>é€šè¿‡ Docker æˆ– Kubernetes ç­‰å®¹å™¨åŒ–æŠ€æœ¯è¿›è¡Œå¾®æœåŠ¡éƒ¨ç½²</li>
<li>Serverless æ— æœåŠ¡å™¨éƒ¨ç½²</li>
</ol>
<blockquote>
<p>æ— æœåŠ¡å™¨ï¼ˆServerlessï¼‰é€šè¿‡åº”ç”¨ <strong>ä½¿ç”¨ç¬¬ä¸‰æ–¹åŠŸèƒ½æˆ–æœåŠ¡</strong>ï¼Œä¸éœ€è¦ç®¡ç†æœåŠ¡å™¨ï¼Œä½†ä¸ä»£è¡¨ä»–ä¸éœ€è¦æœåŠ¡å™¨ï¼Œä¸»è¦åŒ…æ‹¬äº†ï¼š</p>
<p> <strong>åŠŸèƒ½å³æœåŠ¡ï¼ˆFunction as a Serviceï¼ŒFaaSï¼‰</strong> ç®€å•æ¥è®²å°±æ˜¯åŠŸèƒ½è¿è¡Œåœ¨ç‹¬ç«‹å®¹å™¨ä¸­ï¼ŒåŸºäºäº‹ä»¶é©±åŠ¨ï¼Œç”±ç¬¬ä¸‰æ–¹æ‰˜ç®¡åŠŸèƒ½ã€‚</p>
<p> <strong>åç«¯å³æœåŠ¡ï¼ˆBackend as a Serviceï¼ŒBaasï¼‰</strong> ä½¿ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡æ¥è¾¾åˆ°ç›®çš„ã€‚</p>
</blockquote>
<h3 id="å‡çº§ï¼ˆç»´æŠ¤ï¼‰æ¨¡å¼"><a href="#å‡çº§ï¼ˆç»´æŠ¤ï¼‰æ¨¡å¼" class="headerlink" title="å‡çº§ï¼ˆç»´æŠ¤ï¼‰æ¨¡å¼"></a>å‡çº§ï¼ˆç»´æŠ¤ï¼‰æ¨¡å¼</h3><h4 id="è“ç»¿éƒ¨ç½²"><a href="#è“ç»¿éƒ¨ç½²" class="headerlink" title="è“ç»¿éƒ¨ç½²"></a>è“ç»¿éƒ¨ç½²</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210606003239.png"><br>è“ç»¿éƒ¨ç½²ï¼ˆBlue-green deploymentï¼‰ï¼Œå¯ä»¥ç§°ä¹‹ä¸º <strong>å¯ä¸åœæœºç»´æŠ¤</strong>ï¼Œä¸»è¦åˆ†ä¸ºè“ï¼ˆBlueï¼‰å’Œç»¿ï¼ˆGreenï¼‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œå…¶æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>å½“æ›´æ–°æ—¶ï¼Œå°†æ‰€æœ‰è®¿é—®æµé‡åˆ†ç»™ç»¿è‰²éƒ¨åˆ†æ¥æä¾›æœåŠ¡ï¼Œä»è€Œå‡çº§è“è‰²é›†ç¾¤ã€‚</li>
<li>å½“è“è‰²é›†ç¾¤å‡çº§å®Œåï¼Œæ¥å°†ç»¿è‰²æµé‡åˆ‡æ¢åˆ°è“è‰²é›†ç¾¤ï¼Œä»è€Œå‡çº§ç»¿è‰²é›†ç¾¤</li>
<li>å‡çº§å®Œæˆåå°†è®¿é—®æµé‡åˆ†é…åˆ°å…¨éƒ¨é›†ç¾¤ä¸­</li>
</ol>
<h4 id="æ»šåŠ¨éƒ¨ç½²"><a href="#æ»šåŠ¨éƒ¨ç½²" class="headerlink" title="æ»šåŠ¨éƒ¨ç½²"></a>æ»šåŠ¨éƒ¨ç½²</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210606003246.png"><br>æ»šåŠ¨éƒ¨ç½²ï¼ˆRolling deploymentï¼‰ï¼ŒæŒ‡æ¯æ¬¡åªä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡æš‚åœã€‚è¿›è¡Œæ›´æ–°ï¼Œåå°†æ­¤æœåŠ¡ç»§ç»­æŠ•å…¥ä½¿ç”¨ï¼Œç›´åˆ°é›†ç¾¤ä¸­æ‰€æœ‰æœåŠ¡éƒ½è¢«æ›´æ–°æˆ–å®Œæˆä¸ºæ­¢ã€‚</p>
<h4 id="é‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰"><a href="#é‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰" class="headerlink" title="é‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰"></a>é‡‘ä¸é›€å‘å¸ƒï¼ˆç°åº¦å‘å¸ƒï¼‰</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210606003252.png"></p>
<blockquote>
<p>ä¸ºä»€ä¹ˆå«é‡‘ä¸é›€å‘å¸ƒï¼Ÿ<br>åœ¨ä»¥å‰çŸ¿å·¥å¼€çŸ¿çš„æ—¶å€™ï¼Œéœ€è¦åœ¨ä¸‹çŸ¿æ´å‰éœ€è¦æ£€æŸ¥ä¸‹æ–¹æ˜¯å¦æœ‰æ¯’æ°”ï¼ŒçŸ¿å·¥ä¼šæ”¾ä¸€åªé‡‘ä¸é›€è¿›å»ï¼Œæ¥å»æ¢è·¯æ˜¯å¦æœ‰æ¯’æ°”ã€‚</p>
</blockquote>
<p>é‡‘ä¸é›€å‘å¸ƒä¹Ÿå«ç°åº¦å‘å¸ƒï¼ˆCanary release &#x2F; Grayscale releaseï¼‰ï¼Œå…¶ä¸»è¦æ˜¯ä¸€éƒ¨åˆ†æ›´æ–°ï¼Œä¸€éƒ¨åˆ†ä½¿ç”¨è€ç‰ˆæœ¬ï¼Œå½“æ–°ç‰ˆæœ¬ç”¨æˆ·æ²¡ä»€ä¹ˆå»ºè®®çš„è¯ï¼Œåˆ™å…¨éƒ¨å°†è¿ç§»åˆ°æ–°ç‰ˆæœ¬ä¸­ã€‚</p>
<h1 id="Spring-cloud-äº‘åŸç”Ÿæ¦‚è¿°"><a href="#Spring-cloud-äº‘åŸç”Ÿæ¦‚è¿°" class="headerlink" title="Spring cloud äº‘åŸç”Ÿæ¦‚è¿°"></a>Spring cloud äº‘åŸç”Ÿæ¦‚è¿°</h1><p>ç›®å‰æˆ‘ä»¬æ‰€è°ˆè®ºçš„äº‘åŸç”Ÿå¤§å¤šæ•°åˆ†ä¸ºä¸¤ä¸ªï¼Œä¸€ä¸ªç”± spring å¼€å‘å…¬å¸ <strong>Pivotal</strong> æ‰€å®šä¹‰çš„ï¼Œå¦ä¸€ä¸ªåˆ™æ˜¯ç”±è°·æ­Œæ‰€ç‰µå¤´æˆç«‹çš„ <strong>äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼š</strong> ï¼ˆCNCFï¼ŒCloud Native Computing Foundationï¼‰ã€‚</p>
<p>æœ¬æ–‡æˆ‘ä»¬ä»…ç†è§£ Pivotal å…¬å¸å’Œéƒ¨åˆ† CNCF æ‰€å®šä¹‰çš„ä¸ºæœåŠ¡ï¼Œå…¶ä¸»è¦æ¦‚è¿°ä¸»è¦åˆ†ä¸ºå››ç±»ï¼Œåˆ†åˆ«ä¸ºï¼š</p>
<ol>
<li>å¾®æœåŠ¡</li>
<li>DevOps<br><del>3. CI\CDï¼ˆæŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜</del>ï¼‰</li>
<li>å®¹å™¨åŒ–</li>
</ol>
<h2 id="å¾®æœåŠ¡"><a href="#å¾®æœåŠ¡" class="headerlink" title="å¾®æœåŠ¡"></a>å¾®æœåŠ¡</h2><p>è¯»è€…å¯é€šè¿‡ä¸‹ä¸€ç¯‡æ–‡ç« æ·±åº¦å’Œå®è·µä¸­äº†è§£åˆ°å¾®æœåŠ¡åˆ°åº•å¯ä»¥åšä»€ä¹ˆï¼Œä»–çš„ä½œç”¨éƒ½ä¼šè¢«ç†è§£ï¼Œä¸»è¦æ˜ç¡®æœåŠ¡ä¹‹é—´çš„è§£è—•ï¼Œå¤šä¸ªæœåŠ¡é›†ç¾¤ã€‚</p>
<h2 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h2><p>DevOpsï¼ˆDevelopment Opertainosï¼‰ç»„åˆï¼Œå³å¼€å‘å’Œè¿ç»´ç»„åˆï¼Œå¯ä»¥å‡å°‘åº”ç”¨ç¨‹åºå‘å¸ƒçš„é£é™©ã€‚</p>
<blockquote>
<p>CI\CDï¼ˆContinuous integration \ Continuous deploymentï¼‰ï¼ŒåŠæŒç»­é›†æˆå’ŒæŒç»­äº¤ä»˜çš„æ‰€ç•¥è¯ï¼Œå…¶ä¸»è¦æ¦‚å¿µæ˜¯é€šè¿‡åº”ç”¨ç¨‹åºçš„å…±å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ä¸­å®æ–½è‡ªåŠ¨åŒ–ï¼Œåœ¨å¼€å‘å’Œè¿è¥å›¢é˜Ÿæ¶èµ·æ¡¥æ¢ï¼Œä¹Ÿæ˜¯æ„æˆ DevOps å…³é”®ä¹‹ä¸€ã€‚</p>
</blockquote>
<h2 id="å®¹å™¨åŒ–"><a href="#å®¹å™¨åŒ–" class="headerlink" title="å®¹å™¨åŒ–"></a>å®¹å™¨åŒ–</h2><p>å®¹å™¨åŒ–å³ä»¥å®¹å™¨ä¸ºåŸºç¡€ï¼Œåœ¨å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹å’Œåº”ç”¨ï¼Œå…¶ Docker æ˜¯åº”ç”¨æœ€ä¸ºå¹¿æ³›çš„å®¹å™¨å¼•æ“ã€‚é€šè¿‡å®¹å™¨å°è£…è®©è¿›ç¨‹å’Œåº”ç”¨æˆä¸ºä¸€ä¸ªç‹¬ç«‹çš„å•å…ƒï¼Œå¹¶å®ç°é™¤äº†é«˜æ°´å¹³çš„èµ„æºéš”ç¦»ï¼Œç®€åŒ–äº†ç»´æŠ¤ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ kubernetes å®¹å™¨ç¼–æ’ç³»ç»Ÿï¼Œä¸»è¦ç”¨äºå®¹å™¨ç®¡ç†å’Œå®¹å™¨ä¹‹é—´çš„è´Ÿè½½å‡è¡¡ï¼Œéƒ½æ˜¯å®ç°å®¹å™¨è¯çš„å…³é”®ã€‚</p>
<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>æœ¬æ–‡ä½¿ç”¨ <strong>1.8.0_202</strong> å’Œ Maven <strong>3.6.0</strong> è¿›è¡Œæ¼”ç¤ºå’Œæ„å»ºï¼Œè¯»è€…å¯è‡ªè¡Œè¿›è¡Œå®‰è£…å…¶ç¯å¢ƒã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦ä½¿ç”¨ <strong>Spring Assistant</strong>ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥è¿›è¡Œå®‰è£…ï¼Œåˆ†åˆ«æ˜¯ä» jetbrains å†…çš„ æ’ä»¶ç¤¾åŒºä¸­ <a target="_blank" rel="noopener" href="https://plugins.jetbrains.com/plugin/10229-spring-assistant">https://plugins.jetbrains.com/plugin/10229-spring-assistant</a> è¿›è¡Œè·å–ï¼Œä¹Ÿå¯ä» <strong>Plugins</strong> å†…ç›´æ¥è¿›è¡Œå®‰è£…ï¼Œæœç´¢ <strong>Spring Assistant</strong> ä¹‹åé‡å¯ IDEA å³å¯ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/java/spring cloud/13.Spring Cloud Alibaba Sentinel/">Spring Cloud Aliababa Sentinel</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/java/" rel="tag">java</a> <a class="article__tag-none-link" href="/tags/spring-cloud/" rel="tag">spring cloud</a>
			</span>
		
	</div>

	

	
		<p>Sentinel æ˜¯ Alibaba Spring Cloud å¾®æœåŠ¡ç»„ä»¶ä¹‹ä¸€ï¼Œä»–ä»¥ æµé‡ä¸ºåˆ‡å…¥ç‚¹ï¼Œä¸»è¦å®ç°æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§ã€ç³»ç»Ÿè´Ÿè½½ä¿æŠ¤ç­‰å¤šä¸ªç»´åº¦æ¥ä¿è¯æœåŠ¡çš„ç¨³å®šæ€§ï¼Œå› æ­¤ä»–è¿˜æä¾›äº†æœºå™¨å‘ç°ã€å¥åº·æƒ…å†µã€ç›‘æ§ã€è§„åˆ™ç®¡ç†å’Œæ¨é€ç­‰åŠŸèƒ½ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–æ§åˆ¶é¡µé¢ Sentinel Dashboardï¼Œå¯å‰å¾€ <a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/releases/tag/1.8.2">https://github.com/alibaba/Sentinel/releases/tag/1.8.2</a> è¿›è¡Œä¸‹è½½ï¼Œä¹‹åå¯ä»¥é€šè¿‡ä¸‹è¿°å‘½ä»¤å¯åŠ¨ï¼ˆSentinel Dashboard çš„å¸å·å¯†ç åŒæ ·éƒ½ä¸º <code>sentinel</code>ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo java -Dserver.port=9899 -Dcsp.sentinel.dashboard.server=localhost:9899 -Dproject.name=sentinel-dashboard -jar sentinel-dashboard-1.8.2.jar</span><br></pre></td></tr></table></figure>

<h2 id="é™æµæ¨¡å¼"><a href="#é™æµæ¨¡å¼" class="headerlink" title="é™æµæ¨¡å¼"></a>é™æµæ¨¡å¼</h2><h3 id="ç›´æ¥å¤±è´¥"><a href="#ç›´æ¥å¤±è´¥" class="headerlink" title="ç›´æ¥å¤±è´¥"></a>ç›´æ¥å¤±è´¥</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801213452.png"></p>
<blockquote>
<p>é€šè¿‡ postman è¿›è¡Œæµ‹è¯•</p>
</blockquote>
<h4 id="ç›´æ¥é™æµ"><a href="#ç›´æ¥é™æµ" class="headerlink" title="ç›´æ¥é™æµ"></a>ç›´æ¥é™æµ</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801213505.png"></p>
<p>å½“å®ä¾‹è¿è¡Œåï¼Œè¿›å…¥è¯¥å®ä¾‹ä¸­ï¼Œåœ¨æ§åˆ¶å°ä¸­çš„æµæ§è§„åˆ™ä¸­æ·»åŠ ä¸€ä¸ªæ§æµè§„åˆ™ï¼Œå¹¶è®¾ç½® QPS ä¸º 1ï¼Œå¹¶é€‰æ‹©ç›´æ¥æ§æµæ¨¡å¼ï¼Œè€Œè¿™ä¸ªè§„åˆ™æ‰€è¾¾åˆ°çš„æ•ˆæœå°±æ˜¯è®©è¶…è¿‡é˜€å€¼çš„è¯·æ±‚ç›´æ¥å¤±æ•ˆï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ æ‰€éœ€ä¾èµ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨é…ç½®ä¸­æˆ‘ä»¬ä¾ç„¶åªéœ€è¦è¿æ¥ Sentinel æ§åˆ¶å°å³å¯ï¼Œå¹¶é…ç½®é¡¹ç›®çš„åç§°ï¼Œè¿™å°†ä¼šåœ¨æ§åˆ¶å°ä¸­è¿›è¡Œæ˜¾ç¤ºçŠ¶æ€ä»¥åŠç®¡ç†ç­‰ã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">alibaba-sentinel</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:9899</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8210</span></span><br></pre></td></tr></table></figure>

<h5 id="è‡ªå®šä¹‰åŸ‹ç‚¹"><a href="#è‡ªå®šä¹‰åŸ‹ç‚¹" class="headerlink" title="è‡ªå®šä¹‰åŸ‹ç‚¹"></a>è‡ªå®šä¹‰åŸ‹ç‚¹</h5><p>æ‰€è°“ â€œåŸ‹ç‚¹â€ æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå½“ç”¨æˆ·è®¿é—®ç‰¹å®šçš„æŸä¸ªç‚¹ï¼Œä¹Ÿå°±æ˜¯ç›‘å¬è¿™ä¸ªç‚¹æ˜¯å¦è¢«ç”¨æˆ·æ‰€è®¿é—®ï¼Œåœ¨ Sentinel ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>@SentinelResource</code> ä¾èµ–ä¸­çš„åŸ‹ç‚¹ä¸ Sentinel æ§åˆ¶å°ä¸­æ‰€å¢åŠ çš„è§„åˆ™è¿›è¡Œç»‘å®šï¼Œä»è€Œå®ç°ç›´æ¥é™æµçš„æ•ˆæœ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.annotation.SentinelResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è‡ªå®šä¹‰åŸ‹ç‚¹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/8/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">heyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hey&quot;)</span></span><br><span class="line">    <span class="meta">@SentinelResource(&quot;hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Server ok!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“è¿™å®Œæˆä¹‹åï¼Œæˆ‘ä»¬åœ¨ Sentinel æ§åˆ¶å°ä¸­æ‰€å¢åŠ çš„æ§æµè§„åˆ™ QPS&#x3D;1 å½“è¶…è¿‡è¿™ä¸ªé˜€å€¼çš„æ—¶å€™ï¼Œè¯¥è¯·æ±‚ä¹Ÿä¼šå¿«é€Ÿå¤±è´¥ã€‚</p>
<h4 id="å…³è”é™æµ"><a href="#å…³è”é™æµ" class="headerlink" title="å…³è”é™æµ"></a>å…³è”é™æµ</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801213520.png"></p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801213529.png"></p>
<p>å…³è”é™æµç®€å•ç†è§£å°±æ˜¯ï¼Œå½“æˆ‘è®¿é—® <code>test/one</code> çš„ QPS&#x3D;1 çš„é˜€å€¼è¿‡äº†ä»¥åï¼Œé‚£ä¹ˆ <code>test/two</code> è¿™ä¸ªæ¥å£å°±æ— æ³•è¿›è¡Œè®¿é—®ï¼Œå› æ­¤æˆ‘ä»¬åœ¨ç›´æ¥é™æµçš„åŸºç¡€ä¸Šå¯ä»¥ä¸éœ€è¦è®¾ç½®åŸ‹ç‚¹ï¼Œç›´æ¥æ·»åŠ ä¸¤ä¸ªæ¥å£å³å¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å…³è”é™æµ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/8/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">heyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/one&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">one</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Server one ok!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/two&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">two</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Server two ok!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="é“¾è·¯é™æµ"><a href="#é“¾è·¯é™æµ" class="headerlink" title="é“¾è·¯é™æµ"></a>é“¾è·¯é™æµ</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801213543.png"></p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801213555.png"><br>é“¾è·¯è·¯ç”±ä¸»è¦çš„ä½œç”¨å°±æ˜¯ï¼Œå‡è®¾æˆ‘ä»¬çš„æ¥å£éƒ½ä½¿ç”¨ä¸€ä¸ªæ–¹æ³•æ¥å£ï¼Œé‚£ä¹ˆåœ¨ Sentinel ä¸­æ‰€å¡«å†™çš„æ§æµæ¨¡å¼çš„å…¥å£èµ„æºï¼Œå½“å…¥å£èµ„æºè¶…è¿‡ QPS é˜€å€¼æ—¶ï¼Œé‚£ä¹ˆå°†ä¼šè¢«é™æµï¼Œä½†åŒæ ·ä½¿ç”¨æ–¹æ³•æ¥å£çš„å¦ä¸€ä¸ªæ¥å£ä¸ä¼šå—æ­¤å½±å“ï¼Œä¸ºå®ç°é“¾è·¯è·¯ç”±ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ å¦‚ä¸‹ä¾èµ–å’Œå¢åŠ é…ç½®ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-sentinel&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.csp&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;sentinel-web-servlet&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>ä¹‹ååœ¨é…ç½®æ–‡ä»¶ä¸­å°†æ˜¯å¦ç»Ÿä¸€ç½‘ç»œä¸Šä¸‹æ–‡ä¸­é€‰æ‹© falseï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">alibaba-sentinel</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">sentinel:</span></span><br><span class="line">      <span class="attr">transport:</span></span><br><span class="line">        <span class="attr">dashboard:</span> <span class="string">localhost:9899</span></span><br><span class="line">      <span class="attr">web-context-unify:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8210</span></span><br></pre></td></tr></table></figure>

<h5 id="server"><a href="#server" class="headerlink" title="server"></a>server</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.server;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.csp.sentinel.annotation.SentinelResource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æœåŠ¡æ¥å£</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/8/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">sentinelServer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SentinelResource(&quot;message&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sentinelTest</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;sentinel is Test.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.demo.server.sentinelServer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é“¾è·¯é™æµ</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/8/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">heyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> sentinelServer sentinelServer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/one&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">one</span><span class="params">()</span> &#123;</span><br><span class="line">        sentinelServer.sentinelTest();</span><br><span class="line">        System.out.println(<span class="string">&quot;Server two ok!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Server one ok!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/two&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">two</span><span class="params">()</span> &#123;</span><br><span class="line">        sentinelServer.sentinelTest();</span><br><span class="line">        System.out.println(<span class="string">&quot;Server two ok!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Server two ok!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Warm-Up"><a href="#Warm-Up" class="headerlink" title="Warm Up"></a>Warm Up</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801213631.png"></p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801213637.png"></p>
<p>Warm Up é™æµçš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¸ºäº†åº”å¯¹çŒ›çƒˆçš„æµé‡è¯·æ±‚ï¼Œåˆ†æ‰¹æ¬¡çš„è¿›è¡Œå¤„ç†ï¼Œä¹‹åæ…¢æ…¢åŠ æµé‡ï¼Œè€Œä¸æ˜¯å‘ DDos ä¸€æ ·ç›´æ¥å°±æŠŠæœåŠ¡å¹²å´©æºƒäº†ã€‚åšä¸€ä¸ªå¾ˆå½¢è±¡çš„æ¯”å–»ï¼Œæˆ‘ä»¬åƒé¥­çš„æ—¶å€™éƒ½æ˜¯åš¼äº†å¥½å‡ ä¸‹æ‰å¼€å§‹å’½ä¸‹å»çš„ï¼Œè€Œä¸€äº›çŒ›äººåƒé¥­è·Ÿå–æ°´ä¸€æ ·ï¼Œæœ€ç»ˆå¯¼è‡´é£Ÿç‰©å¡åˆ°äº†å–‰å’™äº†ï¼Œè€Œè¿™ç§æƒ…å†µåœ¨é™æµä¸­ä¹ŸåŒæ ·å­˜åœ¨ï¼Œå› æ­¤ Warm Up å°±å¾ˆå¥½çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p>
<h3 id="æ’é˜Ÿé™æµ"><a href="#æ’é˜Ÿé™æµ" class="headerlink" title="æ’é˜Ÿé™æµ"></a>æ’é˜Ÿé™æµ</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801213642.png"></p>
<p>æ’é˜Ÿç­‰å¾…çš„é™æµæ¨¡å¼ä¸»è¦é€šè¿‡è¶…æ—¶æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªè¯·æ±‚çš„å¤„ç†æ—¶å¸¸ï¼Œä»¥æ­¤è®©æœåŠ¡åŒ€é€Ÿå¤„ç†è¯·æ±‚è€Œä¸æ˜¯ç›´æ¥æ‹’ç»è¯·æ±‚çš„ä½œç”¨ï¼Œåœ¨æ–°çš„æ§æµè§„åˆ™ä¸­ï¼Œæˆ‘ä»¬è®¾ç½® QPS ä¸º 4ï¼Œè€Œè¶…æ—¶æ—¶é—´ï¼ˆæ¯ä¸ªè¯·æ±‚çš„å¤„ç†æ—¶é—´ä¸º 1000msï¼‰ï¼Œä»è€Œæˆ‘ä»¬çš„æœåŠ¡æ€§èƒ½å¯ä»¥å¤„ç†ï¼Œä½†å¦‚æœè¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 100ms æ—¶ï¼Œåˆ™ä¼šå‘ç°è¢«æ‹¦æˆªçš„è¯·æ±‚å¾ˆå¤šï¼Œè¿™æ˜¯å› ä¸ºæœåŠ¡çš„å¤„ç†æ€§èƒ½è¾¾ä¸åˆ°é¢„è®¾çš„è¶…æ—¶æ—¶é—´è€Œé€ æˆçš„ã€‚</p>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/java/spring cloud/12.Spring Cloud Alibaba Nacos/">Spring Cloud Alibaba Nacos</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/java/" rel="tag">java</a> <a class="article__tag-none-link" href="/tags/spring-cloud/" rel="tag">spring cloud</a>
			</span>
		
	</div>

	

	
		<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801164139.png"><br>Spring Cloud Alibaba æ˜¯ä¸€ä¸ªéµå¾ª Spring Cloud å˜æˆè§„èŒƒçš„æ¡†æ¶ï¼Œä¹Ÿå°±æ˜¯ Alibaba æ‰€æ¨å‡ºçš„å¾®æœåŠ¡è§£å†³æ–¹æ¡ˆï¼Œä»–ä¸»è¦åˆ†ä¸º Sentinelï¼ˆæµé‡æ§åˆ¶ï¼‰ã€Nacosï¼ˆæœåŠ¡å‘ç°ï¼‰ã€RocketMQï¼ˆåˆ†å¸ƒå¼æ¶ˆæ¯ç³»ç»Ÿï¼‰ã€Dubboï¼ˆé«˜æ€§èƒ½ Java RPC æ¡†æ¶ï¼‰ã€Seataï¼ˆé«˜æ€§èƒ½å¾®æœåŠ¡äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼‰ã€ACMï¼ˆé…ç½®ä¸­ä¸­å¿ƒï¼‰ã€OSSï¼ˆå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼‰ã€SchedulerXï¼ˆåˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ï¼‰ã€SMSï¼ˆçŸ­ä¿¡æœåŠ¡ï¼‰</p>
<p>Alibaba å¯¹ä¸º Spring Cloud çš„è´¡çŒ®åŒæ ·å¯ä»¥ä¸ Netfilx ç›¸åŒçš„äº§å“éƒ½æœ‰ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆï¼Œä½†åœ¨ Spring Cloud ä¸­ Netfilx çš„è´¡çŒ®è¦æ¯” Alibaba æ—©ä¸Šè®¸å¤šï¼Œå› æ­¤é€šå¸¸ Alibaba çš„è§£å†³æ–¹æ¡ˆä¾ç„¶å¯ä»¥æ›¿æ¢æ‰ Netfilx çš„äº§å“ï¼Œä½† Netfilx åŒæ ·ä¹Ÿå¯ä»¥æ›¿æ¢æ‰ Alibaba çš„è§£å†³æ–¹æ¡ˆï¼Œä¸å…¶ç›¸æ¯”ä¹‹ä¸‹ Alibaba çš„è§£å†³æ–¹æ¡ˆæ›´åŠ çš„ç®€æ´ï¼Œé€šå¸¸ä¸€ä¸ªé¡¹ç›®å¯ä»¥ä»£æ›¿å¾ˆå¤šä¸ª Netfilx çš„å­é¡¹ç›®ã€‚</p>
<p>Nacos æ˜¯ Alibaba Spring Cloud ä¸­ç”¨äºæ„å»ºå¾®æœåŠ¡åº”ç”¨ä¸æœåŠ¡æ²»ç†çš„é…ç½®ç®¡ç†ç»„å»ºï¼Œä¸ Eurekaã€Conusl åŒæ ·åˆ†ä¸ºæœåŠ¡ä¸­å¿ƒã€æœåŠ¡æä¾›è€…ã€æœåŠ¡æ¶ˆè´¹è€…ç­‰ä¸‰ä¸ªè§’è‰²ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥ç›´æ¥å®ç°é…ç½®ä¸­å¿ƒçš„æœåŠ¡ã€‚</p>
<p>åœ¨å®ç°æœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦é€šè¿‡ Nacos ä»“åº“æ¥ä¸‹è½½å…¶å‘è¡Œç‰ˆæœ¬çš„æœåŠ¡ä¸­å¿ƒï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ç¯å¢ƒç¯å¢ƒä¾èµ–æ˜¯ï¼š</p>
<ol>
<li>64bit æ”¯æŒ Linux\Unix\Mac\Windowsï¼ˆå®˜æ–¹æ¨è Linux\Mac\Unixï¼‰</li>
<li>JDK 1.8+</li>
<li>Maven 3.2.+</li>
</ol>
<p>æ»¡è¶³ä¾èµ–ç¯å¢ƒåå¯ä»¥é€šè¿‡ <a target="_blank" rel="noopener" href="https://github.com/alibaba/nacos/releases/tag/2.0.3">https://github.com/alibaba/nacos/releases/tag/2.0.3</a> æ¥è·å–ä½ æƒ³è¦çš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½ã€‚</p>
<p>ä¹‹åè§£å‹è¿›å…¥ <code>bin</code> ç›®å½•ï¼Œå¹¶è¿è¡Œ <code>./startup.sh -m standalone</code> å‘½ä»¤ä»¥å¯åŠ¨ Nacosï¼Œå¹¶è®¿é—® <a target="_blank" rel="noopener" href="http://localhost:8848/nacos">http://localhost:8848/nacos</a> å³å¯ç™»å…¥ nacos çš„æ§åˆ¶å°ï¼Œå¸å·å¯†ç å‡ä¸º <code>nacos</code>ï¼Œå› æ­¤æœåŠ¡ä¸­å¿ƒçš„åœ°å€ä¸º <code>localhost:8848</code></p>
<h2 id="æœåŠ¡æ²»ç†"><a href="#æœåŠ¡æ²»ç†" class="headerlink" title="æœåŠ¡æ²»ç†"></a>æœåŠ¡æ²»ç†</h2><h3 id="æœåŠ¡æä¾›è€…"><a href="#æœåŠ¡æä¾›è€…" class="headerlink" title="æœåŠ¡æä¾›è€…"></a>æœåŠ¡æä¾›è€…</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801164149.png"><br>æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸¤ä¸ªæœåŠ¡æä¾›è€…ï¼Œå¹¶è¿æ¥æœåŠ¡ä¸­å¿ƒï¼Œä¹‹åè¿›è¡Œé…ç½®ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦å¼•å…¥ spring-boot-starter-webã€spring-cloud-starter-alibaba-nacos-discovery ä¾èµ–ä»¥ä½œä¸ºå¿…è¦çš„æœåŠ¡æ”¯æ’‘ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>åŒæ ·çš„æˆ‘ä»¬éœ€è¦è¿›è¡Œé…ç½®è¿æ¥æœåŠ¡ä¸­å¿ƒä»¥åŠåç§°ç­‰ï¼Œä»¥ä¾¿åœ¨å¾®æœåŠ¡ç³»ç»Ÿä¸­å‘ç°è¯¥åŠŸèƒ½æ˜¯é‚£ä¸ªæœåŠ¡æ‰€æä¾›çš„ï¼Œå› æ­¤å¥½è¿›è¡Œæ”¹è¿›å’Œè°ƒæ•´ï¼Œé…ç½®åæˆ‘ä»¬è¿˜éœ€è¦åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ  <code>@EnableDiscoveryClient</code> ä¾èµ–</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">localhost-provider</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">discovery:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="string">localhost:8848</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8210</span></span><br></pre></td></tr></table></figure>

<h4 id="heyController"><a href="#heyController" class="headerlink" title="heyController"></a>heyController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æä¾›è€…æ§åˆ¶å™¨</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/8/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">heyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.application.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sty</span> <span class="operator">=</span> <span class="string">&quot;This is Provider: &quot;</span> + appName + <span class="string">&quot;-1&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> sty;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šæ‰€è¿°æˆ‘ä»¬çš„æœåŠ¡æä¾›è€…æ‰€æä¾›çš„åŸºç¡€æœåŠ¡å·²ç»æ„å»ºå®Œæˆï¼Œåœ¨æ¼”ç¤ºä¸­æˆ‘ä»¬æ„å»ºçš„æ˜¯ä¸¤ä¸ªæœåŠ¡æä¾›è€…ï¼Œéƒ½æä¾›åŒæ ·çš„åŠŸèƒ½ï¼Œç«¯å£ä¸º <code>8210ï½8211</code> ï¼Œä¸ºä¸¤ä¸ªæœåŠ¡æä¾›è€…ï¼Œä¹‹åæˆ‘ä»¬å¯ä»¥ç¼–å†™æœåŠ¡æ¶ˆè´¹è€…ã€‚</p>
<h3 id="æœåŠ¡æ¶ˆè´¹è€…"><a href="#æœåŠ¡æ¶ˆè´¹è€…" class="headerlink" title="æœåŠ¡æ¶ˆè´¹è€…"></a>æœåŠ¡æ¶ˆè´¹è€…</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801164200.gif"></p>
<p>è‡³äºæœåŠ¡æ¶ˆè´¹è€…ï¼Œæˆ‘ä»¬åŒæ ·çš„éœ€è¦å¼•å…¥ <code>spring-cloud-starter-alibaba-nacos-discovery</code> ä¾èµ–ä»¥åŠè´Ÿè½½å‡è¡¡ feign ä¾èµ–ï¼Œå’Œä¸€äº›åŸºç¡€æœåŠ¡æä¾›ä¾èµ–ï¼Œæ¥å®ŒæˆæœåŠ¡æ¶ˆè´¹è€…çš„æ„å»ºï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬éœ€è¦åœ¨å¯åŠ¨ç±»ä¸­æ·»åŠ  <code>@EnableDiscoveryClient</code> æ³¨è§£å¹¶å®Œå–„é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶çš„ä¸»è¦ä½œç”¨åŒæ ·æ˜¯é…ç½®æœåŠ¡åç§°ä»¥åŠè¿æ¥æœåŠ¡ä¸­å¿ƒç­‰ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">localhost-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8310</span></span><br></pre></td></tr></table></figure>

<h4 id="heyController-1"><a href="#heyController-1" class="headerlink" title="heyController"></a>heyController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.ServiceInstance;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.discovery.EnableDiscoveryClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.client.loadbalancer.LoadBalancerClient;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableDiscoveryClient</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">heyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> LoadBalancerClient loadBalancerClient;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RestTemplate <span class="title function_">restTemplate</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.application.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">echoApplication</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ServiceInstance</span> <span class="variable">serviceInstance</span> <span class="operator">=</span> loadBalancerClient.choose(<span class="string">&quot;localhost-provider&quot;</span>);</span><br><span class="line">        <span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> serviceInstance.getUri();</span><br><span class="line">        <span class="type">String</span> <span class="variable">callService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>().getForObject(uri + <span class="string">&quot;/hey&quot;</span>, String.class);</span><br><span class="line">        <span class="keyword">return</span> callService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="é…ç½®ä¸­å¿ƒ"><a href="#é…ç½®ä¸­å¿ƒ" class="headerlink" title="é…ç½®ä¸­å¿ƒ"></a>é…ç½®ä¸­å¿ƒ</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801164206.png"></p>
<p>ç›¸å¯¹ä¸ä¹‹å‰çš„ Spring Cloud Config ï¼ŒAlibaba æ‰€æä¾›çš„ Spring Cloud Aliababa Config ä¸»è¦ä¾èµ–äºæœåŠ¡ä¸­å¿ƒçš„åˆ†å‘ä¸é…ç½®ï¼ŒåŒæ—¶è¿˜æ”¯æŒé…ç½®åŠ¨æ€åˆ·æ–°ï¼Œä»¥åŠè¾¾åˆ°å’Œ Spring Cloud Config ç›¸åŒæ•ˆæœçš„é…ç½®æ–‡ä»¶åº”ç”¨ï¼Œåªéœ€è¦ä¾èµ– <code>spring-cloud-starter-alibaba-nacos-config</code> å³å¯ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬è¿˜éœ€è¦åœ¨å¯åŠ¨ç±»ä¸­åŠ å…¥ <code>@EnableDiscoveryClient</code> ä¾èµ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ä¸­å¿ƒä¸­æ–°å»ºä¸€ä¸ª <code>.properties</code> ç±»å‹çš„æ–‡ä»¶ï¼Œå½“ç„¶ä»–é»˜è®¤æ”¯æŒäº† TEXTã€JSONã€XMLã€YAMLã€HTMLã€Properties ç­‰é…ç½®æ ¼å¼ï¼Œæˆ‘ä»¬åªéœ€è¦å¡«å†™é…ç½®ä¿¡æ¯å’Œ <code>Data ID</code> å³å¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.version=rsa</span><br><span class="line">message=Spring Cloud Alibaba Config Server</span><br><span class="line">server.port=9510</span><br></pre></td></tr></table></figure>

<h3 id="bootstrap-yml-amp-application-yml"><a href="#bootstrap-yml-amp-application-yml" class="headerlink" title="bootstrap.yml &amp; application.yml"></a>bootstrap.yml &amp; application.yml</h3><h4 id="bootstrap-yml"><a href="#bootstrap-yml" class="headerlink" title="bootstrap.yml"></a>bootstrap.yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">refreshable-dataids:</span> <span class="string">server-config-example.properties</span></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬é€šè¿‡ <code>refreshable-dataids</code> æ¥ç»‘å®šé…ç½®æ–‡ä»¶çš„åç§°ï¼Œä¹‹åé€šè¿‡æœåŠ¡ä¸­å¿ƒè¿›è¡Œè·å–ï¼Œå› ä¸ºæ˜¯ä»æœåŠ¡ä¸­å¿ƒç›´æ¥è·å–ï¼Œä»è€Œçœå»äº†å¾ˆå¤šé…ç½®ã€‚</p>
<h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">localhost-consumer</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8410</span></span><br></pre></td></tr></table></figure>

<h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210801164216.png"><br>æ§åˆ¶å™¨ä¸»è¦ä½œç”¨å°±æ˜¯é€šè¿‡æœåŠ¡ä¸­å¿ƒä»¥åŠé…ç½®æ‰€ç»‘å®šçš„æ–‡ä»¶ï¼Œæ¥è·å–åˆ°æœåŠ¡ä¸­å¿ƒçš„é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œå¹¶é€šè¿‡æŒ‡å®šæ¥å£æ¥è¿›è¡Œè¾“å‡ºï¼Œå½“ä¸€åˆ‡å¼€å§‹è¿è¡Œåè®¿é—® <a target="_blank" rel="noopener" href="http://localhost:9510/hey">http://localhost:9510/hey</a> å³å¯çœ‹åˆ°ä»æœåŠ¡ä¸­å¿ƒå’Œæ§åˆ¶å™¨æ‰€è¾“å‡ºçš„ä¿¡æ¯ã€‚</p>
<h4 id="ServerConfigController-java"><a href="#ServerConfigController-java" class="headerlink" title="ServerConfigController.java"></a>ServerConfigController.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cloud.context.config.annotation.RefreshScope;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  è·å–æœåŠ¡ä¸­å¿ƒé…ç½®æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/8/1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RefreshScope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServerConfigConortller</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.version&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String appVersion;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;application: &quot;</span> + appVersion + <span class="string">&quot; message: &quot;</span> + message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/java/spring cloud/11.Spring cloud Config/">Spring cloud Config</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/java/" rel="tag">java</a> <a class="article__tag-none-link" href="/tags/spring-cloud/" rel="tag">spring cloud</a>
			</span>
		
	</div>

	

	
		<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210726153838.png"><br>Spring Cloud Config å¯ä»¥ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¤–éƒ¨åŒ–é…ç½®æä¾›æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„æ”¯æŒï¼Œé€šè¿‡ Config Service å³é…ç½®ä¸­å¿ƒï¼Œå¯ä»¥é›†ä¸­ç®¡ç†æ‰€æœ‰ç¯å¢ƒä¸­åº”ç”¨ç¨‹åºé…ç½®ï¼Œè¿™å…¶ä¸­ä¸»è¦ç”¨äºé›†ä¸­ç®¡ç†ä¿¡æ¯çš„ç»„ä»¶ï¼Œç”¨äºæä¾›é…ç½®å˜æ›´ã€é…ç½®æ¨é€ã€å†å²ç‰ˆæœ¬ç®¡ç†ä»¥åŠç°åº¦å‘å¸ƒã€é…ç½®å˜æ›´å®¡è®¡ç­‰ä¸»è¦çš„åŠŸèƒ½ï¼Œä»¥æ­¤æ¥é™ä½åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ‰€ç®¡ç†å’Œé…ç½®ä¿¡æ¯çš„æˆæœ¬ã€‚</p>
<p>å…¶å® Spring Cloud Config è¯´ç®€å•ä¸€ç‚¹å°±æ˜¯é€šè¿‡æœ¬åœ°ï¼ˆå« Git&#x2F;è¿œç¨‹ä»£ç ä»“åº“ï¼‰æ¥è·å–é…ç½®ä¿¡æ¯ï¼Œç„¶åæœåŠ¡æä¾›è€…Aã€Bâ€¦â€¦ ä»é…ç½®ä¸­å¿ƒè·å–æœåŠ¡ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ª <code>Spring Cloud Bus</code> å³æ¶ˆæ¯æ€»çº¿ï¼Œç”¨äºé€šçŸ¥æœåŠ¡æä¾›è€…éœ€è¦è·å–é…ç½®ã€‚</p>
<p>ç›®å‰ä¸»æµçš„é…ç½®ä¸­å¿ƒæœ‰ Spring Cloud Configã€Apolloã€Nacosã€Disconf ç­‰é¡¹ç›®ï¼Œå…¶ä¸­ Spring Cloud Config ä¸ Disconf æ˜¯è¿™äº›é¡¹ç›®ä¸­æœ€æ—©å¼€æºçš„é¡¹ç›®ã€‚</p>
<p>ä½†è¿™äº›é¡¹ç›®ä¸­ï¼ŒSpring Cloud Config ä»–çš„åŠŸèƒ½å…¨é¢ï¼Œä»¥åŠæ— ç¼è´´åˆ Spring ä½“ç³»ï¼Œå› æ­¤å¤§å—æ¬¢è¿ã€‚</p>
<h2 id="Config-Server"><a href="#Config-Server" class="headerlink" title="Config Server"></a>Config Server</h2><h3 id="localhost"><a href="#localhost" class="headerlink" title="localhost"></a>localhost</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210726153948.png"><br>ç›®å‰ä¸»è¦ä¸”æµè¡Œçš„æ–¹å¼å°±æ˜¯é€šè¿‡ git ä»“åº“æ¥è·å–å¤šä¸ªæˆ–å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œå¹¶é€šè¿‡å¯¹ç§°&#x2F;éå¯¹ç§°åŠ å¯†æ¥å¯¹å¯†æ–‡è½¬ä¸ºæ˜æ–‡ï¼Œè¿™éƒ½çš„æ˜“äº Spring Cloud Config çš„ç‰¹æ€§ï¼Œå¦‚æœåªæ»¡è¶³ç®€å•çš„è·å–é…ç½®æ–‡ä»¶åªéœ€è¦æ·»åŠ  <code>spring-cloud-config-server</code> ä¾èµ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>ä¹‹ååœ¨å…¶å¯åŠ¨ç±»ä¸­åŠ å…¥æ³¨è§£ <code>@EnableConfigServer</code>ï¼Œå¹¶é€šè¿‡ <code>application.yml</code> å…¨å±€ Spring é…ç½®ä¸­è®¾ç½®ä»“åº“åœ°å€å’Œå¸å·å¯†ç </p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-server</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://gitee.com/sif_one/spring-cloud-config</span></span><br><span class="line">          <span class="attr">search-paths:</span> <span class="string">config-repositories</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">xxx</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">xxx</span></span><br><span class="line">        <span class="attr">encrypt:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment"># æ˜¯å¦è¿›è¡Œè§£å¯†</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8210</span></span><br></pre></td></tr></table></figure>


<h3 id="git"><a href="#git" class="headerlink" title="git"></a>git</h3><p>å¯¹äº git ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ <code>-</code> åœ¨è®¿é—®æ—¶ä¼šè¢« <code>/</code> æ‰€ä»£æ›¿ï¼Œå¦‚ä½ çš„é…ç½®æ–‡ä»¶åä¸º <code>config-dev.properties</code>ï¼Œé‚£ä¹ˆæ‰€è¯·æ±‚çš„ URI å°±ä¸º <a target="_blank" rel="noopener" href="http://localhost:8210/config/dev">http://localhost:8210/config/dev</a>ï¼Œå½“ç„¶è¿™æ˜¯ json æ ¼å¼çš„ï¼Œå¦‚æœæƒ³ä»¥å¸¸ç”¨çš„æ ¼å¼è¿›è¡Œè¿”å›ï¼Œå¯å°† URI æ”¹ä¸ºå…¶é…ç½®æ–‡ä»¶å <a target="_blank" rel="noopener" href="http://localhost:8210/config-dev.properties">http://localhost:8210/config-dev.properties</a> å³å¯ã€‚</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app.version</span>=<span class="string">dev</span></span><br><span class="line"><span class="attr">message</span>=<span class="string">Spring Cloud Config Demo</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">&#123;cipher&#125;32fd20f46a9c00238236ff530349eefb1dbaad99374c62276f266c326fa8e1ec</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8017</span></span><br></pre></td></tr></table></figure>

<h2 id="Config-Server-Client"><a href="#Config-Server-Client" class="headerlink" title="Config Server Client"></a>Config Server Client</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210729211317.png"><br>Spring cloud config client  çš„ä¸»è¦ä½œç”¨å°±æ˜¯é€šè¿‡é…ç½®ä¸­å¿ƒæ¥è·å–é…ç½®å¹¶ä½¿ç”¨ï¼Œä¸»è¦é€šè¿‡ <code>spring-cloud-starter-config</code> ä¾èµ–æ¥è¿›è¡Œå®ç°ï¼Œå¹¶é€šè¿‡ <code>bootstrap.yml</code> æ–‡ä»¶æ¥è¾¾åˆ°é…ç½®æ–‡ä»¶åˆ‡æ¢çš„æ•ˆæœï¼Œæœ€ååœ¨ä½¿ç”¨æ§åˆ¶å™¨è¿›è¡Œè¾“å‡ºï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-config&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="bootstrap-yml-and-application-yml"><a href="#bootstrap-yml-and-application-yml" class="headerlink" title="bootstrap.yml and application.yml"></a>bootstrap.yml and application.yml</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">rsa</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://localhost:8210</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ bootstrap.yml æ–‡ä»¶ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ <code>profile</code> æ¥åˆ‡æ¢é…ç½®æ–‡ä»¶çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ <code>name(config)</code> å’Œ <code>profile(rsa)</code>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬é…ç½®æ–‡ä»¶ <code>config-rsa</code> æ‹¼åˆè€Œæˆã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨ <code>application.yml</code> Spring å…¨å±€é…ç½®æ–‡ä»¶ä¸­æ¥ä¸ºå…¶æ·»åŠ åº”ç”¨åç§°ï¼Œæ¯•ç«Ÿä»–æ‰æ˜¯æƒé‡ç¬¬ä¸€çš„é…ç½®æ–‡ä»¶ã€‚</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">SpringCloudConfigClient</span></span><br></pre></td></tr></table></figure>

<h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demo.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–é…ç½®ä¸­å¿ƒçš„æ•°æ®</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> kunlun</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/7/26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">heyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.version&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String version;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;message&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hey&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> <span class="string">&quot;message:&quot;</span> + message + <span class="string">&quot;:&quot;</span> + <span class="string">&quot; version:&quot;</span> + version;</span><br><span class="line">        <span class="keyword">return</span> string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="é…ç½®æ–‡ä»¶çš„åŠ å¯†"><a href="#é…ç½®æ–‡ä»¶çš„åŠ å¯†" class="headerlink" title="é…ç½®æ–‡ä»¶çš„åŠ å¯†"></a>é…ç½®æ–‡ä»¶çš„åŠ å¯†</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210726153913.png"></p>
<h3 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210726154017.png"></p>
<p>Config Server é™¤äº†ç®¡ç†é…ç½®æ–‡ä»¶å’Œç‰ˆæœ¬ç®¡ç†ä¹‹å¤–ï¼Œè¿˜æ”¯æŒå¯¹æ–‡ä»¶çš„å¯¹ç§°å’Œéå¯¹ç§°åŠ å¯†ï¼Œå…¶ä¸­å¯¹ç§°åŠ å¯†ç®€å•çš„æ¥å°†å°±æ˜¯é‡‡ç”¨å•ä¸ªå¯†é’¥çš„æ–¹å¼è¿›è¡ŒåŠ å¯†ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªå¯†é’¥å¯ä»¥åŠ å¯†å’Œè§£å¯†ã€‚</p>
<p>è€Œéå¯¹ç§°åŠ å¯†å°±ä¸å¯¹ç§°åŠ å¯†ä¸åŒäº†ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•åˆ†ä¸ºå…¬é’¥å’Œç§é’¥ï¼Œå¦‚æœç”¨å…¬é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œé‚£ä¹ˆåªèƒ½é€šè¿‡ç§é’¥æ‰å¯è§£å¯†ã€‚ç›®å‰æœ‰å¾ˆå¤šæ–‡ç« è¯´éœ€è¦ä½¿ç”¨æ–°ç‰ˆæœ¬çš„ JDK æˆ–è€…é€šè¿‡ JCE æ¥è¿›è¡Œè§£å†³ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯è§£å†³æ–¹æ³•ä¹‹ä¸€ï¼Œåœ¨æ–°ç‰ˆçš„ Spring ä¸­ï¼Œéœ€è¦å¼•å…¥é™¤ <code>spring-cloud-config-server</code> ä¹‹å¤–çš„æ–°ä¾èµ–ï¼Œå³ <code>spring-cloud-starter-bootstrap</code> ä¾èµ–ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>æ­¤æ—¶ <code>spring-cloud-starter-bootstrap</code> ä¼šæä¾›ä¸‰ä¸ªç«¯å£ï¼Œåˆ†åˆ«ç”¨äºåŠ å¯†ã€è§£å¯†ã€æ£€æŸ¥ç­‰æ–¹å¼è¿›è¡Œå¯¹ç§°åŠ å¯†çš„æ“ä½œï¼š</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Name</th>
<th>Info</th>
<th>Uri</th>
<th>Method</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>&#x2F;encrypt&#x2F;status</td>
<td>æ£€æŸ¥åŠ å¯†å¯†é’¥æ˜¯å¦è®¾ç½®æˆåŠŸ</td>
<td><a target="_blank" rel="noopener" href="http://localhost:8210/encrypt/status">http://localhost:8210/encrypt/status</a></td>
<td>GET</td>
</tr>
<tr>
<td>2</td>
<td>&#x2F;encrypt</td>
<td>åŠ å¯†å†…å®¹</td>
<td><a target="_blank" rel="noopener" href="http://localhost:8210/encrypt">http://localhost:8210/encrypt</a></td>
<td>POST</td>
</tr>
<tr>
<td>3</td>
<td>&#x2F;decrypt</td>
<td>è§£å¯†å†…å®¹</td>
<td><a target="_blank" rel="noopener" href="http://localhost:8210/decrypt">http://localhost:8210/decrypt</a></td>
<td>POST</td>
</tr>
</tbody></table>
<p>åœ¨åŸæœ‰çš„ Spring Cloud Config åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦æ–°å»ºä¸€ä¸ª <code>bootstrap.properties</code> æ–‡ä»¶å¹¶å†™å…¥å¯†é’¥ï¼Œè¿™ä¸»è¦çš„ä½œç”¨å°±æ˜¯ï¼Œä½ è¯·æ±‚è¿™ä¸ªæ¥å£æ˜¾ç¤ºçš„æ˜¯æ˜æ–‡ï¼Œè€Œæ²¡æœ‰å¯†é’¥çš„å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚è¿”å›çš„åˆ™æ˜¯å¯†æ–‡ã€‚</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">encrypt.key</span>=<span class="string">hey</span></span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ä½ å¦‚æœæœ‰ä¸è‰¯ç™–å¥½å–œæ¬¢å¯†æ–‡çš„è¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ <code>encrypt</code> æ¥åœæ­¢ Spring cloud config çš„ç›´æ¥ç¿»è¯‘ï¼Œè¿™æ—¶è¿”å›çš„åˆ™æ˜¯å¯†æ–‡ä¿¡æ¯ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">encrypt:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment"># æ˜¯å¦è¿›è¡Œè§£å¯†</span></span><br></pre></td></tr></table></figure>

<h3 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210726154028.png"><br>è‡³äºéå¯¹ç§°åŠ å¯†åˆ™éœ€è¦é€šè¿‡ <code>keytools </code> æ¥æ–°å»ºä¸€ä¸ªå¯†é’¥ï¼Œä¹‹åç”Ÿæˆä¸€ä¸ªå¯†é’¥ç§»åŠ¨åˆ° <code>resourcs</code> ç›®å½•ä¸‹ï¼Œå¹¶åœ¨ bootstrap å…¨å±€é…ç½®æ–‡ä»¶ <code>bbootstrap.applicatiyon</code> ä¸‹å¡«å†™ç›¸å…³çš„é…ç½®ä¿¡æ¯å³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keytool -genkeypair -alias &quot;spring-cloud-config&quot; -keypass &quot;keypass&quot; -keyalg &quot;RSA&quot; -storepass &quot;stropess&quot; -keystore &quot;spring-cloud-config.jks&quot;</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ä¸Šè¿°å‘½ä»¤æœ€ä¸ºå…³é”®çš„éƒ¨åˆ†åˆ™æ˜¯ <code>aliasï¼ˆåˆ«åï¼‰</code> ã€<code>keypassï¼ˆå¯†é’¥å£ä»¤ï¼‰</code>ã€<code>storepassï¼ˆå¯†é’¥åº“å£ä»¤ï¼‰</code> è¿™ä¸‰ç±»ä¸»è¦é…ç½®ï¼Œå°†ä¼šåœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œä½¿ç”¨ä»¥éªŒè¯èº«ä»½ï¼Œè€Œ <code>-keylag</code> åˆ™ä¸»è¦è¡¨ç¤ºå¯†é’¥çš„ç±»å‹ä¸º RSA åŠ å¯†ç®—æ³•ã€‚</p>
<blockquote>
<p>RSAæ˜¯ç”±ç½—çº³å¾·Â·æç»´æ–¯ç‰¹ï¼ˆRon Rivestï¼‰ã€é˜¿è¿ªÂ·è¨è«å°”ï¼ˆAdi Shamirï¼‰å’Œä¼¦çº³å¾·Â·é˜¿å¾·æ›¼ï¼ˆLeonard Adlemanï¼‰åœ¨1977å¹´ä¸€èµ·æå‡ºçš„ï¼Œå½“æ—¶ä»–ä»¬ä¸‰äººéƒ½åœ¨éº»çœç†å·¥å­¦é™¢å·¥ä½œï¼ŒRSA å°±æ˜¯ä»–ä»¬ä¸‰äººå§“æ°å¼€å¤´å­—æ¯æ‹¼åœ¨ä¸€èµ·ç»„æˆçš„ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># å¯†é’¥ä½ç½®</span><br><span class="line">encrypt.key-store.location=classpath:/spring-cloud-config.jks</span><br><span class="line"># å¯†é’¥åˆ«å</span><br><span class="line">encrypt.key-store.alias=spring-cloud-config</span><br><span class="line"># å¯†é’¥åº“å¯†ç </span><br><span class="line">encrypt.key-store.secret=</span><br><span class="line"># å¯†é’¥å¯†ç </span><br><span class="line">encrypt.key-store.password=</span><br></pre></td></tr></table></figure>

<p>ä¸å¯¹ç§°åŠ å¯†ä¸€æ ·ï¼Œå¯ä»¥é€šè¿‡ä¹‹å‰çš„ä¸‰ä¸ªç«¯ç‚¹æ¥è¿›è¡ŒåŠ å¯†ã€è§£å¯†ã€çŠ¶æ€æ£€æŸ¥ç­‰æœåŠ¡ï¼š</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Name</th>
<th>Info</th>
<th>Uri</th>
<th>Method</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>&#x2F;encrypt&#x2F;status</td>
<td>æ£€æŸ¥åŠ å¯†å¯†é’¥æ˜¯å¦è®¾ç½®æˆåŠŸ</td>
<td><a target="_blank" rel="noopener" href="http://localhost:8210/encrypt/status">http://localhost:8210/encrypt/status</a></td>
<td>GET</td>
</tr>
<tr>
<td>2</td>
<td>&#x2F;encrypt</td>
<td>åŠ å¯†å†…å®¹</td>
<td><a target="_blank" rel="noopener" href="http://localhost:8210/encrypt">http://localhost:8210/encrypt</a></td>
<td>POST</td>
</tr>
<tr>
<td>3</td>
<td>&#x2F;decrypt</td>
<td>è§£å¯†å†…å®¹</td>
<td><a target="_blank" rel="noopener" href="http://localhost:8210/decrypt">http://localhost:8210/decrypt</a></td>
<td>POST</td>
</tr>
</tbody></table>
<p>æˆ‘ä»¬åœ¨ git ä»“åº“é‡æ–°å»ºç«‹ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä»–ä¸»è¦é€šè¿‡éå¯¹ç§°åŠ å¯†ä½œä¸ºå¯†æ–‡ï¼Œä¹‹åé€šè¿‡æˆ‘ä»¬çš„å¯†é’¥æ¥è¿›è¡Œè§£å¯†çš„è¿™ä¹ˆä¸€ä¸ªæµç¨‹ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">app.version</span>=<span class="string">rsa</span></span><br><span class="line"><span class="attr">message</span>=<span class="string">Spring Cloud Config Demo</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">&#123;cipher&#125;AQA15miINQvSMr5kJorYoX2MLH+1XgjBAGrJKPJWzAvaUhxfrd6So0skCEXjiidn/Vgf+aWCcz17pugBoRqEeDU6XLyu1tS3dAyNE/z7vbyEcp+DsJOEqHiHnr3VqzrhQTJheJOibkskvd8kJt6WP4F9Tl8qyen6mOz+4/Ce4x9iCzPoWTO2Yc+jXJFAjOSB02/kh1wnqAdyc0s7cDYLjjR+FBSMFjFJXV0Qax28hZNjjdlUb/Hy+8mPaSAQbipc9FIKB+dQaSAABYCviscHz7XkjpfmQN3qOAYiMum851OP1OOn8KHGpUu1u7D8ET+404iAHjNPTKh/As8T9A92Av73YE6b8Dj3m9wZf4hCUyEMFUpo0kffw9ThOAzVgR1RnNY=</span></span><br><span class="line"><span class="attr">server.port</span>=<span class="string">8017</span></span><br></pre></td></tr></table></figure>


<h2 id="Spring-Cloud-Bus"><a href="#Spring-Cloud-Bus" class="headerlink" title="Spring Cloud Bus"></a>Spring Cloud Bus</h2><p>Spring Cloud Bus å°†ä¼šç”¨äºè‡ªåŠ¨åˆ·æ–°é…ç½®ï¼Œå¹¶ä¸”å¯ä»¥ç®¡ç†å’Œä¼ æ’­åˆ†å¸ƒå¼é¡¹ç›®ä¸­çš„æ¶ˆæ¯ï¼Œåˆ©ç”¨æ¶ˆæ¯ä¸­é—´ä»¶å¹¿æ’­çš„æœºåˆ¶ä¼ æ’­å¯ä»¥å®ç°å°†æ¶ˆæ¯è¿æ¥æ•´ä¸ªé›†ç¾¤ï¼Œä»–ç›®å‰æ”¯æŒ Kafka å’Œ RabbitMQï¼Œå…¶ä¸­ç›®å‰ä¸»è¦æµè¡Œçš„å°±æ˜¯è¿™ä¸¤ä¸ªé¡¹ç›®ã€‚</p>
<h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210729211335.png"><br>RabbitMQ æ˜¯ä¸€ä¸ªå¼€æºçš„æ¶ˆæ¯ä»£ç†é¡¹ç›®ï¼Œå³é¢å‘æ¶ˆæ¯çš„ä¸­é—´ä»¶ï¼Œé‡‡ç”¨ Erlang è¯­è¨€æ¥è¿›è¡Œç¼–å†™ï¼Œå› æ­¤æˆ‘ä»¬é™¤äº†å®‰è£… RabbitMQ ä¹‹å¤–è¿˜éœ€è¦å®‰è£… Erlang ã€‚</p>
<p>å¯¹äºä½¿ç”¨ debian ç³»çš„ Linux ç”¨æˆ·ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ <code>apt-get install erlang</code> ç›´æ¥è¿›è¡Œå®‰è£… erlï¼Œä¹‹ååŒæ ·çš„å®‰è£… RabbitMQ Server å¹¶è¿è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install rabbitmq-server</span><br><span class="line">systemctl status rabbitmq-server</span><br></pre></td></tr></table></figure>

<p>è¿è¡Œä¹‹åå°±å¼€å§‹è¿›è¡Œé…ç½® RabbitMQ äº†ï¼Œè¿™é‡Œé¢ä¸»è¦çš„å°±æ˜¯é…ç½®å¸å·å¯†ç ä»¥åŠæƒé™å’Œå®‰è£…å¯è§†åŒ–æ’ä»¶ï¼š</p>
<table>
<thead>
<tr>
<th>Id</th>
<th>Name</th>
<th>Info</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code>rabbitmq-plugins enable rabbitmq_management</code></td>
<td>å®‰è£…å¯è§†åŒ–æ’ä»¶</td>
</tr>
<tr>
<td>2</td>
<td><code>rabbitmqctl add_user root toor</code></td>
<td>æ·»åŠ  root å¸å·å¯†ç ä¸º toor</td>
</tr>
<tr>
<td>3</td>
<td><code>set_user_tags root administrator</code></td>
<td>å°† root å¸å·è®¾ç½®ä¸ºç®¡ç†</td>
</tr>
<tr>
<td>4</td>
<td><code>set_permissions -p / root &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</code></td>
<td>ä¸º root å¸å·æ·»åŠ å†™å…¥æƒé™</td>
</tr>
<tr>
<td>5</td>
<td><code>rabbitmqctl list_permissions</code></td>
<td>æŸ¥çœ‹å½“å‰çš„å½“å‰çš„æƒé™åˆ—è¡¨</td>
</tr>
</tbody></table>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“ RabbimtMQ é…ç½®å®Œæˆåï¼Œä»–ä¼šæä¾›ä¸‰ä¸ªéå¸¸é‡è¦çš„ç«¯å£ï¼Œåˆ†åˆ«ä¸º <code>5672\25672\15672</code> åœ¨æœ¬æ–‡ä¸­ä¸»è¦ä½¿ç”¨ <code>5672</code> ç«¯å£æ¥è¿›è¡Œ AMQP è¿æ¥æ¥å£ï¼Œè€Œ <code>15672</code> ç”¨äº HTTP è®¿é—®æ¥å£ï¼Œä¹Ÿå°±æ˜¯ç›‘æ§ä¸­å¿ƒï¼Œä¹‹åä½ å¯ä»¥å°†è¿™ä¸ªæ¥å£æ·»åŠ åˆ° Config Server &amp; Client é…ç½®æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">SpringCloudConfigClient</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">toor</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">xxx</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br></pre></td></tr></table></figure>

<h3 id="Config-Server-1"><a href="#Config-Server-1" class="headerlink" title="Config Server"></a>Config Server</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210729211346.gif"><br>å¯¹äº Config Server ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº† Spring Cloud Config Bus æ¥å®ç°é…ç½®æ–‡ä»¶æ›´æ–°å’Œå¹¿æ’­çš„ä½œç”¨ï¼Œç®€å•æ¥è®²å°±æ˜¯é»˜è®¤æƒ…å†µä¸‹ Config Client æ˜¯æ— æ³•å®ç°è‡ªåŠ¨æ›´æ–°çš„ï¼Œåªå¯ä»¥é€šè¿‡ Spring Config Bus æ¥è¿›è¡Œå®ç°å‘é€ POST æ¥è¿›è¡Œåˆ·æ–°å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶çš„åº”ç”¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ·»åŠ å¦‚ä¸‹ä¾èµ–ï¼ˆåœ¨åŸæœ‰çš„éå¯¹ç§°åŠ å¯†çš„åŸºç¡€ä¸Šé…ç½® Config Serverï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-config-server&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-bus-amqp&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.integration&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-integration-amqp&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.5.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210729211355.png"></p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">cloud-server</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">git:</span></span><br><span class="line">          <span class="attr">uri:</span> <span class="string">https://gitee.com/sif_one/spring-cloud-config</span></span><br><span class="line">          <span class="attr">search-paths:</span> <span class="string">config-repositories</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">xxx</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">xxx</span></span><br><span class="line">        <span class="attr">encrypt:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment"># æ˜¯å¦è¿›è¡Œè§£å¯†</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">toor</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">xxx</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8210</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;bus-refresh&quot;</span></span><br></pre></td></tr></table></figure>


<p>ä¹‹åæ‰“åŒ…ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¹‹ä¸­ï¼Œè¿è¡Œåå³å¯é€šè¿‡ä½¿ç”¨ <code>http://111.67.201.159:8210/actuator/busrefresh</code> æ¥å£æ¥è¿›è¡Œåˆ·æ–°å®¢æˆ·ç«¯çš„é…ç½®ï¼Œè¿™æ˜¯æ–°ç‰ˆæœ¬ä¸­æ‰€æä¾›çš„æ¥å£ï¼Œå½“ç„¶ä½ å¦‚æœä½¿ç”¨çš„æ˜¯å…¶ä»–ç‰ˆæœ¬ä¹Ÿå¯ä»¥é€šè¿‡è®¿é—® <code>/actuator</code> ç«¯å£æ¥æŸ¥çœ‹ç›®å‰æ‰€æ”¯æŒçš„ Spring-Cloud-Bus æ¥å£ã€‚</p>
<h3 id="Config-Client"><a href="#Config-Client" class="headerlink" title="Config Client"></a>Config Client</h3><p>Config Client çš„ä¸»è¦ä½œç”¨å°±æ˜¯è·å–åˆ° Config Server ä» Git ä»“åº“ä¸­çš„é…ç½®æ–‡ä»¶å¹¶è¿ç”¨ï¼Œä½†æ˜¯åœ¨ä¸ä½¿ç”¨ Spring-Cloud-Config-Bus çš„æƒ…å†µä¸‹ï¼Œå³ä½¿ä½ å°†æœ€æ–°çš„é…ç½®æ–‡ä»¶ä¸Šä¼ äº† Config Config ä¹Ÿä¸ä¼šè¿›è¡Œæ›´æ–°ï¼Œå› æ­¤éœ€è¦é€šè¿‡ Spring Cloud Config Bus æ¥è¿›è¡Œå®ç°ï¼Œåœ¨åŸæœ‰çš„ Config CLient åŸºç¡€ä¸Šè¿›è¡Œæ·»åŠ å³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-config-client --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-config-client&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.0.4&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-bootstrap&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-bus-amqp&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.integration&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-integration-amqp&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.5.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="RefreshScope"><a href="#RefreshScope" class="headerlink" title="@RefreshScope"></a>@RefreshScope</h4><figure class="highlight plaintext"><figcaption><span>ä¾èµ–ä¸»è¦çš„ä½œç”¨å°±æ˜¯å½“ git ä»“åº“å‘ç”Ÿæ”¹å˜æˆ–æ›´æ–°åï¼Œæˆ‘ä»¬é€šè¿‡ Config server æ‰€æä¾›çš„ ```actuator/busrefresh``` POST è¯·æ±‚æ¥åˆ·æ–° Config Client çš„é…ç½®æ–‡ä»¶ï¼Œå› æ­¤è¿™ä¸ªä¾èµ–ä¸»è¦çš„ä½œç”¨å°±æ˜¯åˆ·æ–°çš„èŒƒå›´ï¼Œæˆ‘ä»¬åœ¨åŸæœ‰çš„ Config Server Client åŸºç¡€ä¸Šæ·»åŠ å³å¯ï¼š</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```java</span><br><span class="line">package com.example.demo.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.cloud.context.config.annotation.RefreshScope;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * è·å–é…ç½®ä¸­å¿ƒçš„æ•°æ®</span><br><span class="line"> *</span><br><span class="line"> * @author kunlun</span><br><span class="line"> * @date 2021/7/26</span><br><span class="line"> */</span><br><span class="line">@RestController</span><br><span class="line">@RefreshScope</span><br><span class="line">public class heyController &#123;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;app.version&#125;&quot;)</span><br><span class="line">    private String version;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;message&#125;&quot;)</span><br><span class="line">    private String message;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(&quot;/hey&quot;)</span><br><span class="line">    public String hey() &#123;</span><br><span class="line">        String string = &quot;message:&quot; + message + &quot;:&quot; + &quot; version:&quot; + version;</span><br><span class="line">        return string;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨å¯åŠ¨ç±»ä¸­è¿›è¡Œæ·»åŠ   </p>
</blockquote>
<h4 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">SpringCloudConfigClient</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">toor</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">xxx</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br><span class="line"></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;bus-refresh&quot;</span></span><br></pre></td></tr></table></figure>

<p>é…ç½®æ–‡ä»¶ä¸­çš„ <code>management</code> ä¸ºå¼€å¯æ­¤æ¥å£ï¼Œé»˜è®¤çš„æƒ…å†µä¸‹æ˜¯å…³é—­çš„ï¼Œéœ€è¦é€šè¿‡é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œé…ç½®ï¼Œä¹‹åå³å¯è®¿é—®ï¼Œè™½ç„¶åœ¨æœ€æ–°ç‰ˆæœ¬ä¸­ä¸çŸ¥é“æœ‰æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œä½†æ˜¯ä¸ºäº†ä¿é™©æœŸé—´è¿˜æ˜¯æ·»åŠ ä¸ºå¥½ã€‚</p>
<blockquote>
<p>æ–°ç‰ˆæœ¬ä¸­ Spring Cloud Config Bus æ‰€æä¾›çš„ POST æ›´æ–°æ¥å£ä¸º <code>actuator/busrefresh</code></p>
</blockquote>
<h4 id="bootstrap-yml"><a href="#bootstrap-yml" class="headerlink" title="bootstrap.yml"></a>bootstrap.yml</h4><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">config:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">      <span class="attr">profile:</span> <span class="string">rsa</span></span><br><span class="line">      <span class="attr">uri:</span> <span class="string">http://xxx:8210</span></span><br><span class="line">      <span class="attr">label:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure>

<p>bootstrap é…ç½®æ–‡ä»¶ä¸»è¦åšçš„å°±æ˜¯é€šè¿‡ <code>spring.cloud.config</code> æ¥é“¾æ¥é…ç½®ä¸­å¿ƒï¼Œå¹¶é€šè¿‡é…ç½®ä¸­å¿ƒæ‰€è·å–çš„é…ç½®æ–‡ä»¶æ¥è¿›è¡Œè¿ç”¨ï¼Œæœ€åé…ç½®å®Œæˆåæˆ‘ä»¬å¯ä»¥å°è¯•ä¿®æ”¹é…ç½®æ–‡ä»¶ä¿¡æ¯ï¼Œä½ å¯ä»¥å…¨éƒ¨æ¥å£éƒ½è®¿é—®ä¸€éçœ‹çœ‹æœ€åˆçš„æ•ˆæœï¼ˆé™¤äº† <code>actuator/busrefresh</code>ï¼‰ï¼Œä¹‹åé€šè¿‡ <code>actuator/busrefresh</code> æ¥å£ä»¥ POST æ–¹å¼è¿›è¡Œåˆ·æ–°ï¼Œæœ€åè®¿é—® Spring Cloud Config Client æ‰€æä¾›çš„ <code>/hey</code> æ¥å£æ¥æŸ¥çœ‹æ˜¯å¦åˆ·æ–°æˆåŠŸã€‚</p>
<h3 id="WebHooks"><a href="#WebHooks" class="headerlink" title="WebHooks"></a>WebHooks</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210729211421.png"></p>
<p>WebHooks ä¸»è¦çš„ä½œç”¨å°±æ˜¯å½“æ¨é€åˆ° git ä»“åº“çš„æ—¶å€™ WebHooks æœåŠ¡ä¼šå°† POST è¯·æ±‚åˆ°å¯¹åº”çš„ uri ä¸­ï¼Œä»è€Œå®ç°æˆ‘ä»¬æ‰‹åŠ¨è¯·æ±‚ POST æ¥åˆ·æ–°æœåŠ¡é…ç½®æ–‡ä»¶çš„æ•ˆæœã€‚ä½†åœ¨æ–°ç‰ˆæœ¬ä¸­å´è¯·æ±‚å¤±è´¥ï¼Œè€ƒè™‘å…¶ä»–ä¸å¯æŠ—æ‹’çš„å› ç´ å»ºè®®å›½å†…è¯»è€…é€‰æ‹© Gitteï¼Œä½† WebHooks ä¾ç„¶è¯·æ±‚è¿”å› <code>400</code> å¦‚æœ‰è¯»è€…è§£å†³å¯åœ¨ä¸‹æ”¾è¿›è¡Œè¯„è®ºã€‚</p>

	

	

</article>





	<span class="different-posts">ğŸ“– <a href="/page/15">more posts</a> ğŸ“–</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>æ¬¢è¿æ¥åˆ°æˆ‘çš„ blog <br><br> é€šè¿‡ <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>+<a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a> è¿›è¡Œæ„å»ºçš„ï¼Œå­˜æ”¾åœ¨ <a target="_blank" rel="noopener" href="https://github.com/vendanges/vendanges.github.io">Github</a> ä¸Šã€‚</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>Â© 2022 John Doe | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
