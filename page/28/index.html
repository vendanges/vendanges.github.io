<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>琼瑶</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="琼瑶" type="application/atom+xml">
    
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link" style="color: #fff">Home</a>
			
				<a href="/archives" class="header__link" style="color: #fff">Archive</a>
			
				<a href="/about" class="header__link" style="color: #fff">About</a>
			
		</nav>
		<!-- <h1 class="header__title"><a href="/">琼瑶</a></h1> -->
		<h1 class="header__title"><a href="/"><img style="width: 290px;" src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/202204152017786.png"></a></h1>
		<h2 class="header__subtitle">梦入琼楼寒有月，行过石树冻无烟</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">📖 <a href="/page/27">earlier posts</a> 📖</span>




	<article>
	
		<h1><a href="/2022/04/21/php/laravel/7.Laravel 请求与Cookie/">Laravel 请求与Cookie</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/laravel/" rel="tag">laravel</a> <a class="article__tag-none-link" href="/tags/php/" rel="tag">php</a>
			</span>
		
	</div>

	

	
		<p>在目前，请求已经覆盖了几乎上所有的站点，当你在提交表单的时候，我们通常都会成此次操作为一次表单请求，而表单请求通常别运用到了表单的填写、用户的注册、文章的发布等一系列场景之中，本文将会带读者进入到Laravel请求的实现过程。</p>
<h2 id="URL请求"><a href="#URL请求" class="headerlink" title="URL请求"></a>URL请求</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/7.laravel%20%E8%AF%B7%E6%B1%82%E4%B8%8Ecookie.md/20210208212257432_147788863.png"><br>通常我们最为常用的是通过url进行请求，比如我们访问“<a target="_blank" rel="noopener" href="https://pv.zsun.org.cn/loophole-data/ZSUN-2020-71%E2%80%9D%E5%88%99%E4%BC%9A%E8%AF%B7%E6%B1%82%E8%AF%A5%E7%AB%99%E7%82%B9%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%EF%BC%8C%E7%94%B1%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%BF%9B%E8%A1%8C%E5%93%8D%E5%BA%94%EF%BC%8C%E6%88%91%E4%BB%AC%E5%8F%AF%E4%BB%A5%E9%80%9A%E8%BF%87%E6%8E%A7%E5%88%B6%E5%99%A8+%E8%B7%AF%E7%94%B1%E7%9A%84%E6%96%B9%E5%BC%8F%E8%BF%9B%E8%A1%8C%E5%AE%9E%E7%8E%B0%EF%BC%9A">https://pv.zsun.org.cn/loophole-data/ZSUN-2020-71”则会请求该站点的服务器，由服务器进行响应，我们可以通过控制器+路由的方式进行实现：</a></p>
<h3 id="获取url"><a href="#获取url" class="headerlink" title="获取url"></a>获取url</h3><h4 id="TestController"><a href="#TestController" class="headerlink" title="TestController"></a>TestController</h4><p>在编写控制器之前我们需要进行创建，创建控制器的方法我们可以通过<code>artisan</code>进行创建，创建语法为：</p>
<blockquote>
<p>php artisan make:controller TestController</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$url</span> = <span class="variable">$request</span> -&gt; <span class="title function_ invoke__">url</span>();</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;This request url be:&#x27;</span>.<span class="variable">$url</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="web-php"><a href="#web-php" class="headerlink" title="web.php"></a>web.php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Web Routes</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Here is where you can register web routes for your application. These</span></span><br><span class="line"><span class="comment">| routes are loaded by the RouteServiceProvider within a group which</span></span><br><span class="line"><span class="comment">| contains the &quot;web&quot; middleware group. Now create something great!</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/url&#x27;</span> ,<span class="string">&#x27;TestController&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="获取-id"><a href="#获取-id" class="headerlink" title="获取 id"></a>获取 id</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/7.laravel%20%E8%AF%B7%E6%B1%82%E4%B8%8Ecookie.md/20210208232604700_350448826.png"><br>在实际的开发过程中，我们会遇到很多次的获取用户跳转id的类似需求，而实现这种需求我们也可从第一个例子中慢慢演变：</p>
<h4 id="web-php-1"><a href="#web-php-1" class="headerlink" title="web.php"></a>web.php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/input/&#123;id&#125;&#x27;</span>, <span class="string">&#x27;TestController@up&#x27;</span>);</span><br><span class="line">```  </span><br><span class="line"><span class="comment">#### TestController</span></span><br><span class="line">```php</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">up</span>(<span class="params">Request <span class="variable">$request</span>, <span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$id</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="路由获取-id"><a href="#路由获取-id" class="headerlink" title="路由获取 id"></a>路由获取 id</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/7.laravel%20%E8%AF%B7%E6%B1%82%E4%B8%8Ecookie.md/20210208233421350_1668891816.png"><br>当然慢慢的你会觉得还需要单独创建一个控制器（Controller）有点且非常的麻烦，那你可以使用下面这种直接在路由中开写的：</p>
<h4 id="web-php-2"><a href="#web-php-2" class="headerlink" title="web.php"></a>web.php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/input/&#123;id&#125;&#x27;</span>, function (Request <span class="variable">$request</span>, <span class="variable">$id</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$id</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="表单请求"><a href="#表单请求" class="headerlink" title="表单请求"></a>表单请求</h2><p>表单请求几乎上是项目开发中最为常用的一种，通常运用在注册、登录、发布文章等处用的最多，本文我们将会为读者编写一个较为简单的表单请求与控制器获取的操作：</p>
<h3 id="获取信息"><a href="#获取信息" class="headerlink" title="获取信息"></a>获取信息</h3><h4 id="TestController-1"><a href="#TestController-1" class="headerlink" title="TestController"></a>TestController</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="x2F-resources-x2F-views-x2F-input-blade-php"><a href="#x2F-resources-x2F-views-x2F-input-blade-php" class="headerlink" title="&#x2F;resources&#x2F;views&#x2F;input.blade.php"></a>&#x2F;resources&#x2F;views&#x2F;input.blade.php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;This is be Input up&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;/user/name&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;_token&quot;</span> value=<span class="string">&quot;&lt;?php echo csrf_token()?&gt;&quot;</span>&gt;</span><br><span class="line">    Username:&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span> /&gt;&amp;nbsp;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;up&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h4 id="web-php-3"><a href="#web-php-3" class="headerlink" title="web.php"></a>web.php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Web Routes</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Here is where you can register web routes for your application. These</span></span><br><span class="line"><span class="comment">| routes are loaded by the RouteServiceProvider within a group which</span></span><br><span class="line"><span class="comment">| contains the &quot;web&quot; middleware group. Now create something great!</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/input&#x27;</span> ,function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">post</span>(<span class="string">&#x27;/user/name&#x27;</span>, <span class="keyword">array</span>(<span class="string">&#x27;uses&#x27;</span>=&gt;<span class="string">&#x27;TestController@store&#x27;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="表单检测"><a href="#表单检测" class="headerlink" title="表单检测"></a>表单检测</h3><h4 id="is-表单url"><a href="#is-表单url" class="headerlink" title="is (表单url)"></a>is (表单url)</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/7.laravel%20%E8%AF%B7%E6%B1%82%E4%B8%8Ecookie.md/20210208235555948_1445553544.png"><br>当然，Laravel还为我们提供了丰富的表单检测的方法，分别为检测表单提交方法，比如post&#x2F;get的、也有检测表单提交url的，下面我们将会分别进行演示：</p>
<h5 id="TestController-2"><a href="#TestController-2" class="headerlink" title="TestController"></a>TestController</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">is</span>(<span class="string">&#x27;user/name&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;提交正确&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;提交错误&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这个我们主要用于检测表单提交后的目录，如果不是该控制器中所指定的目录将会出现<code>提交错误</code>的字样。</p>
<h4 id="isMethod-检测提交方法"><a href="#isMethod-检测提交方法" class="headerlink" title="isMethod (检测提交方法)"></a>isMethod (检测提交方法)</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/7.laravel%20%E8%AF%B7%E6%B1%82%E4%B8%8Ecookie.md/20210208234442454_1452459804.png"></p>
<h5 id="TestController-3"><a href="#TestController-3" class="headerlink" title="TestController"></a>TestController</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">isMethod</span>(<span class="string">&#x27;post&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;提交正确&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;提交错误&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Laravel项目中，为我们提供了<code>isMethod</code>方法来用于判断表单的提交方法，以上例子是通过Post进行提交，但是如果使用get形式提交的话将会出现<code>提交错误</code>的字样。</p>
<h4 id="boolean-布尔"><a href="#boolean-布尔" class="headerlink" title="boolean (布尔)"></a>boolean (布尔)</h4><p>在Laravel项目中，布尔的提交方式较为不同，当你提交true的时候，那么会回显为<code>1</code>,当你提交<code>1</code>的时候，回显的还将是<code>1</code>：</p>
<h5 id="TestController-4"><a href="#TestController-4" class="headerlink" title="TestController"></a>TestController</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$request</span>-&gt;<span class="keyword">boolean</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$name</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="has"><a href="#has" class="headerlink" title="has"></a>has</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/7.laravel%20%E8%AF%B7%E6%B1%82%E4%B8%8Ecookie.md/20210209012350871_1855190203.png"><br>在Laravel项目中has主要用于检测表单是否存在，但是翻译后他会显示“has方法来确定请求中是否存在该值”，那么我们可以写一个检测表单是否存在的：</p>
<h5 id="TestController-5"><a href="#TestController-5" class="headerlink" title="TestController"></a>TestController</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$request</span>-&gt;<span class="title function_ invoke__">has</span>(<span class="string">&#x27;sss&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;yes&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在控制器中，我们在has方法后面写了一个名为”sss“的前端表单，如果存在即返回yes，不存在则返回no，那么在前端页面中，我们并不存在name为sss的表单即input，所以返回了no.</p>
<h4 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/7.laravel%20%E8%AF%B7%E6%B1%82%E4%B8%8Ecookie.md/20210209161623448_618513313.png"><br>在实际的开发过程中我们总需要检测一些非法表单的提交，如！×#！@×#一些乱码或空白表单的问题，在Laravel之中与其他语言一样，都是支持运算符的，我们可以通过运算符进行判断该数据是否在“黑名单之中”</p>
<h5 id="TestController-6"><a href="#TestController-6" class="headerlink" title="TestController"></a>TestController</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">input</span>(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$name</span> == <span class="string">&#x27;1&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;yes&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;no&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在上述的code中，我们在TestController控制器中加入了一个运算符<code>==</code>来判断$name的函数是否存在等于<code>1</code>的情况，如果提交数据等于1则返回yes，否则返回no。</p>
<h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/7.laravel%20%E8%AF%B7%E6%B1%82%E4%B8%8Ecookie.md/20210209174335862_1479935215.png"><br>Cookie是在项目开发过程中较为不常用的一种方式，但这种技术运用在会话中较为常用，如钟山计算机端口安全联合众测平台中就是用Cookie技术来达到会话在一定时间内不会过期的问题：</p>
<h3 id="创建cookie"><a href="#创建cookie" class="headerlink" title="创建cookie"></a>创建cookie</h3><h4 id="TestController-7"><a href="#TestController-7" class="headerlink" title="TestController"></a>TestController</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">http</span>\<span class="title">Cookie</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Response</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span>,Response <span class="variable">$response</span></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 创建cookie</span></span><br><span class="line">        <span class="variable">$response</span> = <span class="keyword">new</span> <span class="title class_">Response</span>();</span><br><span class="line">        <span class="variable">$response</span>-&gt;<span class="title function_ invoke__">withCookie</span>(<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;value&#x27;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取cookie</span></span><br><span class="line">        <span class="variable">$value</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;name&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$value</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$response</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/7.laravel%20%E8%AF%B7%E6%B1%82%E4%B8%8Ecookie.md/20210209175453037_781730100.png"><br>在<code>withCookie</code>中，如果你是使用PhpStort的读者，肯定会明白意思，因为集成开发环境会在前面分别进行标注。在本文演示中，我们并没有设置其Cookie的过期时间，读者如果在项目或学习过程有需要的话，可以加入第三项，为其cookie设置时间。</p>
<h3 id="获取cookie"><a href="#获取cookie" class="headerlink" title="获取cookie"></a>获取cookie</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/7.laravel%20%E8%AF%B7%E6%B1%82%E4%B8%8Ecookie.md/20210209171154421_1187019600.png"><br>在Laravel项目中，我们有两种凡是来获取和访问cookie值，可分别使用请求（request）或使用CookieFacade来访问：</p>
<h4 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$value</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">cookie</span>(<span class="string">&#x27;laravel_session&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$value</span>.<span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="CookieFacade"><a href="#CookieFacade" class="headerlink" title="CookieFacade"></a>CookieFacade</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$values</span> = <span class="title class_">\Illuminate\Support\Facades\Cookie</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;laravel_session&#x27;</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$values</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/php/laravel/6.Laravel 控制器/">Laravel 控制器</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/laravel/" rel="tag">laravel</a> <a class="article__tag-none-link" href="/tags/php/" rel="tag">php</a>
			</span>
		
	</div>

	

	
		<p>控制器的存在主要用于替代路由文件中以闭包形式所有的请求处理逻辑，可以使用控制器来组织这些行为，在MVC框架之中，分为业务模型（M）、用户视图（V）、控制器（C），使用MVC的目的是将M和V的实现代码分离，控制器用于确保业务模型以及用户视图的同步，一旦业务模型进行更改，那么用户视图也会随着更改。</p>
<p>控制器主要存放在<code>app/Http/Controllers/</code>目录下，默认情况下并不会生成，需要使用命令<code>php artisan make:controller TestController</code>进行创建，在此会有一个命名潜规则是“作用+Controller”，如本次的控制器作用是测试则命名方式可为“TestController”即可，之后会在<code>app/Http/Controller</code>目录内生成该类，内容如下：</p>
<h2 id="数据传递"><a href="#数据传递" class="headerlink" title="数据传递"></a>数据传递</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/6.laravel%20%E6%8E%A7%E5%88%B6%E5%99%A8.md/20210208003318201_385207825.png"><br>通常我们需要将参数传递到控制器中，在Laravel之中，我们可以通过控制器进行传递，本次我们将实现一个传递id的效果：</p>
<h2 id="命名空间（俗称-“路由绑定”）"><a href="#命名空间（俗称-“路由绑定”）" class="headerlink" title="命名空间（俗称 “路由绑定”）"></a>命名空间（俗称 “路由绑定”）</h2><p>在定义路由时，我们通常不需要写入完整的控制器名称，这是因为<code>ProuteServiceProvider</code>几乎将所有的路由文件加载到了包含名称空间的路由组中。比如一个控制器类的完整空间为<code>namespace App\Http\Controllers;</code>，此时我们可以在路由器中写成：</p>
<blockquote>
<p>Route::get(‘&#x2F;id&#x2F;{id}’, ‘TestController@index’);</p>
</blockquote>
<p>是可以找到TestController控制器的，当然如果你有相关的项目需要或自身的习惯也可以写完整的路径，浙江取决于你。</p>
<h3 id="TestController"><a href="#TestController" class="headerlink" title="TestController"></a>TestController</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;My is be ID: &quot;</span>.<span class="variable">$id</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="web-php"><a href="#web-php" class="headerlink" title="web.php"></a>web.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Web Routes</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Here is where you can register web routes for your application. These</span></span><br><span class="line"><span class="comment">| routes are loaded by the RouteServiceProvider within a group which</span></span><br><span class="line"><span class="comment">| contains the &quot;web&quot; middleware group. Now create something great!</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 这里我们调用的TestController控制器的@index方法</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/id/&#123;id&#125;&#x27;</span>, <span class="string">&#x27;TestController@index&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="单个行为控制器"><a href="#单个行为控制器" class="headerlink" title="单个行为控制器"></a>单个行为控制器</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/6.laravel%20%E6%8E%A7%E5%88%B6%E5%99%A8.md/20210208004550051_89805105.png"><br>单个行为控制器说的通俗且简单一点就是，<strong>该控制器只用于处理你这一个请求</strong>，定义的方法也与普通的控制器有所不同，最为不同的一个点是在方法前面加了两个<code>__</code>，即<code>__invoke</code>函数：</p>
<h3 id="TestController-1"><a href="#TestController-1" class="headerlink" title="TestController"></a>TestController</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$id</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;My is be ID: &quot;</span>.<span class="variable">$id</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="web-php-1"><a href="#web-php-1" class="headerlink" title="web.php"></a>web.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Web Routes</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Here is where you can register web routes for your application. These</span></span><br><span class="line"><span class="comment">| routes are loaded by the RouteServiceProvider within a group which</span></span><br><span class="line"><span class="comment">| contains the &quot;web&quot; middleware group. Now create something great!</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/id/&#123;id&#125;&#x27;</span>, <span class="string">&#x27;TestController&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="视图控制器"><a href="#视图控制器" class="headerlink" title="视图控制器"></a>视图控制器</h2><p>与路由一样，控制器也拥有一个视图控制器，而定义方法与路由所相差无几，实现如下，在Laravel项目中，只需要在控制器中添加一个返回视图的方法以及配置路由即可：</p>
<h3 id="TestController-2"><a href="#TestController-2" class="headerlink" title="TestController"></a>TestController</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">User</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="web-php-2"><a href="#web-php-2" class="headerlink" title="web.php"></a>web.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Web Routes</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Here is where you can register web routes for your application. These</span></span><br><span class="line"><span class="comment">| routes are loaded by the RouteServiceProvider within a group which</span></span><br><span class="line"><span class="comment">| contains the &quot;web&quot; middleware group. Now create something great!</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/test&#x27;</span>, <span class="string">&#x27;TestController@index&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>之后通过访问<code>locahost:8000/test</code>回显的视图将是在<code>resources/</code>下的<code>welcome.blade.php</code>视图文件。</p>
<h2 id="资源控制器（增删改查-“CURD”）"><a href="#资源控制器（增删改查-“CURD”）" class="headerlink" title="资源控制器（增删改查 “CURD”）"></a>资源控制器（增删改查 “CURD”）</h2><p>在Laravel中，资源控制器将经典的增删改查简化成了一行行控制器代码，Laravel为我们提供了一套约定的规则，这种规则可以方便我们的代码写的更加的完美且优雅，以下我们可以通过使用<code>Artisan</code>来生成一个资源控制器，使用的参数为<code>--resource</code>：</p>
<blockquote>
<p>php artisan make:controller PostController –resource</p>
</blockquote>
<p>这与普通的控制器一样，会在&#96;&#96;app\Http\Controllers`&#96;&#96;下创建一个名为<code>PostController</code>的控制器，且自动帮我们生成了CURD方法，<strong>我们可以通过对应请求在路由中进行绑定</strong>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Display a listing of the resource.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Show the form for creating a new resource.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">create</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Store a newly created resource in storage.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">store</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Display the specified resource.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Show the form for editing the specified resource.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">edit</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Update the specified resource in storage.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">Request <span class="variable">$request</span>, <span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Remove the specified resource from storage.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span>(<span class="params"><span class="variable">$id</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>请求方式</th>
<th>Route</th>
<th>FA</th>
<th>路由名称</th>
</tr>
</thead>
<tbody><tr>
<td>GET</td>
<td>&#x2F;post</td>
<td>所有数据展现</td>
<td>index</td>
</tr>
<tr>
<td>GET</td>
<td>&#x2F;post&#x2F;create</td>
<td>插入数据</td>
<td>create</td>
</tr>
<tr>
<td>POST</td>
<td>&#x2F;post&#x2F;store</td>
<td>存储刚刚新提交的数据</td>
<td>store</td>
</tr>
<tr>
<td>GET</td>
<td>&#x2F;post&#x2F;{id}</td>
<td>显示某个数据</td>
<td>show</td>
</tr>
<tr>
<td>GET</td>
<td>&#x2F;post&#x2F;{id}&#x2F;edit</td>
<td>修改某个数据</td>
<td>edit</td>
</tr>
<tr>
<td>PUT</td>
<td>&#x2F;post&#x2F;{id}</td>
<td>更新数据库中某个资源</td>
<td>update</td>
</tr>
<tr>
<td>DELETE</td>
<td>&#x2F;post&#x2F;{id}</td>
<td>删除某个数据</td>
<td>destory</td>
</tr>
</tbody></table>
<p>如果在路由中使用该资源控制器也非常的简单，可以在web.php类中来绑定资源控制器即可：</p>
<blockquote>
<p>Route::resource(‘post’, ‘PostController’);</p>
</blockquote>
<h3 id="实际开发过程中的伪造方法"><a href="#实际开发过程中的伪造方法" class="headerlink" title="实际开发过程中的伪造方法"></a>实际开发过程中的伪造方法</h3><p>在实际开发的过程中，我们会遇到很多问题，前端表单支持GET&#x2F;POST方法但不支持<code>PUT/DELETE</code>的请求方式，所以我们在前端中需要使用一个Blade指令**@method**来使用伪造HTTP动作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;/post/update&quot; method=&quot;POST&quot;&gt;</span><br><span class="line">    @method(&#x27;PUT&#x27;)</span><br><span class="line">    ……</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<h3 id="指定资源路由"><a href="#指定资源路由" class="headerlink" title="指定资源路由"></a>指定资源路由</h3><p>指定资源路由在官方文档中被命名为“部分资源路由”，这里我们以白名单与黑名单为例子让读者更加进一步理解：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用所有</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">resource</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;PostController&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白名单 -&gt; Only 只有……</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">resource</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;PostController&#x27;</span>)-&gt;<span class="title function_ invoke__">only</span>([</span><br><span class="line">   <span class="string">&#x27;index&#x27;</span> //…… ‘index<span class="string">&#x27;, &#x27;</span>show<span class="string">&#x27; &#x27;</span>create<span class="string">&#x27;</span></span><br><span class="line"><span class="string">]);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 黑名单 -&gt; except 除了……以外</span></span><br><span class="line"><span class="string">Route::resource(&#x27;</span>post<span class="string">&#x27;, &#x27;</span>PostController<span class="string">&#x27;)-&gt;except([</span></span><br><span class="line"><span class="string">   &#x27;</span>create<span class="string">&#x27;, &#x27;</span>update<span class="string">&#x27; // …… &#x27;</span>index<span class="string">&#x27;</span></span><br><span class="line"><span class="string">]);</span></span><br></pre></td></tr></table></figure>
<h4 id="白名单（only）"><a href="#白名单（only）" class="headerlink" title="白名单（only）"></a>白名单（only）</h4><p>白名单指only，中文译名为<strong>只</strong>，顾名思义指这个处理器包含什么样的行为，在Laravel之中默认行为是所有。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 白名单 -&gt; Only 只有……</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">resource</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;PostController&#x27;</span>)-&gt;<span class="title function_ invoke__">only</span>([</span><br><span class="line">   <span class="string">&#x27;index&#x27;</span> //…… ‘index<span class="string">&#x27;, &#x27;</span>show<span class="string">&#x27; &#x27;</span>create<span class="string">&#x27;</span></span><br><span class="line"><span class="string">]);</span></span><br></pre></td></tr></table></figure>

<h4 id="黑名单-except"><a href="#黑名单-except" class="headerlink" title="黑名单 (except)"></a>黑名单 (except)</h4><p>Laravel之中的except可以理解为是黑名单，但原意思是“除了……之外”，所以以下例子为除了create、update方法，PostController之中的资源路由我全要。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 黑名单 -&gt; except 除了……以外</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">resource</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;PostController&#x27;</span>)-&gt;<span class="title function_ invoke__">except</span>([</span><br><span class="line">   <span class="string">&#x27;create&#x27;</span>, <span class="string">&#x27;update&#x27;</span> // …… <span class="string">&#x27;index&#x27;</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h3 id="命名资源路由"><a href="#命名资源路由" class="headerlink" title="命名资源路由"></a>命名资源路由</h3><p>在资源控制器名称写入路由的时候，当处理需求较小的情况下还好，但一旦数据非常的庞大，我们除了对路由进行分组，也有一个命名资源路由的方法，只需要使用<code>names</code>即可：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">resource</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;PostController&#x27;</span>)-&gt;<span class="title function_ invoke__">names</span>([</span><br><span class="line">    <span class="string">&#x27;create&#x27;</span> =&gt; <span class="string">&#x27;post.create&#x27;</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h4 id="资源路由参数"><a href="#资源路由参数" class="headerlink" title="资源路由参数"></a>资源路由参数</h4><p>为了让前端变得更加美妙且更好的分辨，Laravel为我们提供了一种用于命名资源路由的方法<code>parameters</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">resource</span>(<span class="string">&#x27;post&#x27;</span>, <span class="string">&#x27;PostController&#x27;</span>)-&gt;<span class="title function_ invoke__">parameters</span>([</span><br><span class="line">    <span class="string">&#x27;post&#x27;</span> =&gt; <span class="string">&#x27;test_post&#x27;</span></span><br><span class="line">]);</span><br></pre></td></tr></table></figure>
<p>之后将会生成<code>/post/&#123;post_test&#125;</code>的url构造。</p>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/php/laravel/5.Laravel 中间件/">Laravel 中间件</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/laravel/" rel="tag">laravel</a> <a class="article__tag-none-link" href="/tags/php/" rel="tag">php</a>
			</span>
		
	</div>

	

	
		<p>在Laravel之中，中间件提供了一种较为方便的机制来过滤应用程序的HTTP请求，如果学习过Spring security的读者肯定不陌生，假如Larvael有一个认证身份的中间件，如果未经过授权就可以访问不可访问的内容，则会被重定向至登录界面。<br>在Laravel之中不仅仅包含了身分验证的中间件，还自带了CSRF防护的中间件，而中间件所在的目录即在<code>/app/Http/Middleware</code>目录下，所以我们需要定义一个中间件：</p>
<blockquote>
<p>php artisan make:middleware MiddleWare</p>
</blockquote>
<p>在这里之中<strong>作者出现了一个潜规则的错误</strong>，在创建中间件的过程中应该使用 <code>需求+中间件</code>的潜规则，则按照潜规则来命名的话需要这样：<code>IdMiddleware</code></p>
<p>之后我们会发现他Laravel会在<code>app/Http/Middleware</code>目录下创建一个MiddleWare.php类，在这个中间件中我们可以对其进行写入：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiddleWare</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Handle an incoming request.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Closure  $next</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"><span class="variable">$request</span>, <span class="built_in">Closure</span> <span class="variable">$next</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Is be Middleware&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$next</span>(<span class="variable">$request</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在中间件中，我们所定义了一个当当前id等于10的情况下，将会返回一个<code>yes</code>。</p>
<h2 id="注册中间件"><a href="#注册中间件" class="headerlink" title="注册中间件"></a>注册中间件</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/5.laravel%20%E4%B8%AD%E9%97%B4%E4%BB%B6.md/20210207134622712_464016695.png"><br>在此之后我们需要去注册一个全局的中间件。全局中间件需要在<code>app/Http/Kernel.php</code>中进行。</p>
<h3 id="全局注册"><a href="#全局注册" class="headerlink" title="全局注册"></a>全局注册</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The application&#x27;s route middleware groups.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$middlewareGroups</span> = [</span><br><span class="line">    <span class="string">&#x27;web&#x27;</span> =&gt; [</span><br><span class="line">        ……</span><br><span class="line">        <span class="title class_">\App\Http\Middleware\MiddleWare</span>::<span class="variable language_">class</span>,</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure>
<p>全局注册即所有路由都将经过的中间件，我们可以在<code>$middlewareGroups</code>下进行添加之后访问localhost:8000即可查看中间件所输出的Hello,world!。</p>
<h3 id="路由注册"><a href="#路由注册" class="headerlink" title="路由注册"></a>路由注册</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/5.laravel%20%E4%B8%AD%E9%97%B4%E4%BB%B6.md/20210207140010765_919321800.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The application&#x27;s route middleware.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * These middleware may be assigned to groups or used individually.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@var</span> array</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">protected</span> <span class="variable">$routeMiddleware</span> = [</span><br><span class="line">    ……</span><br><span class="line">    <span class="string">&#x27;hey&#x27;</span> =&gt; <span class="title class_">\App\Http\Middleware\MiddleWare</span>::<span class="variable language_">class</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure>
<p>在Kernel类中，我们注册了一个<code>MiddleWare</code>名为的中间件，其注册语法为：<code>&#39;id&#39; =&gt; \App\Http\Middleware\MiddleWare::class,</code>。</p>
<h4 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h4><p>路由注册长伴着控制器一起进行，通常在Laravel项目中控制器并不是默认存在的，需要使用如下命令进行生成：</p>
<blockquote>
<p>php artisan make:controller TestController</p>
</blockquote>
<p>之后Controller控制器将会存放在<code>App\Http\Controllers</code>目录下，并存在着一个TestController的类。</p>
<h5 id="TestController"><a href="#TestController" class="headerlink" title="TestController"></a>TestController</h5><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Http</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;Is be Controller&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="web-php"><a href="#web-php" class="headerlink" title="web.php"></a>web.php</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Web Routes</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Here is where you can register web routes for your application. These</span></span><br><span class="line"><span class="comment">| routes are loaded by the RouteServiceProvider within a group which</span></span><br><span class="line"><span class="comment">| contains the &quot;web&quot; middleware group. Now create something great!</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用路由器组进行绑定</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">group</span>([<span class="string">&#x27;middleware&#x27;</span> =&gt; [<span class="string">&#x27;hey&#x27;</span>]], function () &#123;</span><br><span class="line">    <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;test&#x27;</span>,<span class="string">&#x27;TestController@index&#x27;</span>)-&gt;<span class="title function_ invoke__">name</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/php/laravel/4.Laravel 路由/">Laravel 路由</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/laravel/" rel="tag">laravel</a> <a class="article__tag-none-link" href="/tags/php/" rel="tag">php</a>
			</span>
		
	</div>

	

	
		<p>Laravel路由与Spring boot的控制器相差无几，相信学过Spring boot的读者会感觉Laravel非常的和蔼可亲，甚至比Spring boot更好理解。通过阅读前面的Laravel的文件结构我们可以得知，在<code>app/reutes/web.php</code>文件中定义路由，在这里面的路由通常都会被分配给web中间件组<strong>，在不为人知的情况下，他还提供了会话状态和CSRF保护的作用</strong>。</p>
<h2 id="路由的定义"><a href="#路由的定义" class="headerlink" title="路由的定义"></a>路由的定义</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/4.laravel%20%E8%B7%AF%E7%94%B1.md/20210207072219299_618828202.png"><br>在Laravel中，为我们提供了一个简洁优雅的定义路由语法，为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/hey&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;hello,world!&#x27;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="视图路由"><a href="#视图路由" class="headerlink" title="视图路由"></a>视图路由</h3><p>当然此时你觉得单纯的返回字符串已经完全满足不了需求了，这个时候我们可以在定义一个<strong>视图（view）</strong>路由，需要注意的视图路由通常存放在<code>resources/view/</code>目录下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;welcome&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这个时候如果你访问<code>localhost:8000</code>则会跳转至<code>/reousces/view/welcome.blade.php</code>文件所呈现的视图。</p>
<h3 id="重定向路由（redirect）"><a href="#重定向路由（redirect）" class="headerlink" title="重定向路由（redirect）"></a>重定向路由（redirect）</h3><p>重定向路由即访问$url后跳转至另外一个url，而不会产生任何的报错即称之为“重定向”，通俗了说就是<strong>你在你家开了房门，发现外面并不是自己的家</strong>就为重定向：</p>
<h4 id="重定向到另一个视图"><a href="#重定向到另一个视图" class="headerlink" title="重定向到另一个视图"></a>重定向到另一个视图</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">redirect</span>(<span class="string">&#x27;/hey&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br></pre></td></tr></table></figure>
<p>即访问<a target="_blank" rel="noopener" href="http://localhost:8000/hey%EF%BC%8C%E9%87%8D%E5%AE%9A%E5%90%91%E5%88%B0&#39;/&#39;%E6%89%80%E6%98%BE%E7%A4%BA%E7%9A%84%E8%A7%86%E5%9B%BE%60%60%60/resources/view/welcome.blade.php%60%60%60%E3%80%82">http://localhost:8000/hey，重定向到&#39;/&#39;所显示的视图```/resources/view/welcome.blade.php```。</a></p>
<h4 id="重定向到上一个页面"><a href="#重定向到上一个页面" class="headerlink" title="重定向到上一个页面"></a>重定向到上一个页面</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/hey&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">redirect</span>()-&gt;<span class="title function_ invoke__">back</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在Laravel之中，我们也可通过<code>Route::get</code>的方式来进行重定向，而最终执行重定向的是<code>return redirect</code>，只不过第一种方法更加的简洁。</p>
<h2 id="路由参数"><a href="#路由参数" class="headerlink" title="路由参数"></a>路由参数</h2><p>路由参数通常是指用于传递的一些信息，主要分为两类，分别为<strong>必要参数以及一个可选参数</strong>，本文我们主要通过获取id以及名称来进行不同的演示：</p>
<h3 id="必要参数"><a href="#必要参数" class="headerlink" title="必要参数"></a>必要参数</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;id/&#123;id&#125;&#x27;</span>, function (<span class="variable">$id</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;我的ID是：&quot;</span>.<span class="variable">$id</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>可通过访问<code>localhost:8000/id/8012</code>来访问自己的id，所返回的结果也一定是<code>我的ID是：8012</code>。</p>
<h3 id="可选参数"><a href="#可选参数" class="headerlink" title="可选参数"></a>可选参数</h3><p>可选参数与必要参数的区别就是，可选参数允许你提交空值，之后所返回的不是404而是默认定义的字符串或数值。如通过必要参数时，你访问<code>localhost:8000/id/</code>则会返回404，但是如果使用可选参数将会返回默认的值，定义方法如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/&#123;name?&#125;&#x27;</span>, function (<span class="variable">$name</span> = <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/&#123;name?&#125;&#x27;</span>, function (<span class="variable">$name</span> = <span class="string">&#x27;test&#x27;</span>) &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样你如果访问<code>localhost:8000/user/</code>不会返回404,而是返回test信息。</p>
<h2 id="路由约束"><a href="#路由约束" class="headerlink" title="路由约束"></a>路由约束</h2><p>路由约束可分为正则表达式约束、全局约束两种方式，可以理解为使用正则表达式来约束单个路由，使用全局约束来约束全部路由：</p>
<h3 id="正则表达式约束"><a href="#正则表达式约束" class="headerlink" title="正则表达式约束"></a>正则表达式约束</h3><p>使用正则表达式约束需要配合<code>where</code>来定义一个正则表达式用于约束该路由：</p>
<h4 id="单个函数约束"><a href="#单个函数约束" class="headerlink" title="单个函数约束"></a>单个函数约束</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;id/&#123;id&#125;&#x27;</span>, function (<span class="variable">$id</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;我的ID是：&quot;</span>.<span class="variable">$id</span>;</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">where</span>(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;[0-9]+&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h4 id="多个函数约束"><a href="#多个函数约束" class="headerlink" title="多个函数约束"></a>多个函数约束</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/&#123;id&#125;/&#123;name&#125;&#x27;</span>, function (<span class="variable">$id</span>, <span class="variable">$name</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;当前用户ID：&quot;</span>.<span class="variable">$id</span> . <span class="string">&quot;，名称是：&quot;</span> . <span class="variable">$name</span>;</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">where</span>([<span class="string">&#x27;id&#x27;</span> =&gt; <span class="string">&#x27;[0-9]+&#x27;</span>, <span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;[A-Za-z]+&#x27;</span>]);</span><br></pre></td></tr></table></figure>
<p>此时如果你访问<code>http://localhost:8000/user/1/test</code>将会显示“当前用户ID：1，名称是：test”，但是如果不按照正则表达式约束则会出现<code>404</code>的错误，如<code>http://localhost:8000/user/1s/test</code>。</p>
<h3 id="全局约束"><a href="#全局约束" class="headerlink" title="全局约束"></a>全局约束</h3><p>在Laravel项目中，全局约束由<code>app/Providers/RouteServiceProvider.php</code>所定义，具体为在19行左右之中：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Define your route model bindings, pattern filters, etc.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 定义id函数仅允许0-9的输入回显</span></span><br><span class="line">    <span class="title class_">Route</span>::<span class="title function_ invoke__">pattern</span>(<span class="string">&#x27;id&#x27;</span>,<span class="string">&#x27;[0-9]+&#x27;</span>);</span><br><span class="line">    <span class="built_in">parent</span>::<span class="title function_ invoke__">boot</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>routes&#x2F;web.php文件内容如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, function (<span class="variable">$id</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;我的ID是：&quot;</span>.<span class="variable">$id</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>之后通过<a target="_blank" rel="noopener" href="http://localhost:8000/user/11s%E8%AE%BF%E9%97%AE%E5%88%99%E4%BC%9A%E5%87%BA%E7%8E%B0404%E9%94%99%E8%AF%AF%EF%BC%8C%E5%A6%82%E6%8C%89%E7%85%A7%E5%85%A8%E5%B1%80%E7%BA%A6%E6%9D%9F%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%9A%E4%B9%89%E8%AE%BF%E9%97%AE%60%60%60http://localhost:8000/user/11%60%60%60%E5%88%99%E4%BC%9A%E5%9B%9E%E6%98%BE%E2%80%9C%E6%88%91%E7%9A%84ID%E6%98%AF%EF%BC%9A11%E2%80%9D%E6%95%B0%E6%8D%AE%E3%80%82">http://localhost:8000/user/11s访问则会出现404错误，如按照全局约束文件内定义访问```http://localhost:8000/user/11```则会回显“我的ID是：11”数据。</a></p>
<h2 id="路由命名"><a href="#路由命名" class="headerlink" title="路由命名"></a>路由命名</h2><p>路由命名可以为指定的路由生成一个url或者重定向，可以通过<code>name</code>来指定路由名称：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/test&#x27;</span>, function () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/&#123;id?&#125;&#x27;</span>, function (<span class="variable">$id</span> = <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;我的ID是：&quot;</span>.<span class="variable">$id</span>;</span><br><span class="line">&#125;)-&gt;<span class="title function_ invoke__">name</span>(<span class="string">&#x27;user.id&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="路由名称前缀"><a href="#路由名称前缀" class="headerlink" title="路由名称前缀"></a>路由名称前缀</h3><p>后续我们会有一个路由前缀，而为了简便开发，Laravel还提供了一个路由名称前缀，来方便我们与视图的对接：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">group</span>([], function () &#123;</span><br><span class="line">    <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/test&#x27;</span>, function () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="title class_">Route</span>::<span class="title function_ invoke__">name</span>(<span class="string">&#x27;user.&#x27;</span>)-&gt;<span class="title function_ invoke__">group</span>(function () &#123;</span><br><span class="line">        <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/&#123;id?&#125;&#x27;</span>, function (<span class="variable">$id</span> = <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;ID is be:&quot;</span> .<span class="variable">$id</span>;</span><br><span class="line">        &#125;)-&gt;<span class="title function_ invoke__">name</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    ……</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>当然我们这还加上了路由分组，来让代码的可读性和延伸扩展性进行了一系列的优化，而这个路由前缀的最后结果为<code>user.id</code>，我们可以继续。</p>
<h3 id="test-blade-php"><a href="#test-blade-php" class="headerlink" title="test.blade.php"></a>test.blade.php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;&#123;&#123; str_replace(&#x27;_&#x27;, &#x27;-&#x27;, app()-&gt;getLocale()) &#125;&#125;&quot;</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;title&gt;Laravel&lt;/title&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- Fonts --&gt;</span><br><span class="line">    &lt;link href=<span class="string">&quot;https://fonts.googleapis.com/css?family=Nunito:200,600&quot;</span> rel=<span class="string">&quot;stylesheet&quot;</span>&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;a href=<span class="string">&quot;&#123;&#123;route(&#x27;user.id&#x27;, [&#x27;id&#x27; =&gt; 10])&#125;&#125;&quot;</span>&gt;go&gt;&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="路由分组"><a href="#路由分组" class="headerlink" title="路由分组"></a>路由分组</h2><p>在Laravel框架中，路由分组可以通过使用<code>Route::group</code>将不同的路由分别划分在一起，来让代码更加的简洁优雅：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">group</span>([],function () &#123;</span><br><span class="line">    <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/test&#x27;</span>, function () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">view</span>(<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/&#123;id?&#125;&#x27;</span>, function (<span class="variable">$id</span> = <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我的ID是：&quot;</span>.<span class="variable">$id</span>;</span><br><span class="line">    &#125;)-&gt;<span class="title function_ invoke__">name</span>(<span class="string">&#x27;user.id&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="子域名路由"><a href="#子域名路由" class="headerlink" title="子域名路由"></a>子域名路由</h2><p>顾名思义即用于处理子域名的路由，如pv.zsun.org.cn就是一个子路由，本文仅仅用于演示语法，该语法并不具有可执行性，想实现的读者可通过配置服务器应用文件即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">domain</span>(<span class="string">&#x27;&#123;er&#125;.url.org.cn&#x27;</span>)-&gt;<span class="title function_ invoke__">group</span>(function () &#123;</span><br><span class="line">    <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;user/&#123;id&#125;&#x27;</span>, function (<span class="variable">$er</span>, <span class="variable">$id</span>) &#123;</span><br><span class="line">       <span class="comment">// code</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;当前子域名为：&quot;</span>.<span class="variable">$er</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;用户ID为：&quot;</span>.<span class="variable">$id</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="域名前缀"><a href="#域名前缀" class="headerlink" title="域名前缀"></a>域名前缀</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/4.laravel%20%E8%B7%AF%E7%94%B1.md/20210207112951830_1866358753.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">prefix</span>(<span class="string">&#x27;one&#x27;</span>)-&gt;<span class="title function_ invoke__">group</span>(function () &#123;</span><br><span class="line">   <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;two&#x27;</span>, function () &#123;</span><br><span class="line">       <span class="comment">// 即 localhost:8000/one/two</span></span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;one/two&quot;</span>;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>域名前缀偶尔会让读者产生一丝的误会，实际上域名前缀指的是一个一个目录下包含着的一些文件，以这个为比喻可能更加方便读者的理解，如上述我们所写的域名前缀则意为：</p>
<blockquote>
<p>one&#x2F;下的&#x2F;two，即可通过<a target="_blank" rel="noopener" href="http://localhost:8000/one/two%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%BD%93%E7%84%B6%E6%88%91%E4%BB%AC%E4%B9%9F%E5%8F%AF%E4%BB%A5%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AAthree">http://localhost:8000/one/two进行访问，当然我们也可以定义一个three</a>:</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">prefix</span>(<span class="string">&#x27;one&#x27;</span>)-&gt;<span class="title function_ invoke__">group</span>(function () &#123;</span><br><span class="line">   <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;two&#x27;</span>, function () &#123;</span><br><span class="line">       <span class="comment">// 即 localhost:8000/one/two</span></span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;one/two&quot;</span>;</span><br><span class="line">   &#125;);</span><br><span class="line">   <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;three&#x27;</span>, function () &#123;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;one/three&quot;</span>;</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/php/laravel/3.Laravel 项目配置与模式/">Laravel 项目配置与模式</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/laravel/" rel="tag">laravel</a> <a class="article__tag-none-link" href="/tags/php/" rel="tag">php</a>
			</span>
		
	</div>

	

	
		<h2 id="项目配置"><a href="#项目配置" class="headerlink" title="项目配置"></a>项目配置</h2><h3 id="env"><a href="#env" class="headerlink" title="env"></a>env</h3><p>Laravel的项目配置与模式与Java or Java  web差不多，可通过<code>.env</code>文件自来配置当前项目的环境，这个文件是在composer创建项目时自动进行创建的，其中<code>.env</code>下的文件都是自进行生成的，当然你也可以根据项目所需进行自定义，以下是<code>.env</code>文件内容：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">APP_NAME=Laravel</span><br><span class="line">APP_ENV=local</span><br><span class="line">APP_KEY=base64:mHuJZujFK7vNFQAK+TqBNYGkw16feddY6Bf6oK8UUtc=</span><br><span class="line">APP_DEBUG=<span class="literal">true</span></span><br><span class="line">APP_URL=http:<span class="comment">//localhost</span></span><br><span class="line"></span><br><span class="line">LOG_CHANNEL=stack</span><br><span class="line"></span><br><span class="line">DB_CONNECTION=mysql</span><br><span class="line">DB_HOST=<span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">DB_PORT=<span class="number">3306</span></span><br><span class="line">DB_DATABASE=laravel</span><br><span class="line">DB_USERNAME=root</span><br><span class="line">DB_PASSWORD=</span><br><span class="line"></span><br><span class="line">BROADCAST_DRIVER=log</span><br><span class="line">CACHE_DRIVER=file</span><br><span class="line">QUEUE_CONNECTION=sync</span><br><span class="line">SESSION_DRIVER=file</span><br><span class="line">SESSION_LIFETIME=<span class="number">120</span></span><br><span class="line"></span><br><span class="line">REDIS_HOST=<span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">REDIS_PASSWORD=<span class="literal">null</span></span><br><span class="line">REDIS_PORT=<span class="number">6379</span></span><br><span class="line"></span><br><span class="line">MAIL_DRIVER=smtp</span><br><span class="line">MAIL_HOST=smtp.mailtrap.io</span><br><span class="line">MAIL_PORT=<span class="number">2525</span></span><br><span class="line">MAIL_USERNAME=<span class="literal">null</span></span><br><span class="line">MAIL_PASSWORD=<span class="literal">null</span></span><br><span class="line">MAIL_ENCRYPTION=<span class="literal">null</span></span><br><span class="line"></span><br><span class="line">AWS_ACCESS_KEY_ID=</span><br><span class="line">AWS_SECRET_ACCESS_KEY=</span><br><span class="line">AWS_DEFAULT_REGION=us-east-<span class="number">1</span></span><br><span class="line">AWS_BUCKET=</span><br><span class="line"></span><br><span class="line">PUSHER_APP_ID=</span><br><span class="line">PUSHER_APP_KEY=</span><br><span class="line">PUSHER_APP_SECRET=</span><br><span class="line">PUSHER_APP_CLUSTER=mt1</span><br><span class="line"></span><br><span class="line">MIX_PUSHER_APP_KEY=<span class="string">&quot;$&#123;PUSHER_APP_KEY&#125;&quot;</span></span><br><span class="line">MIX_PUSHER_APP_CLUSTER=<span class="string">&quot;$&#123;PUSHER_APP_CLUSTER&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="config-x2F-database-php"><a href="#config-x2F-database-php" class="headerlink" title="config&#x2F;database.php"></a>config&#x2F;database.php</h3><p>相信很多读者都使用过原生态的php写web项目，连接数据库的语法都极具特色，在Laravel项目中，Laravel为我们提供了一个专门的数据库配置文件，我们只需要修改相关参数即可：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;mysql&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;url&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DATABASE_URL&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;host&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_HOST&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;port&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_PORT&#x27;</span>, <span class="string">&#x27;3306&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;database&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_DATABASE&#x27;</span>, <span class="string">&#x27;forge&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;username&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_USERNAME&#x27;</span>, <span class="string">&#x27;forge&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;password&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_PASSWORD&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;unix_socket&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;DB_SOCKET&#x27;</span>, <span class="string">&#x27;&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;charset&#x27;</span> =&gt; <span class="string">&#x27;utf8mb4&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;collation&#x27;</span> =&gt; <span class="string">&#x27;utf8mb4_unicode_ci&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;prefix_indexes&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;strict&#x27;</span> =&gt; <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&#x27;engine&#x27;</span> =&gt; <span class="literal">null</span>,</span><br><span class="line">    <span class="string">&#x27;options&#x27;</span> =&gt; <span class="title function_ invoke__">extension_loaded</span>(<span class="string">&#x27;pdo_mysql&#x27;</span>) ? <span class="title function_ invoke__">array_filter</span>([</span><br><span class="line">        PDO::<span class="variable constant_">MYSQL_ATTR_SSL_CA</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;MYSQL_ATTR_SSL_CA&#x27;</span>),</span><br><span class="line">    ]) : [],</span><br><span class="line">],</span><br></pre></td></tr></table></figure>
<h2 id="模式"><a href="#模式" class="headerlink" title="模式"></a>模式</h2><h3 id="维护模式-down"><a href="#维护模式-down" class="headerlink" title="维护模式 (down)"></a>维护模式 (down)</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/3.laravel%20%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E4%B8%8E%E6%A8%A1%E5%BC%8F.md/20210207065230658_109968253.png"><br>Laravel维护模式可以通过使用<code>php artisan down</code>进行开启，开启后如果再次访问则会出现503：暂停服务的字样</p>
<h3 id="正常模式-（up）"><a href="#正常模式-（up）" class="headerlink" title="正常模式 （up）"></a>正常模式 （up）</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/markdown/web/php/laravel/3.laravel%20%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E4%B8%8E%E6%A8%A1%E5%BC%8F.md/20210207065435553_513893208.png"><br>当然，Laravel不仅仅支持维护模式，还支持一个正常模式，这个模式下则会显示正常的文件内信息，可通过<code>php artisan up</code>开启。</p>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/php/laravel/23.Laravel Redis&amp;Command and Job/">Laravel Redis&amp;Command</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/laravel/" rel="tag">laravel</a> <a class="article__tag-none-link" href="/tags/php/" rel="tag">php</a>
			</span>
		
	</div>

	

	
		<p>Laravel 可以通过 Command 以及相关方法来讲 Redis 进行存储并映射到 MySQL 数据库中，通过 <code>composer require predis/predis</code> 命令来安装 Laravel Redis 的扩展，前提是在 PHP 具有 redis 扩展。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看是否具有 Redis 的扩展我们可以通过 ```php -m``` 的命令来进行查看，如果没有我们可以通过集成环境或者直接到 pecl 所提供的 PHP 扩展下载站 [PECL](https://pecl.php.net/package/redis)中来进行下载，可以通过 ```php --verion``` 来查看当前的 PHP 类型和当前环境信息等。</span><br></pre></td></tr></table></figure>

<p>按照官方文档的示例，在安装完 Redis 扩展后，我们可以在 <code>.env</code> 文件中修改 <code>REDIS_PASSWORD</code> 等配置，此外，也可以建立多个 Redis 链接，但前提是在 <code>config/database.php</code> 中进行一定的配置。</p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20220309210324.png"></p>
<p>我们也可以在 <code>config/database.php</code> 中配置 Redis 的相关的账号信息，比如账号密码和 Key 名等，都可以在 <code>redis</code>  中进行配置：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;redis&#x27;</span> =&gt; [  </span><br><span class="line">  </span><br><span class="line">    <span class="string">&#x27;client&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_CLIENT&#x27;</span>, <span class="string">&#x27;phpredis&#x27;</span>),  </span><br><span class="line">  </span><br><span class="line">    <span class="string">&#x27;options&#x27;</span> =&gt; [  </span><br><span class="line">        <span class="string">&#x27;cluster&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_CLUSTER&#x27;</span>, <span class="string">&#x27;redis&#x27;</span>),  </span><br><span class="line">        <span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_PREFIX&#x27;</span>, <span class="title class_">Str</span>::<span class="title function_ invoke__">slug</span>(<span class="title function_ invoke__">env</span>(<span class="string">&#x27;APP_NAME&#x27;</span>, <span class="string">&#x27;laravel&#x27;</span>), <span class="string">&#x27;_&#x27;</span>).<span class="string">&#x27;_database_&#x27;</span>),  </span><br><span class="line">    ],  </span><br><span class="line">  </span><br><span class="line">    <span class="string">&#x27;default&#x27;</span> =&gt; [  </span><br><span class="line">        <span class="string">&#x27;url&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_URL&#x27;</span>),  </span><br><span class="line">        <span class="string">&#x27;host&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_HOST&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>),  </span><br><span class="line">        <span class="string">&#x27;password&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_PASSWORD&#x27;</span>, <span class="string">&#x27;redis&#x27;</span>),  </span><br><span class="line">        <span class="string">&#x27;port&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_PORT&#x27;</span>, <span class="string">&#x27;6379&#x27;</span>),  </span><br><span class="line">        <span class="string">&#x27;database&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_DB&#x27;</span>, <span class="string">&#x27;14&#x27;</span>),  </span><br><span class="line">    ],  </span><br><span class="line">  </span><br><span class="line">    <span class="string">&#x27;cache&#x27;</span> =&gt; [  </span><br><span class="line">        <span class="string">&#x27;url&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_URL&#x27;</span>),  </span><br><span class="line">        <span class="string">&#x27;host&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_HOST&#x27;</span>, <span class="string">&#x27;127.0.0.1&#x27;</span>),  </span><br><span class="line">        <span class="string">&#x27;password&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_PASSWORD&#x27;</span>, <span class="literal">null</span>),  </span><br><span class="line">        <span class="string">&#x27;port&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_PORT&#x27;</span>, <span class="string">&#x27;6379&#x27;</span>),  </span><br><span class="line">        <span class="string">&#x27;database&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;REDIS_CACHE_DB&#x27;</span>, <span class="string">&#x27;15&#x27;</span>),  </span><br><span class="line">    ],  </span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>之后，我们也可以在 <code>app/Http/Controllers/</code> 中定义一个名为 <code>RedisController.php</code> 的控制器，引入 <code>Illuminate\Support\Facades\Redis</code> 扩展并作为 <code>App\Http\Controllers\Controller</code> 的延伸，定义两个基础的 Redis 存储方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Redis</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisController</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="title class_">Redis</span>::<span class="title function_ invoke__">set</span>(<span class="string">&#x27;key&#x27;</span>,<span class="string">&#x27;hello,redis!&#x27;</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="variable">$name</span> = <span class="title class_">Redis</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;key&#x27;</span>);  </span><br><span class="line">        <span class="title function_ invoke__">var_dump</span>(<span class="variable">$name</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后，为了使得方法的正常执行，我们还需要通过路由来定义，在 <code>routes/web.php</code> 中写入：</p>
<p> <img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20220309210258.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/get&#x27;</span>, <span class="string">&#x27;RedisController@get&#x27;</span>);  </span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/set&#x27;</span>, <span class="string">&#x27;RedisController@set&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>最后，我们就可以通过 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/set">http://127.0.0.1:8000/set</a> 和 <a target="_blank" rel="noopener" href="http://127.0.0.1:8000/get">http://127.0.0.1:8000/get</a> 来进行对 Redis 的 Set 和 Get 的操作。</p>
<p>同样的 Laravel Predis 支持了 Redis 的命令，我们可以通过阅读 <a target="_blank" rel="noopener" href="https://www.redis.com.cn/redis-commands.html">Redis 官方文档</a> 或 <a target="_blank" rel="noopener" href="https://www.redis.com.cn/commands.html">Redis 速查表</a> 来配合 Laravel 来进行实现对 Redis 的操作。</p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20220309212434.png"></p>
<p>对于 <code>hMset</code> 类型的插入，我们可以通过使用 <code>Redis:hMset</code> 的方式来进行插入，如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Redis</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisController</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">set</span>(<span class="params"></span>) </span>&#123;  </span><br><span class="line">        <span class="variable">$key</span> = <span class="string">&#x27;HSET&#x27;</span>;  </span><br><span class="line">        <span class="variable">$value</span>= [  </span><br><span class="line">            <span class="string">&#x27;id&#x27;</span> =&gt;  <span class="string">&#x27;1&#x27;</span>,  </span><br><span class="line">            <span class="string">&#x27;name&#x27;</span> =&gt;  <span class="string">&#x27;test&#x27;</span>,  </span><br><span class="line">            <span class="string">&#x27;mess&#x27;</span> =&gt;  <span class="string">&#x27;This is test&#x27;</span>  </span><br><span class="line"> ];  </span><br><span class="line">        <span class="title class_">Redis</span>::<span class="title function_ invoke__">hMset</span>(<span class="variable">$key</span>,<span class="variable">$value</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Command-amp-Job"><a href="#Command-amp-Job" class="headerlink" title="Command &amp; Job"></a>Command &amp; Job</h2><p>Redis 通常是一个缓存服务，主要用于作为中间层进行，我们可以通过使用 Reids 配合 Laravel 作为队列，通过 Laravel 队列所支持的 Command 来将 Redis 信息提取后映射到 MySQL 或其他数据库中。</p>
<p>在本文中，我们主要理解 Laravel 队列以及 Job(工作线程) 和 Command 的使用，同样的我们也可以通过 Controller 来进行调用 Job。</p>
<p>我们可以使用 Laravel artisan 命令来创建一个工作线程，并命名为 <code>RedisJobTest</code> ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:job RedisJobTest</span><br></pre></td></tr></table></figure>

<p>创建完后他会在 <code>app/Jobs/</code> 目录下生成一个 <code>RedisJobTest.php</code> 的 PHP 类，我们需要在里面进行编辑：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Jobs</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Bus</span>\<span class="title">Queueable</span>;  </span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Queue</span>\<span class="title">ShouldQueue</span>;  </span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Bus</span>\<span class="title">Dispatchable</span>;  </span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Queue</span>\<span class="title">InteractsWithQueue</span>;  </span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Queue</span>\<span class="title">SerializesModels</span>;  </span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Redis</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisJobTest</span> <span class="keyword">implements</span> <span class="title">ShouldQueue</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="keyword">use</span> <span class="title">Dispatchable</span>, <span class="title">InteractsWithQueue</span>, <span class="title">Queueable</span>, <span class="title">SerializesModels</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$key</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * Create a new job instance. * * <span class="doctag">@return</span> void  </span></span><br><span class="line"><span class="comment"> */</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$key</span></span>)  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="comment">// key  </span></span><br><span class="line"> <span class="variable language_">$this</span>-&gt;key = <span class="variable">$key</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * Execute the job. * * <span class="doctag">@return</span> void  </span></span><br><span class="line"><span class="comment"> */</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="variable">$llen</span>      = <span class="title class_">Redis</span>::<span class="title function_ invoke__">connection</span>()-&gt;<span class="title function_ invoke__">LLEN</span>(<span class="variable">$this</span>-&gt;key);  </span><br><span class="line">        <span class="variable">$lineToint</span> = (<span class="keyword">int</span>)<span class="variable">$llen</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">dump</span>(<span class="variable">$lineToint</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后我们还需要创建一个命令，用于调用该队列，同样的我们也使用 Artisan 命令来进行创建：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:command RedisJobCommand</span><br></pre></td></tr></table></figure>

<p>然后在 <code>app/Console/Commands/RedisJobCommand.php</code> 下，来调用我们的工作线程：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Console</span>\<span class="title class_">Commands</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Jobs</span>\<span class="title">RedisJobTest</span>;  </span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Console</span>\<span class="title">Command</span>;  </span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Log</span>;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisJobCommand</span> <span class="keyword">extends</span> <span class="title">Command</span>  </span></span><br><span class="line"><span class="class"></span>&#123;  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * The name and signature of the console command. * * <span class="doctag">@var</span> string  </span></span><br><span class="line"><span class="comment"> */</span> <span class="keyword">protected</span> <span class="variable">$signature</span> = <span class="string">&#x27;command:redis_job_test&#x27;</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * The console command description. * * <span class="doctag">@var</span> string  </span></span><br><span class="line"><span class="comment"> */</span> <span class="keyword">protected</span> <span class="variable">$description</span> = <span class="string">&#x27;Command description&#x27;</span>;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * Create a new command instance. * * <span class="doctag">@return</span> void  </span></span><br><span class="line"><span class="comment"> */</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="built_in">parent</span>::<span class="title function_ invoke__">__construct</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/**  </span></span><br><span class="line"><span class="comment"> * Execute the console command. * * <span class="doctag">@return</span> mixed  </span></span><br><span class="line"><span class="comment"> */</span> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params"></span>)  </span></span><br><span class="line"><span class="function">    </span>&#123;  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Redis run start&#x27;</span>;  </span><br><span class="line">  </span><br><span class="line">        <span class="title class_">RedisJobTest</span>::<span class="title function_ invoke__">dispatch</span>(<span class="string">&#x27;SET&#x27;</span>)  </span><br><span class="line">            -&gt;<span class="title function_ invoke__">delay</span>(<span class="title function_ invoke__">now</span>()-&gt;<span class="title function_ invoke__">addMinutes</span>(<span class="number">1</span>));  </span><br><span class="line">  </span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Redis run end&#x27;</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在上述的 Code 中，我们主要通过 <code>$signature</code> 类型来定义一个命令，同样的我们也可以在 <code>$description</code> 添加该命令的方法和描述，最后在 <code>handle</code> 方法中写入 <code>RedisJobTest::dispatch</code> 来调用 RedisJobTest 工作线程。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通过上述的流程演示，我们可以通过工作线程来实现 Redis 锁，在 Laravel Job 中的 ```handle()``` 方法下，添加 Redis 锁即可：</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Redis</span>::<span class="title function_ invoke__">throttle</span>(<span class="string">&#x27;key&#x27;</span>)-&gt;<span class="title function_ invoke__">allow</span>(<span class="number">10</span>)-&gt;<span class="title function_ invoke__">every</span>(<span class="number">60</span>)-&gt;<span class="title function_ invoke__">then</span>(function () &#123;</span><br><span class="line">    <span class="comment">// 任务逻辑...</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 无法获得锁...</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">release</span>(<span class="number">10</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>上述 code 中，主要 Redis 中的频率限制，也就是限制指定类型每 60 秒只执行10次，如果没有锁，那么一般情况下将会导致任务被放回队列使其被重试。</p>
<p>在大量的数据涌入的情况下可能会导致数据库的崩溃从而出现错误，因此我们需要使用到 Redis 锁，这些在 Laravel 中主要被称之为频率限制，我们可以翻阅官方文档来检索我们需要的 <a target="_blank" rel="noopener" href="https://learnku.com/docs/laravel/6.x/queues/5168#6b57e8">队列 | 综合话题 |《Laravel 6 中文文档 6.x》| Laravel China 社区 (learnku.com)</a>。</p>
<p>在官方文档中，我们也可以在调用队列的时候对其进行延迟分发，这主要通过 <code>delay</code> 方法来进行实现，详细的可以查阅官方文档的描述 <a target="_blank" rel="noopener" href="https://learnku.com/docs/laravel/6.x/queues/5168#2d054a">队列 | 综合话题 |《Laravel 6 中文文档 6.x》| Laravel China 社区 (learnku.com)</a>。</p>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/php/laravel/22.Laravel Email 认证/">Laravel Email 认证</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/laravel/" rel="tag">laravel</a> <a class="article__tag-none-link" href="/tags/php/" rel="tag">php</a>
			</span>
		
	</div>

	

	
		<p>Laravel 为开发者提供了一种非常简便的方法来实现出 Email 认证，很遗憾的是官方文档所提供的信息并不完整。</p>
<h2 id="发送"><a href="#发送" class="headerlink" title="发送"></a>发送</h2><h3 id="MustVerifyEmail"><a href="#MustVerifyEmail" class="headerlink" title="MustVerifyEmail"></a>MustVerifyEmail</h3><p>首先，我们直接在 <code>app/User.php</code> 加上 <code>MustVerifyEmail</code> 接口使让其成为 <code>User.php</code> 的接口即可：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Auth</span>\<span class="title">MustVerifyEmail</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">User</span> <span class="keyword">as</span> <span class="title">Authenticatable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Notifications</span>\<span class="title">Notifiable</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Authenticatable</span> <span class="keyword">implements</span> <span class="title">MustVerifyEmail</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="env"><a href="#env" class="headerlink" title=".env"></a>.env</h3><p>当配置接口类之后，我们还需要配置 <code>.env</code> 文件，并在此修改其邮箱的服务器以用于发送邮件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">MAIL_DRIVER=<span class="literal">null</span></span><br><span class="line">MAIL_HOST=<span class="literal">null</span></span><br><span class="line">MAIL_PORT=<span class="literal">null</span></span><br><span class="line">MAIL_USERNAME=<span class="literal">null</span></span><br><span class="line">MAIL_PASSWORD=<span class="literal">null</span></span><br><span class="line">MAIL_ENCRYPTION=<span class="literal">null</span></span><br><span class="line">MAIL_FROM_ADDRESS=<span class="literal">null</span></span><br><span class="line">MAIL_FROM_NAME=<span class="string">&quot;$&#123;APP_NAME&#125;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="保护路由"><a href="#保护路由" class="headerlink" title="保护路由"></a>保护路由</h3><p>Laravel 的 <code>Auth\VerificationConteroller</code> 类包含了发送验证链接和看验证 Email 的必要逻辑。这都将通过 <code>verify</code> 选项传递给 <code>Auth::routes</code>方法中，因此我们需要在 <code>web.php</code> 中增加：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Web Routes</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| Here is where you can register web routes for your application. These</span></span><br><span class="line"><span class="comment">| routes are loaded by the RouteServiceProvider within a group which</span></span><br><span class="line"><span class="comment">| contains the &quot;web&quot; middleware group. Now create something great!</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Auth</span>::<span class="title function_ invoke__">routes</span>([<span class="string">&#x27;verify&#x27;</span>=&gt;<span class="literal">true</span>]);</span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">group</span>([],function () &#123;</span><br><span class="line">    <span class="title class_">Route</span>::<span class="title function_ invoke__">get</span>(<span class="string">&#x27;/home&#x27;</span>, <span class="string">&#x27;HomeController@space&#x27;</span>)-&gt;<span class="title function_ invoke__">name</span>(<span class="string">&#x27;home&#x27;</span>)-&gt;<span class="title function_ invoke__">middleware</span>(<span class="string">&#x27;verified&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当我们在 get 路由后加入 <code>middleware(&#39;verified&#39;)</code> 方法后，将会自动验证当前用户使用邮箱是否经过验证，通过验证的用户将会在 <code>users</code> 数据库表中 <code>email_verified_at</code>字段中添加其验证时间。</p>
<h3 id="验证重定向"><a href="#验证重定向" class="headerlink" title="验证重定向"></a>验证重定向</h3><p>如果要设置验证完成后主要通过 <code>app/Http/Controllers/Auth/VerificationController.php</code> 类中的 <code>$redirectTo</code> 属性来进行设置，默认的是跳转至用户的个人空间：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>\<span class="title class_">Http</span>\<span class="title class_">Controllers</span>\<span class="title class_">Auth</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>\<span class="title">Controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Providers</span>\<span class="title">RouteServiceProvider</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">VerifiesEmails</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VerificationController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    |--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">    | Email Verification Controller</span></span><br><span class="line"><span class="comment">    |--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">    |</span></span><br><span class="line"><span class="comment">    | This controller is responsible for handling email verification for any</span></span><br><span class="line"><span class="comment">    | user that recently registered with the application. Emails may also</span></span><br><span class="line"><span class="comment">    | be re-sent if the user didn&#x27;t receive the original email message.</span></span><br><span class="line"><span class="comment">    |</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">use</span> <span class="title">VerifiesEmails</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Where to redirect users after verification.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$redirectTo</span> = <span class="title class_">RouteServiceProvider</span>::<span class="variable constant_">HOME</span>;</span><br><span class="line"></span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如果在登录后验证邮箱时出错，可通过下述两条 <code>artisan</code> 命令来清理下 Laravel 缓存：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php artisan config:cache</span><br><span class="line">php artisan cache:clear</span><br></pre></td></tr></table></figure>

<h2 id="文本"><a href="#文本" class="headerlink" title="文本"></a>文本</h2><h3 id="邮箱验证"><a href="#邮箱验证" class="headerlink" title="邮箱验证"></a>邮箱验证</h3><h4 id="Notifications"><a href="#Notifications" class="headerlink" title="Notifications"></a>Notifications</h4><p>在 Laravel 中，我们可以通过使用 <code>php artisan make:notification VerifyEmail</code> 来新建一个 VerifyEmail 邮件通知，正常情况下他默认存储在了 <code>vendor/laravel/framework/src/Illuminate/Auth/Notifications/VerifyEmail.php</code> 下。</p>
<p>此  时在 <strong>toMail</strong> 方法下，来自定义邮件中的用语：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> (<span class="keyword">new</span> <span class="title class_">MailMessage</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">greeting</span>(<span class="string">&#x27;Hello!&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">line</span>(<span class="string">&#x27;One of your invoices has been paid!&#x27;</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">action</span>(<span class="string">&#x27;View Invoice&#x27;</span>, <span class="variable">$url</span>)</span><br><span class="line">            -&gt;<span class="title function_ invoke__">line</span>(<span class="string">&#x27;Thank you for using our application!&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="sendEmailVerificationNotification"><a href="#sendEmailVerificationNotification" class="headerlink" title="sendEmailVerificationNotification"></a>sendEmailVerificationNotification</h4><p>当你通过使用 <code>artisan</code> 命令创建一个邮件通知后，并不代表已经完成了，还需要在 <code>app/User.php</code> 中添加一个 <code>sendEmailVerificationNotification</code> 即“发送电子邮件验证通知”方法：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Notifications</span>\<span class="title">VerifyEmail</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Auth</span>\<span class="title">MustVerifyEmail</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">User</span> <span class="keyword">as</span> <span class="title">Authenticatable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Notifications</span>\<span class="title">Notifiable</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Authenticatable</span> <span class="keyword">implements</span> <span class="title">MustVerifyEmail</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ……</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sendEmailVerificationNotification</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">notify</span>(<span class="keyword">new</span> <span class="title class_">VerifyEmail</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="notifications"><a href="#notifications" class="headerlink" title="notifications"></a>notifications</h4><p>既然当 Notifications 以及 sendEmailVerificationNotification 都配置完成了，我们还需要来自定义邮件的模板：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --tag=laravel-notifications</span><br></pre></td></tr></table></figure>

<p>此时会将 <code>/vendor/laravel/framework/src/Illuminate/Notifications/resources/views</code> 内容复制到 <code>/resources/views/vendor/notifications</code> 下。</p>
<p>当然你如果需要将所有 <del>Markdown</del> 通知组件导出自己的项目中进行自定义：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan vendor:publish --tag=laravel-mail</span><br></pre></td></tr></table></figure>

<p>Laravel 会将<code>/vendor/laravel/framework/src/Illuminate/Mail/resources/views</code>目录内容复制到<code>/resources/views/vendor/mail</code>下。</p>
<p>需要注意的是，该目录会包含除组件之外的 <code>resources/views/vendor/mail/html/themes</code>目录，该目录下存储着默认的主题文件，您可以自行定义并分享。</p>
<h3 id="重置密码"><a href="#重置密码" class="headerlink" title="重置密码"></a>重置密码</h3><h4 id="ResetPassword"><a href="#ResetPassword" class="headerlink" title="ResetPassword"></a>ResetPassword</h4><p>在进行下一步之后，我们需要来对重置密码的文本模板进行更改，和 <strong>邮箱验证</strong> 相差无几，需要通过使用 <code>artisan</code> 命令：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php artisan make:notification ResetPassword</span><br></pre></td></tr></table></figure>

<p>之后将从 <code>vendor/laravel/framework/src/Illuminate/Auth/Notifications/ResetPassword.php</code> 文件复制到 <code>app/Notifications/ResetPassword.php</code>中，因此我们可以参考 <code>vendor</code> 内的文件结构写入<code>app/Notifications</code>目录下。</p>
<h4 id="sendPasswordResetNotification"><a href="#sendPasswordResetNotification" class="headerlink" title="sendPasswordResetNotification"></a>sendPasswordResetNotification</h4><p>当 <strong>ResetPassword</strong> 准备完成之后，我们需要通过在<code>app/User.php</code>文件中添加一个<code>sendPasswordResetNotification</code>方法，来使得 <strong>ResetPassword</strong> 通知被正常使用：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Notifications</span>\<span class="title">VerifyEmail</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">App</span>\<span class="title">Notifications</span>\<span class="title">ResetPassword</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Contracts</span>\<span class="title">Auth</span>\<span class="title">MustVerifyEmail</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Foundation</span>\<span class="title">Auth</span>\<span class="title">User</span> <span class="keyword">as</span> <span class="title">Authenticatable</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Notifications</span>\<span class="title">Notifiable</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">Authenticatable</span> <span class="keyword">implements</span> <span class="title">MustVerifyEmail</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ……</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">sendPasswordResetNotification</span>(<span class="params"><span class="variable">$token</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">notify</span>(<span class="keyword">new</span> <span class="title class_">ResetPassword</span>(<span class="variable">$token</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/php/laravel/21.Laravel Eloquent 序列化/">Laravel Eloquent 序列化</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/laravel/" rel="tag">laravel</a> <a class="article__tag-none-link" href="/tags/php/" rel="tag">php</a>
			</span>
		
	</div>

	

	
		<p>在构建 JSON API 的时候，我们需要通过使用 Eloquent 所提供的一些简便方法来进行实现。需要注意的是我们可以通过设置返回的 <code>header</code>来进行返回 <strong>具有人类可读</strong> 的输出。</p>
<p>在官方文档中我们可以看到，我们可以序列化为数组或者字符串形式，<strong>但实际上，并不是这样</strong> 直接返回 <code>return $data</code> 即可返回出 json。因此官方文档所提供的 <code>toJson \ toArray</code>都输出的是<code>Json</code>格式内容。</p>
<p>且返回的数据中文均不是人类具有可读性的 <code>\x000</code> 格式，即 <strong>Unicode16</strong> 格式，无论你在返回中添加 <strong>JSON_UNESCAPED_UNICODE</strong> 都无济于事。</p>
<h2 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$issue</span> = <span class="title class_">IssuesModel</span>::<span class="title function_ invoke__">all</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">response</span>()-&gt;<span class="title function_ invoke__">json</span>(<span class="variable">$issue</span>,<span class="number">200</span>,[<span class="string">&#x27;Content-Type&#x27;</span>=&gt;<span class="string">&#x27;application/json;charset=UTF-8&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Charset&#x27;</span>=&gt;<span class="string">&#x27;utf-8&#x27;</span>],</span><br><span class="line">        JSON_UNESCAPED_UNICODE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此他返回的是一个 <strong>具有人类可读</strong> 的 JSON 类型文本，如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;titles&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;datetimes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-05-17 03:27:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;names&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-05-17 03:27:42&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-05-17 03:27:42&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h2 id="黑名单与白名单"><a href="#黑名单与白名单" class="headerlink" title="黑名单与白名单"></a>黑名单与白名单</h2><h3 id="黑名单"><a href="#黑名单" class="headerlink" title="黑名单"></a>黑名单</h3><p>在官方的文档中，黑名单被称之为更具直观的 “ <strong>隐藏输出</strong> ”，即从字面意思上理解不输出当前属性的值，我们可以在需要输出的 <code>Eloquent ORM 模型</code> 中保护属性中添加一个 <code>$hidden</code> 属性即可。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">App</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Database</span>\<span class="title">Eloquent</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestModel</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    ……</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$hidden</span> = [<span class="string">&#x27;titles&#x27;</span>,<span class="string">&#x27;datetimes&#x27;</span>,<span class="string">&#x27;names&#x27;</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此相应的 json 对象也不会进行输出，如原先的 <code> [&#39;titles&#39;,&#39;datetimes&#39;,&#39;names&#39;]</code> 都不会在下述的返回响应中不会输出。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-05-17 03:27:42&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-05-17 03:27:42&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;……&quot;</span><span class="punctuation">:</span> <span class="keyword">null</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h3 id="白名单"><a href="#白名单" class="headerlink" title="白名单"></a>白名单</h3><p>白名单在官方文档中也被称之为 “白名单”，因此在本文中我们可以使用一种更为直观的方法来以 “ <strong>需要输出的对象</strong> ” 来更加直观的理解。白名单的输出也非常简单，和上述步骤一样在 <code>Eloquent ORM 模型</code>中添加一个<code>$visible</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="variable">$visible</span> = [<span class="string">&#x27;titles&#x27;</span>,<span class="string">&#x27;datetimes&#x27;</span>,<span class="string">&#x27;names&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>因此输出的也是只有相应的 json 对象：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;titles&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;datetimes&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2021-05-17 03:27:00&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;names&quot;</span><span class="punctuation">:</span> <span class="string">&quot;……&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/php/laravel/20.Laravel Flysystem/">Laravel Flysystem</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/laravel/" rel="tag">laravel</a> <a class="article__tag-none-link" href="/tags/php/" rel="tag">php</a>
			</span>
		
	</div>

	

	
		<p>Laravel 通过 Frank de Jonge 内的 Flysystem 扩展包为开发者提供了一个强大的文件系统抽象概念。配置 Flysystem 的配置在<code>config/filesystem.php</code>中，再次我们可以配置所有的文件存储位置以及文件磁盘。</p>
<h2 id="public"><a href="#public" class="headerlink" title="public"></a>public</h2><p>public 磁盘被称之为“公共磁盘”，因此他主要适用与公开的访问文件，默认情况下由本地（local）进行驱动，并存储在<code>storage/app/publi</code>目录下。如果需要让此在网络情况下也可以访问，需要创建<code>public/storage</code>至<code>storaage/app/public</code>的符号链接。</p>
<blockquote>
<p>这种方式可以将公开文件都保存在一个目录下，以及在使用停机时间部署时可以轻松在不同的部署之间共享这些文件。</p>
</blockquote>
<p>此时我们可以通过使用 下述 artisan 命令来创建符号链接：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">php artisan storage:<span class="built_in">link</span></span></span><br><span class="line">The [public/storage] directory has been linked.</span><br></pre></td></tr></table></figure>

<h3 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h3><p>同样的在 public 中，可见行为目录的 755(拥有读、写、执行权限)和文件的644(拥有读写权限)，我们也可修改<code>filesystem</code>配置文件中的权限映射：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;local&#x27;</span> =&gt; [</span><br><span class="line">    <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;local&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;root&#x27;</span> =&gt; <span class="title function_ invoke__">storage_path</span>(<span class="string">&#x27;app&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;permissions&#x27;</span> =&gt;[</span><br><span class="line">        <span class="string">&#x27;file&#x27;</span>=&gt;[</span><br><span class="line">            <span class="string">&#x27;public&#x27;</span>=&gt;<span class="number">0600</span>,</span><br><span class="line">            <span class="string">&#x27;private&#x27;</span>=&gt;<span class="number">0700</span></span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">],</span><br></pre></td></tr></table></figure>

<p>在上述配置中，我们将 &#x2F;public 赋予了<code>0600</code>即只有读写权限，而在 &#x2F;private 目录下则赋予了 <code>0700</code>的可读、写、执行权限。</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="local"><a href="#local" class="headerlink" title="local"></a>local</h3><p>在 Laravel 中，要实现文件的上传需要通过使用 <code>file</code>以及<code>store</code>的搭配，通过 <code>file</code>来告诉 Laravel:”你需要上传谁，及获取谁的表单”。而<code>store</code>则是告诉 Laravel 你需要存储在哪个<strong>目录下</strong>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//web.php</span></span><br><span class="line"><span class="title class_">Route</span>::<span class="title function_ invoke__">post</span>(<span class="string">&#x27;/upload&#x27;</span>,<span class="string">&quot;PostController@update&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;--inbar.blade.php--&#125;&#125;</span><br><span class="line">&lt;form action=<span class="string">&quot;/upload&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    @csrf</span><br><span class="line">    &lt;input type=<span class="string">&quot;hidden&quot;</span> name=<span class="string">&quot;_token&quot;</span> value=<span class="string">&quot;&lt;?php echo csrf_token()?&gt;&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;img&quot;</span>&gt;</span><br><span class="line">    &lt;button type=<span class="string">&quot;submit&quot;</span>&gt;Up File&lt;/button&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    Controller</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Update the specified resource in storage.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$path</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;img&#x27;</span>)-&gt;<span class="title function_ invoke__">store</span>(<span class="string">&#x27;avatars&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$path</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>在上述的 Controller code 中，我们通过了获取名为 <code>img</code> 表单所上传的文件后存储至<code>avatars</code>即<code>storage/app/avatars</code>目录下。值得注意的是默认情况下 <code>store</code>方法会自动生成一个唯一ID <strong>作为文件名称</strong>。</p>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210512031325.png"><br>当我们上传图像的时候，将会在 <code>avatars</code>目录下显示出我们刚刚上传的图像，并经过了<code>store</code>来自动生成一个唯一的ID作为文件名称。</p>
<h3 id="Tencent-cos"><a href="#Tencent-cos" class="headerlink" title="Tencent cos"></a>Tencent cos</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210512030931.png"><br>在上面我们介绍了 Laravel 文件的存储中，说到了<strong>文件磁盘</strong>，其中主要可以进行本地和远程的文件上传。在 Laravel 我们通常会使用国内较快的 腾讯云 COS，而 Laravel 默认的是 AWS s3，本文主要使用 Tencent cloud cosv5 作为演示，首先需要安装依赖：</p>
<h4 id="安装与配置"><a href="#安装与配置" class="headerlink" title="安装与配置"></a>安装与配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require freyo/flysystem-qcloud-cos-v5</span><br></pre></td></tr></table></figure>

<p>当一切完成之后想 <code>config/app.php</code> 文件内<code>providers</code>中添加以下信息：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">&#x27;providers&#x27;</span> =&gt; [</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Laravel Framework Service Providers...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    ……</span><br><span class="line">    <span class="title class_">Freyo\Flysystem\QcloudCOSv5\ServiceProvider</span>::<span class="variable language_">class</span>,</span><br></pre></td></tr></table></figure>

<h5 id="env-and-filesystems"><a href="#env-and-filesystems" class="headerlink" title="env and filesystems"></a>env and filesystems</h5><p>在然后将下述 code 粘贴并修改到 <code>.end</code>文件中：</p>
<blockquote>
<p>需要参考腾讯云 COS 管理内和密钥页面进行填写</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">COSV5_APP_ID=</span><br><span class="line">COSV5_SECRET_ID= </span><br><span class="line">COSV5_SECRET_KEY=</span><br><span class="line">COSV5_TOKEN=null</span><br><span class="line">COSV5_TIMEOUT=60</span><br><span class="line">COSV5_CONNECT_TIMEOUT=60</span><br><span class="line">COSV5_BUCKET=</span><br><span class="line">COSV5_REGION=</span><br><span class="line">COSV5_CDN=</span><br><span class="line">COSV5_SCHEME=https</span><br><span class="line">COSV5_READ_FROM_CDN=false</span><br><span class="line">COSV5_CDN_KEY=</span><br><span class="line">COSV5_ENCRYPT=false</span><br></pre></td></tr></table></figure>

<p>当修改完成后将下述 code 复制到 <code>config/filesystems.php</code> 文件内的<code>disks</code>下，无需修改：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;disks&#x27;</span> =&gt; [</span><br><span class="line">    ……</span><br><span class="line">    <span class="string">&#x27;cosv5&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;driver&#x27;</span> =&gt; <span class="string">&#x27;cosv5&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;region&#x27;</span>          =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;COSV5_REGION&#x27;</span>, <span class="string">&#x27;ap-guangzhou&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;credentials&#x27;</span>     =&gt; [</span><br><span class="line">            <span class="string">&#x27;appId&#x27;</span>     =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;COSV5_APP_ID&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;secretId&#x27;</span>  =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;COSV5_SECRET_ID&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;secretKey&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;COSV5_SECRET_KEY&#x27;</span>),</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;timeout&#x27;</span>         =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;COSV5_TIMEOUT&#x27;</span>, <span class="number">60</span>),</span><br><span class="line">        <span class="string">&#x27;connect_timeout&#x27;</span> =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;COSV5_CONNECT_TIMEOUT&#x27;</span>, <span class="number">60</span>),</span><br><span class="line">        <span class="string">&#x27;bucket&#x27;</span>          =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;COSV5_BUCKET&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;cdn&#x27;</span>             =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;COSV5_CDN&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;scheme&#x27;</span>          =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;COSV5_SCHEME&#x27;</span>, <span class="string">&#x27;https&#x27;</span>),</span><br><span class="line">        <span class="string">&#x27;read_from_cdn&#x27;</span>   =&gt; <span class="title function_ invoke__">env</span>(<span class="string">&#x27;COSV5_READ_FROM_CDN&#x27;</span>, <span class="literal">false</span>),</span><br><span class="line">    ],</span><br></pre></td></tr></table></figure>

<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    Controller</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Update the specified resource in storage.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update</span>(<span class="params">Request <span class="variable">$request</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 1.获取 名为 img 表单所提交的文件</span></span><br><span class="line"><span class="comment">         * 2.选择 cosv5 作为文件磁盘</span></span><br><span class="line"><span class="comment">         * 3.将 $file 存储至 &quot;picture_class&quot; 目录下</span></span><br><span class="line"><span class="comment">         * 4.生成并返回该文件的 url。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">        <span class="variable">$file</span> = <span class="variable">$request</span>-&gt;<span class="title function_ invoke__">file</span>(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line">        <span class="variable">$disk</span> = <span class="title class_">Storage</span>::<span class="title function_ invoke__">disk</span>(<span class="string">&#x27;cosv5&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_content</span> = <span class="variable">$disk</span>-&gt;<span class="title function_ invoke__">put</span>(<span class="string">&quot;picture_class&quot;</span>,<span class="variable">$file</span>);</span><br><span class="line">        <span class="variable">$file_url</span> = <span class="variable">$disk</span>-&gt;<span class="title function_ invoke__">url</span>(<span class="variable">$file_content</span>);</span><br><span class="line">        <span class="keyword">return</span> (<span class="variable">$file_url</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="文件名称"><a href="#文件名称" class="headerlink" title="文件名称"></a>文件名称</h5><p>在 local 一节中我们说道了 <code>store</code>方法会自动生成一个唯一的ID <strong>作为文件的名称</strong>，因此在提交的时候唯一性是保证了，但是可读性会大大缩小。因此我们可以通过下述几个方法来对文件名称进行操作：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
</tr>
</thead>
<tbody><tr>
<td>getClientOriginalName</td>
<td>获取原来的文件名</td>
</tr>
<tr>
<td>getClientOriginalExtension</td>
<td>获取文件的扩展名</td>
</tr>
<tr>
<td>getClientMimeType</td>
<td>文件的类型</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$file = $request-&gt;file(&#x27;img&#x27;);</span><br><span class="line">$extension = $file-&gt;getClientOriginalName();</span><br><span class="line">$filename = date(&#x27;Y-m-d G_i_s&#x27;) . &quot;.&quot;.$extension;</span><br><span class="line"></span><br><span class="line">$disk = Storage::disk(&#x27;cosv5&#x27;);</span><br><span class="line">$file_content = $disk-&gt;putFileAs(&#x27;picture_class&#x27;,$file,$filename);</span><br><span class="line">$file_url = $disk-&gt;url($file_content);</span><br><span class="line">return $file_url;</span><br></pre></td></tr></table></figure>
<p>除了上述的 getClient 方法外，我们还需要配合<code>date</code>方法来共同完成，因此我们通过使用 <code>data</code>的 <strong>Y-m-d G_i_s</strong> 来进行实现，分别表示 <strong>年份-月份-日期 小时_分周_秒数</strong> 等，最终输出 <strong>2021-05-12 23_46_00</strong>。</p>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/php/laravel/2.Laravel 文件结构/">Laravel 文件结构</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/laravel/" rel="tag">laravel</a> <a class="article__tag-none-link" href="/tags/php/" rel="tag">php</a>
			</span>
		
	</div>

	

	
		<p>在不同的开发环境和项目中，文件结构是一个非常重要的一点，如maven的文件结构可以分为src&#x2F;main&#x2F;等等，在这些结构中都会有一个默认的“潜规则”。如你在开发项目的时候，还在本地测试阶段，而你却将项目源代码放到了&#x2F;src&#x2F;main目录下，这则会让同事觉得你有点问题。Laravel的文件结构也一样，如下：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>app</td>
<td>用于包含应用程序的核心代码</td>
<td>开发项目的时候所有类都将存放于此</td>
</tr>
<tr>
<td></td>
<td>Console</td>
<td>包含应用程序中所有自定义的Artisan命令</td>
</tr>
<tr>
<td></td>
<td>Events*</td>
<td>默认情况并不存在，主要用于放置<strong>事件类</strong>，用于警告应用程序和其他部分发生了一个给定的操作</td>
</tr>
<tr>
<td></td>
<td>Exceptions</td>
<td>包含应用程序的异常处理，也可放置应用程序跑出的任何异常</td>
</tr>
<tr>
<td></td>
<td>Http</td>
<td>包含<strong>控制器、中间件、表单</strong>请求，处理应用程序请求的所有逻辑基本都将放置在此目录</td>
</tr>
<tr>
<td></td>
<td>Jobs*</td>
<td>jobs目录是一般情况下并不存在的，用于包含应用程序的队列</td>
</tr>
<tr>
<td></td>
<td>Listeners*</td>
<td>默认情况下并不存在，主要用于包含事件处理类</td>
</tr>
<tr>
<td></td>
<td>Mail*</td>
<td>Mail目录并不存在，主要用于包含应用程序发送邮件的类</td>
</tr>
<tr>
<td></td>
<td>Notifications*</td>
<td>默认情况下不存在，用于包含应用程序发送的所有事物同志</td>
</tr>
<tr>
<td></td>
<td>Policies*</td>
<td>默认情况下并不存在，主要用于包含授权策略类，即用户是否可以对一个资源进行访问等</td>
</tr>
<tr>
<td></td>
<td>Providers</td>
<td>用于包含应用程序的所有服务提供者，服务提供者将通过服务容器绑定服务引导程序。在新的Laravel应用中，此项目母吕将会包含一些应用提供者，可根据自己的需求将自己添加到此母吕中</td>
</tr>
<tr>
<td></td>
<td>Rules*</td>
<td>默认情况并不存在，主要包含应用程序自定义验证规则对象</td>
</tr>
<tr>
<td>bootstrap</td>
<td>主要包含app.php以及cache目录</td>
<td>cache用于存放框架所自动生成来提升整体性能文件</td>
</tr>
<tr>
<td>Config</td>
<td>即配置包含了配置文件</td>
<td>可阅读这些配置文件来掌握Laravel</td>
</tr>
<tr>
<td>database</td>
<td>即数据填充和模型工厂类</td>
<td>当然顾名思义你也可以用于放置数据库文件？</td>
</tr>
<tr>
<td>public</td>
<td>public目录包含了首页文件<code>index.php</code></td>
<td>还可用于放置资源文件如<code>js/css/img</code>等</td>
</tr>
<tr>
<td>resources</td>
<td>包含了图像和一些未编译的文件</td>
<td>你可用于存放SASS这些</td>
</tr>
<tr>
<td>routes</td>
<td>routes 目录包含了所有的路由定义类</td>
<td>此外还有默认存在的<code>api.php  channels.php  console.php  web.php</code>路由文件。</td>
</tr>
<tr>
<td></td>
<td>web.php</td>
<td>放置在了web中间件组的路由，提供了会话状态、CSRF防护和cookie加密</td>
</tr>
<tr>
<td></td>
<td>api.php</td>
<td>放置在api中间件组的路由，提供频率限制，通过路由进入应用请求通过令牌进行认证</td>
</tr>
<tr>
<td></td>
<td>console.php</td>
<td>定义所有基于终端命令闭包汉书的文件，每个闭包汉书都被绑定到了一个命令示例且允许命令号IO方法的进行简单交互</td>
</tr>
<tr>
<td>storage</td>
<td>哟用于存储编译后的blade、session、缓存、框架生成的文件</td>
<td>内包含了<code>app、framework、logs</code>三个子目录，分别对应<strong>应用生成、框架生成、日志生成</strong></td>
</tr>
<tr>
<td></td>
<td>storage&#x2F;app&#x2F;public</td>
<td>用于包含用户生成的文件</td>
</tr>
<tr>
<td>tests</td>
<td>即用于包含自动化测试文件</td>
<td>此处潜规则是每个自测试类都以<code>test</code>作为后缀</td>
</tr>
<tr>
<td>vendor</td>
<td>包含项目中所有的 composer 依赖包</td>
<td></td>
</tr>
</tbody></table>

	

	

</article>





	<span class="different-posts">📖 <a href="/page/29">more posts</a> 📖</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>欢迎来到我的 blog <br><br> 通过 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>+<a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a> 进行构建的，存放在 <a target="_blank" rel="noopener" href="https://github.com/vendanges/vendanges.github.io">Github</a> 上。</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2022 John Doe | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
