<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="theme-color" content="#33474d">
	<title>琼瑶</title>
	<link rel="stylesheet" href="/css/style.css" />
	
      <link rel="alternate" href="/atom.xml" title="琼瑶" type="application/atom+xml">
    
<meta name="generator" content="Hexo 6.1.0"></head>

<body>

	<header class="header">
		<nav class="header__nav">
			
				<a href="/" class="header__link" style="color: #fff">Home</a>
			
				<a href="/archives" class="header__link" style="color: #fff">Archive</a>
			
				<a href="/about" class="header__link" style="color: #fff">About</a>
			
		</nav>
		<!-- <h1 class="header__title"><a href="/">琼瑶</a></h1> -->
		<h1 class="header__title"><a href="/"><img style="width: 290px;" src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/202204152017786.png"></a></h1>
		<h2 class="header__subtitle">梦入琼楼寒有月，行过石树冻无烟</h2>
	</header>

	<main>
		
	<span class="different-posts different-posts_earlier">📖 <a href="/page/7">earlier posts</a> 📖</span>




	<article>
	
		<h1><a href="/2022/04/21/javascript/d3/29.D3 矩阵布局/">D3 矩阵布局</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210413153321.png"><br>矩阵布局（<code>Treemap</code>）是一个层级布局或分层布局扩展，最早由<code>Ben Shneiderman</code>在 <code>1991</code>进行提出，可以通过对一块举行进行切分，并达到层级演示的效果。会通过使用将一块<code>类似于近正矩形</code>并进行切块，之后将数据根据<code>矩形树图算法</code>进行计算。</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.layout.treemap()</td>
<td>创建矩阵数布局</td>
<td></td>
</tr>
<tr>
<td></td>
<td>treemap.nodes(root)</td>
<td>根据<code>root</code>进行计算，并获取节点数据</td>
</tr>
<tr>
<td></td>
<td>treemap.links(nodes)</td>
<td>根据 nodes 进行计算，获取连线数组</td>
</tr>
<tr>
<td></td>
<td>treemap.children(<code>[children]</code>)</td>
<td>设置或获取子节点访问器（默认情况下子节点对象是<code>children</code> ）</td>
</tr>
<tr>
<td></td>
<td>treemap.sort(<code>[comparator]</code>)</td>
<td>设置或获取布局的节点排序数据</td>
</tr>
<tr>
<td></td>
<td>treemap.value(<code>[value]</code>)</td>
<td>设置或获取值访问器</td>
</tr>
<tr>
<td></td>
<td>treemap.size(<code>[size]</code>)</td>
<td>设置或获取布局尺寸，（有两个参数分别为 表示<code>宽</code>以及<code>高</code>）</td>
</tr>
<tr>
<td></td>
<td>treemap.padding(<code>[padding]</code>)</td>
<td>设置或获取矩阵单元之间的间隔（单位为像素）</td>
</tr>
<tr>
<td></td>
<td>treemap.round(<code>[round]</code>)</td>
<td>设置或获取是否对计算结果是否进行<code>四舍五路</code></td>
</tr>
<tr>
<td></td>
<td>treemap.sticky(<code>[sticky]</code>)</td>
<td>设置或获取矩阵树图是否有<code>粘性</code>，粘性属性布局将保留整个过度中节点的相对排序</td>
</tr>
<tr>
<td></td>
<td>treemap.ratio(<code>[ratio]</code>)</td>
<td>设置或获取矩阵树图是否有<code>粘性</code>的</td>
</tr>
<tr>
<td></td>
<td>treemap.mode(<code>[mode]</code>)</td>
<td>设置矩阵布局模式，不同算法之间的有<code>很大的差异</code></td>
</tr>
<tr>
<td></td>
<td></td>
<td><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210413153418.png"></td>
</tr>
</tbody></table>
<h2 id="确定数据"><a href="#确定数据" class="headerlink" title="确定数据"></a>确定数据</h2><p>下述我们通过计算出<code>广州省、吉林省、河南省</code>的人口迁移数据，通过新建<code>json</code>文件来进行写入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;name&quot;</span>: <span class="string">&quot;中国&quot;</span>,</span><br><span class="line">  <span class="string">&quot;children&quot;</span>:</span><br><span class="line">  [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;广州省&quot;</span>,</span><br><span class="line">      <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;佛山市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">25.82</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;东莞市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">10.26</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;深圳市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">8.53</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;清远市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">5.22</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;中山市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">3.56</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;惠州市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">3.49</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;肇庆市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">2.85</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;江门市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">2.52</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;珠海市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">1.92</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;湛江市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">1.62</span>&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;吉林省&quot;</span>,</span><br><span class="line">      <span class="string">&quot;children&quot;</span>:[</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;辽阳市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">11.82</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;哈尔滨市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">10.55</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;北京市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">6.56</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;铁岭市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">5.77</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;通辽市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">5.14</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;兴安盟&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">4.46</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;大连市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">3.34</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;大庆市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">2.86</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;天津市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">2.27</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;齐齐哈尔市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">1.88</span>&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&quot;name&quot;</span>: <span class="string">&quot;河南省&quot;</span>,</span><br><span class="line">      <span class="string">&quot;children&quot;</span>: [</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;辽阳市&quot;</span>,<span class="string">&quot;ratio&quot;</span>: <span class="number">11.82</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;哈尔滨市&quot;</span>,<span class="string">&quot;ratio&quot;</span>: <span class="number">10.55</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;北京市&quot;</span>, <span class="string">&quot;ratio&quot;</span>: <span class="number">6.56</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;铁岭市&quot;</span>,<span class="string">&quot;ratio&quot;</span>: <span class="number">5.77</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;通辽市&quot;</span>,<span class="string">&quot;ratio&quot;</span>: <span class="number">5.14</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;兴安盟&quot;</span>,<span class="string">&quot;ratio&quot;</span>: <span class="number">4.46</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;大连市&quot;</span>,<span class="string">&quot;ratio&quot;</span>: <span class="number">3.34</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;大庆市&quot;</span>,<span class="string">&quot;ratio&quot;</span>: <span class="number">2.86</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;天津市&quot;</span>,<span class="string">&quot;ratio&quot;</span>: <span class="number">2.27</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;齐齐哈尔市&quot;</span>,<span class="string">&quot;ratio&quot;</span>: <span class="number">1.88</span>&#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="布局运算"><a href="#布局运算" class="headerlink" title="布局运算"></a>布局运算</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210413153449.png"><br>上述的 <code>json</code> 数据是无法直接被 <code>d3.js</code>所识别的，所以需要通过使用布局，将得到<code>node</code>以及<code>links</code>的连线关系并进行转换，上图我们以<code>河南省数据</code>为例，转换如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    转换数据 -&gt; nodes（节点） -&gt; links (连线关系)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> treemap = d3.<span class="property">layout</span>.<span class="title function_">treemap</span>()</span><br><span class="line">    .<span class="title function_">size</span>([padding.<span class="property">width</span>,padding.<span class="property">height</span>])</span><br><span class="line">    .<span class="title function_">value</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">ratio</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d3.<span class="title function_">json</span>(<span class="string">&quot;treemap.json&quot;</span>,<span class="keyword">function</span> (<span class="params">error, root</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> nodes = treemap.<span class="title function_">nodes</span>(root)</span><br><span class="line">    <span class="keyword">var</span> links = treemap.<span class="title function_">links</span>(nodes)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(nodes)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(links)</span><br><span class="line">&#125;）</span><br></pre></td></tr></table></figure>

<h2 id="绘制矩阵"><a href="#绘制矩阵" class="headerlink" title="绘制矩阵"></a>绘制矩阵</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    转换数据 -&gt; nodes（节点） -&gt; links (连线关系)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> treemap = d3.<span class="property">layout</span>.<span class="title function_">treemap</span>()</span><br><span class="line">    .<span class="title function_">size</span>([padding.<span class="property">width</span>,padding.<span class="property">height</span>])</span><br><span class="line">    .<span class="title function_">value</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">ratio</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d3.<span class="title function_">json</span>(<span class="string">&quot;treemap.json&quot;</span>,<span class="keyword">function</span> (<span class="params">error, root</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> nodes = treemap.<span class="title function_">nodes</span>(root)</span><br><span class="line">    <span class="keyword">var</span> links = treemap.<span class="title function_">links</span>(nodes)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(nodes)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(links)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 选择颜色 */</span></span><br><span class="line">    <span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20c</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* &lt;g&gt; 组 */</span></span><br><span class="line">    <span class="keyword">var</span> groups = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">        .<span class="title function_">data</span>(nodes.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> !d.<span class="property">children</span></span><br><span class="line">        &#125;))</span><br><span class="line">        .<span class="title function_">enter</span>()</span><br><span class="line">        .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 矩形 */</span></span><br><span class="line">    <span class="keyword">var</span> rects = groups.<span class="title function_">append</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;nodeRect&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">x</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">y</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">dx</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">dy</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span> (<span class="params">d,i</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">color</span>(d.<span class="property">parent</span>.<span class="property">name</span>)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 文字 */</span></span><br><span class="line">    <span class="keyword">var</span> text = groups.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;nodeName&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">x</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">y</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;dx&quot;</span>, <span class="string">&quot;0.5em&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>, <span class="string">&quot;1.5em&quot;</span>)</span><br><span class="line">        .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">name</span> + <span class="string">&quot;&quot;</span> + d.<span class="property">ratio</span></span><br><span class="line">        &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.nodeRect</span> &#123;</span><br><span class="line">  stroke: white;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.nodeName</span> &#123;</span><br><span class="line">  fill: white;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/javascript/d3/28.D3 直方布局/">D3 直方布局</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p>直方布局（<code>Histogram Layout</code>），可以用于表示数据的分布。可分为<code>矩阵直方图（Matrix histogram）</code>和<code>曲线直方图（Curve histogram）</code>两种表达方式。</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.layout.histogram()</td>
<td>创建一个直方图布局</td>
<td></td>
</tr>
<tr>
<td></td>
<td>histogram.value()</td>
<td>设置或获取值访问器</td>
</tr>
<tr>
<td></td>
<td>histogram.range()</td>
<td>设置数据的分布范围，主要分为两个数组指定（分别表述<code>上限（min）</code>以及<code>下线（max）</code>）</td>
</tr>
<tr>
<td></td>
<td>histogram.bins()</td>
<td>设置数据的分布区间的个数或长度，如果没有参数则默认返回当前设置的值</td>
</tr>
<tr>
<td></td>
<td>histogram.bins(<code>count</code>)</td>
<td>将<code>count</code>作为参数则代表<strong>数据的分布区间(bins)</strong> 的数量，<code>bins</code>的区间长度则会被<code>均匀</code>的分割</td>
</tr>
<tr>
<td></td>
<td>histogram.bins(<code>thresholds</code>)</td>
<td>可以指定任意长度的区间（如：<code>[100, 125, 130, 135, 140, 145]</code>）</td>
</tr>
<tr>
<td></td>
<td>histogram.bins(<code>function</code>)</td>
<td>当前函数<strong>必须返回</strong> 一个<code>thresholds</code> 数组</td>
</tr>
<tr>
<td></td>
<td>histogram.frequency(<code>frequency</code>)</td>
<td>值为<code>true</code>为统计<strong>数量</strong>;反之<code>false</code>则是统计<strong>频率</strong></td>
</tr>
<tr>
<td>d3.random.normal()</td>
<td>用于生成<code>正态分布</code>，主要用于表述一个<strong>不明的随机变量</strong> ，通常第一个参数用于表述<code>平均值</code>，第二个参数是<code>标准差</code></td>
<td></td>
</tr>
</tbody></table>
<h2 id="数据转换与确定数据"><a href="#数据转换与确定数据" class="headerlink" title="数据转换与确定数据"></a>数据转换与确定数据</h2><h3 id="normal-确定数据"><a href="#normal-确定数据" class="headerlink" title="normal 确定数据"></a>normal 确定数据</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210413013716.png"><br>normal 即 <code>正态</code>分布，主要用于表示出一个<strong>不明的随机变量</strong>，通常第一个参数用于表述出<code>平均值</code>，而第二个参数即代表<code>标准差</code>，（Standard Deviation）在<code>概率统计</code>上标准差定义是总体各单位的标准值与其平均数离差的算数平均数的平方根，可以反映出<code>个体间的离散程度</code>，通过下述 Code 你会感觉到每次输出的数据坐标，<strong>都是不一样的</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 创建初始数据</span></span><br><span class="line"><span class="comment">    |_|-- 通过 databases 来保存 rand 数据</span></span><br><span class="line"><span class="comment">    |_|-- 根据 rand 生成平均值为170，差值为10，保存至 databases 中。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> rand = d3.<span class="property">random</span>.<span class="title function_">normal</span>(<span class="number">170</span>,<span class="number">50</span>);</span><br><span class="line"><span class="keyword">var</span> databases = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i =<span class="number">0</span>; i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">    databases.<span class="title function_">push</span>(<span class="title function_">rand</span>())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(databases)</span><br></pre></td></tr></table></figure>

<h3 id="转换数据"><a href="#转换数据" class="headerlink" title="转换数据"></a>转换数据</h3><p>通过使用<code>normal</code>生成的随机数据是人类无法直接理解其意思的，因此需要通过使用其<code>直方布局</code>进行转换出<code>人类可理解</code>的数据含义，主要有三个变量，分别为<code>x：区间的下限值、dx：区间的长度、y：此处的区间数量(frequency true)或频率(frequency false)</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 转换数据</span></span><br><span class="line"><span class="comment">    |_|-- 数据的分布范围 rangeMin / rangeMax</span></span><br><span class="line"><span class="comment">    |_|-- 数据的分布区间 binNum</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> binding = &#123;</span><br><span class="line">    <span class="attr">binNum</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">rangeMin</span>: <span class="number">130</span>,</span><br><span class="line">    <span class="attr">rangeMax</span>: <span class="number">210</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> histogram = d3.<span class="property">layout</span>.<span class="title function_">histogram</span>()</span><br><span class="line">    .<span class="title function_">range</span>([binding.<span class="property">rangeMin</span>,binding.<span class="property">rangeMax</span>])</span><br><span class="line">    .<span class="title function_">bins</span>(binding.<span class="property">binNum</span>)</span><br><span class="line">    .<span class="title function_">frequency</span>(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hisData = <span class="title function_">histogram</span>(databases)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hisData)</span><br></pre></td></tr></table></figure>

<h2 id="绘制"><a href="#绘制" class="headerlink" title="绘制"></a>绘制</h2><h3 id="矩形直方图"><a href="#矩形直方图" class="headerlink" title="矩形直方图"></a>矩形直方图</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210413013704.png"><br>通过使用 <code>normal</code> 以及 <code>Histogram Layout</code>计算出数据后，通过比例尺来创建<code>x\y</code>轴并绘制矩形，最后形成为矩形直方图。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">right</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">bottom</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">left</span>: <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 创建初始数据</span></span><br><span class="line"><span class="comment">    |_|-- 通过 databases 来保存 rand 数据</span></span><br><span class="line"><span class="comment">    |_|-- 根据 rand 生成100个随机数据，保存至 databases 中。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> rand = d3.<span class="property">random</span>.<span class="title function_">normal</span>(<span class="number">170</span>,<span class="number">50</span>);</span><br><span class="line"><span class="keyword">var</span> databases = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i =<span class="number">0</span>; i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">    databases.<span class="title function_">push</span>(<span class="title function_">rand</span>())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(databases)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 转换数据</span></span><br><span class="line"><span class="comment">    |_|-- 数据的分布范围 rangeMin / rangeMax</span></span><br><span class="line"><span class="comment">    |_|-- 数据的分布区间 binNum</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> binding = &#123;</span><br><span class="line">    <span class="attr">binNum</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">rangeMin</span>: <span class="number">130</span>,</span><br><span class="line">    <span class="attr">rangeMax</span>: <span class="number">210</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> histogram = d3.<span class="property">layout</span>.<span class="title function_">histogram</span>()</span><br><span class="line">    .<span class="title function_">range</span>([binding.<span class="property">rangeMin</span>,binding.<span class="property">rangeMax</span>])</span><br><span class="line">    .<span class="title function_">bins</span>(binding.<span class="property">binNum</span>)</span><br><span class="line">    .<span class="title function_">frequency</span>(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hisData = <span class="title function_">histogram</span>(databases)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hisData)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义 x 轴比例尺 */</span></span><br><span class="line"><span class="keyword">var</span> xAxisWidth = <span class="number">450</span>,</span><br><span class="line">    xTicks = hisData.<span class="title function_">map</span>( <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">x</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xScale = d3.<span class="property">scale</span>.<span class="title function_">ordinal</span>()</span><br><span class="line">    .<span class="title function_">domain</span>(xTicks)</span><br><span class="line">    .<span class="title function_">rangeRoundBands</span>([<span class="number">0</span>, xAxisWidth],<span class="number">0.1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义 y 轴比例尺 */</span></span><br><span class="line"><span class="keyword">var</span> yAxisWidth = <span class="number">450</span>;</span><br><span class="line"><span class="keyword">var</span> yScale = d3.<span class="property">scale</span>.<span class="title function_">linear</span>()</span><br><span class="line">    .<span class="title function_">domain</span>([d3.<span class="title function_">min</span>(hisData, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">y</span></span><br><span class="line">    &#125;),</span><br><span class="line">        d3.<span class="title function_">max</span>(hisData, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">y</span></span><br><span class="line">        &#125;)])</span><br><span class="line">    .<span class="title function_">range</span>([padding.<span class="property">height</span> - padding.<span class="property">top</span> - padding.<span class="property">bottom</span> ,<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    分别定义 x/y 轴比例尺</span></span><br><span class="line"><span class="comment">    绘制比例尺。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> xAxis = d3.<span class="property">svg</span>.<span class="title function_">axis</span>()</span><br><span class="line">    .<span class="title function_">scale</span>(xScale)</span><br><span class="line">    .<span class="title function_">orient</span>(<span class="string">&quot;bottom&quot;</span>)</span><br><span class="line">    .<span class="title function_">tickFormat</span>(d3.<span class="title function_">format</span>(<span class="string">&quot;.0f&quot;</span>))</span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;axis&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + padding.<span class="property">left</span> + <span class="string">&quot;,&quot;</span> + (padding.<span class="property">height</span> - padding.<span class="property">bottom</span>) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">    .<span class="title function_">call</span>(xAxis)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> yAxis = d3.<span class="property">svg</span>.<span class="title function_">axis</span>()</span><br><span class="line">    .<span class="title function_">scale</span>(yScale)</span><br><span class="line">    .<span class="title function_">orient</span>(<span class="string">&quot;left&quot;</span>)</span><br><span class="line">    .<span class="title function_">tickFormat</span>(d3.<span class="title function_">format</span>(<span class="string">&quot;.0f&quot;</span>))</span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;axis&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span>+ padding.<span class="property">left</span> + <span class="string">&quot;,&quot;</span> + padding.<span class="property">top</span> + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">    .<span class="title function_">call</span>(yAxis)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制矩形 */</span></span><br><span class="line"><span class="keyword">var</span> gRect = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + padding.<span class="property">left</span> + <span class="string">&quot;,&quot;</span> + (- padding.<span class="property">bottom</span> + -<span class="number">10</span>) + <span class="string">&quot;)&quot;</span> )</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;opacity&quot;</span>,<span class="number">1.0</span>)</span><br><span class="line"></span><br><span class="line">gRect.<span class="title function_">selectAll</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(hisData)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span> (<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">xScale</span>(d.<span class="property">x</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>, <span class="keyword">function</span> (<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> padding.<span class="property">height</span> - <span class="title function_">yScale</span>(d.<span class="property">y</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, <span class="keyword">function</span> (<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> xScale.<span class="title function_">rangeBand</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">yScale</span>(d.<span class="property">y</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<p>需要注意的是，我们需要为此添加CSS样式：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@color:</span> <span class="number">#929292</span>;</span><br><span class="line"><span class="selector-class">.axis</span> <span class="selector-tag">path</span>,   <span class="comment">/* 坐标轴路径设置 */</span></span><br><span class="line"><span class="selector-class">.axis</span> <span class="selector-tag">line</span> &#123;    <span class="comment">/* 设置 坐标轴的线条 */</span></span><br><span class="line">  fill: <span class="attribute">none;   /* 设置坐标轴宽度 */</span></span><br><span class="line"><span class="attribute">  stroke</span>: <span class="variable">@color</span>;  <span class="comment">/* 坐标轴颜色 */</span></span><br><span class="line">  shape-rendering: crispEdges;  <span class="comment">/* 将形状渲染为清晰的边缘 */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.axis</span> <span class="selector-tag">text</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: sans-serif;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">11px</span>;</span><br><span class="line">  fill: @<span class="attribute">color;</span></span><br><span class="line"><span class="attribute">&#125;</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line"><span class="attribute">rect &#123;</span></span><br><span class="line"><span class="attribute">  fill</span>: <span class="variable">@color</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="曲线直方图"><a href="#曲线直方图" class="headerlink" title="曲线直方图"></a>曲线直方图</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210413013723.png"><br>相比与矩形直方图（<code> Rectangle Histogram</code>）来比，曲线直方图（<code>Curve Histogram</code>）更加的的连贯，在下述的 code 中，主要将坐标轴以及比例尺进行倒序，之后通过<code>line</code>将其绘制路径。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">right</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">bottom</span>: <span class="number">30</span>,</span><br><span class="line">    <span class="attr">left</span>: <span class="number">30</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 创建初始数据</span></span><br><span class="line"><span class="comment">    |_|-- 通过 databases 来保存 rand 数据</span></span><br><span class="line"><span class="comment">    |_|-- 根据 rand 生成100个随机数据，保存至 databases 中。</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> rand = d3.<span class="property">random</span>.<span class="title function_">normal</span>(<span class="number">170</span>,<span class="number">10</span>);</span><br><span class="line"><span class="keyword">var</span> databases = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i =<span class="number">0</span>; i&lt;<span class="number">100</span>;i++) &#123;</span><br><span class="line">    databases.<span class="title function_">push</span>(<span class="title function_">rand</span>())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(databases)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 转换数据</span></span><br><span class="line"><span class="comment">    |_|-- 数据的分布范围 rangeMin / rangeMax</span></span><br><span class="line"><span class="comment">    |_|-- 数据的分布区间 binNum</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> binding = &#123;</span><br><span class="line">    <span class="attr">binNum</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">rangeMin</span>: <span class="number">130</span>,</span><br><span class="line">    <span class="attr">rangeMax</span>: <span class="number">210</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> histogram = d3.<span class="property">layout</span>.<span class="title function_">histogram</span>()</span><br><span class="line">    .<span class="title function_">range</span>([binding.<span class="property">rangeMin</span>,binding.<span class="property">rangeMax</span>])</span><br><span class="line">    .<span class="title function_">bins</span>(binding.<span class="property">binNum</span>)</span><br><span class="line">    .<span class="title function_">frequency</span>(<span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hisData = <span class="title function_">histogram</span>(databases)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(hisData)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义 x 轴比例尺 */</span></span><br><span class="line"><span class="keyword">var</span> xAxisWidth = <span class="number">450</span>,</span><br><span class="line">    xTicks = hisData.<span class="title function_">map</span>( <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">x</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xScale = d3.<span class="property">scale</span>.<span class="title function_">ordinal</span>()</span><br><span class="line">    .<span class="title function_">domain</span>(xTicks)</span><br><span class="line">    .<span class="title function_">rangeRoundBands</span>([<span class="number">0</span>, xAxisWidth],<span class="number">0.1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义 y 轴比例尺 */</span></span><br><span class="line"><span class="keyword">var</span> yAxisWidth = <span class="number">450</span>;</span><br><span class="line"><span class="keyword">var</span> yScale = d3.<span class="property">scale</span>.<span class="title function_">linear</span>()</span><br><span class="line">    .<span class="title function_">domain</span>([d3.<span class="title function_">min</span>(hisData, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">y</span></span><br><span class="line">    &#125;),</span><br><span class="line">        d3.<span class="title function_">max</span>(hisData, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">y</span></span><br><span class="line">        &#125;)])</span><br><span class="line">    .<span class="title function_">range</span>([<span class="number">0</span>, yAxisWidth])</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制路径 */</span></span><br><span class="line"><span class="keyword">var</span> lineGenerator = d3.<span class="property">svg</span>.<span class="title function_">line</span>()</span><br><span class="line">    .<span class="title function_">x</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> <span class="title function_">xScale</span>(d.<span class="property">x</span>); &#125;)</span><br><span class="line">    .<span class="title function_">y</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123; <span class="keyword">return</span> padding.<span class="property">height</span> - <span class="title function_">yScale</span>(d.<span class="property">y</span>); &#125;)</span><br><span class="line">    .<span class="title function_">interpolate</span>(<span class="string">&quot;basis&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gLine = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,<span class="string">&quot;translate(&quot;</span> + padding.<span class="property">left</span> + <span class="string">&quot;,&quot;</span> + ( -padding.<span class="property">bottom</span> ) +  <span class="string">&quot;)&quot;</span>)</span><br><span class="line"></span><br><span class="line">gLine.<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;none&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;stroke-width&quot;</span>,<span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;stroke&quot;</span>,<span class="string">&quot;#929292&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,<span class="title function_">lineGenerator</span>(hisData));</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    分别定义 x/y 轴比例尺</span></span><br><span class="line"><span class="comment">    绘制比例尺。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> xAxis = d3.<span class="property">svg</span>.<span class="title function_">axis</span>()</span><br><span class="line">    .<span class="title function_">scale</span>(xScale)</span><br><span class="line">    .<span class="title function_">orient</span>(<span class="string">&quot;bottom&quot;</span>)</span><br><span class="line"></span><br><span class="line">yScale.<span class="title function_">range</span>([yAxisWidth, <span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> yAxis = d3.<span class="property">svg</span>.<span class="title function_">axis</span>()</span><br><span class="line">    .<span class="title function_">scale</span>(yScale)</span><br><span class="line">    .<span class="title function_">orient</span>(<span class="string">&quot;left&quot;</span>)</span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;axis&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + padding.<span class="property">left</span> + <span class="string">&quot;,&quot;</span> + (padding.<span class="property">height</span> - padding.<span class="property">bottom</span>) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">    .<span class="title function_">call</span>(xAxis)</span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;axis&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + padding.<span class="property">left</span> + <span class="string">&quot;,&quot;</span> + (padding.<span class="property">height</span> - padding.<span class="property">bottom</span> - yAxisWidth) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line">    .<span class="title function_">call</span>(yAxis)</span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/javascript/d3/27.D3 捆布局/">D3 捆布图</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p>捆布图（<code>Bundle Layout</code>），即捆图（<code>Bundle</code>），主要实现了<code>Danny Holten</code>的分层边缘捆绑算法，<strong>对于每个输入的连接</strong>，<strong>都会</strong>计算出树的路径，从父层次结构上达到最小公共节点，之后在返回目标节点，最终生成捆绑样条，捆布图的主要作用就是<strong>计算出连线的路径</strong>。</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.layout.bundle()</td>
<td>创建饼布图</td>
<td></td>
</tr>
<tr>
<td></td>
<td>bundle(<code>links</code>)</td>
<td>根据数组<code>链接</code>的来源（<code>source</code>）与目标（<code>target</code>）来计算出路径</td>
</tr>
</tbody></table>
<h2 id="层级布局"><a href="#层级布局" class="headerlink" title="层级布局"></a>层级布局</h2><p>层级布局（<code>Hierarchical layout</code>）即采用了嵌套结构（父节点与字节点）来描述信息的布局，通过层级布局总共延伸了<code>集群图（Cluster）、打包图（Pack）、分区图（Paratition）、树图（Tree）以及矩阵树图（Treemap）</code></p>
<h2 id="布局运算"><a href="#布局运算" class="headerlink" title="布局运算"></a>布局运算</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210409112704.png"><br>首先通过使用<code>集群图</code>布局进行计算出节点，来符合捆图使用的节点数据，在通过使用<code>map</code>将<code>gitLink</code>转换为节点对象，在通过使用<code>捆图布局</code>转换成捆图数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    基本 svg 样式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 捆图数据 */</span></span><br><span class="line"><span class="keyword">var</span> gitName = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;gitee&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;Kooder&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;CEF4Delphi&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;Debian-Pi-Aarch64&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;QwidgetExe&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;debian-cn&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;PowerToys&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;FastAPI&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;vscode-drawio&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;PaddleDetection&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;QWidgetExe&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;Stduino IDE&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;react-photo-view&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;Waifu2x-Extension-GUI&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;egg-decorator-router&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;PowerToys&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;InjectFix&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;dnSpy&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;proxyer&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;wenyan-lang&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;Ventoy&quot;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gitLink = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;Kooder&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;CEF4Delphi&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;CEF4Delphi&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;Debian-Pi-Aarch64&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;QwidgetExe&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;debian-cn&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;PowerToys&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;FastAPI&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;vscode-drawio&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;PaddleDetection&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;QWidgetExe&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;Stduino IDE&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;react-photo-view&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;Waifu2x-Extension-GUI&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;egg-decorator-router&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;PowerToys&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;InjectFix&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;dnSpy&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;proxyer&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;wenyan-lang&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;Ventoy&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 集群图布局</span></span><br><span class="line"><span class="comment">    |__|- 计算出集群图布局节点</span></span><br><span class="line"><span class="comment">    |_ 捆图布局</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> cluster = d3.<span class="property">layout</span>.<span class="title function_">cluster</span>()</span><br><span class="line">    .<span class="title function_">size</span>([<span class="number">360</span>, padding.<span class="property">width</span> /<span class="number">2</span> -<span class="number">50</span>])</span><br><span class="line">    .<span class="title function_">separation</span>(<span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (a.<span class="property">parent</span> == b.<span class="property">parent</span> ? <span class="number">1</span> : <span class="number">2</span>) / a.<span class="property">depth</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bundle = d3.<span class="property">layout</span>.<span class="title function_">bundle</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nodes = cluster.<span class="title function_">nodes</span>(gitName)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(nodes)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 将连线端转换为节点对象</span></span><br><span class="line"><span class="comment">    |_ 调用捆布图转换数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> oLinks = <span class="title function_">map</span>(nodes, gitLink)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(oLinks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> links = <span class="title function_">bundle</span>(oLinks)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(links)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    将 source and target 替换为节点对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">map</span>(<span class="params">nodes,links</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> hash = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;nodes.<span class="property">length</span>;i++) &#123;</span><br><span class="line">        hash[nodes[i].<span class="property">name</span>] = nodes[i]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> resultLinks = []</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;links.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        resultLinks.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">source</span>:hash[</span><br><span class="line">                links[i].<span class="property">source</span></span><br><span class="line">                ],</span><br><span class="line">            <span class="attr">target</span>:hash[</span><br><span class="line">                links[i].<span class="property">target</span></span><br><span class="line">                ]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resultLinks</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="捆布图"><a href="#捆布图" class="headerlink" title="捆布图"></a>捆布图</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210409112725.png"><br>通过<code>放射性线段生成器</code>来绘制出捆图的路径（path），再使用<code>node</code>计算出节点位置并添加结点 <code>&lt;circle&gt; and &lt;text&gt;</code>最终绘制出捆图</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    基本 svg 样式</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 捆图数据 */</span></span><br><span class="line"><span class="keyword">var</span> gitName = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="attr">children</span>: [</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;gitee&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;Kooder&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;CEF4Delphi&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;Debian-Pi-Aarch64&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;QwidgetExe&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;debian-cn&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;PowerToys&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;FastAPI&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;vscode-drawio&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;PaddleDetection&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;QWidgetExe&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;Stduino IDE&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;react-photo-view&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;Waifu2x-Extension-GUI&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;egg-decorator-router&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;InjectFix&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;dnSpy&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;proxyer&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;wenyan-lang&quot;</span>&#125;,</span><br><span class="line">        &#123;<span class="attr">name</span>: <span class="string">&quot;Ventoy&quot;</span>&#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> gitLink = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;Kooder&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;CEF4Delphi&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;CEF4Delphi&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;Debian-Pi-Aarch64&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;QwidgetExe&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;debian-cn&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;PowerToys&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;FastAPI&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;vscode-drawio&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;PaddleDetection&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;QWidgetExe&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;Stduino IDE&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;react-photo-view&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;Waifu2x-Extension-GUI&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;egg-decorator-router&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;PowerToys&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;InjectFix&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;dnSpy&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;proxyer&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;wenyan-lang&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">source</span>: <span class="string">&quot;gitee&quot;</span>,</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;Ventoy&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 集群图布局</span></span><br><span class="line"><span class="comment">    |__|- 计算出集群图布局节点</span></span><br><span class="line"><span class="comment">    |_ 捆图布局</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> cluster = d3.<span class="property">layout</span>.<span class="title function_">cluster</span>()</span><br><span class="line">    .<span class="title function_">size</span>([<span class="number">360</span>, padding.<span class="property">width</span> /<span class="number">2</span> -<span class="number">50</span>])</span><br><span class="line">    .<span class="title function_">separation</span>(<span class="keyword">function</span> (<span class="params">a, b</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (a.<span class="property">parent</span> == b.<span class="property">parent</span> ? <span class="number">1</span> : <span class="number">2</span>) / a.<span class="property">depth</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bundle = d3.<span class="property">layout</span>.<span class="title function_">bundle</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nodes = cluster.<span class="title function_">nodes</span>(gitName)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(nodes)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 将连线端转换为节点对象</span></span><br><span class="line"><span class="comment">    |_ 调用捆布图转换数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> oLinks = <span class="title function_">map</span>(nodes, gitLink)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(oLinks)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> links = <span class="title function_">bundle</span>(oLinks)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(links)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    将 source and target 替换为节点对象，</span></span><br><span class="line"><span class="comment">    并将新的元素增加到数组之中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">map</span>(<span class="params">nodes,links</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> hash = []</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;nodes.<span class="property">length</span>;i++) &#123;</span><br><span class="line">        hash[nodes[i].<span class="property">name</span>] = nodes[i]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> resultLinks = []</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;links.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        resultLinks.<span class="title function_">push</span>(&#123;</span><br><span class="line">            <span class="attr">source</span>:hash[</span><br><span class="line">                links[i].<span class="property">source</span></span><br><span class="line">                ],</span><br><span class="line">            <span class="attr">target</span>:hash[</span><br><span class="line">                links[i].<span class="property">target</span></span><br><span class="line">                ]</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> resultLinks</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 放射性线段生成器</span></span><br><span class="line"><span class="comment">    |__|-设置插值模式为 bundle 即捆图</span></span><br><span class="line"><span class="comment">    |__| 将张力设置为 45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> line = d3.<span class="property">svg</span>.<span class="property">line</span>.<span class="title function_">radial</span>()</span><br><span class="line">    .<span class="title function_">interpolate</span>(<span class="string">&quot;bundle&quot;</span>)</span><br><span class="line">    .<span class="title function_">tension</span>(<span class="number">.45</span>)</span><br><span class="line">    .<span class="title function_">radius</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">y</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">angle</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">x</span> / <span class="number">180</span> * <span class="title class_">Math</span>.<span class="property">PI</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 坐标组 &lt;g&gt; 元素 */</span></span><br><span class="line">gBundel = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;&quot;</span> +</span><br><span class="line">        <span class="string">&quot;translate(&quot;</span> + (padding.<span class="property">width</span>/<span class="number">2</span>) + <span class="string">&quot;,&quot;</span> + (padding.<span class="property">height</span>/<span class="number">2</span>) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 颜色比例尺 */</span></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20c</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制连线路径 &lt;path&gt; */</span></span><br><span class="line"><span class="keyword">var</span> link = gBundel.<span class="title function_">selectAll</span>(<span class="string">&quot;.link&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(links)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;link&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, line)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加节点 */</span></span><br><span class="line"><span class="keyword">var</span> node = gBundel.<span class="title function_">selectAll</span>(<span class="string">&quot;.node&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(nodes.<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> !d.<span class="property">children</span></span><br><span class="line">    &#125;))</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;node&quot;</span>)   </span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;rotate(&quot;</span> + (d.<span class="property">x</span> - <span class="number">90</span>) + <span class="string">&quot;) translate(&quot;</span> +</span><br><span class="line">            d.<span class="property">y</span> + <span class="string">&quot;)&quot;</span> + <span class="string">&quot;rotate(&quot;</span> + (<span class="number">90</span> -d.<span class="property">x</span>) + <span class="string">&quot;)&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制节点圆形 &lt;circle&gt; */</span></span><br><span class="line">node.<span class="title function_">append</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>,<span class="number">1</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span> (<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(i)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制节点名称 &lt;text&gt; */</span></span><br><span class="line">node.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>,<span class="string">&quot;.12em&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;text-anchor&quot;</span>,<span class="string">&quot;middle&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.link</span> &#123;</span><br><span class="line">  fill: transparent;</span><br><span class="line">  stroke: <span class="number">#e5e5e5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.node</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">  fill: <span class="number">#242424</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/javascript/d3/26.D3 树布图/">D3 树布图</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p>树图（<code>Tree Diagram</code>），实在区域内按照规则布置<code>节点（node）</code>，之后通过<code>连线（link）</code>连接起来的图形之一，在数据可视化中被成为<code>树布图</code>，或称之为<code>流程图</code>，通过布局运算后的树图将会被称之为“<strong>树布图（Tree Layout）</strong>”</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.layout.tree()</td>
<td>创建一个树布图</td>
<td></td>
</tr>
<tr>
<td></td>
<td>tree.size(<code>width,[height]</code>)</td>
<td>设置或获取大小，分别表示宽和高</td>
</tr>
<tr>
<td></td>
<td>tree.nodeSize()</td>
<td>设置或获取各节点的大小</td>
</tr>
<tr>
<td></td>
<td>tree.value()</td>
<td>设置或获取值访问器，默认为空，如果设置则会在此节点中多出一个<code>value</code></td>
</tr>
<tr>
<td></td>
<td>tree.children()</td>
<td>设置或获取各个节点的访问器</td>
</tr>
<tr>
<td></td>
<td>tree.sort()</td>
<td>设置或获取排序的比较器</td>
</tr>
<tr>
<td></td>
<td>tree.separation()</td>
<td>设置或获取相邻节点之间的间隔</td>
</tr>
<tr>
<td></td>
<td>tree.nodes()</td>
<td>根据根进行计算，获取节点数组</td>
</tr>
<tr>
<td></td>
<td>tree.links()</td>
<td>根据 nodes计算，获取连线数组</td>
</tr>
</tbody></table>
<h2 id="布局运算"><a href="#布局运算" class="headerlink" title="布局运算"></a>布局运算</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210409012635.png"></p>
<h3 id="确定数据"><a href="#确定数据" class="headerlink" title="确定数据"></a>确定数据</h3><p>D3 的树布图的原始数据主要通过使用<code>.json</code>进行写入，在 <code>.json</code>中主要可以分为<code>name</code>以及<code>children</code>，将用于定义<code>叶子的名称</code>以及划分出一个<code>分支</code>，即子节点并继续写入：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;开始&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;子节点&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;子节点&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;子节点的子节点&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;子节点的子节点&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;children&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">            <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;子节点的子节点的子节点&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">          <span class="punctuation">]</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;子节点&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="计算数据"><a href="#计算数据" class="headerlink" title="计算数据"></a>计算数据</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210409012644.png"><br>通过使用树布图（<code>Tree Layout</code>）将会计算出树图的基本<code>节点</code>以及连线数据（<code>source and target</code>）通常<code>节点（nodes）</code>他会共输出<code>parent（父节点）、children（子节点）、depth（节点深度）、x\y（节点x\y坐标）</code>，而<code>连线 (links)</code>将会输出<code>source and targe</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    设置 x 的位置为 80</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> gTree = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,<span class="string">&quot;translate(80,0)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 开始布局运算</span></span><br><span class="line"><span class="comment">    |__|- 获取长宽高并对高-200</span></span><br><span class="line"><span class="comment">    |__|- 设置相邻节点间的位置</span></span><br><span class="line"><span class="comment">    |__|--| a,b 表示两个相邻节点，如果a和b的节点相同，则间隔为1,否则为2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> tree = d3.<span class="property">layout</span>.<span class="title function_">tree</span>()</span><br><span class="line">    .<span class="title function_">size</span>([padding.<span class="property">width</span>, padding.<span class="property">height</span>-<span class="number">200</span>])</span><br><span class="line">    .<span class="title function_">separation</span>(<span class="keyword">function</span> (<span class="params">a,b</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (a.<span class="property">parent</span> == b.<span class="property">parent</span> ? <span class="number">1</span>:<span class="number">2</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 对角线投射 */</span></span><br><span class="line"><span class="keyword">var</span> diagonal = d3.<span class="property">svg</span>.<span class="title function_">diagonal</span>()</span><br><span class="line">    .<span class="title function_">projection</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [d.<span class="property">y</span>, d.<span class="property">x</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 读取 json 数据</span></span><br><span class="line"><span class="comment">    |__|-- nodes 计算得到的节点数组</span></span><br><span class="line"><span class="comment">    |__|-- links 计算出连线数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">d3.<span class="title function_">json</span>(<span class="string">&quot;./tree.json&quot;</span>, <span class="keyword">function</span> (<span class="params">error, root</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> nodes = tree.<span class="title function_">nodes</span>(root)</span><br><span class="line">    <span class="keyword">var</span> links = tree.<span class="title function_">links</span>(nodes)</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(nodes)</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(links)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h2 id="树布图"><a href="#树布图" class="headerlink" title="树布图"></a>树布图</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210409012653.png"><br>树图（<code>Tree</code>）是所谓的流程图的基本组成部分，在本文中，主要通过<code>.json</code>数据并通过<code>对角线生成器</code>进行投射，通过使用<code>&lt;path&gt;</code>绘制出节点的连接线，然后分别添加<code>&lt;circle&gt; and &lt;text&gt;</code>的出一个完整的树图。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 布局 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    设置 x 的位置为 80</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> gTree = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,<span class="string">&quot;translate(80,0)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 开始布局运算</span></span><br><span class="line"><span class="comment">    |__|- 获取长宽高并对高-200</span></span><br><span class="line"><span class="comment">    |__|- 设置相邻节点间的位置</span></span><br><span class="line"><span class="comment">    |__|--| a,b 表示两个相邻节点，如果a和b的节点相同，则间隔为1,否则为2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> tree = d3.<span class="property">layout</span>.<span class="title function_">tree</span>()</span><br><span class="line">    .<span class="title function_">size</span>([padding.<span class="property">width</span>, padding.<span class="property">height</span>-<span class="number">200</span>])</span><br><span class="line">    .<span class="title function_">separation</span>(<span class="keyword">function</span> (<span class="params">a,b</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (a.<span class="property">parent</span> == b.<span class="property">parent</span> ? <span class="number">1</span>:<span class="number">2</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 对角线投射 */</span></span><br><span class="line"><span class="keyword">var</span> diagonal = d3.<span class="property">svg</span>.<span class="title function_">diagonal</span>()</span><br><span class="line">    .<span class="title function_">projection</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [d.<span class="property">y</span>, d.<span class="property">x</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 读取 json 数据</span></span><br><span class="line"><span class="comment">    |__|-- nodes 计算得到的节点数组</span></span><br><span class="line"><span class="comment">    |__|-- links 计算出连线数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">d3.<span class="title function_">json</span>(<span class="string">&quot;./tree.json&quot;</span>, <span class="keyword">function</span> (<span class="params">error, root</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> nodes = tree.<span class="title function_">nodes</span>(root)</span><br><span class="line">    <span class="keyword">var</span> links = tree.<span class="title function_">links</span>(nodes)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 对角线投射绘制 */</span></span><br><span class="line">    <span class="keyword">var</span> link = gTree.<span class="title function_">selectAll</span>(<span class="string">&quot;.link&quot;</span>)</span><br><span class="line">        .<span class="title function_">data</span>(links)</span><br><span class="line">        .<span class="title function_">enter</span>()</span><br><span class="line">        .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;link&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,diagonal)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 为每个点添加足够的 &lt;circle&gt; and &lt;text&gt; 元素 */</span></span><br><span class="line">    <span class="keyword">var</span> node = gTree.<span class="title function_">selectAll</span>(<span class="string">&quot;.node&quot;</span>)</span><br><span class="line">        .<span class="title function_">data</span>(nodes)</span><br><span class="line">        .<span class="title function_">enter</span>()</span><br><span class="line">        .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;node&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + d.<span class="property">y</span> + <span class="string">&quot;,&quot;</span> + d.<span class="property">x</span> + <span class="string">&quot;)&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    node.<span class="title function_">append</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>,<span class="number">4.5</span>)</span><br><span class="line"></span><br><span class="line">    node.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            |_ x</span></span><br><span class="line"><span class="comment">            |__|-- 以节点为判断目标，如果是叶子节点则在左边(end)，否则在右边(start)</span></span><br><span class="line"><span class="comment">            |_ y</span></span><br><span class="line"><span class="comment">            |__|-- 设置文字的 y 轴 高度使得与圆圈对齐。</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;dx&quot;</span>,<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">children</span> ? -<span class="number">18</span> :<span class="number">18</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>,<span class="number">3</span>)</span><br><span class="line">        .<span class="title function_">style</span>(<span class="string">&quot;text-anchor&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">children</span> ? <span class="string">&quot;end&quot;</span>:<span class="string">&quot;start&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="property">name</span></span><br><span class="line">        &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="开关"><a href="#开关" class="headerlink" title="开关"></a>开关</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210415014357.png"><br>开关是<code>数据图表的一种交互方式</code>，当点击某个元素的时候会出现新的元素，再次点击支护有会被隐藏，这种方式通常会被运用在<strong>思维导图</strong>中。在下述的code中，主要会分为<code>enter、update、exit</code>，分别表示<code>展开数据、展开后的数据、比和数据</code>等三种表达方式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 布局 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">1800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">2800</span>,</span><br><span class="line">    <span class="attr">left</span>: <span class="number">80</span>,</span><br><span class="line">    <span class="attr">right</span>: <span class="number">50</span>,</span><br><span class="line">    <span class="attr">top</span>: <span class="number">20</span>,</span><br><span class="line">    <span class="attr">bottom</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>, padding.<span class="property">width</span> + padding.<span class="property">left</span> + padding.<span class="property">right</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>, padding.<span class="property">height</span> + padding.<span class="property">top</span> + padding.<span class="property">bottom</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="string">&quot;translate(&quot;</span> + padding.<span class="property">left</span> + <span class="string">&quot;,&quot;</span> + padding.<span class="property">top</span> + <span class="string">&quot;)&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 开始布局运算</span></span><br><span class="line"><span class="comment">    |__|- 获取长宽高并对高-200</span></span><br><span class="line"><span class="comment">    |__|- 设置相邻节点间的位置</span></span><br><span class="line"><span class="comment">    |__|--| a,b 表示两个相邻节点，如果a和b的节点相同，则间隔为1,否则为2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> tree = d3.<span class="property">layout</span>.<span class="title function_">tree</span>()</span><br><span class="line">    .<span class="title function_">size</span>([padding.<span class="property">width</span>, padding.<span class="property">height</span>-<span class="number">200</span>])</span><br><span class="line">    .<span class="title function_">separation</span>(<span class="keyword">function</span> (<span class="params">a,b</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (a.<span class="property">parent</span> == b.<span class="property">parent</span> ? <span class="number">1</span>:<span class="number">2</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 对角线投射 */</span></span><br><span class="line"><span class="keyword">var</span> diagonal = d3.<span class="property">svg</span>.<span class="title function_">diagonal</span>()</span><br><span class="line">    .<span class="title function_">projection</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> [d.<span class="property">y</span>, d.<span class="property">x</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 读取 json 数据</span></span><br><span class="line"><span class="comment">    |__|-- 为第一个节点添加初始坐标 x0/y0</span></span><br><span class="line"><span class="comment">    |__|-- nodes 计算得到的节点数组</span></span><br><span class="line"><span class="comment">    |__|-- links 计算出连线数组</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">d3.<span class="title function_">json</span>(<span class="string">&quot;./teamLayout.json&quot;</span>, <span class="keyword">function</span> (<span class="params">error, root</span>) &#123;</span><br><span class="line">    root.<span class="property">x0</span> = padding.<span class="property">height</span>/<span class="number">2</span></span><br><span class="line">    root.<span class="property">y0</span> = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">redraw</span>(root)    <span class="comment">/* 第一个节点为起始节点重绘和他的重绘函数 */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">redraw</span>(<span class="params">source</span>) &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            计算出节点的连线位置,</span></span><br><span class="line"><span class="comment">            nodes / links 计算出节点的连线和位置</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">var</span> nodes = tree.<span class="title function_">nodes</span>(root)</span><br><span class="line">        <span class="keyword">var</span> links = tree.<span class="title function_">links</span>(nodes)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重新计算点的 y坐标</span></span><br><span class="line">        nodes.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            d.<span class="property">y</span> = d.<span class="property">depth</span> * <span class="number">400</span>;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            处理节点</span></span><br><span class="line"><span class="comment">            获取节点的 update 以及 enter 和 exit 部分</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">var</span> nodeUpdate = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;.node&quot;</span>)</span><br><span class="line">            .<span class="title function_">data</span>(nodes, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> d.<span class="property">name</span></span><br><span class="line">            &#125;)</span><br><span class="line">        <span class="keyword">var</span> nodeEnter = nodeUpdate.<span class="title function_">enter</span>()</span><br><span class="line">        <span class="keyword">var</span> nodeExit = nodeUpdate.<span class="title function_">exit</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            节点的 enter 处理方法</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">var</span> enterNodes = nodeEnter.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;node&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + source.<span class="property">y0</span> + <span class="string">&quot;,&quot;</span> + source.<span class="property">x0</span> + <span class="string">&quot;)&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">on</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="title function_">toggle</span>(d)   <span class="comment">// 开关，“d”为节点如果有则保存到 _children，并将此设置为 null，如果有没子节点则将原来的设置为 null</span></span><br><span class="line">                <span class="title function_">redraw</span>(d)   <span class="comment">// 计算出节点的连线位置</span></span><br><span class="line">            &#125;)</span><br><span class="line">        enterNodes.<span class="title function_">append</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>, <span class="number">0</span>)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> d.<span class="property">_children</span> ? <span class="string">&quot;none&quot;</span> : <span class="string">&quot;#fff&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        enterNodes.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> d.<span class="property">children</span> || d.<span class="property">_children</span> ? -<span class="number">19</span> : <span class="number">19</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>, <span class="string">&quot;.35em&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;text-anchor&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> d.<span class="property">children</span> || d.<span class="property">_children</span> ? <span class="string">&quot;end&quot;</span> : <span class="string">&quot;start&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> d.<span class="property">name</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;fill-opacity&quot;</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            节点的  update 处理方法</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">var</span> updateNodes = nodeUpdate.<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot; translate(&quot;</span> + d.<span class="property">y</span> + <span class="string">&quot;,&quot;</span> + d.<span class="property">x</span> + <span class="string">&quot;)&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        updateNodes.<span class="title function_">select</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> d.<span class="property">children</span> ? <span class="string">&quot;lightsteelblue&quot;</span> : <span class="string">&quot;#fff&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        updateNodes.<span class="title function_">select</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;fill-opacity&quot;</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update 处理方法</span></span><br><span class="line">        updateNodes.<span class="title function_">select</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>,<span class="number">5</span>)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> d.<span class="property">children</span> ? <span class="string">&quot;while&quot;</span>:<span class="string">&quot;#fff&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line">        updateNodes.<span class="title function_">select</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;fill-opacity&quot;</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Exit 处理方法</span></span><br><span class="line">        <span class="keyword">var</span> exitNodes = nodeExit.<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + source.<span class="property">y</span> + <span class="string">&quot;,&quot;</span> + source.<span class="property">x</span> + <span class="string">&quot;)&quot;</span></span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">remove</span>()</span><br><span class="line">        exitNodes.<span class="title function_">select</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        exitNodes.<span class="title function_">select</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;fill-opacity&quot;</span>,<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            处理连线</span></span><br><span class="line"><span class="comment">            获取连线的 update 部分</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="keyword">var</span> linkUpdate = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;.link&quot;</span>)</span><br><span class="line">            .<span class="title function_">data</span>(links, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> d.<span class="property">target</span>.<span class="property">name</span></span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            连线的 enter 处理方法</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">var</span> linkEnter = linkUpdate.<span class="title function_">enter</span>()  <span class="comment">// 获取连线的 enter 部分</span></span><br><span class="line"></span><br><span class="line">        linkEnter.<span class="title function_">insert</span>(<span class="string">&quot;path&quot;</span>,<span class="string">&quot;.node&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;link&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> o = &#123;</span><br><span class="line">                    <span class="attr">x</span>: source.<span class="property">x0</span>,</span><br><span class="line">                    <span class="attr">y</span>: source.<span class="property">y0</span>,</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">diagonal</span>(&#123;</span><br><span class="line">                    <span class="attr">source</span>: o, <span class="attr">target</span>: o</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, diagonal)</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            连线的 update 处理方法</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        linkUpdate.<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, diagonal)</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            连线的 exit 处理方法</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">var</span> linkExit = linkUpdate.<span class="title function_">exit</span>()    <span class="comment">// 获取连线的 Exit 部分</span></span><br><span class="line">        linkExit.<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">1000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, <span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> o = &#123;<span class="attr">x</span>: source.<span class="property">x</span>, <span class="attr">y</span>: source.<span class="property">y</span>&#125;;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">diagonal</span>(&#123;<span class="attr">source</span>: o, <span class="attr">target</span>: o&#125;);</span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">remove</span>();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            将当前节点保存在 x0\y0变量</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        nodes.<span class="title function_">forEach</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            d.<span class="property">x0</span> = d.<span class="property">x</span>;</span><br><span class="line">            d.<span class="property">y0</span> = d.<span class="property">y</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        开关，”d“ 为节点，</span></span><br><span class="line"><span class="comment">        如果有节点，则将节点保存到 _children，并将字节点设置为 null</span></span><br><span class="line"><span class="comment">        如果没有子节点，则去会原来的子节点，设置为 null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">toggle</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (d.<span class="property">children</span>) &#123;</span><br><span class="line">            d.<span class="property">_children</span> = d.<span class="property">children</span></span><br><span class="line">            d.<span class="property">children</span> = <span class="literal">null</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            d.<span class="property">children</span> = d.<span class="property">_children</span></span><br><span class="line">            d.<span class="property">_children</span> = <span class="literal">null</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.link</span> &#123;</span><br><span class="line">  fill: transparent;</span><br><span class="line">  stroke: <span class="number">#e5e5e5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.node</span> circle&#123;</span><br><span class="line">  stroke-<span class="attribute">width</span>: <span class="number">1px</span>;</span><br><span class="line">  stroke: <span class="number">#ec6868</span>;</span><br><span class="line">  fill: transparent;</span><br><span class="line">  <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.node</span> &#123;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">12px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/javascript/d3/25.D3 弦布图/">D3 弦布图</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210408162242.png"><br>弦图（<code>Chord Diagram</code>），是一种表示一组<code>元素之间关系</code>的学术图表之一。主要可以分为<strong>外部节点</strong>和<strong>内部弦</strong>。通过弦图布局（<code>Chord Layout</code>）可以将方块矩阵转换成一个可用于绘制<strong>节点</strong>和<strong>弦</strong>的数据。</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.layout.chord()</td>
<td>创建弦布图</td>
<td></td>
</tr>
<tr>
<td></td>
<td>chord.matrix()</td>
<td>设置或获取矩阵（<strong>必须</strong>为方块矩阵，行列数相等）</td>
</tr>
<tr>
<td></td>
<td>chord.padding()</td>
<td>设置或获取元素节点之间的间距，默认为<code>0</code></td>
</tr>
<tr>
<td></td>
<td>chord.sortGroups()</td>
<td>对节点进行排序</td>
</tr>
<tr>
<td></td>
<td>chord.sortSubgroups()</td>
<td>对各点所在行的数据进行排序</td>
</tr>
<tr>
<td></td>
<td>chord.sortChords()</td>
<td>对弦进行排序</td>
</tr>
<tr>
<td></td>
<td>chord.chords()</td>
<td>返回弦数组</td>
</tr>
<tr>
<td></td>
<td>chord.groups()</td>
<td>返回节点数组</td>
</tr>
</tbody></table>
<h2 id="布局运算"><a href="#布局运算" class="headerlink" title="布局运算"></a>布局运算</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210408162302.png"><br>使用弦布图（<code>Chord Layout</code>）可以直接通过 d3 来计算出<code>弧</code>的<code>startAngle and endAngle</code>等，并通过使用<code>chords() and groups()</code>来直接输出弦图的<code>弦数组以及节点数组</code>，需要注意的是弦图使用的数据添加方法采用了<strong>方块矩阵</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> node = [</span><br><span class="line">    <span class="string">&quot;长春市&quot;</span>,<span class="string">&quot;四平市&quot;</span>,<span class="string">&quot;吉林市&quot;</span>,<span class="string">&quot;松原市&quot;</span>,<span class="string">&quot;通化市&quot;</span>,<span class="string">&quot;白城市&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nodeData = [</span><br><span class="line">    [<span class="number">0</span>,<span class="number">20.56</span>,<span class="number">14.16</span>,<span class="number">11.65</span>,<span class="number">4.87</span>,<span class="number">4.76</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">20.56</span>,<span class="number">14.16</span>,<span class="number">11.65</span>,<span class="number">4.87</span>,<span class="number">4.76</span>],</span><br><span class="line">    [<span class="number">53.57</span>,<span class="number">0</span>,<span class="number">3.09</span>,<span class="number">4.77</span>,<span class="number">1.5</span>,<span class="number">1.43</span>],</span><br><span class="line">    [<span class="number">53.57</span>,<span class="number">4.48</span>,<span class="number">0</span>,<span class="number">3.19</span>,<span class="number">4.86</span>,<span class="number">1.59</span>],</span><br><span class="line">    [<span class="number">43.96</span>,<span class="number">5.91</span>,<span class="number">2.59</span>,<span class="number">0</span>,<span class="number">0.62</span>,<span class="number">11.13</span>],</span><br><span class="line">    [<span class="number">21.22</span>,<span class="number">2.6</span>,<span class="number">8.81</span>,<span class="number">0.84</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> chord = d3.<span class="property">layout</span>.<span class="title function_">chord</span>()</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">0.03</span>)</span><br><span class="line">    .<span class="title function_">sortSubgroups</span>(d3.<span class="property">ascending</span>)</span><br><span class="line">    .<span class="title function_">matrix</span>(nodeData)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chord.<span class="title function_">groups</span>())</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(chord.<span class="title function_">chords</span>())</span><br></pre></td></tr></table></figure>

<h2 id="弦布图"><a href="#弦布图" class="headerlink" title="弦布图"></a>弦布图</h2><p>在下述 code 中分别添加了三个<code>&lt;g&gt;</code>元素，分别包括了<code>位置、节点、弦</code>，分别代表了<code>gOuter(g)、gInner（g）、path（outerPath）、text（outerText）、innerPath（path）</code>，在 web 展示的结构是：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- gChord --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">g</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- gOuter --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">g</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">path</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span>    <span class="comment">&lt;!-- outerPath / path --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">text</span>&gt;</span><span class="tag">&lt;/<span class="name">text</span>&gt;</span>    <span class="comment">&lt;!-- outerText / text --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- gInner --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">g</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">path</span>&gt;</span><span class="tag">&lt;/<span class="name">path</span>&gt;</span>    <span class="comment">&lt;!-- innerPath / path --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">g</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 规格 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 弦图数据 */</span></span><br><span class="line"><span class="keyword">var</span> node = [</span><br><span class="line">    <span class="string">&quot;长春市&quot;</span>,<span class="string">&quot;四平市&quot;</span>,<span class="string">&quot;吉林市&quot;</span>,<span class="string">&quot;松原市&quot;</span>,<span class="string">&quot;通化市&quot;</span>,<span class="string">&quot;白城市&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> nodeData = [</span><br><span class="line">    [<span class="number">0</span>,<span class="number">20.56</span>,<span class="number">14.16</span>,<span class="number">11.65</span>,<span class="number">4.87</span>,<span class="number">4.76</span>],</span><br><span class="line">    [<span class="number">0</span>,<span class="number">20.56</span>,<span class="number">14.16</span>,<span class="number">11.65</span>,<span class="number">4.87</span>,<span class="number">4.76</span>],</span><br><span class="line">    [<span class="number">53.57</span>,<span class="number">0</span>,<span class="number">3.09</span>,<span class="number">4.77</span>,<span class="number">1.5</span>,<span class="number">1.43</span>],</span><br><span class="line">    [<span class="number">53.57</span>,<span class="number">4.48</span>,<span class="number">0</span>,<span class="number">3.19</span>,<span class="number">4.86</span>,<span class="number">1.59</span>],</span><br><span class="line">    [<span class="number">43.96</span>,<span class="number">5.91</span>,<span class="number">2.59</span>,<span class="number">0</span>,<span class="number">0.62</span>,<span class="number">11.13</span>],</span><br><span class="line">    [<span class="number">21.22</span>,<span class="number">2.6</span>,<span class="number">8.81</span>,<span class="number">0.84</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 布局运算 */</span></span><br><span class="line"><span class="keyword">var</span> chord = d3.<span class="property">layout</span>.<span class="title function_">chord</span>()</span><br><span class="line">    .<span class="title function_">padding</span>(<span class="number">0.03</span>)</span><br><span class="line">    .<span class="title function_">sortSubgroups</span>(d3.<span class="property">ascending</span>)</span><br><span class="line">    .<span class="title function_">matrix</span>(nodeData)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 计算出 &lt;g&gt; 元素位置 */</span></span><br><span class="line"><span class="keyword">var</span> gChord = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,</span><br><span class="line">        <span class="string">&quot;translate(&quot;</span> + padding.<span class="property">width</span>/<span class="number">2</span> + <span class="string">&quot;,&quot;</span> + padding.<span class="property">height</span>/<span class="number">2</span> + <span class="string">&quot;)&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 节点和弦的 &lt;g&gt; 元素 */</span></span><br><span class="line"><span class="keyword">var</span> gOuter = gChord.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> gInner = gChord.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 颜色比例尺 */</span></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20c</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 内部与外部半径 */</span></span><br><span class="line"><span class="keyword">var</span> innerRadius = padding.<span class="property">width</span> / <span class="number">2</span> * <span class="number">0.7</span></span><br><span class="line"><span class="keyword">var</span> outerRadius = innerRadius * <span class="number">1.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 弧生成器 */</span></span><br><span class="line"><span class="keyword">var</span> arcOuter = d3.<span class="property">svg</span>.<span class="title function_">arc</span>()</span><br><span class="line">    .<span class="title function_">innerRadius</span>(innerRadius)</span><br><span class="line">    .<span class="title function_">outerRadius</span>(outerRadius)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |- 添加 path 元素</span></span><br><span class="line"><span class="comment">    |- 绑定弧生成器 arcOuter</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gOuter.<span class="title function_">selectAll</span>(<span class="string">&quot;.outerPath&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(chord.<span class="title function_">groups</span>())</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;outerPath&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(d.<span class="property">index</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>, arcOuter)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |- 绘制节点文字</span></span><br><span class="line"><span class="comment">    |- 选择节点文字 node</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gOuter.<span class="title function_">selectAll</span>(<span class="string">&quot;.outerText&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(chord.<span class="title function_">groups</span>())</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    <span class="comment">/* 计算出弧中心角度 */</span></span><br><span class="line">    .<span class="title function_">each</span>(<span class="keyword">function</span> (<span class="params">d,i</span>) &#123;</span><br><span class="line">        d.<span class="property">angle</span> = (d.<span class="property">startAngle</span> + d.<span class="property">endAngle</span>) /<span class="number">2</span></span><br><span class="line">        d.<span class="property">name</span> = node[i]</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;outerText&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>,<span class="string">&quot;.35em&quot;</span>)</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        |- 旋转 d.angle</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="string">&quot;rotate(&quot;</span> + (d.<span class="property">angle</span> * <span class="number">180</span> / <span class="title class_">Math</span>.<span class="property">PI</span>) + <span class="string">&quot;)&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            |- 平移到半径外</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        result += <span class="string">&quot;translate(0,&quot;</span> + -<span class="number">1.0</span> * (outerRadius + <span class="number">10</span>) + <span class="string">&quot;)&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            翻转文字</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (d.<span class="property">angle</span> &gt; <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">3</span> / <span class="number">4</span> &amp;&amp; d.<span class="property">angle</span> &lt; <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">5</span> /<span class="number">4</span>)</span><br><span class="line">            result += <span class="string">&quot;rotate(180)&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arcInner =  d3.<span class="property">svg</span>.<span class="title function_">chord</span>()</span><br><span class="line">    .<span class="title function_">radius</span>(innerRadius)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绑定数据并生成弦 */</span></span><br><span class="line">gInner.<span class="title function_">selectAll</span>(<span class="string">&quot;.innerPath&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(chord.<span class="title function_">chords</span>())</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;innerPath&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,arcInner)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> color (d.<span class="property">source</span>.<span class="property">index</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>less</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@colorWhite</span>: #ffffff;</span><br><span class="line"><span class="selector-class">.outerPath</span>&#123;</span><br><span class="line">  stroke: @colorWhite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.outerText</span>&#123;</span><br><span class="line">  text-anchor: middle;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  fill: @color;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.innerPath</span>&#123;</span><br><span class="line">  stroke: @colorWhite;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了体现出<code>外弦</code>和<code>节点</code>的区分，我们需要为<code>outerPath（外弦路径）、outerText（外弦文字/节点文字）、innerPath（内弦路径）</code>添加样式。</p>
<blockquote>
<p>css</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.outerPath</span>&#123;</span><br><span class="line">  stroke: <span class="number">#ffffff</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.outerText</span>&#123;</span><br><span class="line">  text-anchor: middle;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">16px</span>;</span><br><span class="line">  fill: <span class="number">#929292</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.innerPath</span>&#123;</span><br><span class="line">  stroke: <span class="number">#ffffff</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="behavior"><a href="#behavior" class="headerlink" title="behavior"></a>behavior</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210408190119.png"></p>
<p>为了增加观感上的体验，我们为弦布图增加了<code>behavior</code>，主要通过使用使用<code>mouseover（鼠标光标） and mouseout（光标移出）</code>，然后通过<code>d.source.index !=i &amp;&amp; d.target.index !=i</code>排除<strong>光标选择外的数据</strong>，在通过添加过渡来实现效果。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*  |_ 鼠标事件</span></span><br><span class="line"><span class="comment">    |_| _ mouseover    光标接触</span></span><br><span class="line"><span class="comment">    |_| _ mouseout     光标移出</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">gOuter.<span class="title function_">selectAll</span>(<span class="string">&quot;.outerPath&quot;</span>)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseover&quot;</span>, <span class="title function_">fade</span>(<span class="number">0.0</span>))</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseout&quot;</span>, <span class="title function_">fade</span>(<span class="number">1.0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 透明与半透明方法</span></span><br><span class="line"><span class="comment">    |_|_ 选择鼠标接触到的内部弦</span></span><br><span class="line"><span class="comment">    |_|_ 设置过度与延迟</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fade</span>(<span class="params">opacity</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">g,i</span>) &#123;</span><br><span class="line">        gInner.<span class="title function_">selectAll</span>(<span class="string">&quot;.innerPath&quot;</span>)</span><br><span class="line">            .<span class="title function_">filter</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> d.<span class="property">source</span>.<span class="property">index</span> !=i &amp;&amp; d.<span class="property">target</span>.<span class="property">index</span> !=i</span><br><span class="line">        &#125;)</span><br><span class="line">            .<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">2000</span>)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;opacity&quot;</span>, opacity)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/javascript/d3/24.D3 behavior/">D3 behavior</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p>behavior，即“<code>行为</code>”，他主要包含了<code>d3.behavior.drag</code>以及<code>d3.behavior.zoom</code>来分别实现和处理<strong>拖拽和缩放</strong>的交互形式。</p>
<h2 id="click"><a href="#click" class="headerlink" title="click"></a>click</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210408031338.png"><br>在先介绍 <code>behavior</code>前，我们需要了解到基本的鼠标事件，鼠标事件主要分为<code>6</code>种，主要是辨别鼠标的<code>按下、触点</code>等两种：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
</tr>
</thead>
<tbody><tr>
<td>click</td>
<td>鼠标单击某元素时（被 <code>mousedown（鼠标按下） and mouseup（鼠标松开）</code>组合在一起）</td>
</tr>
<tr>
<td>mouseover</td>
<td>当接收到<code>光标触点时</code> ……</td>
</tr>
<tr>
<td>mouseout</td>
<td>当光标从 …… <code>移出时</code></td>
</tr>
<tr>
<td>mousemove</td>
<td>当鼠标<code>移动</code>时 ……</td>
</tr>
<tr>
<td>mousedown</td>
<td>当鼠标 <code>按下</code> 时 ……</td>
</tr>
<tr>
<td>mouseup</td>
<td>当鼠标<code>按下松开</code>时 ……</td>
</tr>
</tbody></table>
<p>在下述的 code 中我们组要实现了鼠标的<code>按下（mousedown \ click)、鼠标松开（mouseup）、光标接触（mouseover）、光标移出（mouseout）</code>的例子，并配合<code>过渡效果</code>来分别的进行显示，需要值得注意的是<code>click与 mousedown</code>并<strong>不是完全一样</strong>的，可以从下述 code 看出差别。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;blue&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>,<span class="number">200</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>,<span class="number">20</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,<span class="number">100</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,<span class="number">100</span>)</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        |- mouseover 收到光标时</span></span><br><span class="line"><span class="comment">        |- mouseout 当光标移出时</span></span><br><span class="line"><span class="comment">        |- mousedown 当鼠标按下时 / click 当鼠标按下时</span></span><br><span class="line"><span class="comment">        |- mouseup 当鼠标松下时</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseover&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">            .<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">2000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;red&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseout&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">            .<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">2000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;blue&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,<span class="number">100</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;click&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">            .<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">2000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,<span class="number">200</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseup&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">            .<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">2000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,<span class="number">100</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h2 id="drag"><a href="#drag" class="headerlink" title="drag"></a>drag</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210408031347.png"><br>拖拽 (<code>drag</code>) 主要通过使用<code>d3.behavior.drag</code>来进行实现，是指通过鼠标将元素从一个位置到另一位置，通常主要分为<code>按下鼠标、鼠标移动、鼠标松开</code>等三个步骤，D3 为此提供了一种更为简单方法 :</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.behavior.drag()</td>
<td>创建一个拖拽</td>
<td></td>
</tr>
<tr>
<td></td>
<td>drag.on(<code>type[,listener</code>])</td>
<td>设置时间监听器，主要支持三种类型，分别为：“<code>dragstart（拖拽开始）、drag（拖拽中）、dragend（拖拽结束）</code>“，而<code>listener</code>是监听函数，默认返回当前指定事件监听器</td>
</tr>
<tr>
<td></td>
<td>drag.origin()</td>
<td>设置拖拽起点，<strong>可以使得鼠标与被平移元素以相对不变的偏移量进行移动</strong> ，如果设置了起点，那么将会在<code>鼠标按下（mousedown）</code>事件发生时进行调用</td>
</tr>
<tr>
<td></td>
<td>on.dragstart</td>
<td>监听 drag 拖动<code>是否开始</code></td>
</tr>
<tr>
<td></td>
<td>on.dragend</td>
<td>监听 dran 拖动<code>是否结束</code></td>
</tr>
</tbody></table>
<p>在下述的 code 中，我们主要通过使用<code>drag</code>来进行移动，当移动的时候将数据<code>cy\cx</code>数据赋值到当前<code>svg</code>图像的<code>x\y</code>轴中，并通过使用<code>dragstart</code>与<code>dragend</code>来进行监听<code>drag</code>是否被拖动，从而添加<code>过渡属性</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 样式 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 圆数据与位置 */</span></span><br><span class="line"><span class="keyword">var</span> circles = [</span><br><span class="line">    &#123;<span class="attr">cx</span>: <span class="number">50</span>, <span class="attr">cy</span>: <span class="number">50</span>, <span class="attr">r</span>:<span class="number">20</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 起点坐标 origin</span></span><br><span class="line"><span class="comment">    |_ 将拖拽时的坐标赋值给 event.x \ event.y</span></span><br><span class="line"><span class="comment">    |_ 当拖拽开始时将颜色设置为 red 并将圆弧半径设置为 50 dragstart</span></span><br><span class="line"><span class="comment">    |_ 拖拽结束后将颜色与半径设置原来的样子  dragend</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> drag = d3.<span class="property">behavior</span>.<span class="title function_">drag</span>()</span><br><span class="line">    .<span class="title function_">origin</span>(<span class="keyword">function</span> (<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">x</span>: d.<span class="property">cx</span>, <span class="attr">y</span>: d.<span class="property">cy</span>&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;drag&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="variable language_">this</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;cx&quot;</span>, d.<span class="property">cx</span> = d3.<span class="property">event</span>.<span class="property">x</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;cy&quot;</span>, d.<span class="property">cy</span> = d3.<span class="property">event</span>.<span class="property">y</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;dragstart&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">2000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;red&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>,<span class="number">50</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;dragend&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">2000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;blue&quot;</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>,<span class="number">20</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制圆 */</span></span><br><span class="line">svg.<span class="title function_">selectAll</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(circles)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;cx&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">cx</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;cy&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">cy</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">r</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;blue&quot;</span>)</span><br><span class="line">    .<span class="title function_">call</span>(drag)</span><br></pre></td></tr></table></figure>

<h2 id="zoom"><a href="#zoom" class="headerlink" title="zoom"></a>zoom</h2><p>缩放（<code>zoom</code>）是在数据可视化中较为常用的小细节之一，因此 d3 为我们提供了<code>d3.behavior.zoom</code>方法来用于构建缩放行为。</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.behavior.zoom</td>
<td>构建一个缩放行为</td>
<td></td>
</tr>
<tr>
<td></td>
<td>zoom(selection)</td>
<td>将此行为应用到选择集中</td>
</tr>
<tr>
<td></td>
<td>zoom.translate()</td>
<td>设置缩放的平移量，默认为<code>0</code>，并返回当前的平移向量</td>
</tr>
<tr>
<td></td>
<td>zoom.scale()</td>
<td>设置初始<code>放大、缩小</code>量的最大值，默认为<code>0～∞</code></td>
</tr>
<tr>
<td></td>
<td>zoom.center()</td>
<td>设置缩放的<code>中心点</code>，默认为<strong>鼠标的位置</strong></td>
</tr>
<tr>
<td></td>
<td>zoom.x()</td>
<td>设置一个 <code>x</code>方向比例尺，比例尺会随着<strong>放大、缩小改变定义域</strong></td>
</tr>
<tr>
<td></td>
<td>zoom.y()</td>
<td>设置一个 <code>y</code>方向比例尺，比例尺会随着<strong>放大、缩小改变定义域</strong></td>
</tr>
<tr>
<td></td>
<td>zoom.on</td>
<td>设置<code>事件类型</code>，主要分为：”<code>zoomstart（缩放开始）、zoom（正在缩放）、zoomend（缩放结束）</code>“三种</td>
</tr>
</tbody></table>
<p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210408031401.png"><br>通过<code>on.zoom</code>来计算出缩放的开始并因此得到圆的大小和坐标信息，之后绑定数据进行绘制，在这其中主要通过使用<code>scaleExtent</code>来设置缩放的倍数，其方法主要分为<code>最小值、最大值</code>，下述code中的缩放最大为<code>2</code>倍，最小为<code>1</code>倍，并设置基础的<code>比例尺</code>，通过缩放来观察比例尺的<code>缩放变化</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 结构 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> circles = [</span><br><span class="line">    &#123;<span class="attr">cx</span>: <span class="number">150</span>, <span class="attr">cy</span>: <span class="number">200</span>, <span class="attr">r</span>:<span class="number">30</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 比例尺 */</span></span><br><span class="line"><span class="keyword">var</span> x = d3.<span class="property">scale</span>.<span class="title function_">linear</span>()</span><br><span class="line">    .<span class="title function_">domain</span>([<span class="number">0</span>, padding.<span class="property">width</span>])</span><br><span class="line">    .<span class="title function_">range</span>([<span class="number">0</span>, padding.<span class="property">width</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> y = d3.<span class="property">scale</span>.<span class="title function_">linear</span>()</span><br><span class="line">    .<span class="title function_">domain</span>([<span class="number">0</span>, padding.<span class="property">height</span>])</span><br><span class="line">    .<span class="title function_">range</span>([<span class="number">0</span>, padding.<span class="property">height</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 计算出基本缩放后大小与位置 */</span></span><br><span class="line"><span class="keyword">var</span> zoom = d3.<span class="property">behavior</span>.<span class="title function_">zoom</span>()</span><br><span class="line">    .<span class="title function_">x</span>(x)</span><br><span class="line">    .<span class="title function_">y</span>(y)</span><br><span class="line">    .<span class="title function_">scaleExtent</span>([<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        |_ 缩放开始进行颜色过渡 zoomstart</span></span><br><span class="line"><span class="comment">        |_ 缩放中计算出位置与大小 zoom</span></span><br><span class="line"><span class="comment">        |_ 缩放结束进行控制台输出 zoomend</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;zoomstart&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            .<span class="title function_">transition</span>()</span><br><span class="line">            .<span class="title function_">duration</span>(<span class="number">2000</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;red&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;zoom&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="variable language_">this</span>)</span><br><span class="line">            .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,<span class="string">&quot;translate(&quot;</span> + d3.<span class="property">event</span>.<span class="property">translate</span> + <span class="string">&quot;)&quot;</span> +     <span class="comment">/* 平移位置 */</span></span><br><span class="line">            <span class="string">&quot;scale(&quot;</span> + d3.<span class="property">event</span>.<span class="property">scale</span> + <span class="string">&quot;)&quot;</span>)    <span class="comment">/* 缩放大小 */</span></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;x 的定义域&quot;</span> + x.<span class="title function_">domain</span>())</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;y 的值域&quot;</span> + y.<span class="title function_">domain</span>())</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;zoomend&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        d3.<span class="title function_">select</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;缩放结束&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绑定位置数据到 元素 &lt;g&gt; */</span></span><br><span class="line"><span class="keyword">var</span> g = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">call</span>(zoom)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制圆 */</span></span><br><span class="line">g.<span class="title function_">selectAll</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(circles)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;cx&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">cx</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;cy&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">cy</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">r</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>, <span class="string">&quot;blue&quot;</span>)</span><br></pre></td></tr></table></figure>



	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/javascript/d3/23.D3 力布图/">D3 力布图</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p>力布图，也被称之为力导向图（<code>Force</code>），通过使用布局可以<code>物理模拟</code>的方式将力导向图更加灵活的实现位置的简单控制与计算。而力导向图本身是一种<code>绘图算法</code>，即在二位或三维空间中配置一个节点，节点之间通过直线连接，这种方式被称之为<strong>连线</strong>，每次连线的长度基本长度<strong>相等</strong>，需要注意的是这种线会显得<strong>尽量不可相交</strong>。</p>
<p>节点和连线都被施加了力的作用，根据力的作用，来计算出节点和连线的运动轨迹，最终使得让他们呈现一种<strong>静止的</strong>画面。</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.layout.force</td>
<td>创建一个力布图，即<code>力导向图布局</code></td>
<td></td>
</tr>
<tr>
<td>force.size([size])</td>
<td>设置胡获取力布图的作用范围，size 主要影响里到力布图的重力中心和初始的随机位置，默认为<code>1x1</code></td>
<td></td>
</tr>
<tr>
<td>force.nodes([node])</td>
<td>设置或获取力导向图的布局节点数组，默认为返回当前节点数组</td>
<td></td>
</tr>
<tr>
<td>force.charge([charge])</td>
<td>指定电荷强度，主要用于决定是<strong>排斥</strong>还是<strong>吸引</strong>，如果输入的值是<code>正</code>的则导致节点互相<strong>吸引</strong>，输入<code>负值</code>则会导致节点<code>互相排斥</code>。（需要足以的是，电荷是通过使用<code>Barnes-Hut</code>算法进行实现的）</td>
<td></td>
</tr>
<tr>
<td>force.links([links])</td>
<td>设置或获取力布图的连接数组，默认为返回当前的连接数组</td>
<td></td>
</tr>
<tr>
<td>force.linkDistance([distance])</td>
<td>设置链接点间目标距离的连线长度，默认为<code>20</code></td>
<td></td>
</tr>
<tr>
<td>force.start()</td>
<td>启动模拟，<code>首次创建</code>力布图时必须被调用，然后分配节点和链接，当节点发生变化的时候将会再次被调用，通过此函数可以及那指定从何时开始计算。</td>
<td></td>
</tr>
<tr>
<td>force.tick()</td>
<td>进入力布图的仿真步骤，主要通过配合<code>start and stop</code>来计算出静态布局</td>
<td></td>
</tr>
<tr>
<td>force.on(type,listener)</td>
<td><code>type</code>是一个事件类型，主要有：<code>start、tick、end</code>三种，而<code>listener</code>则是监听器，主要用于更新节点和链接的显示位置</td>
<td></td>
</tr>
<tr>
<td>force.drag()</td>
<td>绑定一个行为允许的交互式托转节点，<code>drag</code>函数主要用于实现拖拽操作</td>
<td></td>
</tr>
</tbody></table>
<h2 id="布局运算"><a href="#布局运算" class="headerlink" title="布局运算"></a>布局运算</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210407234657.png"><br>当通过下述 code 运行之后，那么数据将会通过<code>start()</code>进行转换，转换后的数据将会发生变化，原有的节点将会得出<code>index、x、y、px、py、fixed、weight</code>等额外属性，这些属性分别意思为<code>索引、x坐标、y坐标、上一时刻的x坐标、上一时刻的y坐标、节点是否固定、节点有多少连线并与之相连</code>。</p>
<p>而链接数组将会返回出的数据我们可以的出两个非常重要的点即<code>source</code>和<code>targe</code>，分别代表来来源与<code>目标</code>，就如<code>source: 0, target: 2</code>，那么就表述数组<code>one</code>链接<code>2</code>，在这里我们需要注意的是，<strong>D3 是从0开始计算的</strong>，或者说<strong>我不能链接我自己，source: 0, targe: 0</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 规格 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    定义节点数组以及连线数组</span></span><br><span class="line"><span class="comment">    nodes and edges</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> nodes = [</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;one&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;two&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;three&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;3&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;4&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;5&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;6&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> edges = [</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">2</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">3</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">1</span>, <span class="attr">target</span>: <span class="number">4</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">1</span>, <span class="attr">target</span>: <span class="number">5</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">1</span>, <span class="attr">target</span>: <span class="number">6</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    | 设置节点数据</span></span><br><span class="line"><span class="comment">    |_ nodes 设置节点数组</span></span><br><span class="line"><span class="comment">    |_ links 设置连线数组</span></span><br><span class="line"><span class="comment">    |_ size 设置大小</span></span><br><span class="line"><span class="comment">    |_ linkDistance 设置连线距离</span></span><br><span class="line"><span class="comment">    |_ charge 设置电荷数</span></span><br><span class="line"><span class="comment">    | 开始计算</span></span><br><span class="line"><span class="comment">    |_ start 开始布局计算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> force = d3.<span class="property">layout</span>.<span class="title function_">force</span>()</span><br><span class="line">    .<span class="title function_">nodes</span>(nodes)</span><br><span class="line">    .<span class="title function_">links</span>(edges)</span><br><span class="line">    .<span class="title function_">size</span>([padding.<span class="property">width</span>,padding.<span class="property">height</span>])</span><br><span class="line">    .<span class="title function_">linkDistance</span>(<span class="number">90</span>)</span><br><span class="line">    .<span class="title function_">charge</span>(-<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">force.<span class="title function_">start</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(nodes)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(edges)</span><br></pre></td></tr></table></figure>

<h2 id="力布图"><a href="#力布图" class="headerlink" title="力布图"></a>力布图</h2><h3 id="绘制力布图"><a href="#绘制力布图" class="headerlink" title="绘制力布图"></a>绘制力布图</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210407234704.png"></p>
<p>在下述的 code 中我们主要绘制了<code>连接线</code>及其样式、还有<code>圆</code>的绘制与样式，在这其中，主要通过使用<code>drag</code>来赋予圆可以被<code>拖拽</code>，之后通过使用<code>.on</code>来重新计算出链接点的坐标以及文字的坐标。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 规格 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    定义节点数组以及连线数组</span></span><br><span class="line"><span class="comment">    nodes and edges</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> nodes = [</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;one&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;two&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;three&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;3&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;4&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;5&quot;</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">name</span>: <span class="string">&quot;6&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> edges = [</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">1</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">2</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">0</span>, <span class="attr">target</span>: <span class="number">3</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">1</span>, <span class="attr">target</span>: <span class="number">4</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">1</span>, <span class="attr">target</span>: <span class="number">5</span>&#125;,</span><br><span class="line">    &#123;<span class="attr">source</span>: <span class="number">1</span>, <span class="attr">target</span>: <span class="number">6</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    | 设置节点数据</span></span><br><span class="line"><span class="comment">    |_ nodes 设置节点数组</span></span><br><span class="line"><span class="comment">    |_ links 设置连线数组</span></span><br><span class="line"><span class="comment">    |_ size 设置大小</span></span><br><span class="line"><span class="comment">    |_ linkDistance 设置连线距离</span></span><br><span class="line"><span class="comment">    |_ charge 设置电荷数</span></span><br><span class="line"><span class="comment">    | 开始计算</span></span><br><span class="line"><span class="comment">    |_ start 开始布局计算</span></span><br><span class="line"><span class="comment">    |_ category20c 由D3 所提供的 20种颜色（第三方案）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> force = d3.<span class="property">layout</span>.<span class="title function_">force</span>()</span><br><span class="line">    .<span class="title function_">nodes</span>(nodes)</span><br><span class="line">    .<span class="title function_">links</span>(edges)</span><br><span class="line">    .<span class="title function_">size</span>([padding.<span class="property">width</span>,padding.<span class="property">height</span>])</span><br><span class="line">    .<span class="title function_">linkDistance</span>(<span class="number">190</span>)</span><br><span class="line">    .<span class="title function_">charge</span>(-<span class="number">900</span>)</span><br><span class="line"></span><br><span class="line">force.<span class="title function_">start</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20c</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制连线 */</span></span><br><span class="line"><span class="keyword">var</span> lines = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;.forceLine&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(edges)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;forceLine&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    |_ 绘制节点圆圈</span></span><br><span class="line"><span class="comment">    |———— 添加 circle</span></span><br><span class="line"><span class="comment">    |———— 设置样式为 forceCircle</span></span><br><span class="line"><span class="comment">    |———— 设置圆半径为 40r</span></span><br><span class="line"><span class="comment">    |———— 允许被拖动</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> circles = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;.forceCircle&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(nodes)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;circle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;r&quot;</span>,<span class="number">40</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;fill&quot;</span>, <span class="keyword">function</span> (<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(i)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">call</span>(force.<span class="property">drag</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 绘制文字 */</span></span><br><span class="line"><span class="keyword">var</span> texts = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;.forceText&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(nodes)</span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;forceText&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">x</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">y</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>,<span class="string">&quot;.3em&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">name</span>;</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 鼠标事件监听器 */</span></span><br><span class="line">force.<span class="title function_">on</span>(<span class="string">&quot;tick&quot;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">/* 更新连线端点坐标 */</span></span><br><span class="line">    lines.<span class="title function_">attr</span>(<span class="string">&quot;x1&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">source</span>.<span class="property">x</span></span><br><span class="line">    &#125;)</span><br><span class="line">    lines.<span class="title function_">attr</span>(<span class="string">&quot;y1&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">source</span>.<span class="property">y</span></span><br><span class="line">    &#125;)</span><br><span class="line">    lines.<span class="title function_">attr</span>(<span class="string">&quot;x2&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">target</span>.<span class="property">x</span></span><br><span class="line">    &#125;)</span><br><span class="line">    lines.<span class="title function_">attr</span>(<span class="string">&quot;y2&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">target</span>.<span class="property">y</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 更新节点坐标 */</span></span><br><span class="line">    circles.<span class="title function_">attr</span>(<span class="string">&quot;cx&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">x</span></span><br><span class="line">    &#125;)</span><br><span class="line">    circles.<span class="title function_">attr</span>(<span class="string">&quot;cy&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">y</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 更新节点的文字坐标 */</span></span><br><span class="line">    texts.<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">x</span></span><br><span class="line">    &#125;)</span><br><span class="line">    texts.<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">y</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>CSS</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.forceLine</span> &#123;</span><br><span class="line">  fill: none;</span><br><span class="line">  stroke: <span class="number">#d0d0d0</span>;</span><br><span class="line">  stroke-<span class="attribute">width</span>: <span class="number">2px</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.forceText</span> &#123;</span><br><span class="line">  text-anchor: middle;</span><br><span class="line">  fill: white;</span><br><span class="line">  <span class="attribute">font-weight</span>: bold;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="on"><a href="#on" class="headerlink" title="on"></a>on</h3><p>如一开始介绍的函数方法一样,<code>force.on(type.listener)</code>是一个监听器可通过使用<code>on</code>进行更新节点以及链接的显示位置，当然也可以设置拖拽后固定对象的位置，可添加：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> drag = force.<span class="title function_">drag</span>()</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;dragstart&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        d.<span class="property">fixed</span> = <span class="literal">true</span></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>


	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/javascript/d3/22.D3 饼布图/">D3 饼布图</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p>饼状图（<code>Pie Chart</code>）通过使用布局可以<code>方便</code>计算出饼图或圈外的开始以及结束的角度，饼布图还可以用于绘制弧形。当开始绘制的时候<code>布局会将数据数组</code>转换成一个<code>对象数据</code>，在这个对象数据中包含了<strong>开始角度</strong>以及<strong>结束角度</strong>，之后传递给弧形生成器。</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.layout.pie()</td>
<td>创建一个新的饼图</td>
<td></td>
</tr>
<tr>
<td>pie(value[,index])</td>
<td>转换数据，转换后的每个对象都包含有<code>起始角度</code>和<code>终止角度</code></td>
<td></td>
</tr>
<tr>
<td>pie.value([accessor])</td>
<td>设置或获取<code>值访问器</code>，即从接收的数据中提取初始值</td>
<td></td>
</tr>
<tr>
<td>pie.sort([comparator])</td>
<td>设置或获取<code>比较器</code>，主要用于进行排序</td>
<td></td>
</tr>
<tr>
<td>pie.startAngle([angle])</td>
<td>如果指定<code>angle</code>，那么将会来设置饼布图所有起始弧度，默认为<code>0</code>，单位为<code>弧度</code></td>
<td></td>
</tr>
<tr>
<td>pie.endAngle([angle])</td>
<td>如果设置<code>angle</code>，那么将会设置饼布图的所有终止弧度，默认为<code>2π</code>，单位为<code>弧度</code></td>
<td></td>
</tr>
</tbody></table>
<h2 id="布局运用"><a href="#布局运用" class="headerlink" title="布局运用"></a>布局运用</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210407111951.png"><br>在下述 code 中，主要定义了基本的饼布图数据，之后通过使用<code>d3.layout.pie</code>创建布局，共过使用<code>值访问</code>将传入的数组提取出需要转换的数据方法，因此<code>所有数据都会被调用一次此方法</code>，通过使用值访问器，那么将会分别返回<code>没一项的对应</code>数据，如<code>[2015,1000]</code>，那么通过值访问器将会返回<code>1000</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> database = [</span><br><span class="line">    [<span class="number">2015</span>,<span class="number">1000</span>],</span><br><span class="line">    [<span class="number">2016</span>,<span class="number">2000</span>],</span><br><span class="line">    [<span class="number">2017</span>,<span class="number">3000</span>],</span><br><span class="line">    [<span class="number">2018</span>,<span class="number">4000</span>],</span><br><span class="line">    [<span class="number">2019</span>,<span class="number">5000</span>],</span><br><span class="line">    [<span class="number">2020</span>,<span class="number">6000</span>],</span><br><span class="line">    [<span class="number">2021</span>,<span class="number">7000</span>]</span><br><span class="line">]</span><br><span class="line"><span class="keyword">var</span> pie = d3.<span class="property">layout</span>.<span class="title function_">pie</span>()</span><br><span class="line">    .<span class="title function_">value</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d[<span class="number">1</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pieEcho = <span class="title function_">pie</span>(database)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(pieEcho)</span><br></pre></td></tr></table></figure>

<h3 id="Start-and-EndAngle"><a href="#Start-and-EndAngle" class="headerlink" title="Start and EndAngle"></a>Start and EndAngle</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210407112218.png"><br>通过使用布局（<code>layout</code>），可以不需要开发者手动进行计算来根据<code>布局</code>得出结果，在下述 code 中主要通过使用 <code>startAngle</code>以及<code>endAngle</code>来分别指定圆弧的<code>开始以及结束半径</code>，整个过程都无需开发者进行手动计算，直接根据布局运算的出结果。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 样式 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 饼布图数据 */</span></span><br><span class="line"><span class="keyword">var</span> database = [</span><br><span class="line">    [<span class="number">2015</span>,<span class="number">1000</span>],</span><br><span class="line">    [<span class="number">2016</span>,<span class="number">2000</span>],</span><br><span class="line">    [<span class="number">2017</span>,<span class="number">3000</span>],</span><br><span class="line">    [<span class="number">2018</span>,<span class="number">4000</span>],</span><br><span class="line">    [<span class="number">2019</span>,<span class="number">5000</span>],</span><br><span class="line">    [<span class="number">2020</span>,<span class="number">6000</span>],</span><br><span class="line">    [<span class="number">2021</span>,<span class="number">7000</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /- 值访问器 function</span></span><br><span class="line"><span class="comment">    /——— 输出经过布局计算出的值 pie(databases)</span></span><br><span class="line"><span class="comment">    /———— 自定义设置圆弧的开始半径以及结束半径</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> pie = d3.<span class="property">layout</span>.<span class="title function_">pie</span>()</span><br><span class="line">    .<span class="title function_">startAngle</span>(<span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">0.2</span>)</span><br><span class="line">    .<span class="title function_">endAngle</span>(<span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">1.5</span>)</span><br><span class="line">    .<span class="title function_">value</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d[<span class="number">1</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pieEcho = <span class="title function_">pie</span>(database)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /—— 半径设置 arc</span></span><br><span class="line"><span class="comment">    /———— 外半径 outerRadius</span></span><br><span class="line"><span class="comment">    /———— 内半径 innerRadius(为区分这里设置200,饼状图应该设置为0)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> outerRadius = padding.<span class="property">width</span> / <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> innerRadius = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arc = d3.<span class="property">svg</span>.<span class="title function_">arc</span>()</span><br><span class="line">    .<span class="title function_">innerRadius</span>(innerRadius)</span><br><span class="line">    .<span class="title function_">outerRadius</span>(outerRadius)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置颜色 */</span></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20c</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 为对应数据添加弧的基本位置 */</span></span><br><span class="line"><span class="keyword">var</span> arcs = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(pieEcho)  <span class="comment">/* 绑定计算后的数据 */</span></span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,</span><br><span class="line">        <span class="string">&quot;translate(&quot;</span> + (padding.<span class="property">width</span> /<span class="number">2</span>) +<span class="string">&quot;,&quot;</span> + (padding.<span class="property">height</span> /<span class="number">2</span>) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加路径元素 */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(i)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">arc</span>(d)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /—— 文字</span></span><br><span class="line"><span class="comment">    /———— 问别定义文文字的xy坐标</span></span><br><span class="line"><span class="comment">    /———— 计算出数据的百分比</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> x = arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">var</span> y = arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;)&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;text-anchor&quot;</span>,<span class="string">&quot;middle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;white&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> percent = <span class="title class_">Number</span>(d.<span class="property">value</span>)/d3.<span class="title function_">sum</span>(database, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d[<span class="number">1</span>]</span><br><span class="line">        &#125;) * <span class="number">100</span></span><br><span class="line">        <span class="keyword">return</span> percent.<span class="title function_">toFixed</span>(<span class="number">1</span>) + <span class="string">&quot;%&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    外部文字及线条</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;stroke&quot;</span>,<span class="string">&quot;black&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x1&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>] * <span class="number">2.3</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y1&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>] * <span class="number">2.3</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x2&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>] * <span class="number">2.2</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y2&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>] * <span class="number">2.2</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> x = arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>] * <span class="number">2.5</span></span><br><span class="line">        <span class="keyword">var</span> y = arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>] * <span class="number">2.5</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;)&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;text-anchor&quot;</span>,<span class="string">&quot;middle&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">data</span>[<span class="number">0</span>]</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<h2 id="绘制弧"><a href="#绘制弧" class="headerlink" title="绘制弧"></a>绘制弧</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210407112004.png"></p>
<p>通常来讲布局与<code>弧生成器</code>来进行绘制的图被称之为<code>饼布图</code>，与弧生成器来直接绘制饼图类似，因此<code>startAngle</code>以及<code>endAngle</code>都将适用与饼布图。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 样式 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 饼布图数据 */</span></span><br><span class="line"><span class="keyword">var</span> database = [</span><br><span class="line">    [<span class="number">2015</span>,<span class="number">1000</span>],</span><br><span class="line">    [<span class="number">2016</span>,<span class="number">2000</span>],</span><br><span class="line">    [<span class="number">2017</span>,<span class="number">3000</span>],</span><br><span class="line">    [<span class="number">2018</span>,<span class="number">4000</span>],</span><br><span class="line">    [<span class="number">2019</span>,<span class="number">5000</span>],</span><br><span class="line">    [<span class="number">2020</span>,<span class="number">6000</span>],</span><br><span class="line">    [<span class="number">2021</span>,<span class="number">7000</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /- 值访问器 function</span></span><br><span class="line"><span class="comment">    /——— 输出经过布局计算出的值 pie(databases)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> pie = d3.<span class="property">layout</span>.<span class="title function_">pie</span>()</span><br><span class="line">        .<span class="title function_">value</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d[<span class="number">1</span>]</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pieEcho = <span class="title function_">pie</span>(database)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /—— 半径设置 arc</span></span><br><span class="line"><span class="comment">    /———— 外半径 outerRadius</span></span><br><span class="line"><span class="comment">    /———— 内半径 innerRadius(为区分这里设置200,饼状图应该设置为0)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> outerRadius = padding.<span class="property">width</span> / <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> innerRadius = <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arc = d3.<span class="property">svg</span>.<span class="title function_">arc</span>()</span><br><span class="line">    .<span class="title function_">innerRadius</span>(innerRadius)</span><br><span class="line">    .<span class="title function_">outerRadius</span>(outerRadius)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置颜色 */</span></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20c</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 为对应数据添加弧的基本位置 */</span></span><br><span class="line"><span class="keyword">var</span> arcs = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(pieEcho)  <span class="comment">/* 绑定计算后的数据 */</span></span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,</span><br><span class="line">        <span class="string">&quot;translate(&quot;</span> + (padding.<span class="property">width</span> /<span class="number">2</span>) +<span class="string">&quot;,&quot;</span> + (padding.<span class="property">height</span> /<span class="number">2</span>) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加路径元素 */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(i)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">arc</span>(d)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="内部文字"><a href="#内部文字" class="headerlink" title="内部文字"></a>内部文字</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210407112146.png"><br>在下述的 code 中，我们通过使用 <code>arc.centroid</code>来计算出弧的中心坐标，之后在通过计算数据的百分比最终得出一个完整的饼图内部数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 样式 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 饼布图数据 */</span></span><br><span class="line"><span class="keyword">var</span> database = [</span><br><span class="line">    [<span class="number">2015</span>,<span class="number">1000</span>],</span><br><span class="line">    [<span class="number">2016</span>,<span class="number">2000</span>],</span><br><span class="line">    [<span class="number">2017</span>,<span class="number">3000</span>],</span><br><span class="line">    [<span class="number">2018</span>,<span class="number">4000</span>],</span><br><span class="line">    [<span class="number">2019</span>,<span class="number">5000</span>],</span><br><span class="line">    [<span class="number">2020</span>,<span class="number">6000</span>],</span><br><span class="line">    [<span class="number">2021</span>,<span class="number">7000</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /- 值访问器 function</span></span><br><span class="line"><span class="comment">    /——— 输出经过布局计算出的值 pie(databases)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> pie = d3.<span class="property">layout</span>.<span class="title function_">pie</span>()</span><br><span class="line">        .<span class="title function_">value</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d[<span class="number">1</span>]</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pieEcho = <span class="title function_">pie</span>(database)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /—— 半径设置 arc</span></span><br><span class="line"><span class="comment">    /———— 外半径 outerRadius</span></span><br><span class="line"><span class="comment">    /———— 内半径 innerRadius(为区分这里设置200,饼状图应该设置为0)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> outerRadius = padding.<span class="property">width</span> / <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> innerRadius = <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arc = d3.<span class="property">svg</span>.<span class="title function_">arc</span>()</span><br><span class="line">    .<span class="title function_">innerRadius</span>(innerRadius)</span><br><span class="line">    .<span class="title function_">outerRadius</span>(outerRadius)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置颜色 */</span></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20c</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 为对应数据添加弧的基本位置 */</span></span><br><span class="line"><span class="keyword">var</span> arcs = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(pieEcho)  <span class="comment">/* 绑定计算后的数据 */</span></span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,</span><br><span class="line">        <span class="string">&quot;translate(&quot;</span> + (padding.<span class="property">width</span> /<span class="number">2</span>) +<span class="string">&quot;,&quot;</span> + (padding.<span class="property">height</span> /<span class="number">2</span>) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加路径元素 */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(i)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">arc</span>(d)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 内部文字 */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> x = arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">var</span> y = arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;)&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;text-anchor&quot;</span>,<span class="string">&quot;middle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;white&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> percent = <span class="title class_">Number</span>(d.<span class="property">value</span>)/d3.<span class="title function_">sum</span>(database, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d[<span class="number">1</span>]</span><br><span class="line">        &#125;) * <span class="number">100</span></span><br><span class="line">        <span class="keyword">return</span> percent.<span class="title function_">toFixed</span>(<span class="number">1</span>) + <span class="string">&quot;%&quot;</span></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h3 id="外部文字"><a href="#外部文字" class="headerlink" title="外部文字"></a>外部文字</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210407112102.png"><br>外部文字依然可以通过使用<code>arc.centroid</code>来直接根据圆弧从中心点进行计算，从而分别出的<code>线</code>以及<code>文字</code>的路径和<code>x,y</code>轴的坐标。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 样式 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 饼布图数据 */</span></span><br><span class="line"><span class="keyword">var</span> database = [</span><br><span class="line">    [<span class="number">2015</span>,<span class="number">1000</span>],</span><br><span class="line">    [<span class="number">2016</span>,<span class="number">2000</span>],</span><br><span class="line">    [<span class="number">2017</span>,<span class="number">3000</span>],</span><br><span class="line">    [<span class="number">2018</span>,<span class="number">4000</span>],</span><br><span class="line">    [<span class="number">2019</span>,<span class="number">5000</span>],</span><br><span class="line">    [<span class="number">2020</span>,<span class="number">6000</span>],</span><br><span class="line">    [<span class="number">2021</span>,<span class="number">7000</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /- 值访问器 function</span></span><br><span class="line"><span class="comment">    /——— 输出经过布局计算出的值 pie(databases)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> pie = d3.<span class="property">layout</span>.<span class="title function_">pie</span>()</span><br><span class="line">        .<span class="title function_">value</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d[<span class="number">1</span>]</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pieEcho = <span class="title function_">pie</span>(database)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /—— 半径设置 arc</span></span><br><span class="line"><span class="comment">    /———— 外半径 outerRadius</span></span><br><span class="line"><span class="comment">    /———— 内半径 innerRadius(为区分这里设置200,饼状图应该设置为0)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> outerRadius = padding.<span class="property">width</span> / <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> innerRadius = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arc = d3.<span class="property">svg</span>.<span class="title function_">arc</span>()</span><br><span class="line">    .<span class="title function_">innerRadius</span>(innerRadius)</span><br><span class="line">    .<span class="title function_">outerRadius</span>(outerRadius)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置颜色 */</span></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20c</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 为对应数据添加弧的基本位置 */</span></span><br><span class="line"><span class="keyword">var</span> arcs = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(pieEcho)  <span class="comment">/* 绑定计算后的数据 */</span></span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,</span><br><span class="line">        <span class="string">&quot;translate(&quot;</span> + (padding.<span class="property">width</span> /<span class="number">2</span>) +<span class="string">&quot;,&quot;</span> + (padding.<span class="property">height</span> /<span class="number">2</span>) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加路径元素 */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(i)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">arc</span>(d)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /—— 文字</span></span><br><span class="line"><span class="comment">    /———— 问别定义文文字的xy坐标</span></span><br><span class="line"><span class="comment">    /———— 计算出数据的百分比</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> x = arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">var</span> y = arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;)&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;text-anchor&quot;</span>,<span class="string">&quot;middle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;white&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> percent = <span class="title class_">Number</span>(d.<span class="property">value</span>)/d3.<span class="title function_">sum</span>(database, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d[<span class="number">1</span>]</span><br><span class="line">        &#125;) * <span class="number">100</span></span><br><span class="line">        <span class="keyword">return</span> percent.<span class="title function_">toFixed</span>(<span class="number">1</span>) + <span class="string">&quot;%&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    外部文字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;stroke&quot;</span>,<span class="string">&quot;black&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x1&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>] * <span class="number">2.3</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y1&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>] * <span class="number">2.3</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x2&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>] * <span class="number">2.2</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y2&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>] * <span class="number">2.2</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> x = arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>] * <span class="number">2.5</span></span><br><span class="line">        <span class="keyword">var</span> y = arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>] * <span class="number">2.5</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;)&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;text-anchor&quot;</span>,<span class="string">&quot;middle&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">data</span>[<span class="number">0</span>]</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="增加交互"><a href="#增加交互" class="headerlink" title="增加交互"></a>增加交互</h2><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210414104706.png"><br>在下述的 code 中，我们主要通过<code>getPixelLength</code>以及分别定义两个连接弧文字直线，将直线变得斜上一点，之后通过使用d3所提供的<code>behavior</code>增加鼠标的交互。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 样式 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 饼布图数据 */</span></span><br><span class="line"><span class="keyword">var</span> database = [</span><br><span class="line">    [<span class="string">&quot;2015&quot;</span>,<span class="number">1000</span>],</span><br><span class="line">    [<span class="string">&quot;2016&quot;</span>,<span class="number">2000</span>],</span><br><span class="line">    [<span class="string">&quot;2017&quot;</span>,<span class="number">3000</span>],</span><br><span class="line">    [<span class="string">&quot;2018&quot;</span>,<span class="number">4000</span>],</span><br><span class="line">    [<span class="string">&quot;2019&quot;</span>,<span class="number">5000</span>],</span><br><span class="line">    [<span class="string">&quot;2020&quot;</span>,<span class="number">6000</span>],</span><br><span class="line">    [<span class="string">&quot;2021&quot;</span>,<span class="number">7000</span>]</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /- 值访问器 function</span></span><br><span class="line"><span class="comment">    /——— 输出经过布局计算出的值 pie(databases)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> pie = d3.<span class="property">layout</span>.<span class="title function_">pie</span>()</span><br><span class="line">    .<span class="title function_">value</span>(<span class="keyword">function</span>(<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d[<span class="number">1</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> pieEcho = <span class="title function_">pie</span>(database)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /—— 半径设置 arc</span></span><br><span class="line"><span class="comment">    /———— 外半径 outerRadius</span></span><br><span class="line"><span class="comment">    /———— 内半径 innerRadius(为区分这里设置200,饼状图应该设置为0)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> outerRadius = padding.<span class="property">width</span> / <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> innerRadius = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> arc = d3.<span class="property">svg</span>.<span class="title function_">arc</span>()</span><br><span class="line">    .<span class="title function_">innerRadius</span>(innerRadius)</span><br><span class="line">    .<span class="title function_">outerRadius</span>(outerRadius)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 设置颜色 */</span></span><br><span class="line"><span class="keyword">var</span> color = d3.<span class="property">scale</span>.<span class="title function_">category20c</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 为对应数据添加弧的基本位置 */</span></span><br><span class="line"><span class="keyword">var</span> arcs = svg.<span class="title function_">selectAll</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">data</span>(pieEcho)  <span class="comment">/* 绑定计算后的数据 */</span></span><br><span class="line">    .<span class="title function_">enter</span>()</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,</span><br><span class="line">        <span class="string">&quot;translate(&quot;</span> + (padding.<span class="property">width</span> /<span class="number">2</span>) +<span class="string">&quot;,&quot;</span> + (padding.<span class="property">height</span> /<span class="number">2</span>) + <span class="string">&quot;)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加路径元素 */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;path&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="keyword">function</span>(<span class="params">d,i</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">color</span>(i)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;d&quot;</span>,<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">arc</span>(d)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /—— 文字</span></span><br><span class="line"><span class="comment">    /———— 问别定义文文字的xy坐标</span></span><br><span class="line"><span class="comment">    /———— 计算出数据的百分比</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> x = arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">var</span> y = arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;)&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;text-anchor&quot;</span>,<span class="string">&quot;middle&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;white&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> percent = <span class="title class_">Number</span>(d.<span class="property">value</span>)/d3.<span class="title function_">sum</span>(database, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> d[<span class="number">1</span>]</span><br><span class="line">        &#125;) * <span class="number">100</span></span><br><span class="line">        <span class="keyword">return</span> percent.<span class="title function_">toFixed</span>(<span class="number">1</span>) + <span class="string">&quot;%&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    外部文字</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> fontsize = <span class="number">14</span></span><br><span class="line"></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;stroke&quot;</span>,<span class="string">&quot;black&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x1&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>] * <span class="number">2</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y1&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>] * <span class="number">2</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x2&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>] * <span class="number">2.2</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y2&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>] * <span class="number">2.2</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    分别定义两个连接弧文字直线</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;line&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;stroke&quot;</span>,<span class="string">&quot;black&quot;</span>)</span><br><span class="line">    .<span class="title function_">each</span>(<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">        d.<span class="property">textLine</span> = &#123;<span class="attr">x1</span>:<span class="number">0</span>, <span class="attr">y1</span>:<span class="number">0</span>, <span class="attr">x2</span>:<span class="number">0</span>, <span class="attr">y2</span>:<span class="number">0</span>&#125;;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x1&quot;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">        d.<span class="property">textLine</span>.<span class="property">x1</span> = arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>] * <span class="number">2.2</span>;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">textLine</span>.<span class="property">x1</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y1&quot;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">        d.<span class="property">textLine</span>.<span class="property">y1</span> = arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>] * <span class="number">2.2</span>;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">textLine</span>.<span class="property">y1</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x2&quot;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> strLen = <span class="title function_">getPixelLength</span>(d.<span class="property">data</span>[<span class="number">0</span>],fontsize) * <span class="number">1.5</span>;</span><br><span class="line">        <span class="keyword">var</span> bx = arc.<span class="title function_">centroid</span>(d)[<span class="number">0</span>] * <span class="number">2.2</span>;</span><br><span class="line">        d.<span class="property">textLine</span>.<span class="property">x2</span> =	bx &gt;= <span class="number">0</span> ? bx + strLen : bx - strLen;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">textLine</span>.<span class="property">x2</span>;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y2&quot;</span>,<span class="keyword">function</span>(<span class="params">d</span>)&#123;</span><br><span class="line">        d.<span class="property">textLine</span>.<span class="property">y2</span> =	arc.<span class="title function_">centroid</span>(d)[<span class="number">1</span>] * <span class="number">2.2</span>;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">textLine</span>.<span class="property">y2</span>;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">arcs.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> x = <span class="number">0</span></span><br><span class="line">        <span class="keyword">var</span> y = <span class="number">0</span></span><br><span class="line">        x = (d.<span class="property">textLine</span>.<span class="property">x1</span> + d.<span class="property">textLine</span>.<span class="property">x2</span>) /<span class="number">2</span></span><br><span class="line">        y = d.<span class="property">textLine</span>.<span class="property">y1</span></span><br><span class="line">        y = y &gt; <span class="number">0</span> ? y + fontsize * <span class="number">1.1</span> : y - fontsize * <span class="number">0.4</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;translate(&quot;</span> + x + <span class="string">&quot;,&quot;</span> + y + <span class="string">&quot;)&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;text-anchor&quot;</span>,<span class="string">&quot;middle&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;font-size&quot;</span>,fontsize)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> d.<span class="property">data</span>[<span class="number">0</span>]</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    添加提示</span></span><br><span class="line"><span class="comment">    默认的情况下透明度为 0，</span></span><br><span class="line"><span class="comment">    当鼠标经过的时候将透明度设置为 0.9</span></span><br><span class="line"><span class="comment">    移出时设在将透明度设置为0</span></span><br><span class="line"><span class="comment">    当鼠标移动的时候，计算出当前所在位置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> givecuo = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;div&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;style&quot;</span>)</span><br><span class="line">    .<span class="title function_">style</span>(<span class="string">&quot;opacity&quot;</span>,<span class="number">0.0</span>)</span><br><span class="line"></span><br><span class="line">arcs.<span class="title function_">on</span>(<span class="string">&quot;mouseover&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">    givecuo.<span class="title function_">html</span>(d.<span class="property">data</span>[<span class="number">0</span>] + <span class="string">&quot;当前数据为&quot;</span> + <span class="string">&quot;&lt;br/&gt;&quot;</span> + d.<span class="property">data</span>[<span class="number">1</span>] + <span class="string">&quot;%&quot;</span>)</span><br><span class="line">        .<span class="title function_">style</span>(<span class="string">&quot;left&quot;</span>, (d3.<span class="property">event</span>.<span class="property">pageX</span>) + <span class="string">&quot;px&quot;</span>)</span><br><span class="line">        .<span class="title function_">style</span>(<span class="string">&quot;top&quot;</span>, (d3.<span class="property">event</span>.<span class="property">pageY</span> + <span class="number">20</span>) + <span class="string">&quot;px&quot;</span>)</span><br><span class="line">        .<span class="title function_">style</span>(<span class="string">&quot;opacity&quot;</span>,<span class="number">0.9</span>)</span><br><span class="line">&#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mousemove&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        givecuo.<span class="title function_">style</span>(<span class="string">&quot;left&quot;</span>, (d3.<span class="property">event</span>.<span class="property">pageX</span>) + <span class="string">&quot;px&quot;</span>)</span><br><span class="line">            .<span class="title function_">style</span>(<span class="string">&quot;top&quot;</span>, (d3.<span class="property">event</span>.<span class="property">pageY</span> + <span class="number">20</span>) + <span class="string">&quot;px&quot;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">on</span>(<span class="string">&quot;mouseout&quot;</span>, <span class="keyword">function</span> (<span class="params">d</span>) &#123;</span><br><span class="line">        givecuo.<span class="title function_">style</span>(<span class="string">&quot;opacity&quot;</span>,<span class="number">0.0</span>)</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    将直线稍微斜一点</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">getPixelLength</span>(<span class="params">str,fontsize</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> curLen = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;str.<span class="property">length</span>;i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> code = str.<span class="title function_">charCodeAt</span>(i)</span><br><span class="line">        <span class="keyword">var</span> pixelLen = code &gt; <span class="number">255</span> ? fontsize : fontsize / <span class="number">2</span></span><br><span class="line">        curLen += pixelLen</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> curLen</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>css</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.style</span> &#123;</span><br><span class="line">  <span class="attribute">font-family</span>: simsun;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">120px</span>;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">background-color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/javascript/d3/21.D3 布局/">D3 布局</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p>布局(<code>layout</code>)是 D3 中最为重要的概念之一，其中他的作用就是进行一个<code>数据的转换</code>，以及进行分别进行<code>计算图形的位置和形状</code>的关系，他总共提供了<code>饼布局、力布局、弦布局、树布局、捆布局、直方布局、矩阵树布局</code>等<strong>七种常用布局</strong>：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
</tr>
</thead>
<tbody><tr>
<td>饼布图(Pie)</td>
<td>饼布图主要用于方便<code>计算</code>出饼图或圈内的<code>弧线</code>开始和结束的角度，如果没有 Layout，那通过 <code>弧生成器</code>也可以实现，但通过饼布图会更加的方便且更加<strong>智能</strong></td>
</tr>
<tr>
<td>力布图 (Force)</td>
<td>通过<code>物理模拟</code>的方式将力导向图更加灵活的实现位置的简单控制</td>
</tr>
<tr>
<td>弦布图（Chord）</td>
<td>弦图所示的内容为一组<code>实体或数据</code>之间的关系，并通过使用不同的弧线之间画出<code>二次被塞尔曲线</code>，将关系表述在一张弦图中</td>
</tr>
<tr>
<td>树布图（Tree）</td>
<td>树布图主要通过使用<code>莱因戈尔德-蒂尔福德</code>算法来产生一个简洁的<code>树状节点</code>，来展示层级结构</td>
</tr>
<tr>
<td>捆布图（Bundle）</td>
<td>通过使用<code>丹尼-霍尔登</code>分层捆图的实现，将每个输入的连接来计算出一条路径，然后路径分别被不同的路径穿过，也就是说捆布图的主要作用就是<strong>计算链接路径</strong></td>
</tr>
<tr>
<td>直方布局（Histogram）</td>
<td>直方布图主要用于展示数据分布</td>
</tr>
<tr>
<td>矩形树布局（Treemap）</td>
<td>矩形树布局由<code>Ben Shneiderman</code>在1991年提出，将一块矩形区域进行切割多次，来达到层级的效果</td>
</tr>
</tbody></table>
<p>还有一种在 D3 极为不同的布局就是 <code>层次布局</code>，层次布局也被称之为<code>分层布局</code>，他是一种抽象的布局，不可以直接进行使用，<strong>但是他允许在不同的分层布局中共享节点</strong>，以他为中心分出了：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
</tr>
</thead>
<tbody><tr>
<td>Cluster</td>
<td>簇实体构成的树状图</td>
</tr>
<tr>
<td>Pack</td>
<td>使用递归圆填充法来创建一个分层布局</td>
</tr>
<tr>
<td>Partition</td>
<td>将节点树递归划分成分辐射状或环状</td>
</tr>
<tr>
<td>Tree</td>
<td>将节点树整体放置</td>
</tr>
<tr>
<td>Treemap</td>
<td>使用递归空间划分显示节点树（虽然他不是分层布局，但捆绑布局可以同分层布局<strong>共同使用</strong>）</td>
</tr>
</tbody></table>

	

	

</article>




	<article>
	
		<h1><a href="/2022/04/21/javascript/d3/20.D3 transition/">D3 transition</a></h1>
	
	<div class="article__infos">
		<span class="article__date">2022-04-21</span><br />
		
		
			<span class="article__tags">
			  	<a class="article__tag-none-link" href="/tags/d3-v3/" rel="tag">d3 v3</a> <a class="article__tag-none-link" href="/tags/javascript/" rel="tag">javascript</a> <a class="article__tag-none-link" href="/tags/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="tag">数据可视化</a>
			</span>
		
	</div>

	

	
		<p>过渡（<code>excessive</code>），主要用于进行视觉效果的交互，让原有生动的数据变得更加活跃，通常在前端图标中较为应用，而其学术图标仅针对静态数据的展示效果。</p>
<h2 id="transition"><a href="#transition" class="headerlink" title="transition"></a>transition</h2><p>在 d3 中创建过度主要需要通过<code>d3.transition</code>以及 <code>selection.transition</code>，他们都可以返回一个过度的效果，他们两个的区别在于<code>d3.transtion</code>主要用于<strong>直接创建一个对象，然后在指定一个作用对象</strong>，而<code>selection.transtion</code>是<strong>通过作用对象创建过渡</strong>，简单的就是一个是<strong>选择集对象</strong>，而另一个就是<strong>过度对象</strong>：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>d3.transition([选择],[名称])</td>
<td>创建一个过度对象</td>
<td></td>
</tr>
<tr>
<td>transition.delay([延迟])</td>
<td>设置一个过度的延迟时间，单位是<code>ms</code> (默认的延迟时间为 <code>0ms</code>)</td>
<td></td>
</tr>
<tr>
<td>transtion.duration([持续时间])</td>
<td>设置过度的持续时间，单位是<code>ms</code> （默认的持续时间为<code>250ms</code>）</td>
<td></td>
</tr>
<tr>
<td>transtion.ease()</td>
<td>创建一个过度的样式</td>
<td></td>
</tr>
<tr>
<td></td>
<td>linear</td>
<td>线性缓动</td>
</tr>
<tr>
<td></td>
<td>polynomial</td>
<td>多项式缓动</td>
</tr>
<tr>
<td></td>
<td>quadratic</td>
<td>二次缓动</td>
</tr>
<tr>
<td></td>
<td>cubic</td>
<td>三次缓动</td>
</tr>
<tr>
<td></td>
<td>sinusoidal</td>
<td>正弦缓动</td>
</tr>
<tr>
<td></td>
<td>exponential</td>
<td>指数缓动</td>
</tr>
<tr>
<td></td>
<td>back</td>
<td>回缩后冲击终点</td>
</tr>
<tr>
<td></td>
<td>circular</td>
<td>环形缓动</td>
</tr>
<tr>
<td></td>
<td>circular</td>
<td>缓动效果</td>
</tr>
<tr>
<td></td>
<td>elastic</td>
<td>震荡缓动，就像是类似于震荡的橡皮筋一样</td>
</tr>
<tr>
<td></td>
<td>bounce</td>
<td>弹跳缓动，像是一个橡皮球一样</td>
</tr>
</tbody></table>
<h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><h4 id="d3-transition"><a href="#d3-transition" class="headerlink" title="d3.transition"></a>d3.transition</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210406100707.png"></p>
<p>在下述的 code 中我们主要使用<code>d3.transtion</code>方法来进行添加一个过渡效果，通过使用过渡效果可以将宽度为<code>100</code>的矩形过渡为宽度<code>500</code>且效果非常的丝滑。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">svg.<span class="title function_">append</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;blue&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>,<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>,<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,<span class="number">100</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,<span class="number">30</span>)</span><br><span class="line">    .<span class="title function_">transition</span>()</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,<span class="number">500</span>)</span><br></pre></td></tr></table></figure>

<h4 id="selection-transition"><a href="#selection-transition" class="headerlink" title="selection.transition"></a>selection.transition</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210406100717.png"><br>在上图中，我们通过使用<code>selection.transtion</code>即<strong>选择集对象</strong>来实现过渡的<code>delay、duration、ease</code>即延迟、持续时间以及震荡过渡样式等效果的实现，<strong>需要注意的是 transition可以被多次的调用</strong>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rect = svg.<span class="title function_">append</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;blue&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>,<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>,<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,<span class="number">100</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /- 选择了 rect 函数，从而创建一个过度对象</span></span><br><span class="line"><span class="comment">    /-- 设置延迟时间 @delay 为 1000，即 1s</span></span><br><span class="line"><span class="comment">    /-- 设置持续时间 @duration 为 10s</span></span><br><span class="line"><span class="comment">    /-- 指定过度样式 @ease 为 elastic即震荡缓动</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> rectTran = rect.<span class="title function_">transition</span>()</span><br><span class="line">    .<span class="title function_">delay</span>(<span class="number">1000</span>)</span><br><span class="line">    .<span class="title function_">duration</span>(<span class="number">10000</span>)</span><br><span class="line">    .<span class="title function_">ease</span>(<span class="string">&quot;elastic&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,<span class="number">500</span>)</span><br></pre></td></tr></table></figure>

<h3 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h3><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210406155300.png"><br>通常为了满足部分开发者的变态心里，D3 为此提供了图表的过度属性，主要有两个，分别我为<code>transition.attr</code>以及<code>transition.attrTween</code>两个过度效果，通常<code>transition.attr</code>最为常用，而<code>transition.attrTween</code>则是可以<strong>手动设置插值函数</strong>，虽然他属性变化的中间值是默认插值函数计算，但通过使用<code>transition.attrTween</code>则可以手动设置插值函数：</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>DA</th>
<th>FA</th>
</tr>
</thead>
<tbody><tr>
<td>transition.attr(name,value)</td>
<td>将属性<code>name</code>过度到目标值</td>
<td></td>
</tr>
<tr>
<td>transition.attrTween(name,tween)</td>
<td>将<code>name</code>使用插值函数<code>tween</code>进行过度</td>
<td></td>
</tr>
<tr>
<td></td>
<td>linear<code>-in</code></td>
<td>按照正方向运动</td>
</tr>
<tr>
<td></td>
<td>linear<code>-out</code></td>
<td>按照反向运动</td>
</tr>
<tr>
<td></td>
<td>linear<code>-in-out</code></td>
<td>前半段用<code>正方向</code>运动，后半段有那个<code>反方向</code>运动</td>
</tr>
<tr>
<td></td>
<td>linear<code>-out-in</code></td>
<td>前半段用<code>反方向</code>运动，后半段用<code>正方向</code>运动 (除了<code>linear</code>过渡样式可用之外，也可以用于其他的过渡样式)</td>
</tr>
</tbody></table>
<h4 id="transition-attr"><a href="#transition-attr" class="headerlink" title="transition.attr"></a>transition.attr</h4><p>在下述的 code 中，我们通过使用<code>selection.transtion</code>即<strong>选择集对象</strong>来实现过渡的<code>delay、duration、ease</code>即延迟、持续时间以及震荡过渡样式等效果的实现。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rect = svg.<span class="title function_">append</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;blue&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>,<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>,<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,<span class="number">100</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    /- 选择了 rect 函数，从而创建一个过度对象</span></span><br><span class="line"><span class="comment">    /-- 设置延迟时间 @delay 为 1000，即 1s</span></span><br><span class="line"><span class="comment">    /-- 设置持续时间 @duration 为 10s</span></span><br><span class="line"><span class="comment">    /-- 指定过度样式 @ease 为 elastic即震荡缓动</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> rectTran = rect.<span class="title function_">transition</span>()</span><br><span class="line">    .<span class="title function_">delay</span>(<span class="number">1000</span>)</span><br><span class="line">    .<span class="title function_">duration</span>(<span class="number">10000</span>)</span><br><span class="line">    .<span class="title function_">ease</span>(<span class="string">&quot;elastic&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,<span class="number">500</span>)   </span><br></pre></td></tr></table></figure>
<h4 id="transition-attrTween"><a href="#transition-attrTween" class="headerlink" title="transition.attrTween"></a>transition.attrTween</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210406155335.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 数据 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">900</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">900</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 矩形与函数过度 */</span></span><br><span class="line"><span class="keyword">var</span> rect = svg.<span class="title function_">append</span>(<span class="string">&quot;rect&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;blue&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>,<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>,<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,<span class="number">100</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,<span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rectTran = rect.<span class="title function_">transition</span>()</span><br><span class="line">    .<span class="title function_">duration</span>(<span class="number">1500</span>)</span><br><span class="line">    .<span class="title function_">attrTween</span>(<span class="string">&quot;width&quot;</span>,</span><br><span class="line">        <span class="keyword">function</span>(<span class="params">d, i, a</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title class_">Number</span>(a) + t * <span class="number">500</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    .<span class="title function_">ease</span>(<span class="string">&quot;elastic-in-out&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;red&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 文字与文字过度 */</span></span><br><span class="line"><span class="keyword">var</span> text = svg.<span class="title function_">append</span>(<span class="string">&quot;text&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;blue&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>,<span class="number">150</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;y&quot;</span>,<span class="number">10</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;dy&quot;</span>,<span class="string">&quot;1.2em&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;text-anchor&quot;</span>,<span class="string">&quot;end&quot;</span>)</span><br><span class="line">    .<span class="title function_">text</span>(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> initx = text.<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> initText = text.<span class="title function_">text</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> textTran = text.<span class="title function_">transition</span>()</span><br><span class="line">    .<span class="title function_">duration</span>(<span class="number">1500</span>)</span><br><span class="line">    .<span class="title function_">tween</span>(<span class="string">&quot;text&quot;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            d3.<span class="title function_">select</span>(<span class="variable language_">this</span>)</span><br><span class="line">                .<span class="title function_">attr</span>(<span class="string">&quot;x&quot;</span>,<span class="title class_">Number</span>(initx) + t * <span class="number">500</span>)</span><br><span class="line">                .<span class="title function_">text</span>(<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Number</span>(initText) + t * <span class="number">500</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    .<span class="title function_">ease</span>(<span class="string">&quot;elastic-in-out&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;fill&quot;</span>,<span class="string">&quot;red&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>在上述 code 中 ：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.<span class="title function_">attrTween</span>(<span class="string">&quot;width&quot;</span>,</span><br><span class="line">    <span class="keyword">function</span>(<span class="params">d, i, a</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">function</span>(<span class="params">t</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title class_">Number</span>(a) + t * <span class="number">500</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
<p>其中我们使用了<code>attrTween</code>来手动设置中间值默认的插值函数，<code>function (d,i,a</code>分别代表<strong>数据、索引、属性</strong>等三种信息，其中<code>a</code>是<code>width</code>是一个初始值。而<code>return function(t)</code>所返回的<code>t</code>则是<strong>插值函数</strong>，他的范围是<code>0,1</code>，分别代表了<strong>开始、结束</strong>，所以当<code>t</code>处于<code>0</code>时，<code>function(t)</code>返回<code>100</code>，但是当<code>t</code>返回<code>1</code>时，<code>function(t)</code>将会返回<code>500</code>来表述过渡结束。</p>
<h4 id="axis"><a href="#axis" class="headerlink" title="axis"></a>axis</h4><p><img src="https://49812933408852955071488026628034-1301075051.cos.ap-nanjing.myqcloud.com/20210406231822.png"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 基本 svg 样式 */</span></span><br><span class="line"><span class="keyword">var</span> padding = &#123;</span><br><span class="line">    <span class="attr">width</span>: <span class="number">800</span>,</span><br><span class="line">    <span class="attr">height</span>: <span class="number">800</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> svg = d3.<span class="title function_">select</span>(<span class="string">&quot;body&quot;</span>)</span><br><span class="line">    .<span class="title function_">append</span>(<span class="string">&quot;svg&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;width&quot;</span>,padding.<span class="property">width</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;height&quot;</span>,padding.<span class="property">height</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 线性比例尺 */</span></span><br><span class="line"><span class="keyword">var</span> xScale = d3.<span class="property">scale</span>.<span class="title function_">linear</span>()</span><br><span class="line">    .<span class="title function_">domain</span>([<span class="number">0</span>,<span class="number">100</span>])</span><br><span class="line">    .<span class="title function_">range</span>([<span class="number">0</span>,<span class="number">500</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 坐标轴 */</span></span><br><span class="line"><span class="keyword">var</span> xAxis = d3.<span class="property">svg</span>.<span class="title function_">axis</span>()</span><br><span class="line">    .<span class="title function_">scale</span>(xScale)</span><br><span class="line">    .<span class="title function_">orient</span>(<span class="string">&quot;bottom&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加方法 g 绑定 xAxis 坐标轴 */</span></span><br><span class="line"><span class="keyword">var</span> g = svg.<span class="title function_">append</span>(<span class="string">&quot;g&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>,<span class="string">&quot;axis&quot;</span>)</span><br><span class="line">    .<span class="title function_">attr</span>(<span class="string">&quot;transform&quot;</span>,<span class="string">&quot;translate(50,400)&quot;</span>)</span><br><span class="line">    .<span class="title function_">call</span>(xAxis)</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 添加过渡 */</span></span><br><span class="line">xScale.<span class="title function_">domain</span>([<span class="number">0</span>,<span class="number">10</span>])</span><br><span class="line">g.<span class="title function_">transition</span>()</span><br><span class="line">    .<span class="title function_">duration</span>(<span class="number">2000</span>)</span><br><span class="line">    .<span class="title function_">call</span>(xAxis)</span><br></pre></td></tr></table></figure>
	

	

</article>





	<span class="different-posts">📖 <a href="/page/9">more posts</a> 📖</span>



	</main>

	<footer class="footer">
	<div class="footer-content">
		
	      <div class="footer__element">
	<p>欢迎来到我的 blog <br><br> 通过 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>+<a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a> 进行构建的，存放在 <a target="_blank" rel="noopener" href="https://github.com/vendanges/vendanges.github.io">Github</a> 上。</p>
</div>

	    
	      <div class="footer__element">
	<h5>Check out</h5>
	<ul class="footer-links">
		<li class="footer-links__link"><a href="/archives">Archive</a></li>
		
		  <li class="footer-links__link"><a href="/atom.xml">RSS</a></li>
	    
		<li class="footer-links__link"><a href="/about">about page</a></li>
		<li class="footer-links__link"><a href="/tags">Tags</a></li>
		<li class="footer-links__link"><a href="/categories">Categories</a></li>
	</ul>
</div>

	    

		<div class="footer-credit">
			<span>© 2022 John Doe | Powered by <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> | Theme <a target="_blank" rel="noopener" href="https://github.com/HoverBaum/meilidu-hexo">MeiliDu</a></span>
		</div>

	</div>


</footer>



</body>

</html>
